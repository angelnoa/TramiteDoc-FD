/*
 * Created on 27/11/2007
 *
 * TODO To change the template for this generated file go to
 * Window - Preferences - Java - Code Style - Code Templates
 */
package tramitedoc.concytec.dao.sql;
import java.net.InetAddress;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.Time;
import java.sql.Timestamp;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.GregorianCalendar;
import java.util.HashMap;
import java.util.Hashtable;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.json.simple.JSONObject;
import org.omg.CORBA.Current;

import tramitedoc.concytec.bean.AConexion;
import tramitedoc.concytec.bean.BArchivo;
import tramitedoc.concytec.bean.BCodPadre;
import tramitedoc.concytec.bean.BCorrelativos;
import tramitedoc.concytec.bean.BDatosFirmante;
import tramitedoc.concytec.bean.BDocumento;
import tramitedoc.concytec.bean.BFondo;
import tramitedoc.concytec.bean.BInfoListaObservacion;
import tramitedoc.concytec.bean.BInfoListaReiterativo;
import tramitedoc.concytec.bean.BMedio;
import tramitedoc.concytec.bean.BMesaPartes;
import tramitedoc.concytec.bean.BModalidad;
import tramitedoc.concytec.bean.BMotivo;
import tramitedoc.concytec.bean.BOficinas;
import tramitedoc.concytec.bean.BPersona;
import tramitedoc.concytec.bean.BPersonal;
import tramitedoc.concytec.bean.BRuta;
import tramitedoc.concytec.bean.BSerie;
import tramitedoc.concytec.bean.BSolicitud;
import tramitedoc.concytec.bean.BTipoDocumento;
import tramitedoc.concytec.bean.BUsuario;
import tramitedoc.concytec.bean.EstandarBean;
import tramitedoc.concytec.dao.interfaces.DocumentosInternosService;
import tramitedoc.concytec.dao.interfaces.IUsuarioDAO;
import tramitedoc.concytec.form.FFormMantArchivar;
import tramitedoc.concytec.form.FFormMantDerivar;
import tramitedoc.concytec.form.FFormMantRecepcion;
import tramitedoc.concytec.service.DocumentosInternosServiceImplement;
import tramitedoc.concytec.util.Funciones;
import tramitedoc.concytec.util.IConstante;
import tramitedoc.concytec.util.ObtieneConexion;

/**
 * @author Administrador
 *
 * TODO To change the template for this generated type comment go to
 * Window - Preferences - Java - Code Style - Code Templates
 */
public class SqlUsuarioDAO implements IUsuarioDAO,IConstante{
	
	protected  Log log = LogFactory.getLog(SqlUsuarioDAO.class);
	
	public List<BUsuario> listar() {
		ObtieneConexion x = new ObtieneConexion();
		Connection cn = x.getConnection();

        ArrayList<BUsuario> usuarios = new ArrayList<BUsuario>();
        
        try {

            String sql = "select  usuario, clave, estado, perfil, flag, nombres, apellidos, email, dni, sede  from tramite.usuarios;";
            PreparedStatement ps = cn.prepareStatement(sql);
            System.out.println(ps);
            ResultSet rs = ps.executeQuery();

            while (rs.next()) {

            	BUsuario usuario = new BUsuario();
                
            	usuario.setUsuario(rs.getString(1));
            	usuario.setClave(rs.getString(2));
            	usuario.setEstado(rs.getString(3));
            	usuario.setPerfil(rs.getString(4));
            	usuario.setFlag(rs.getString(5));
            	usuario.setNombre_personal(rs.getString(6));
            	usuario.setApellidos(rs.getString(7));
            	usuario.setEmail(rs.getString(8));
            	usuario.setDni(rs.getString(9));
            	usuario.setSede(rs.getString(10));
            	
            	usuarios.add(usuario);
                
            }
            
            ps.close();
            x.cerrar_conexion(cn,rs);
            
        } catch (SQLException ex) {
            System.out.println("ERROR LISTAR USUARIOS: " + ex.getMessage());
        } 
        return usuarios;	
	}
	
	public Collection  of_lista_oficinas_jefes(Connection cnx,String codigo_oficina) throws Exception {
		
        //log.info("ENTRO A  Lista de oficinas");
		Collection ListaOficinas = new ArrayList();
		
		BOficinas BOficinasVO = null;
		Statement us  = null;
		ResultSet rs = null;
       
        try {	
        	String ls_sql ="";
        	
        	   ls_sql = "select codigo_oficina,descripcion_oficina,nombre_corto,siglas_oficina " +
        			"from tramite.oficinas where grupo_oficina = ( " +
        			"select grupo_oficina from tramite.oficinas where codigo_oficina='"+codigo_oficina+"') " +
        			"order by orden asc";
        	
	    	us = cnx.createStatement();
    		rs = us.executeQuery(ls_sql);
    		
			while ( rs.next() ) { 
				
				BOficinasVO = new BOficinas();
				
				BOficinasVO.setCodigo_oficina(rs.getString("codigo_oficina"));
				BOficinasVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
				BOficinasVO.setNombre_corto(rs.getString("nombre_corto"));
				BOficinasVO.setSiglas_oficina(rs.getString("siglas_oficina"));
				
				
				ListaOficinas.add(BOficinasVO);

			}	
            
			rs.close();
			
            
        } catch (SQLException e) {
             e.printStackTrace();
        }
        return ListaOficinas;
	                
	}
	 public Collection  of_lista_oficinas_usuario(Connection cnx,String usuario) throws Exception {
		
       // //log.info("ENTRO A  Lista de Oficinas por Usuario");
		Collection OficinasUsuario = new ArrayList();
		
		BUsuario BUsuarioVO = null;
		Statement us  = null;
		ResultSet rs = null;
       
		 
        try {	
        	
        
        	String ls_sql = "SELECT DISTINCT of.codigo_oficina as codigo_oficina,of.descripcion_oficina as descripcion_oficina,per.c_usuario as c_usuario," +
        			"per.codigo_personal as codigo_personal FROM tramite.oficinas of, tramite.personal per WHERE of.codigo_oficina" +
        			" = per.codigo_oficina  and  per.c_usuario = " + "'" + usuario + "'" + " AND  of.es_activo = 'A'";
        	log.info("El s_sql"+ ls_sql);
        	
	    	us = cnx.createStatement();
	    	////log.info("El us"+ us);
    		rs = us.executeQuery(ls_sql);
    		////log.info("El rs"+ rs);
			while ( rs.next() ) { 
				////log.info("Dentro del Resultset");
				BUsuarioVO = new BUsuario();
				////log.info("Despues del Bean");
				BUsuarioVO.setCodigo_oficina(rs.getString("codigo_oficina"));
				BUsuarioVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
				BUsuarioVO.setC_usuario(rs.getString("c_usuario"));
				BUsuarioVO.setCodigo_personal(rs.getString("codigo_personal"));
				
				OficinasUsuario.add(BUsuarioVO);
			}	
            
			rs.close();
			
            
        } catch (SQLException e) {
             e.printStackTrace();
        }
        return OficinasUsuario;
	                
	}
	 
	 public Collection  of_lista_series(Connection cnx,String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Series");
			Collection ListaSeries = new ArrayList();
			
			BSerie BSerieVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "select codigo_serie,descripcion_serie from tramite.serie_documental sd where" +
	        			" sd.codigo_oficina=" + "'" + oficina + "'" + "  order by sd.descripcion_serie asc";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					BSerieVO = new BSerie();
					BSerieVO.setCodigo_serie(rs.getString("codigo_serie"));
					BSerieVO.setDescripcion_serie(rs.getString("descripcion_serie"));
					
					ListaSeries.add(BSerieVO);

				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaSeries;
		                
		}
	 
	 public Collection  of_listar_medios(Connection cnx) throws Exception {
			
	        //log.info("ENTRO A  Lista de Medios");
			Collection ListaSeries = new ArrayList();
			
			BMedio BMedioVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "select * from tramite.medio order by codigo_medio asc";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					BMedioVO = new BMedio();
					BMedioVO.setId_medio(rs.getInt("id_medio"));
					BMedioVO.setCodigo_medio(rs.getString("codigo_medio"));
					BMedioVO.setDescripcion(rs.getString("descripcion"));
					BMedioVO.setEstado(rs.getString("estado"));
					
					ListaSeries.add(BMedioVO);

				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaSeries;
		                
		}
	 
	 public Collection  of_lista_documentos(Connection cnx,String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Documentos");
			Collection ListaDocumentos = new ArrayList();
			
			BTipoDocumento BTipoDocumentoVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "SELECT td.codigo_tipo as codigo_tipo,td.descripcion_tipo as descripcion_tipo,td.es_multiple as es_multiple FROM tramite.correlativos" +
	        			" co,tramite.tipo_documento td WHERE  co.codigo_tipo = td.codigo_tipo  and " +
	        			"co.codigo_oficina = " + "'" + oficina + "'" + " ";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BTipoDocumentoVO = new BTipoDocumento();
					
					BTipoDocumentoVO.setCodigo_tipo(rs.getString("codigo_tipo"));
					BTipoDocumentoVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BTipoDocumentoVO.setEs_multiple(rs.getString("es_multiple"));
					
				
					ListaDocumentos.add(BTipoDocumentoVO);

				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaDocumentos;
		                
		}
	 
	 public Collection  of_lista_tipdoc_todos(Connection cnx) throws Exception {
			
	        //log.info("ENTRO A  Lista de Todos los Documentos");
			Collection ListaTodosDocumentos = new ArrayList();
			
			BTipoDocumento BTipoDocumentoVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "SELECT td.codigo_tipo,td.descripcion_tipo FROM tramite.tipo_documento td order by descripcion_tipo asc";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BTipoDocumentoVO = new BTipoDocumento();
					
					BTipoDocumentoVO.setCodigo_tipo(rs.getString("codigo_tipo"));
					BTipoDocumentoVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					
				
					ListaTodosDocumentos.add(BTipoDocumentoVO);

				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaTodosDocumentos;
		                
		}
	 
	 public BOficinas  of_nombre_oficina(Connection cnx,String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de  oficinas");
			
			
			BOficinas BOficinasVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "select * from tramite.oficinas WHERE " +
	        			"codigo_oficina=" + "'" + oficina + "'" + "";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BOficinasVO = new BOficinas();
					BOficinasVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BOficinasVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
				
				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return BOficinasVO;
		                
		}
	 
	 public BPersonal  of_datos_usuario(Connection cnx,String codpersonal,String codoficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Datos de Usuario");
			Collection ListaDatosUsuario = new ArrayList();
			
			BPersonal BPersonalVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "select pe.nombre_personal,pe.c_usuario,us.clave from tramite.personal pe,tramite.usuarios us " +
	        			"WHERE pe.c_usuario=us.usuario and codigo_personal =" + "'" + codpersonal + "'" + " and codigo_oficina =" + "'" + codoficina + "'" + "";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BPersonalVO = new BPersonal();
					
					BPersonalVO.setNombre_personal(rs.getString("nombre_personal"));
					BPersonalVO.setC_usuario(rs.getString("c_usuario"));
					BPersonalVO.setClave(rs.getString("clave"));
					

				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return BPersonalVO;
		                
		}
	 
	 public Collection  of_lista_personas_oficinas(String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Personas por oficinas");
			Collection ListaPersonasOficinas = new ArrayList();
			
			BPersonal BPersonalVO = null;
			Statement us  = null;
			ResultSet rs = null;
			ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
	        try {	
	        	
	        	String ls_sql = "SELECT pe.nombre_personal,pe.codigo_personal,of.codigo_oficina," +
	        			"us.estado,pe.es_responsable FROM tramite.oficinas of,tramite.personal pe," +
	        			"tramite.usuarios us WHERE pe.codigo_oficina =of.codigo_oficina AND" +
	        			" pe.c_usuario=us.usuario and us.estado = 'A'  AND  pe.validacion=1 " +
	        			"and pe.codigo_oficina = " + "'" + oficina + "'" +
	        			" order by pe.es_responsable desc,pe.nombre_personal asc";
	        	
	        	us = con.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		log.info("El ls_sql es..." + ls_sql);
				while ( rs.next() ) { 
					
					BPersonalVO = new BPersonal();
					
					BPersonalVO.setNombre_personal(rs.getString("nombre_personal"));
					BPersonalVO.setCodigo_personal(rs.getString("codigo_personal"));
					BPersonalVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					
					/*String nombre_personal=rs.getString("nombre_personal");
					String codigo_personal=rs.getString("codigo_personal");
					String codigo_oficina=rs.getString("codigo_oficina");
					*/
					/*log.info("nombre_personal es "+ nombre_personal);
					log.info("codigo_personal es "+ codigo_personal);
					log.info("codigo_oficina es "+ codigo_oficina);
					 */
					ListaPersonasOficinas.add(BPersonalVO);

				}	
	            x.cerrar_conexion(con, rs);
				
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con, rs);
	        }
	        return ListaPersonasOficinas;
		                
		}
	 
	 public String  of_abreviatura(String codigo_personal) throws Exception {
			
	        //log.info("ENTRO A  Lista de Personas por oficinas");
			Collection ListaPersonasOficinas = new ArrayList();
			String abreviatura = "";
			
			BPersonal BPersonalVO = null;
			Statement us  = null;
			ResultSet rs = null;
			ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
	        try {	
	        	
	        	String ls_sql = "select ga.abreviatura from tramite.personal pe, tramite.tbl_grado_academico ga "
	        					+" where pe.id_grado_academico = ga.id_grado_academico "
	        					+" and pe.codigo_personal = '"+codigo_personal+"' ";
	        	
	        	us = con.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		log.info("El ls_sql es..." + ls_sql);
				while ( rs.next() ) { 
					
					abreviatura=rs.getString("abreviatura");
					
				}	
	            x.cerrar_conexion(con, rs);
				
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con, rs);
	        }
	        log.info("Abreviatura -> "+abreviatura);
	        return abreviatura;
		                
		}
	 
	 public Collection  of_lista_modalidad_rutas(String cod_ruta) throws Exception {
			
	        //log.info("ENTRO A  Lista de Modalidades por Ruta");
			Collection ListaModalidadRuta = new ArrayList();
			
			BModalidad BModalidadVO = null;
			Statement us  = null;
			ResultSet rs = null;
			ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
	        try {	
	        	
	        	/*String ls_sql = "SELECT pe.nombre_personal,pe.codigo_personal,of.codigo_oficina FROM" +
	        			" tramite.oficinas of,tramite.personal pe WHERE pe.codigo_oficina =of.codigo_oficina AND" +
	        			" pe.codigo_oficina = " + "'" + oficina + "'" + "";*/
	        	String ls_sql="select md.cod_modalidad,md.cod_ruta,md.nombre_modalidad,md.estado from" +
	        			" tramite.modalidad md,tramite.ruta ru where md.cod_ruta=ru.cod_ruta and" +
	        			" ru.cod_ruta=" + "'" + cod_ruta + "'" + " order by md.cod_modalidad";
	        	
	        	us = con.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		//log.info("El ls_sql es..." + ls_sql);
				while ( rs.next() ) { 
					
					BModalidadVO = new BModalidad();
					
					BModalidadVO.setCod_modalidad(rs.getInt("cod_modalidad"));
					BModalidadVO.setNombre_modalidad(rs.getString("nombre_modalidad"));
					BModalidadVO.setEstado(rs.getString("estado"));
					
		
					/*log.info("nombre_personal es "+ nombre_personal);
					log.info("codigo_personal es "+ codigo_personal);
					log.info("codigo_oficina es "+ codigo_oficina);
					 */
					ListaModalidadRuta.add(BModalidadVO);

				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaModalidadRuta;
		                
		}
	 
	 public Collection  of_lista_oficinas(Connection cnx) throws Exception {
			
	        //log.info("ENTRO A  Lista de oficinas");
			Collection ListaOficinas = new ArrayList();
			
			BOficinas BOficinasVO = null;
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			ResultSet rs = null;
			PreparedStatement pstmt = null;
	       
	        try {	
	        	
	        	String ls_sql = "select codigo_oficina,descripcion_oficina,nombre_corto,siglas_oficina  from  tramite.oficinas order by orden ";
	        	log.info("JM LISTA OFICINA"+ls_sql);
	        	pstmt = con.prepareStatement(ls_sql);
	        	rs=pstmt.executeQuery();
	    		
				while ( rs.next() ) { 
					
					BOficinasVO = new BOficinas();
					
					BOficinasVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BOficinasVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BOficinasVO.setNombre_corto(rs.getString("nombre_corto"));
					BOficinasVO.setSiglas_oficina(rs.getString("siglas_oficina"));
					
					
					ListaOficinas.add(BOficinasVO);

				}	
	            

				x.cerrar_conexion(con,rs);
				pstmt.close();
				
	            
	        } catch (SQLException e) {
	        	x.cerrar_conexion(con);
	             e.printStackTrace();
	        }
	        return ListaOficinas;
		                
		}
	 
	 public Collection  of_lista_oficinas_institucion(String codigo_institucion, boolean valor) throws Exception {
			
	        log.info("ENTRO A  Lista de oficinas");
			Collection ListaOficinas = new ArrayList();
			
			BOficinas BOficinasVO = null;
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			ResultSet rs = null;
			PreparedStatement pstmt = null;
	        
			if(!valor){
				codigo_institucion=(codigo_institucion.equals("2"))? "3":"2";
			}
			log.info("codigo institucion-> "+codigo_institucion);
			
	        try {	
	        	
	        	String ls_sql = "select codigo_oficina,descripcion_oficina,nombre_corto,siglas_oficina,grupo_oficina,padre  from  tramite.oficinas ";
	        	
	        	if(codigo_institucion.equals("2")){
	        		ls_sql=ls_sql+" where grupo_oficina <> 3";
	        	}else{
	        		ls_sql=ls_sql+" where grupo_oficina= 3 ";
	        	}

	        	ls_sql=ls_sql+" order by orden ";
	        	
	        	pstmt = con.prepareStatement(ls_sql);
	        	
	        	log.info("sql-> "+pstmt);
	        	rs=pstmt.executeQuery();
	    		
				while ( rs.next() ) { 
					
					BOficinasVO = new BOficinas();
					
					BOficinasVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BOficinasVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BOficinasVO.setNombre_corto(rs.getString("nombre_corto"));
					BOficinasVO.setSiglas_oficina(rs.getString("siglas_oficina"));
					BOficinasVO.setGrupo_oficina(rs.getInt("grupo_oficina"));
					BOficinasVO.setPadre(rs.getInt("padre"));
					
					ListaOficinas.add(BOficinasVO);

				}	
	            

				x.cerrar_conexion(con,rs);
				pstmt.close();
				
	            
	        } catch (SQLException e) {
	        	x.cerrar_conexion(con);
	             e.printStackTrace();
	        }
	        return ListaOficinas;
		                
		}
	 
	 public String of_es_padre(String ls_codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de oficinas");
						
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			ResultSet rs = null;
			PreparedStatement pstmt = null;
	        int resultado=1;
			
	        try {	
	        	
	        	String ls_sql = "select padre from tramite.oficinas where codigo_oficina="+ls_codigo_oficina;
	        		        		        	
	        	pstmt = con.prepareStatement(ls_sql);
	        	
	        	//log.info("sql-> "+pstmt);
	        	rs=pstmt.executeQuery();
	    		
				while ( rs.next() ) { 
										
					resultado=rs.getInt("padre");
					
				}	
	            
				x.cerrar_conexion(con,rs);
				pstmt.close();
				
	            
	        } catch (SQLException e) {
	        	x.cerrar_conexion(con);
	             e.printStackTrace();
	        }
	        return String.valueOf(resultado);
		                
		}
	 
	 
	 public Collection  of_lista_oficinas_institucion(String codigo_institucion,String grupo_oficina, boolean valor) throws Exception {
			
	        //log.info("ENTRO A  Lista de oficinas");
			Collection ListaOficinas = new ArrayList();
			
			BOficinas BOficinasVO = null;
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			ResultSet rs = null;
			PreparedStatement pstmt = null;
	        int grupo_oficina_entero=Integer.parseInt(grupo_oficina);
			if(!valor){
				codigo_institucion=(codigo_institucion.equals("2"))? "3":"2";
			}
			
			
	        try {	
	        	
	        	String ls_sql = "select codigo_oficina,descripcion_oficina,nombre_corto,siglas_oficina,grupo_oficina,padre  from tramite.oficinas ";
	        	
	        	if(codigo_institucion.equals("2")){
	        		ls_sql=ls_sql+" where grupo_oficina <> 3";
	        	}else{
	        		ls_sql=ls_sql+" where grupo_oficina= 3 ";
	        	}

	        	ls_sql=ls_sql+" and es_activo='A'  order by orden ";
	        	
	        	pstmt = con.prepareStatement(ls_sql);
	        	
	        	log.info("sqlJM-> "+ls_sql);
	        	rs=pstmt.executeQuery();
	    		
				while ( rs.next() ) { 
					
					BOficinasVO = new BOficinas();
					
					BOficinasVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BOficinasVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BOficinasVO.setNombre_corto(rs.getString("nombre_corto"));
					BOficinasVO.setSiglas_oficina(rs.getString("siglas_oficina"));
					BOficinasVO.setGrupo_oficina(rs.getInt("grupo_oficina"));
					BOficinasVO.setPadre(rs.getInt("padre"));
					
					if(grupo_oficina_entero==BOficinasVO.getGrupo_oficina()){
						BOficinasVO.setGrupo_oficina_combo(1);
					}					
					
					//System.out.println(">> "+BOficinasVO.getCodigo_oficina()+" -  "+BOficinasVO.getGrupo_oficina_combo());
					ListaOficinas.add(BOficinasVO);

				}	
	            

				x.cerrar_conexion(con,rs);
				pstmt.close();
				
	            
	        } catch (SQLException e) {
	        	x.cerrar_conexion(con);
	             e.printStackTrace();
	        }
	        return ListaOficinas;
		                
		}
	 
	 public Collection  of_lista_oficinas_institucion(String codigo_institucion, String nombre_usuario) throws Exception {
			
	        log.info("ENTRO A  Lista de oficinas");
			Collection ListaOficinas = new ArrayList();
			
			BOficinas BOficinasVO = null;
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			ResultSet rs = null;
			PreparedStatement pstmt = null;
			
			
	        try {	
	        	
	        	String ls_sql = "SELECT  pe.codigo_oficina,ofi.descripcion_oficina,ofi.nombre_corto,ofi.siglas_oficina  FROM tramite.personal pe , tramite.oficinas ofi ,tramite.usuarios usu "+
	        			" WHERE  pe.nombre_personal = '"+nombre_usuario+"' and pe.validacion=1  and pe.codigo_oficina=ofi.codigo_oficina and ofi.institucion="+codigo_institucion+" and pe.c_usuario=usu.usuario and usu.estado='A' "+
	        			" order by pe.nombre_personal;";
	        		        	
	        	
	        	pstmt = con.prepareStatement(ls_sql);
	        	
	        	log.info("sql-> "+pstmt);
	        	rs=pstmt.executeQuery();
	    		
				while ( rs.next() ) { 
					
					BOficinasVO = new BOficinas();
					
					BOficinasVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BOficinasVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BOficinasVO.setNombre_corto(rs.getString("nombre_corto"));
					BOficinasVO.setSiglas_oficina(rs.getString("siglas_oficina"));
					
					
					ListaOficinas.add(BOficinasVO);

				}	
	            
				x.cerrar_conexion(con,rs);
				pstmt.close();
				
	            
	        } catch (SQLException e) {
	        	x.cerrar_conexion(con);
	             e.printStackTrace();
	        }
	        return ListaOficinas;
		                
		}
	 
	 public boolean  validaUsuarioDirigido(String nombre_usuario) throws Exception {
			
	        //log.info("ENTRO A  Lista de oficinas");
			boolean es_valido = false;
			BOficinas BOficinasVO = null;
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			ResultSet rs = null;
			PreparedStatement pstmt = null;
			
			
	        try {	
	        	
	        	String ls_sql = "SELECT  pe.codigo_oficina  FROM tramite.personal pe ,tramite.usuarios usu "+
	        			" WHERE  pe.nombre_personal = '"+nombre_usuario+"' and pe.validacion=1  and pe.c_usuario=usu.usuario and usu.estado='A' "+
	        			" order by pe.nombre_personal;";
	        		        	
	        	
	        	pstmt = con.prepareStatement(ls_sql);
	        	
	        	log.info("sql-> "+pstmt);
	        	rs=pstmt.executeQuery();
	    		
				while ( rs.next() ) { 
					BOficinasVO = new BOficinas();
					BOficinasVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					es_valido=true;
				}	
	            
				x.cerrar_conexion(con,rs);
				pstmt.close();
				
	            
	        } catch (SQLException e) {
	        	x.cerrar_conexion(con);
	             e.printStackTrace();
	        }
	        return es_valido;
		                
		}
	 
	 public Collection  of_lista_oficinas(Connection cnx,String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de oficinas");
			Collection ListaOficinas = new ArrayList();
			
			BOficinas BOficinasVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "select codigo_oficina,descripcion_oficina,nombre_corto,siglas_oficina" +
	        			" from tramite.oficinas where codigo_oficina="+codigo_oficina+ "  order by orden asc";
	        	
	        	log.info(ls_sql);
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BOficinasVO = new BOficinas();
					
					BOficinasVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BOficinasVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BOficinasVO.setNombre_corto(rs.getString("nombre_corto"));
					BOficinasVO.setSiglas_oficina(rs.getString("siglas_oficina"));
					
					
					ListaOficinas.add(BOficinasVO);

				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaOficinas;
		                
		}
	 
	 public Collection  of_lista_rutas(Connection cnx) throws Exception {
			
	        //log.info("ENTRO A  Lista de oficinas");
			Collection ListaRutas = new ArrayList();
			
			BRuta BRutaVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "select cod_ruta,nombre_ruta,estado from tramite.ruta order by cod_ruta asc";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BRutaVO = new BRuta();
					
					BRutaVO.setCod_ruta(rs.getInt("cod_ruta"));
					BRutaVO.setNombre_ruta(rs.getString("nombre_ruta"));
					BRutaVO.setEstado(rs.getString("estado"));
					
					
					
					ListaRutas.add(BRutaVO);

				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaRutas;
		                
		}
	 public Collection  of_lista_motivos(Connection cnx) throws Exception {
			
	        //log.info("ENTRO A  Lista de Motivos");
			Collection ListaMotivos = new ArrayList();
			
			BMotivo BMotivoVO = null;
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			ResultSet rs = null;
			PreparedStatement pstmt = null;
	       
	        try {	
	        	
	        	String ls_sql = " SELECT descripcion_motivo,codigo_motivo FROM tramite.motivo order by descripcion_motivo";
	        	
	        	pstmt = con.prepareStatement(ls_sql);
	        	rs=pstmt.executeQuery();
	    		
				while ( rs.next() ) { 
					
					BMotivoVO = new BMotivo();
					
					BMotivoVO.setDescripcion_motivo(rs.getString("descripcion_motivo"));
					BMotivoVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					
					ListaMotivos.add(BMotivoVO);

				}	
	            

				x.cerrar_conexion(con,rs);
				pstmt.close();
				
	            
	        } catch (SQLException e) {
	        	x.cerrar_conexion(con);
	             e.printStackTrace();
	        }
	        return ListaMotivos;
		                
		}
	 
	 public Collection  of_lista_motivos() throws Exception{

			Collection ListaMotivos = new ArrayList();
			
			BMotivo BMotivoVO = null;
			Statement us  = null;
			ResultSet rs = null;
			ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
	        try {	
	        	
	        	String ls_sql = " SELECT descripcion_motivo,codigo_motivo FROM tramite.motivo order by descripcion_motivo";
	        	
	        	us = con.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		log.info("El ls_sql es..." + ls_sql);
				while ( rs.next() ) {
					BMotivoVO = new BMotivo();
				
				BMotivoVO.setDescripcion_motivo(rs.getString("descripcion_motivo"));
				BMotivoVO.setCodigo_motivo(rs.getString("codigo_motivo"));
				
				ListaMotivos.add(BMotivoVO);
				}	
	            x.cerrar_conexion(con, rs);
				
            
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con, rs);
	        }
	        return ListaMotivos;
		                
		
	 }
	 
	 	 
	 public Collection  of_lista_correlativos(Connection cnx,String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Correlativos");
			Collection ListaCorrelativos = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "SELECT co.codigo_oficina,co.codigo_fondo,co.codigo_tipo,td.descripcion_tipo" +
	        			",of.descripcion_oficina,fo.descripcion_fondo,co.ultimo FROM tramite.correlativos co," +
	        			"tramite.oficinas of,tramite.tipo_documento td,tramite.fondo  fo WHERE " +
	        			" of.codigo_oficina = co.codigo_oficina  and  of.codigo_fondo = co.codigo_fondo" +
	        			"  and td.codigo_tipo = co.codigo_tipo  and  fo.codigo_fondo = of.codigo_fondo" +
	        			"  and  co.codigo_fondo = '01'  AND co.codigo_oficina = " + "'" + oficina + "'" + " ";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BCorrelativosVO = new BCorrelativos();
					BTipoDocumentoVO = new BTipoDocumento();
					BOficinasVO = new BOficinas();
					BFondoVO = new BFondo();
					
					BCorrelativosVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BCorrelativosVO.setCodigo_fondo(rs.getString("codigo_fondo"));
					BCorrelativosVO.setCodigo_tipo(rs.getString("codigo_tipo"));
					BCorrelativosVO.setUltimo(rs.getString("ultimo"));
					BTipoDocumentoVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					
					BOficinasVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BFondoVO.setDescripcion_fondo(rs.getString("descripcion_fondo"));
					
					
					ListaCorrelativos.add(BCorrelativosVO);
					ListaCorrelativos.add(BTipoDocumentoVO);
					ListaCorrelativos.add(BOficinasVO);
					ListaCorrelativos.add(BFondoVO);

				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaCorrelativos;
		                
		}
	 
	 public Collection  mesa_partes_normal(Connection cnx,String oficina,String fecha_inicio,String fecha_fin,String naturaleza,
			 String estado,String tipodoc,String filtro,String valorfiltro,String numero_registro,String numero_expediente) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);
	    	//log.info(" naturaleza.... : " + naturaleza);*/
	    	
	        try {	
	        	
	        	//String ls_naturaleza=naturaleza.equals("*");
	        	//ls_naturaleza="";
	        	
	        			
	        		////log.info(" Si es una lista normal");
	        		
	        		 ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        			"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
	        			"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta,md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva," +
	        			"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	        			"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	        			"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino," +
	        			"pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc md," +
	        			"tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de,tramite.oficinas of," +
	        			"tramite.oficinas of_a,tramite.personal pr where tp.codigo_tipo=dc.codigo_tipo and" +
	        			" dc.codigo_documento=md.codigo_documento and dc.codigo_documento=de.codigo_documento and" +
	        			" md.codigo_documento=de.codigo_documento and de.destinatario=pr.codigo_personal and" +
	        			" md.codigo_oficina=of.codigo_oficina and de.destino_documento=of_a.codigo_oficina and" +
	        			" md.codigo_oficina like " + "'" + oficina + "'" + " and md.codigo_fondo like '01' order by" +
	        			"  md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	        		 
	        	
	  
	        		 ////log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 
	 public int  of_lista_mesa_partes(Connection cnx,String oficina,String fecha_inicio,String fecha_fin,String naturaleza,String estado,String tipodoc,String filtro,String valorfiltro) {
	    	
	     //   obtenermos el valor maximo...
	    	//log.info("dentro del insertar_detalle......." );
	    	int    li_retorno;
	    	int    li_parcial = 0 ;
	    	
	    	String ls_correlativo=null;
	    	li_retorno = 1;
	    	
	    	
	    	try{
	    		
	    	
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    	}
	    	return li_retorno ;
		}
	 
	 public  Collection of_lista_solicitud(Connection cnx) throws Exception {
			
	        //log.info("ENTRO A  Lista de Solicitudes");
			Collection ListaSolicitudes = new ArrayList();
			
			BSolicitud BSolicitudVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "SELECT * from tramite.solicitud";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BSolicitudVO = new BSolicitud();
					
					BSolicitudVO.setCodigo_solicitud(rs.getString("codigo_solicitud"));
					BSolicitudVO.setNombre_solicitud(rs.getString("nombre_solicitud"));
					BSolicitudVO.setEstado(rs.getString("estado"));
					
					ListaSolicitudes.add(BSolicitudVO);

				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaSolicitudes;
		                
		}
	 
	 /*public Collection of_procedencia_listar(Connection cnx,String Tipo,String Cadena) throws Exception{
			
			//log.info("ENTRO A BUSCAR procedencia institucion");
			BPersona BPersonaVO= null;
			
			Collection listaProcedencia = new ArrayList();
			String ls_sql ="";
			Statement us  = null;
			ResultSet rs = null;
			try 
			{	
     	
				if(Tipo.equals("N")){
					
					 ls_sql = "SELECT * FROM tramite.persona WHERE  nombre_persona LIKE " + "'" + Cadena + "'"+ " and tipo =" + "'" + Tipo + "'" + "";
					 us = cnx.createStatement();
			    	 rs = us.executeQuery(ls_sql);
			    	 //log.info("Si el tipo es Natural: " + rs);
					 while ( rs.next() ) { 
							
						 BPersonaVO = new BPersona();
							
						 BPersonaVO.setCodigo_persona(rs.getString("codigo_persona"));
						 BPersonaVO.setNombre_persona(rs.getString("nombre_persona"));
						 BPersonaVO.setTipo(rs.getString("tipo"));		
							
						 listaProcedencia.add(BPersonaVO);

						}	
					 
				}else if(Tipo.equals("J")){
					
					 ls_sql = "SELECT * FROM tramite.persona WHERE  nombre_persona LIKE " + "'" + Cadena + "'"+ " and tipo =" + "'" + Tipo + "'" + "";
					 us = cnx.createStatement();
			    	 rs = us.executeQuery(ls_sql);
			    	 //log.info("Si el tipo es Juridico: " + rs);
					 while ( rs.next() ) { 
							
						 BPersonaVO = new BPersona();
							
						 BPersonaVO.setCodigo_persona(rs.getString("codigo_persona"));
						 BPersonaVO.setNombre_persona(rs.getString("nombre_persona"));
						 BPersonaVO.setTipo(rs.getString("tipo"));		
							
						 listaProcedencia.add(BPersonaVO);

						}	
					 
				}else if(Tipo.equals("NJ")){
					
					 ls_sql = "SELECT * FROM tramite.persona WHERE  nombre_persona LIKE " + "'" + Cadena + "'"+ "";
					 us = cnx.createStatement();
			    	 rs = us.executeQuery(ls_sql);
			    	 //log.info("Si el tipo es Juridico: " + rs);
					 while ( rs.next() ) { 
							
						 BPersonaVO = new BPersona();
							
						 BPersonaVO.setCodigo_persona(rs.getString("codigo_persona"));
						 BPersonaVO.setNombre_persona(rs.getString("nombre_persona"));
						 BPersonaVO.setTipo(rs.getString("tipo"));		
							
						 listaProcedencia.add(BPersonaVO);

						}	
					 
				}
				
				rs.close();
				
			} catch (SQLException e) 
			{
				 e.printStackTrace();
			}
			return listaProcedencia;
	                
			}*/

	 public  Collection of_listar_personas(Connection cnx) throws Exception {
			
	        //log.info("ENTRO A  Lista de Instituciones, Persona Natural");
			Collection ListaPersonas = new ArrayList();
			
			BPersona BPersonaVO= null;
			Statement us  = null;
			ResultSet rs = null;
	       int contador=0;
	        try {	
	        	
	        	String ls_sql = "SELECT * FROM tramite.persona order by  nombre_persona asc";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BPersonaVO = new BPersona();
					contador=contador+1;
					BPersonaVO.setContador(contador);
					BPersonaVO.setCodigo_persona(rs.getString("codigo_persona"));
					BPersonaVO.setNombre_persona(rs.getString("nombre_persona"));
					BPersonaVO.setTipo(rs.getString("tipo"));	
					
					ListaPersonas.add(BPersonaVO);

				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaPersonas;
		                
		}
	 
	 public void of_ingresar_procedencia(Connection cnx,String descripcion,String tipopersona) {

	    	Statement us  = null;
			
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
			    	 ls_sql = "insert into tramite.persona(nombre_persona,tipo) values('"+descripcion+ "','"+tipopersona+"')";
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);
	    		
			    	 x.cerrar_conexion(con);
			    	 us.close();
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		x.cerrar_conexion(con);
	    	}

		}
	 
	 public void of_ingresar_procedencia(String descripcion,String tipopersona) {

	    	Statement us  = null;
			
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
			    	 ls_sql = "insert into tramite.persona(nombre_persona,tipo) values('"+descripcion+ "','"+tipopersona+"')";
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);
	    		
			    	 x.cerrar_conexion(con);
			    	 us.close();
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		x.cerrar_conexion(con);
	    	}

		}
	 
	 public String of_ingresar_documento(Connection cnx,String codigo_oficina,String medio,String codigo_tipo,String naturaleza_documento,String destino_documento,
				String contacto,String destinatario,String codigo_solicitud,String numero_documento,
				String fecha_registro,String hora,String folios_documento,String asunto_documento,
				String observa_documento,String usuario_actual,String firmadopor,String origen_documento,String desc_origen,
				String tipo,String persona,String fecha_rpta,String correlativorecepcion,String numero_referencia,String dirigido,String claveExterior, String codigo_intitucion) {
	    	
	     //   obtenermos el valor maximo...
	    	log.info("dentro del ingresar Nuevo Documento ......USADA POR MESA DE PARTES" );
		 	Funciones funciones = new Funciones();
		 	Calendar calendario = new GregorianCalendar();
		 	
		    asunto_documento = funciones.convertir_comillas_simples(asunto_documento);
		    observa_documento = funciones.convertir_comillas_simples(observa_documento);
		    numero_referencia = funciones.convertir_comillas_simples(numero_referencia);
		    numero_documento = funciones.convertir_comillas_simples(numero_documento);
		    
	    	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
   		 	int horadia = calendario.get(Calendar.HOUR_OF_DAY);
   		 	int minutos = calendario.get(Calendar.MINUTE);
   		 	int segundos = calendario.get(Calendar.SECOND);
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "2";
	    	String ls_valor  = "";
	    	
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);*/
	    	
	    	
	    	int li_retorno = 1;
	    	int li_parcial = 0 ;
	    	int li_expediente = 0 ;
	    	int li_secuencia=0;
	    	int li_secuencia_oficina;
	    	int ls_secuencia_origen = 0;
	    	int codigo_documento_actual= 0;
	    	String codigo_documento= "" ;
	    	String ls_extraer_year= "" ;
	    	//String naturaleza_documento = "E";
	    	String ls_correlativo=null;
	    	
	    	
	    	String ls_sql = "";
	    	
	    	ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			Statement us  = null;
			ResultSet rs = null;
			PreparedStatement pstmt = null;
			
	    	try{
	    		codigo_intitucion=(codigo_intitucion==null)?"1":codigo_intitucion;
	    		/****ls_sql = "Select max(codigo_documento) as c_valor from tramite.documento";
    			//log.info("ls_sql............   " + ls_sql );
    			us = con.createStatement();
		    	rs = us.executeQuery(ls_sql);
		    	 //log.info("El ls_sql es: " + ls_sql);
				
		    	 if (rs == null) 
		    		{
		    		//	//log.info("rs es nulo ......." );
		    			li_retorno = 1;
		    	    }
		    		else
		    		{
		    			////log.info("rs NO es nulo ......." );
			    		while ( rs.next() ) { 
			    				  //          //log.info("dentro del whyle......." );
			    				            if (rs.getString("c_valor") == null )
			    				            {
			    				    		//	//log.info("ta vacio nulo ......." );
			    				    			li_retorno = 1;
			    				    	    }
			    				            else
			    				    		{
			    				            //	//log.info("ls_valor :" + rs.getString("c_valor"));
			    				            	
			    				            	ls_valor=rs.getString("c_valor");
			    				            	li_retorno = Integer.valueOf(ls_valor).intValue() + 1;
			    				    		}
			    				           
			    		}
			        }
		    	 
		    	 //codigo_documento = yearactual+ li_retorno;
		    	 codigo_documento = String.valueOf(li_retorno);
		    	 
		    	 // ingresar codigo_documento,CLAVE,NUMERO_EXPEDIENTE
		    	 
		    	 //log.info("El nuevo codigo documento es....LLLLL" + codigo_documento);
		    	 
	    		//Registramos un documento en la tabla tramite.documento
		    	 String tipo_envio = "P";   ****/
		    	 
		    	 
		    	 /**ls_sql = "insert into tramite.documento(codigo_documento,codigo_tipo,naturaleza_documento,numero_documento,fecha_documento,asunto_documento,folios_documento,observa_documento," +
		    	 		"fecha_registro,hora_registro,ultima_modificacion,ultimo_usuario,estado_documento,postergado,cargo,anio,dirigido) values(" + "'" + codigo_documento + "'" + "," + "'" + codigo_tipo + "'" +
		    	 		"," + "'" + naturaleza_documento + "'" +
		    	 		"," + "'" + numero_documento + "'" +
		    	 		"," + "'" + fecha_documento + "'" +
		    	 		"," + "'" + asunto_documento + "'" +
		    	 		"," + "'" + folios_documento + "'" +
		    	 		"," + "'" + observa_documento + "'" +
		    	 		"," + "'" + fecha_registro + "'" +
		    	 		"," + "'" + hora + "'" +
		    	 		"," + "'" + fecha_documento + "'" +
		    	 		"," + "'" + usuario_actual + "'" +
		    	 		"," + "'" + estado_documento + "'"+
		    	 		"," + "'N'"+
		    	 		"," + "'N'"+
		    	 		","+ "'" + yearactual + "'"+
		    	 		","+ "'" + dirigido + "')";
		    	 log.info("El primer ls_sql es" + ls_sql);**/
		    	 
		    	log.info("Hora-> "+hora+":00"); 
		    	hora=hora.trim();
		    	String tipo_envio = "P";
		    	
		    			 		
	 			ls_sql = "insert into tramite.documento(codigo_tipo,naturaleza_documento,numero_documento,fecha_documento,asunto_documento,folios_documento,observa_documento," +
	 	    	 		"fecha_registro,hora_registro,ultima_modificacion,ultimo_usuario,estado_documento,postergado,cargo,anio,dirigido,id_institucion) " +
	 	    	 		"values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";

	    	
		    	
	    	 	log.info("El primer ls_sql es" + ls_sql);
		    	 
		    	 
		    	 pstmt = con.prepareStatement(ls_sql);
		    	 //pstmt.setInt(1, li_retorno);
		    	 pstmt.setString(1, codigo_tipo);
		    	 pstmt.setString(2,naturaleza_documento);
		    	 pstmt.setString(3,numero_documento);
		    	 pstmt.setString(4,fecha_documento);
		    	 pstmt.setString(5,asunto_documento);
		    	 pstmt.setString(6,folios_documento);
		    	 pstmt.setString(7,observa_documento);
		    	 pstmt.setString(8,fecha_registro);
		    	 pstmt.setTime(9, Time.valueOf(hora+":00"));
		    	 pstmt.setString(10,fecha_documento);
		    	 pstmt.setString(11,usuario_actual);
		    	 pstmt.setString(12,estado_documento);
		    	 pstmt.setString(13,"N");
		    	 pstmt.setString(14,"N");
		    	 pstmt.setInt(15,Integer.parseInt(yearactual.trim()));
		    	 pstmt.setString(16,dirigido);
		    	 
		    	 pstmt.setInt(17,Integer.parseInt(codigo_intitucion));
 
		    	 pstmt.executeUpdate();
		    	// us = con.createStatement();
		    	// us.executeUpdate(ls_sql);
		    	 
//		    	------------------------Registramos la Oficina de Origen y Destino-------------------------//
		    	 
		    	/* ls_sql = "insert into tramite.doc_entrada_origen(codigo_documento,codigo_fondo,codigo_oficina,codigo_personal)" +
		    	 		" values(" + "'" + codigo_documento + "'"+ "," +"'01'"+ 
		    	 		"," +"'" + codigo_oficina + "'"+ "," +"'" + persona + "'"+ ")";
	    	 
			    	 //log.info("El segundo ls_sql doc_entrada_origen es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);
	    	 
			    	 
		    	 ls_sql = "insert into tramite.doc_entrada_destino(codigo_documento,secuencia_documento,codigo_personal,codigo_fondo,codigo_oficina)" +
	    	 		" values(" + "'" + codigo_documento + "'"+ "," +"'1'"+ 
	    	 		"," +"'" + destinatario + "'"+ "," +"'01'"+"," +"'" + destino_documento + "'"+")";
    	 
		    	 //log.info("El tercero ls_sql doc_entrada_destino es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);*/
		    	 
		    	 	//------------------------Registramos Origen y Destino del Documento-------------------------//
		    	 
		    	 /***ls_sql = "insert into tramite.doc_entrada(codigo_documento,destinatario,remitente,destino_documento," +
		    	 		"fondo_destino,origen_documento,medio,hora,firmadopor,codigo_solicitud,desc_origen,tipo) values(" + "'" + codigo_documento + "'"
		    	 		+ "," +"'" + destinatario + "'"+ "," +"'" + contacto + "'"
		    	 		+ "," +"'" + destino_documento + "'"+ "," +"'01'"
		    	 		+ "," + "'" + origen_documento + "'"+ "," +"'" + medio + "'"
		    	 		+ "," +"'" + hora + "'"+ "," +"'" + firmadopor + "'"
		    	 		+ "," +"'" + codigo_solicitud + "'"
		    	 		+ "," +"'" + desc_origen + "'"
		    	 		+ "," +"'" + tipo + "'"+ ")";
		    	 
		    	 //log.info("El cuarto ls_sql doc_entrada es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);***/
		    	 
		    	ls_sql="SELECT last_value as valor FROM tramite.seq_documento;";
		    	us = con.createStatement();
	 			rs = us.executeQuery(ls_sql);    		
	 			log.info("sql :"+ls_sql);
		 		while(rs.next()){
		 			li_retorno=(rs.getInt("valor"));

		 		}
			 		
			 	codigo_documento = String.valueOf(li_retorno);
		    		
		    	 
		    	 ls_sql = "insert into tramite.doc_entrada(codigo_documento,destinatario,remitente,destino_documento,fondo_destino," +
		    	 		"origen_documento,medio,hora,firmadopor,codigo_solicitud," +
		    	 		"desc_origen,tipo) " +
		    	 "values(?,?,?,?,?,?,?,?,?,?,?,?)";

		    	 pstmt = con.prepareStatement(ls_sql);
		    	 pstmt.setInt(1, li_retorno);
		    	 pstmt.setInt(2, Integer.parseInt(destinatario));
		    	 pstmt.setString(3, contacto);
		    	 pstmt.setInt(4, Integer.parseInt(destino_documento));
		    	 pstmt.setString(5, "01");
		    	 pstmt.setInt(6, Integer.parseInt(origen_documento));
		    	 pstmt.setString(7, medio);
		    	 pstmt.setString(8, hora);
		    	 pstmt.setString(9, firmadopor);
		    	 pstmt.setInt(10, Integer.parseInt(codigo_solicitud));
		    	 pstmt.setString(11, desc_origen);
		    	 pstmt.setString(12, tipo);
		    	 
		    	 pstmt.executeUpdate();
		    	 
		    	 
		    	//------------------------Registramos el movimiento del Documento-------------------------//
		    	/* ls_sql = "select count(codigo_documento) as c_valor from tramite.movimientos_doc where codigo_documento  = " + "'" + codigo_documento + "'"  + "";
		    	 us = cnx.createStatement();
		    	 rs = us.executeQuery(ls_sql);
		    	// //log.info("El resultset es: " + rs);
		    	
		 		while ( rs.next() ) { 
		 				            //log.info("dentro del whyle......." );
		 				            ls_valor = rs.getString("c_valor"); 
		 				            log.info("ls_valor :" + ls_valor );
		 				            
		 		}
		 		
		 		li_secuencia = Integer.valueOf(ls_valor).intValue() + 1;
		 		log.info("li_secuencia: " + li_secuencia);
		    	 if (ls_valor.equals("0")) {
		 		*/	
		    	 
		    	 /**
		    	  * JAZANERO
		    	  */
		    	 if(codigo_intitucion.equals("2")){
		    		 
		    		 ls_sql = "insert into tramite.documento_fondecyt(codigo_documento_concytec) " +
		    	 		"values(?)";
		 		
			    	 pstmt = con.prepareStatement(ls_sql);
			    	 pstmt.setInt(1, li_retorno);
			    			    	 
			    	 pstmt.executeUpdate();
		    	 }
		    	 
		    	 
		    	 
		    	li_secuencia = 1;
			 	log.info("li_secuencia: " + li_secuencia);
			 		
		    	String fecha_consulta = fecha_registro.substring(6,10)+fecha_registro.substring(3,5)+fecha_registro.substring(0,2);
			        	
			        // //log.info("fecha_consulta: " + fecha_consulta);
			         
			         //int numero=Integer.parseInt(str.trim());
			         //li_expediente=Integer.parseInt(ls_valor.trim())+1;
			        
		    		 if(!codigo_solicitud.equals("23") && !codigo_solicitud.equals("24") 
		    				 && !codigo_solicitud.equals("25")&& !codigo_solicitud.equals("26")&&
		    				 !codigo_solicitud.equals("27")&&
		    				 !codigo_solicitud.equals("29")){ //29=PUBLICACIONES agregado por Moises Pelaez: 08-07-2011
		    			
		    			 log.info("SI EL CODIGO DE SOLICITUD ES DIFERENTE DE 23,24,25,26,27,29");
		    			
		    			 
		    			 //ls_sql = "Select max(codigo_expediente) as c_expediente from tramite.movimientos_doc";
		    			 ls_sql = " SELECT CASE WHEN MAX(codigo_expediente)=10138 THEN 10332 ELSE MAX(codigo_expediente) END AS c_expediente  FROM tramite.movimientos_doc " +
		    			 		  " WHERE codigo_expediente NOT IN (SELECT  DISTINCT codigo_expediente FROM tramite.movimientos_doc WHERE codigo_expediente>=10139 " +
		    			 		  " AND codigo_expediente<=10332)";

			    			log.info("ls_sql............   " + ls_sql );
			    			us = con.createStatement();
					    	rs = us.executeQuery(ls_sql);
					    	//log.info("El resultset es: " + rs);
							
					    	 if (rs == null ) 
					    		{
					    	//		//log.info("rs es nulo ......." );
					    			li_expediente = 1;
					    	    }
					    		else
					    		{
					    		//	//log.info("rs NO es nulo ......." );
						    		while ( rs.next() ) { 
						    				         //   //log.info("dentro del whyle......." );
						    				            if (rs.getString("c_expediente").trim() == null )
						    				            {
						    				    			//log.info("ta vacio nulo ......." );
						    				    			li_expediente = 1;
						    				    	    }
						    				            else
						    				    		{
						    				            //	//log.info("ls_valor :" + rs.getString("c_expediente").trim());
						    				        
						    				            	li_expediente = Integer.valueOf(rs.getString("c_expediente").trim()).intValue() + 1;
						    				            	 //log.info("El li_expediente es..." + li_expediente);
						    				    		}
						    				           
						    		}
						        }
					    	 log.info("FIN SOLICITUD ES DIFERENTE DE 23,24,25,26,27,29"); 
		    		 /***
		    			 ls_sql="SELECT nextval('tramite.seq_numero_expediente');";
				    	 us = con.createStatement();
				 			rs = us.executeQuery(ls_sql);    		
				 			log.info("sql :"+ls_sql);
					 		while(rs.next()){
					 			li_expediente=(rs.getInt("nextval"));
					 		}
					 		
					 ***/
					 	//li_expediente = li_expediente + 1;
		    		 }
		    		 
		    		 log.info("DESPUES DEL NUMERO EXPEDIENTE" + li_expediente);
		    		 
		    		 registrarCodigoDocumento_NumeroExpediente_clave(codigo_documento,li_expediente,claveExterior);
		    		 
		    	/****	 ls_sql = "insert into tramite.movimientos_doc(codigo_documento," +
		    		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
		    		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		    		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
		    		 		"oficina_deriva,destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente,oficina_origen,codigo_recepcion,numero_referencia" +
		    		 		",tipo_envio,secuencia_origen) values(" + "'" + codigo_documento + "'"
		    	 		+ "," +"'01'"+","+"'"+ li_secuencia + "'"+ "," +"'" + codigo_oficina + "'"+ "," +"'01'"
		    	 		+ "," + "'" + origen_documento + "'"+ "," +"'5'"
		    	 		+ "," +"'" + fecha_registro + "'"+ "," +"'" + fecha_consulta + "'"+ "," +"'" + hora + "'"
		    	 		+ "," +"'" + observa_documento + "'"+ "," +"'" + codigo_documento + "'"
		    	 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+ "," +"'" + destino_documento + "'"+
		    	 		"," +"'" + destinatario + "'"+
		    	 		"," +"'" + desc_origen + "'"+
		    	 		"," +"'" + tipo + "'"+
		    	 		"," +"'" + fecha_rpta + "'"+
		    	 		"," +"'" + li_expediente + "'"+
		    	 		"," +"'" + codigo_oficina + "'"+
		    	 		"," +"'" + correlativorecepcion + "'"+
		    	 		"," +"'" + numero_referencia + "','"+tipo_envio+"',"+ls_secuencia_origen+")";
		    	 
		    	// log.info("El tercer ls_sql registro de nuestra oficina origen es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql); ****/
		    	 

		    		 
		    		ls_sql = "insert into tramite.movimientos_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
    		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
    		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
    		 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
    		 		"oficina_origen,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen) " +
    		 		"values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";	 
		    		
		    		fecha_rpta = (fecha_rpta==null)? "":fecha_rpta;
		    		correlativorecepcion = (correlativorecepcion==null)? "":correlativorecepcion;
		    		numero_referencia = (numero_referencia==null)? "":numero_referencia;
		    		
		    		log.info("-->"+origen_documento+","+fecha_registro+","+fecha_consulta+","+observa_documento+","+usuario_actual+","+destinatario);
		    		log.info(","+desc_origen+","+tipo+","+fecha_rpta+","+tipo_envio+","+correlativorecepcion+","+numero_referencia);
		    		
		    		
		    		 pstmt = con.prepareStatement(ls_sql);
		    		 pstmt.setInt(1, li_retorno);
			    	 pstmt.setString(2, "01");
			    	 pstmt.setInt(3, li_secuencia);
			    	 pstmt.setInt(4, Integer.parseInt(codigo_oficina));
			    	 pstmt.setString(5, "01");
			    	 pstmt.setString(6, origen_documento);
			    	 pstmt.setString(7, "5");
			    	 pstmt.setString(8, fecha_registro);
			    	 pstmt.setString(9, fecha_consulta);
			    	 pstmt.setTime(10, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
			    	 pstmt.setString(11, observa_documento);
			    	 pstmt.setInt(12, Integer.parseInt(codigo_documento));
			    	 pstmt.setString(13, usuario_actual);
			    	 pstmt.setString(14, "01");
			    	 pstmt.setInt(15, Integer.parseInt(destino_documento));
			    	 pstmt.setString(16, destinatario);
			    	 pstmt.setString(17, desc_origen);
			    	 pstmt.setString(18, tipo);
			    	 pstmt.setString(19, fecha_rpta);
			    	 pstmt.setInt(20, li_expediente);
			    	 pstmt.setInt(21, Integer.parseInt(codigo_oficina));
			    	 pstmt.setInt(22, Integer.parseInt(correlativorecepcion));
			    	 pstmt.setInt(23, Integer.parseInt(numero_referencia));
			    	 pstmt.setString(24, tipo_envio);
			    	 pstmt.setInt(25, ls_secuencia_origen);
			    	 
			    	 pstmt.executeUpdate(); 
		    		 
		    		 
		    	 li_secuencia_oficina = li_secuencia + 1;
			 		
		    	/****ls_sql = "insert into tramite.movimientos_doc(codigo_documento," +
 		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
 		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
 		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
 		 		"oficina_deriva,destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente,oficina_origen,codigo_recepcion,numero_referencia" +
 		 		",tipo_envio,secuencia_origen) values(" + "'" + codigo_documento + "'"
	 	 		+ "," +"'01'"+","+"'"+ li_secuencia_oficina + "'"+ "," +"'" + destino_documento + "'"+ "," +"'01'"
	 	 		+ "," + "'" + origen_documento + "'"+ "," +"'2'"
	 	 		+ "," +"'" + fecha_registro + "'"+ "," +"'" + fecha_consulta + "'"+ "," +"'" + hora + "'"
	 	 		+ "," +"'" + observa_documento + "'"+ "," +"'" + codigo_documento + "'"
	 	 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+ "," +"'" + destino_documento + "'"+
	 	 		"," +"'" + destinatario + "'"+
	 	 		"," +"'" + desc_origen + "'"+
	 	 		"," +"'" + tipo + "'"+
	 	 		"," +"'" + fecha_rpta + "'"+
    	 		"," +"'" + li_expediente + "'"+
    	 		"," +"'" + codigo_oficina + "'"+
    	 		"," +"'" + correlativorecepcion + "'"+
    	 		"," +"'" + numero_referencia + "'," +
    	 		"'"+tipo_envio+"',"+li_secuencia+")";
 	 
			 	 //log.info("El cuarto ls_sql oficina a las q se deriva el documento es" + ls_sql);
			 	 us = con.createStatement();
			 	 us.executeUpdate(ls_sql);****/
		    	 
		    	 ls_sql = "insert into tramite.movimientos_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
	 		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
	 		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
	 		 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
	 		 		"oficina_origen,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen) " +
	 		 		"values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
		    	 
		    	 pstmt = con.prepareStatement(ls_sql);
	    		 pstmt.setInt(1, li_retorno);
		    	 pstmt.setString(2, "01");
		    	 pstmt.setInt(3, li_secuencia_oficina);
		    	 pstmt.setInt(4, Integer.parseInt(destino_documento));
		    	 pstmt.setString(5, "01");
		    	 pstmt.setString(6, origen_documento);
		    	 pstmt.setString(7, "2");
		    	 pstmt.setString(8, fecha_registro);
		    	 pstmt.setString(9, fecha_consulta);
		    	 pstmt.setTime(10, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
		    	 pstmt.setString(11, observa_documento);
		    	 pstmt.setInt(12, Integer.parseInt(codigo_documento));
		    	 pstmt.setString(13, usuario_actual);
		    	 pstmt.setString(14, "01");
		    	 pstmt.setInt(15, Integer.parseInt(destino_documento));
		    	 pstmt.setString(16, destinatario);
		    	 pstmt.setString(17, desc_origen);
		    	 pstmt.setString(18, tipo);
		    	 pstmt.setString(19, fecha_rpta);
		    	 pstmt.setInt(20, li_expediente);
		    	 pstmt.setInt(21, Integer.parseInt(codigo_oficina));
		    	 pstmt.setInt(22, Integer.parseInt(correlativorecepcion));
		    	 pstmt.setInt(23, Integer.parseInt(numero_referencia));
		    	 pstmt.setString(24, tipo_envio);
		    	 pstmt.setInt(25, li_secuencia);
		    	 
		    	 pstmt.executeUpdate();
			 	 
			 	 /***********************Registrando para el recorrido********************/
		    	 
			 	/**** ls_sql = "insert into tramite.recorrido_doc(codigo_documento," +
			 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
			 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
			 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
			 		"oficina_deriva,destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente,oficina_origen,estado,codigo_recepcion,numero_referencia" +
			 		",tipo_envio,secuencia_origen) values(" + "'" + codigo_documento + "'"
			 		+ "," +"'01'"+","+"'"+ li_secuencia_oficina + "'"+ "," +"'" + destino_documento + "'"+ "," +"'01'"
			 		+ "," + "'" + origen_documento + "'"+ "," +"'2'"
			 		+ "," +"'" + fecha_registro + "'"+ "," +"'" + fecha_consulta + "'"+ "," +"'" + hora + "'"
			 		+ "," +"'" + observa_documento + "'"+ "," +"'" + codigo_documento + "'"
			 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+ "," +"'" + destino_documento + "'"+
			 		"," +"'" + destinatario + "'"+
			 		"," +"'" + desc_origen + "'"+
			 		"," +"'" + tipo + "'"+
			 		"," +"'" + fecha_rpta + "'"+
			 		"," +"'" + li_expediente + "'"+
			 		"," +"'" + codigo_oficina + "'"+
			 		"," +"'1'"+
			 		"," +"'" + correlativorecepcion + "'"+
			 		"," +"'" + numero_referencia + "'"+
			 		",'"+tipo_envio+"',"+ls_secuencia_origen+")";

			 	 //log.info("El 2 ls_sql recorrido_doc a las q se deriva el documento es" + ls_sql);
			 	 us = con.createStatement();
			 	 us.executeUpdate(ls_sql);****/
			 	 
		    	 ls_sql = "insert into tramite.recorrido_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
			 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
			 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
			 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
			 		"oficina_origen,estado,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen) " +
			 		"values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
		    	 
		    	 pstmt = con.prepareStatement(ls_sql);
	    		 pstmt.setInt(1, Integer.parseInt(codigo_documento));
		    	 pstmt.setString(2, "01");
		    	 pstmt.setInt(3, li_secuencia_oficina);
		    	 pstmt.setInt(4, Integer.parseInt(destino_documento));
		    	 pstmt.setString(5, "01");
		    	 pstmt.setString(6, origen_documento);
		    	 pstmt.setString(7, "2");
		    	 pstmt.setString(8, fecha_registro);
		    	 pstmt.setString(9, fecha_consulta);
		    	 pstmt.setTime(10, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
		    	 pstmt.setString(11, observa_documento);
		    	 pstmt.setInt(12, Integer.parseInt(codigo_documento));
		    	 pstmt.setString(13, usuario_actual);
		    	 pstmt.setString(14, "01");
		    	 pstmt.setInt(15, Integer.parseInt(destino_documento));
		    	 pstmt.setString(16, destinatario);
		    	 pstmt.setString(17, desc_origen);
		    	 pstmt.setString(18, tipo);
		    	 pstmt.setString(19, fecha_rpta);
		    	 pstmt.setInt(20, li_expediente);
		    	 pstmt.setInt(21, Integer.parseInt(codigo_oficina));
		    	 pstmt.setString(22, "1");
		    	 pstmt.setInt(23, Integer.parseInt(correlativorecepcion));
		    	 pstmt.setInt(24, Integer.parseInt(numero_referencia));
		    	 pstmt.setString(25, tipo_envio);
		    	 pstmt.setInt(26, li_secuencia);
		    	 
		    	 pstmt.executeUpdate();
		    	 
		    	 
			 	 
			 	/***ls_sql = "insert into tramite.recorrido_doc(codigo_documento," +
		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
		 		"oficina_deriva,destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente,oficina_origen,estado,codigo_recepcion,numero_referencia" +
		 		",tipo_envio,secuencia_origen) values(" + "'" + codigo_documento + "'"
	 		+ "," +"'01'"+","+"'"+ li_secuencia + "'"+ "," +"'" + codigo_oficina + "'"+ "," +"'01'"
	 		+ "," + "'" + origen_documento.trim() + "'"+ "," +"'5'"
	 		+ "," +"'" + fecha_registro.trim() + "'"+ "," +"'" + fecha_consulta.trim() + "'"+ "," +"'" + hora + "'"
	 		+ "," +"'" + observa_documento.trim() + "'"+ "," +"'" + codigo_documento + "'"
	 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+ "," +"'" + destino_documento + "'"+
	 		"," +"'" + destinatario + "'"+
	 		"," +"'" + desc_origen + "'"+
	 		"," +"'" + tipo + "'"+
	 		"," +"'" + fecha_rpta + "'"+
	 		"," +"'" + li_expediente + "'"+
	 		"," +"'" + codigo_oficina + "'"+
	 		"," +"'2'"+
	 		"," +"'" + correlativorecepcion + "'"+
	 		"," +"'" + numero_referencia + "'"+
	 		",'"+tipo_envio+"',"+li_secuencia+")";
			 	
			 	
			 //log.info("El 1er ls_sql recorrido_doc registro de nuestra oficina origen es" + ls_sql);
			 us = con.createStatement();
			 us.executeUpdate(ls_sql);****/
	 
		    	 ls_sql = "insert into tramite.recorrido_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
			 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
			 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
			 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
			 		"oficina_origen,estado,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen)" +
			 		"values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
			
		    	 pstmt = con.prepareStatement(ls_sql);
	    		 pstmt.setInt(1, Integer.parseInt(codigo_documento));
		    	 pstmt.setString(2, "01");
		    	 pstmt.setInt(3, li_secuencia);
		    	 pstmt.setInt(4, Integer.parseInt(codigo_oficina));
		    	 pstmt.setString(5, "01");
		    	 pstmt.setString(6, origen_documento);
		    	 pstmt.setString(7, "5");
		    	 pstmt.setString(8, fecha_registro);
		    	 pstmt.setString(9, fecha_consulta);
		    	 pstmt.setTime(10, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
		    	 pstmt.setString(11, observa_documento);
		    	 pstmt.setInt(12, Integer.parseInt(codigo_documento));
		    	 pstmt.setString(13, usuario_actual);
		    	 pstmt.setString(14, "01");
		    	 pstmt.setInt(15, Integer.parseInt(destino_documento));
		    	 pstmt.setString(16, destinatario);
		    	 pstmt.setString(17, desc_origen);
		    	 pstmt.setString(18, tipo);
		    	 pstmt.setString(19, fecha_rpta);
		    	 pstmt.setInt(20, li_expediente);
		    	 pstmt.setInt(21, Integer.parseInt(codigo_oficina));
		    	 pstmt.setString(22, "2");
		    	 pstmt.setInt(23, Integer.parseInt(correlativorecepcion));
		    	 pstmt.setInt(24, Integer.parseInt(numero_referencia));
		    	 pstmt.setString(25, tipo_envio);
		    	 pstmt.setInt(26, ls_secuencia_origen);
		    	 
		    	 pstmt.executeUpdate();
		/*******************copia a secretarias*********************/
		 	/***************si el destinatario es Fernando Ortega******************/ 
		
			 	 
		 		/*}else{
		 			String ls_estado="A";
		 			ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = " + "'" + ls_estado  + "'"+
		 			"," + "fecha_movimiento=" + "'" + fecha_registro + "'"+ "," + " hora_movimiento=" +
		 			"'" + hora + "'"+ "," + " ultimo_usuario=" + "'" + usuario_actual + "'" +
		 			" where codigo_documento = " + "'" + codigo_documento + "'"+" and secuencia_movimiento = " +
		 			"'" + li_secuencia + "'" + " ";
		 			
		 			// //log.info("Para actualizar los movimientos es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);
		 		}*/
		    	x.cerrar_conexion(con,rs);
		    	pstmt.close();
		    	us.close();
			 
	    	}
	    	catch(Exception e){
	    		e.printStackTrace();
	    		x.cerrar_conexion(con);
	    	}
	    	return codigo_documento;
		}
	 
	 private void registrarCodigoDocumento_NumeroExpediente_clave(
		String codigo_documento, int li_expediente, String claveExterior) {
		 log.info("Entry registrarCodigoDocumento_NumeroExpediente_clave...");
		 Connection con=null;
		 ObtieneConexion x=null;
		 PreparedStatement pstmt = null;	
		 try{
			x= new ObtieneConexion();
			con= x.getConnection();		
			
				String INSERT="INSERT INTO tramite.documento_expediente_clave( codigo_documento, numero_expediente, clave)   VALUES (?, ?, ?)";
				pstmt = con.prepareStatement(INSERT);
				pstmt.setInt(1, Integer.parseInt(codigo_documento));
				pstmt.setInt(2, li_expediente);
				pstmt.setString(3, claveExterior);						
				pstmt.executeUpdate();
			    x.cerrar_conexion(con);
			    pstmt.close();
	    log.info("Finally registrarCodigoDocumento_NumeroExpediente_clave...");		
	    	}
	    	catch(Exception e){
	    		log.error("error en el Servlet : " + e.getMessage());
	    		x.cerrar_conexion(con);
	    	}
		
	}
	public void of_recibir_doc(Connection cnx,String oficina,String documento,String usuario,String fecha,
			 String hora,String observacion,String ls_estado_doc,String ls_correlativorecepcion,
			 String secuencia_movimiento,String asunto_documento,String cargo_personal) {
	    	
	     //   obtenermos el valor maximo...
	    	log.info("dentro del of_recibir_doc" );
	    	int    li_retorno;
	    	int    li_parcial = 0 ;
	    	String ls_correlativo=null;
	    	String ls_ano=null;
	    	String ls_mes=null;
	    	String ls_dia=null;
	    	String fecha_consulta=null;
	    	String ls_estado_tramite="3";
	    	String ls_estado_preliq="6";
	    	String ls_estado_liquid="7";
	    	String codigo_fondo="01";
	    	li_retorno = 1;
	    	
	    	Calendar calendario = new GregorianCalendar();
	    	int horadia = calendario.get(Calendar.HOUR_OF_DAY);
		 	int minutos = calendario.get(Calendar.MINUTE);
		 	int segundos = calendario.get(Calendar.SECOND);
		 	
	    	String ls_sql = "";
	    	
	    	ObtieneConexion x= new ObtieneConexion();
			Connection con= x.getConnection();
	    	Statement us  = null;
			ResultSet rs = null;
			PreparedStatement pstmt = null;
			
	    	try{
	    		
	    		//log.info("fecha: " + fecha );
	        	ls_ano = fecha.substring(6, 10);
	        	ls_mes = fecha.substring(3, 5);
	        	ls_dia = fecha.substring(0, 2);
	        	//log.info("ls_ano: " + ls_ano );
	        	//log.info("ls_mes: " + ls_mes );
	        	//log.info("ls_dia: " + ls_dia );
	        	
	        	fecha_consulta = fecha.substring(6,10)+fecha.substring(3,5)+fecha.substring(0,2);
	        	
	        	////log.info("fecha_consulta: " + fecha_consulta);
		    
	        	if(ls_estado_doc.equals("2") || ls_estado_doc.equals("8")){
	        	//Estado es Por Recibir o Por Enviar
	        			   				
	        			 //boolean recepcionReiterativo =	recepcionReiterativo(fecha, fecha_consulta, usuario, hora, codigo_fondo, documento, oficina, ls_correlativorecepcion);
	        			//  if(!recepcionReiterativo){
	        			
	        				/***ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = " +"'"+ls_estado_tramite+
			        		"'"+ ","+"fecha_movimiento="+"'"+fecha+"'"+","+"fecha_consulta="+"'"+fecha_consulta+"'"+
			        		","+" hora_movimiento="+"'"+hora+"'"+"," + " ultimo_usuario=" + "'" +usuario+ "'"+"," +
			        		" flag=" + "''" + " where codigo_fondo="+ "'" + codigo_fondo +
			        		"'" + " and codigo_oficina= "+ "'" +oficina + "'" + " and codigo_documento="+"'"+documento+"'"+
			        		" and codigo_recepcion="+"'"+ls_correlativorecepcion+"'"+ " and secuencia_movimiento="+"'"+secuencia_movimiento+"'"+"";
	        				
	        				us=con.createStatement();
	   			    	    us.executeUpdate(ls_sql);****/	
	        		
	        		/***
	        		 * temporal
	        		 */
	        		
	        				        		
	        		ls_sql = "UPDATE tramite.movimientos_doc SET  codigo_oficina= ?  " +
	        		" where codigo_documento=?  and secuencia_movimiento=? ";
	        		pstmt = con.prepareStatement(ls_sql);

	        		pstmt.setInt(1, Integer.parseInt(oficina));
					pstmt.setInt(2, Integer.parseInt(documento));
					pstmt.setInt(3, Integer.parseInt(secuencia_movimiento));
					log.info("q0: "+pstmt);
			    	 
			    	pstmt.executeUpdate();
			    	
			    	/**
			    	 * fin temporal
			    	 */
	        		
	        		ls_sql = "UPDATE tramite.movimientos_doc "
	        				+ " SET estado_movimiento = ? , fecha_movimiento=? ,fecha_consulta=? "
	        				+ ", hora_movimiento=? , ultimo_usuario=? , flag=?  " +
	        		" where codigo_fondo=?  "
	        		+ " and codigo_oficina= ?  "
	        		+ " and codigo_documento=?  " 
	        		+ " and secuencia_movimiento=?  "
	        		+ " and codigo_recepcion=? ";
	        		
	        		pstmt = con.prepareStatement(ls_sql);

					pstmt.setString(1, ls_estado_tramite);
					pstmt.setString(2, fecha);
					pstmt.setString(3, fecha_consulta);
					pstmt.setTime(4, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
					pstmt.setString(5, usuario);
					pstmt.setString(6, "");
					pstmt.setString(7, codigo_fondo);
					pstmt.setInt(8, Integer.parseInt(oficina));
					pstmt.setInt(9, Integer.parseInt(documento));
					pstmt.setInt(10, Integer.parseInt(secuencia_movimiento));
					pstmt.setInt(11, Integer.parseInt(ls_correlativorecepcion));
			    	
					log.info("q1: "+pstmt);
			    	 
			    	pstmt.executeUpdate();
			    	 
	        			//	}
	        		
			    	 
			    	 /***ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'"+codigo_fondo+"'"+" and codigo_oficina="+"'"+oficina+"'"+
		    	 		" and codigo_documento="+"'"+documento+"' and secuencia_movimiento = "+secuencia_movimiento+
		    	 		" )";
	    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);***/	
			    	 
			    	ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
	    	 		" codigo_fondo=?  and codigo_oficina=?  and codigo_documento=?  and secuencia_movimiento = ?  )";
			    	
			    	pstmt = con.prepareStatement(ls_sql);

			    	pstmt = con.prepareStatement(ls_sql);
					pstmt.setString(1, codigo_fondo);
					pstmt.setInt(2, Integer.parseInt(oficina));
					pstmt.setInt(3, Integer.parseInt(documento));
					pstmt.setInt(4, Integer.parseInt(secuencia_movimiento));
			    	 
					log.info("q2: "+pstmt);
			    	pstmt.executeUpdate();
			    	
			    	
			    	 String codigo_documento_interno="";
			    	 
			    	 ls_sql = "select codigo_documento_interno from tramite.documento_tipo_documento_interno "+
			    	 " where codigo_documento=?  and secuencia_movimiento_destino =?  and codigo_estado_documento=? ";

			    	 log.info("ls_sql............   " + ls_sql );
			    	 pstmt = con.prepareStatement(ls_sql);

						pstmt.setInt(1, Integer.parseInt(documento));
						pstmt.setInt(2, Integer.parseInt(secuencia_movimiento));
						pstmt.setInt(3, 3);
				    	 
						log.info("q3: "+pstmt);
				    rs=pstmt.executeQuery();
				    	
					 while (rs.next()){ 
		    	   			codigo_documento_interno = rs.getString("codigo_documento_interno");
		    	   			
			    	}
		    	   	
					 //ACTUALIZO LOS PROYECTOS PARA QUE PUEDAN SER VISTOS POR EL QUE RECIBE
					if(codigo_documento_interno!=null && !codigo_documento_interno.equals("")){
						ls_sql="update tramite.tbl_det_upinternos set estado_usuario_origen = 'C', estado_usuario_fin = 'A' "+
			    		" where id_det_upinternos IN (select  b.id_det_upinternos  from  tramite.tbl_cab_upinternos a, tramite.tbl_det_upinternos b "+ 
			    		" where a.id_cab_upinternos = b.id_cab_upinternos and a.codigo_documento_interno =?  and a.codigos_documento_interno_proyecto > 0 )";
			    			
			    		log.info("ls_sql............   " +ls_sql);
			    		 pstmt = con.prepareStatement(ls_sql);

							pstmt.setInt(1, Integer.parseInt(codigo_documento_interno.trim()));
							pstmt.executeUpdate();
					}
						
		    	   	
		    		x.cerrar_conexion(con,rs);
		    		pstmt.close();
		    		
	        	}
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );
	    		x.cerrar_conexion(con);
	    		//x.cerrar_conexion(cnx);
	    	}

		}
	 
	 private boolean recepcionReiterativo(String fecha, String fecha_consulta, String usuario, String hora, String codigo_fondo, String documento, String oficina, String ls_correlativorecepcion) throws Exception {
		
		 //En desarrollo Falta Analisis
		 Collection listado = secuencias(documento,oficina);
		 boolean recepcionReiterativo = false;
		 String  ls_sql = "";
		if(listado!=null && listado.size()>1){
			recepcionReiterativo = true;
			
			//Actualizar a estado tramitado
			ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = 3" +
			","+"fecha_movimiento="+"'"+fecha+"'"+","+"fecha_consulta="+"'"+fecha_consulta+"'"+
 		   ","+" hora_movimiento="+"'"+hora+"'"+"," + " ultimo_usuario=" + "'" +usuario+ "'"+"," +
 		   " flag=" + "''" + " where codigo_fondo="+ "'" + codigo_fondo +
 		   "'" + " and codigo_oficina= "+ "'" +oficina + "'" + " and codigo_documento="+"'"+documento+"'"+
 		   " and codigo_recepcion="+"'"+ls_correlativorecepcion+"'";
			
			//Archivar el resto
			Iterator it = listado.iterator();
			BMesaPartes mesa = null;
			int i=0;
			while(it.hasNext()){
				i++;
				if(i>=1){
					mesa = (BMesaPartes)it.next();
										
				}				
			}
			
		}
		 
		
		return recepcionReiterativo;
	}
	private Collection secuencias(String documento,
			String oficina) throws Exception{

		ObtieneConexion x= new ObtieneConexion();
		Connection cnx= x.getConnection();
		Statement us = null;
		ResultSet rs  = null;
		String ls_sql = "";
		Collection listado = new ArrayList();
		try{
			ls_sql = "select * from tramite.movimientos_doc where codigo_documento = "+documento+" and codigo_oficina = "+oficina;
			us = cnx.createStatement();
	    	rs = us.executeQuery(ls_sql);
	    	BMesaPartes mesa = null;
	    	while(rs.next()){
	    		mesa = new BMesaPartes();
	    		mesa.setCodigo_documento(rs.getString(""));
	    		
	    		listado.add(mesa);
	    	}
			x.cerrar_conexion(cnx,rs);
			
		}catch(Exception e){
			e.printStackTrace();
			x.cerrar_conexion(cnx);
		}
		return listado;
	}
	public BMesaPartes of_obtener_padre(Connection cnx,String documento) throws Exception {
			
	        //log.info("ENTRO A  Obtener documento padre");
			
	        SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_sistema  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String yearactual = year.format(d);
	    	
	    	
	    /*	//log.info("FECHA fecha_sistema.... : " + fecha_sistema);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);*/
	    	
	    	
        	
	        BMesaPartes BMesaPartesVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "select codigo_inicia  from tramite.movimientos_doc WHERE " +
	        			"codigo_documento=" + "'" + documento + "'" + "";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BMesaPartesVO = new BMesaPartes();
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					
					
				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return BMesaPartesVO;
		                
		}
	 
//1
	 public void of_registrar_derivacion_mismo(Connection cnx,String ls_oficina,String codigo_oficina,String codigo_motivo,String observacion
	   			,String destinatario,String ls_documento,String ls_secuencia,String ls_usuario,String ls_codigoPadre,
	   			int correla,String fecha_rpta,int codigo_expediente,String ls_descripcion_oficina,
	   			int codigo_recepcion,String doc_resp,String fecha_rpta_rq,Character tipo_envio) {

	    	log.info("Dentro del of_registrar_derivacion_mismo.......1" );
	    	log.info("Envio E o I oficinas diferentes y funcion usada para enviar a copias----REITERATIVO");
	    	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	Calendar calendario = new GregorianCalendar();
	    	
	    	int horadia = calendario.get(Calendar.HOUR_OF_DAY);
   		 	int minutos = calendario.get(Calendar.MINUTE);
   		 	int segundos = calendario.get(Calendar.SECOND);
   		 	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "2";
	    	String ls_valor  = "";
	    	String origen_documento  = "";
	    	
	    	String horaActual = "00:00:00";
	    	Calendar cal = Calendar.getInstance();
	        Date hora = cal.getTime();
	        DateFormat df = DateFormat.getTimeInstance();
	        horaActual = df.format(hora);
	        
	       // //log.info("horaActual.... : " + horaActual);
	       
	        
	    	int    li_retorno =0;
	    	int    li_secuencia =0;
	    	int    li_secuencia_nueva =1;
	    	int    li_secuencia_recorrido =0;
	    	
	    //	//log.info("eL ls_secuencia ES.... : " + ls_secuencia);
	    	
	    	li_secuencia_recorrido=Integer.valueOf(ls_secuencia).intValue()+1;
	    	
	    	
	    	log.info("eL li_secuencia_recorrido ES.... : " + li_secuencia_recorrido);
	    	 
	    	int    li_parcial = 0 ;
	    	
	    	String codigo_documento= "" ;
	    	String ls_extraer_year= "" ;
	    	
	    	String ls_correlativo=null;
	    	
	    	Statement us  = null;
			ResultSet rs = null;
			PreparedStatement pstm = null;
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
	    		
	    	
	    		ls_sql = "Select coalesce(max(secuencia_movimiento),0)+1 as c_valor from tramite.movimientos_doc where codigo_documento =?";
	    		pstm = con.prepareStatement(ls_sql);
				pstm.setInt(1, Integer.parseInt(ls_codigoPadre));
				rs = pstm.executeQuery();
			
				while(rs.next()){
					li_secuencia_nueva = rs.getInt("c_valor");

		 		}
				
		    	/** if (rs == null){	
		    			li_secuencia_nueva = 1;
		    	 }else if( rs.next() ) {                        
			    		li_secuencia_nueva = rs.getInt("c_valor");
			    		log.info("nuevo li_secuencia :" + li_secuencia_nueva);			    				    					    				           
		    	 }***/
			        
		    	 
		    	 //Se quito el correlativo_deriva !!
				
				StringBuffer ls_sql_1 = new StringBuffer("insert into tramite.movimientos_doc(codigo_documento," +
		 		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie,codigo_motivo," +
		 		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		 		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
		 		 		"oficina_deriva,destinatario,fecha_rpta,codigo_expediente,oficina_origen,desc_origen," +
		 		 		"codigo_recepcion,doc_resp,fecha_rpta_rq,tipo_envio) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)");
				
				pstm = con.prepareStatement(ls_sql_1.toString());
				pstm.setInt(1, Integer.parseInt(ls_codigoPadre));
				pstm.setString(2, "01");
				pstm.setInt(3, li_secuencia_nueva);						
		    	pstm.setInt(4, Integer.parseInt(codigo_oficina));
		    	pstm.setString(5, "01");
		    	pstm.setInt(6, Integer.parseInt(codigo_motivo));
		    	pstm.setString(7, origen_documento);
		    	 
		    	 	if(codigo_oficina.equals("1")){//Si es PRESIDENCIA el codigo de Oficina -> EL estado es por RECIBIR
		    		 pstm.setString(8, "8");
		    		// ls_sql_1.append("'8'");
		    		 //log.info("el ls_codigo_oficina: " + ls_sql);
					}
					else{
						
						//En otro caso Estado Por Recibir
						pstm.setString(8, "2");
						//ls_sql_1.append("'2'");
						//log.info("el ls_codigo_oficina: " + ls_sql);
					}

		    	 pstm.setString(9, fecha_documento);
		    	 pstm.setString(10, fechaconsulta);
		    	 pstm.setTime(11, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
		    	 pstm.setString(12, observacion);
		    	 pstm.setInt(13, Integer.parseInt(ls_codigoPadre));
		    	 pstm.setString(14, ls_usuario);
		    	 pstm.setString(15, "01");
		    	 pstm.setInt(16, Integer.parseInt(codigo_oficina));
		    	 pstm.setString(17, destinatario);
		    	 pstm.setString(18, fecha_rpta);
		    	 pstm.setInt(19, codigo_expediente);
		    	 pstm.setInt(20, Integer.parseInt(ls_oficina));
		    	 pstm.setString(21, ls_descripcion_oficina);
		    	 pstm.setInt(22, correla);
		    	 pstm.setString(23, doc_resp);
		    	 pstm.setString(24, fecha_rpta_rq);
		    	 pstm.setString(25, tipo_envio.toString());
		    	 
		    	 
		    	 pstm.executeUpdate();
				
				
				
				
		    /***	 StringBuffer ls_sql_1 = new StringBuffer("insert into tramite.movimientos_doc(codigo_documento," +
 		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie,codigo_motivo," +
 		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
 		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
 		 		"oficina_deriva,destinatario,fecha_rpta,codigo_expediente,oficina_origen,desc_origen," +
 		 		"codigo_recepcion,doc_resp,fecha_rpta_rq,tipo_envio)");   
		    	 
		    	 ls_sql_1.append(" values(" + "'" + ls_codigoPadre + "'"
	 	 		+ "," +"'01'"+","+"'"+ li_secuencia_nueva + "'"+ "," +"'" 
	 	 		+ codigo_oficina + "'"+ "," +"'01'"+ "," + "'" + codigo_motivo + "'"+ "," + "'" +
	 	 		origen_documento + "'"+ ",");
		    	 
		    	 if(codigo_oficina.equals("1")){//Si es PRESIDENCIA el codigo de Oficina -> EL estado es por RECIBIR
		    		 ls_sql_1.append("'8'");
		    		 //log.info("el ls_codigo_oficina: " + ls_sql);
					}
				else{
					
					//En otro caso Estado Por Recibir
					ls_sql_1.append("'2'");
					//log.info("el ls_codigo_oficina: " + ls_sql);
				}

		    	 ls_sql_1.append("," +"'" + fecha_documento + "'"+ "," +"'" + fechaconsulta + "'"+ "," +"'" + horaActual + "'"
	 	 		+ "," +"'" + observacion + "'"+ "," +"'" + ls_codigoPadre + "'"
	 	 		+ "," +"'" + ls_usuario + "'"+ "," +"'01'"+ "," +"'" + codigo_oficina + "'"+
	 	 		"," +"'" + destinatario + "'"+","+"'"+fecha_rpta+"'"+","+"'"+codigo_expediente+"'"+
	 			","+"'"+ls_oficina+"'"+
	 	 		","+"'"+ls_descripcion_oficina+"'"+
	 	 		","+"'"+correla+"'"+
	 	 		","+"'"+doc_resp+"'"+
	 	 		","+"'"+fecha_rpta_rq+"'"+
	 	 		",'"+tipo_envio+"')");  
		    	 //log.info("El primer ls_sql_1 es..!!" + ls_sql_1);
		    	 String query = ls_sql_1.toString();
		    	 pstm = con.prepareStatement(query);
		    	 pstm.executeUpdate();***/

		    	//log.info("El primer query es..!!" + query);
		    	//log.info("El primer pstm es..!!" + pstm);
		    	//log.info("El primer ls_sql_1 es..!!" + ls_sql_1);
		    	 /*us = con.createStatement();
		    	 us.executeUpdate(ls_sql);
		    	 */
		    	
			    	 //log.info("La secuencia del movimiento lista seleccionado es:" + ls_secuencia );
		    	 
		    	 ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento=?, fecha_movimiento=?, hora_movimiento=?, "
		    		 +"ultimo_usuario=? ,fecha_rpta=?  where codigo_fondo=?  and  codigo_oficina=? "+
		    		 " and codigo_documento=?  and secuencia_movimiento=? ";
		    	 
		    	 	pstm = con.prepareStatement(ls_sql);
		    	 	pstm.setString(1, "5");
		    	 	pstm.setString(2, fecha_documento);
		    	 	pstm.setTime(3, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
		    	 	pstm.setString(4, ls_usuario);
		    	 	pstm.setString(5, fecha_rpta);
		    	 	pstm.setString(6, "01");
		    	 	pstm.setInt(7, Integer.parseInt(ls_oficina));
					pstm.setInt(8, Integer.parseInt(ls_codigoPadre));
					pstm.setInt(9, Integer.parseInt(ls_secuencia));
						
					pstm.executeUpdate();
		    	 
		    	/***	 ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento="+"'5'"+","+
			    	 "fecha_movimiento="+"'"+fecha_documento+"'"+","+"hora_movimiento="+
			    	 "'"+horaActual+"'"+","+"ultimo_usuario="+"'"+ls_usuario+"'"+
			    	 ","+"fecha_rpta="+"'"+fecha_rpta+"'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+ls_secuencia+"'"+"";
			    	//log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); ***/
			    	 
			    	 /********************registrando derivacion documento***********/
			    	 
			    	 //log.info("Si el valor es 0 a ingresar duplicacion derivacion");
					
					ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
	    	 		" codigo_fondo=?  and codigo_oficina=? "+
	    	 		" and codigo_documento=?  and secuencia_movimiento=? )";
					pstm = con.prepareStatement(ls_sql);
		    	 	pstm.setString(1, "01");
		    	 	pstm.setInt(2, Integer.parseInt(codigo_oficina));
					pstm.setInt(3, Integer.parseInt(ls_codigoPadre));
					pstm.setInt(4, li_secuencia_nueva);
						
					pstm.executeUpdate();
					
					
		 			/** ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+"'"+li_secuencia_nueva+"'"+
		    	 		" )";
				    	 
			    	//log.info("El ls_sql insert recorrido_doc 2 documento es" + ls_sql);	 
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);***/
			    	 
					 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo=?  and codigo_oficina=? "+
		    	 		" and codigo_documento=?  and secuencia_movimiento=? )";
					 
						pstm = con.prepareStatement(ls_sql);
			    	 	pstm.setString(1, "01");
			    	 	pstm.setInt(2, Integer.parseInt(ls_oficina));
						pstm.setInt(3, Integer.parseInt(ls_codigoPadre));
						pstm.setInt(4, Integer.parseInt(ls_secuencia));
							
						pstm.executeUpdate();
					
			    	 /***ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+"'"+ls_secuencia+"'"+
		    	 		" )";
			    	 
			    	 ////log.info("El ls_sql insert recorrido_doc 1 documento es" + ls_sql);
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	***/
				    
			    	  
			    	 //log.info("update a los estados del recorrido es:" + ls_secuencia );
						
					ls_sql = "UPDATE tramite.recorrido_doc SET estado=? "+
			    	 " where codigo_fondo=?  and codigo_oficina=? "+
			    	 " and codigo_documento=?  and secuencia_movimiento=? ";
					pstm = con.prepareStatement(ls_sql);
		    	 	pstm.setString(1, "2");
		    	 	pstm.setString(2, "01");
		    	 	pstm.setInt(3, Integer.parseInt(ls_oficina));
					pstm.setInt(4, Integer.parseInt(ls_codigoPadre));
					pstm.setInt(5, Integer.parseInt(ls_secuencia));
						
					pstm.executeUpdate();
					
						
		    		 /***ls_sql = "UPDATE tramite.recorrido_doc SET estado="+"'2'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+ls_secuencia+"'"+"";
			    	// //log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); ***/
			    	 
			    	// //log.info("update a los estados 2 del recorrido es:" + ls_secuencia );
					
					ls_sql = "UPDATE tramite.recorrido_doc SET estado=? "+
			    	 " where codigo_fondo=?  and codigo_oficina=? "+
			    	 " and codigo_documento=?  and secuencia_movimiento=? ";
					
					pstm = con.prepareStatement(ls_sql);
		    	 	pstm.setString(1, "1");
		    	 	pstm.setString(2, "01");
		    	 	pstm.setInt(3, Integer.parseInt(codigo_oficina));
					pstm.setInt(4, Integer.parseInt(ls_codigoPadre));
					pstm.setInt(5, li_secuencia_nueva);
						
					pstm.executeUpdate();
					
		    		/**** ls_sql = "UPDATE tramite.recorrido_doc SET estado="+"'1'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+li_secuencia_nueva+"'"+"";
			    	// //log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); **/
			    	 
			    	 x.cerrar_conexion(con);
			    	 pstm.close();
			   
	    	}
	    	catch(Exception e){
	    		e.printStackTrace();
	    		x.cerrar_conexion(con);
	    	}

		}
	 
//3
	 public void of_registrar_derivacion_mismo(Connection cnx,String ls_oficina,String codigo_oficina,String codigo_motivo,String observacion
	   			,String destinatario,String ls_documento,String ls_secuencia,String ls_usuario,String ls_codigoPadre,
	   			int correla,String fecha_rpta,int codigo_expediente,String ls_descripcion_oficina,
	   			int codigo_recepcion,String doc_resp,String fecha_rpta_rq,Character tipo_envio,int secuencia_origen) {
	    	
	     //   obtenermos el valor maximo...
	    	log.info("Dentro del of_registrar_derivacion_mismo....con secuencia origen...3----PRINCIPAL Y COPIAS ----- TODAS LAS OFICINAS" );
	    	
	    	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	Calendar calendario = new GregorianCalendar();
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "2";
	    	String ls_valor  = "";
	    	String origen_documento  = "";
	    	int secuencia_origen_ls=secuencia_origen;
	    	
   		 	int horadia = calendario.get(Calendar.HOUR_OF_DAY);
   		 	int minutos = calendario.get(Calendar.MINUTE);
   		 	int segundos = calendario.get(Calendar.SECOND);
	    	
	    	log.info("secuencia_origen_ls >"+secuencia_origen_ls);
	    	
	    	String horaActual = "00:00:00";
	    	Calendar cal = Calendar.getInstance();
	        Date hora = cal.getTime();
	        DateFormat df = DateFormat.getTimeInstance();
	        horaActual = df.format(hora);
	        
	       // //log.info("horaActual.... : " + horaActual);
	       
	        
	    	int    li_retorno =0;
	    	int    li_secuencia =0;
	    	int    li_secuencia_nueva =1;
	    	int    li_secuencia_recorrido =0;
	    	
	    //	//log.info("eL ls_secuencia ES.... : " + ls_secuencia);
	    	
	    	li_secuencia_recorrido=Integer.valueOf(ls_secuencia).intValue()+1;
	    	
	    	
	    	log.info("eL li_secuencia_recorrido ES.... : " + li_secuencia_recorrido);
	    	 
	    	int    li_parcial = 0 ;
	    	
	    	String codigo_documento= "" ;
	    	String ls_extraer_year= "" ;
	    	
	    	String ls_correlativo=null;
	    	
	    	
	    	ObtieneConexion x= new ObtieneConexion();
			Connection	con= x.getConnection();
			
	    	Statement us  = null;
			ResultSet rs = null;
			PreparedStatement pstm = null;
	    	String ls_sql = "";
			
	    	try{
	    		
	    	
	    	ls_sql = "Select coalesce(max(secuencia_movimiento),0)+1 as c_valor from tramite.movimientos_doc where codigo_documento =? ";
	    	pstm = con.prepareStatement(ls_sql);
			pstm.setInt(1, Integer.parseInt(ls_codigoPadre));
			rs = pstm.executeQuery();
		
			while(rs.next()){
				li_secuencia_nueva = rs.getInt("c_valor");

	 		}
			
 			/**us = con.createStatement();
		    rs = us.executeQuery(ls_sql);
		    //log.info("El resultset es: " + rs);
				
		    	if (rs == null) {	
		    			li_secuencia_nueva = 1;
		    	}else if( rs.next() ) {                        
			    		li_secuencia_nueva = rs.getInt("c_valor");
			    		log.info("nuevo li_secuencia :" + li_secuencia_nueva);			    				    					    				           
			    }***/
			        
			StringBuffer ls_sql_1 = new StringBuffer("insert into tramite.movimientos_doc(codigo_documento," +
	 		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie,codigo_motivo," +
	 		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
	 		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
	 		 		"oficina_deriva,destinatario,fecha_rpta,codigo_expediente,oficina_origen,desc_origen," +
	 		 		"codigo_recepcion,doc_resp,fecha_rpta_rq,tipo_envio,secuencia_origen) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)");
			
			/*origen_documento=(origen_documento.equals(""))? null:origen_documento;
			fecha_rpta=(fecha_rpta.equals(""))? null:fecha_rpta;
			ls_descripcion_oficina=(ls_descripcion_oficina.equals(""))? null:ls_descripcion_oficina;
			doc_resp=(doc_resp.equals(""))? null:doc_resp;
			fecha_rpta_rq=(fecha_rpta_rq.equals(""))? null:fecha_rpta_rq;*/
			
    		log.info("-->"+Integer.parseInt(ls_codigoPadre)+","+"01"+","+li_secuencia_nueva+","+Integer.parseInt(codigo_oficina));
    		log.info("-->"+"01"+","+codigo_motivo+","+origen_documento+",8,"+fecha_documento+","+fechaconsulta);
    		log.info("-->"+Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
    		log.info("-->"+observacion+","+Integer.parseInt(ls_codigoPadre)+","+ls_usuario+",01,");
    		log.info("-->"+Integer.parseInt(codigo_oficina)+","+destinatario+","+fecha_rpta+","+codigo_expediente);
    		log.info("-->"+Integer.parseInt(ls_oficina)+","+ls_descripcion_oficina+","+correla);
    		log.info("-->"+doc_resp+","+fecha_rpta_rq+","+tipo_envio.toString());
    		log.info("-->"+secuencia_origen_ls);
    		
    		doc_resp= (doc_resp.length()>79)? doc_resp.substring(0, 78):doc_resp;
    		
			
			pstm = con.prepareStatement(ls_sql_1.toString());
			pstm.setInt(1, Integer.parseInt(ls_codigoPadre));
			pstm.setString(2, "01");
			pstm.setInt(3, li_secuencia_nueva);						
	    	pstm.setInt(4, Integer.parseInt(codigo_oficina));
	    	pstm.setString(5, "01");
	    	pstm.setInt(6, Integer.parseInt(codigo_motivo));
	    	pstm.setString(7, origen_documento);
	    	 
	    	 	if(codigo_oficina.equals("1")){//Si es PRESIDENCIA el codigo de Oficina -> EL estado es por RECIBIR
	    		 pstm.setString(8, "8");
	    		// ls_sql_1.append("'8'");
	    		 //log.info("el ls_codigo_oficina: " + ls_sql);
				}
				else{
					
					//En otro caso Estado Por Recibir
					pstm.setString(8, "2");
					//ls_sql_1.append("'2'");
					//log.info("el ls_codigo_oficina: " + ls_sql);
				}

	    	 pstm.setString(9, fecha_documento);
	    	 pstm.setString(10, fechaconsulta);
	    	 pstm.setTime(11, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
	    	 pstm.setString(12, observacion);
	    	 pstm.setInt(13, Integer.parseInt(ls_codigoPadre));
	    	 pstm.setString(14, ls_usuario);
	    	 pstm.setString(15, "01");
	    	 pstm.setInt(16, Integer.parseInt(codigo_oficina));
	    	 pstm.setString(17, destinatario);
	    	 pstm.setString(18, fecha_rpta);
	    	 pstm.setInt(19, codigo_expediente);
	    	 pstm.setInt(20, Integer.parseInt(ls_oficina));
	    	 pstm.setString(21, ls_descripcion_oficina);
	    	 pstm.setInt(22, correla);
	    	 pstm.setString(23, doc_resp);
	    	 pstm.setString(24, fecha_rpta_rq);
	    	 pstm.setString(25, tipo_envio.toString());
	    	 pstm.setInt(26, secuencia_origen_ls);
	    	 pstm.executeUpdate();	 
	    	 
		    	 //Se quito el correlativo_deriva !!
		    /***	StringBuffer ls_sql_1 = new StringBuffer("insert into tramite.movimientos_doc(codigo_documento," +
		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie,codigo_motivo," +
		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
		 		"oficina_deriva,destinatario,fecha_rpta,codigo_expediente,oficina_origen,desc_origen," +
		 		"codigo_recepcion,doc_resp,fecha_rpta_rq,tipo_envio,secuencia_origen)");   //SECUENCIA ORIGEN
		    	 
		    	 ls_sql_1.append(" values(" + "'" + ls_codigoPadre + "'"+ "," +"'01'"+","+"'"+ li_secuencia_nueva + "'"+ "," +"'" 
	 	 		+ codigo_oficina + "'"+ "," +"'01'"+ "," + "'" + codigo_motivo + "'"+ "," + "'" +origen_documento+ "'"+ ",");
		    	 
		    	if(codigo_oficina.equals("1")){//Si es PRESIDENCIA el codigo de Oficina -> EL estado es por RECIBIR
		    		ls_sql_1.append("'8'");
		    		 //log.info("el ls_codigo_oficina: " + ls_sql);
				}else{	
					//En otro caso Estado Por Recibir
					ls_sql_1.append("'2'");
					//log.info("el ls_codigo_oficina: " + ls_sql);
				}

		    	 ls_sql_1.append("," +"'" + fecha_documento + "'"+ "," +"'" + fechaconsulta + "'"+ "," +"'" + horaActual + "'"
	 	 		+ "," +"'" + observacion + "'"+ "," +"'" + ls_codigoPadre + "'"
	 	 		+ "," +"'" + ls_usuario + "'"+ "," +"'01'"+ "," +"'" + codigo_oficina + "'"+
	 	 		"," +"'" + destinatario + "'"+","+"'"+fecha_rpta+"'"+","+"'"+codigo_expediente+"'"+
	 			","+"'"+ls_oficina+"'"+
	 	 		","+"'"+ls_descripcion_oficina+"'"+
	 	 		","+"'"+correla+"'"+
	 	 		","+"'"+doc_resp+"'"+
	 	 		","+"'"+fecha_rpta_rq+"'"+
	 	 		",'"+tipo_envio+"',"+secuencia_origen_ls+")");  
		    	 //log.info("El primer ls_sql_1 es..!!" + ls_sql_1);
		    	 
		    	 String query = ls_sql_1.toString();
		    	 pstm = con.prepareStatement(query);
		    	 pstm.executeUpdate();***/

		    	//log.info("El primer query es..!!" + query);
		    	//log.info("El primer pstm es..!!" + pstm);
		    	//log.info("El primer ls_sql_1 es..!!" + ls_sql_1);
		    	 /*us = con.createStatement();
		    	 us.executeUpdate(ls_sql);
		    	 */
		    	
			    	 //log.info("La secuencia del movimiento lista seleccionado es:" + ls_secuencia );
	    	 
	    	 if(!tipo_envio.toString().equals("R")){
	    		 ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento=?, fecha_movimiento=?, hora_movimiento=?, "
	    	    		 +" ultimo_usuario=? ,fecha_rpta=?  "
	    	    		 + " where codigo_fondo=?  "
	    	    		 + "and  codigo_oficina=? "+
	    	    		 "  and codigo_documento=?  "
	    	    		 + "and secuencia_movimiento=? ";
	    	    		 
	    	    	 
	    	    	 	pstm = con.prepareStatement(ls_sql);
	    	    	 	pstm.setString(1, "5");
	    	    	 	pstm.setString(2, fecha_documento);
	    	    	 	pstm.setTime(3, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
	    	    	 	pstm.setString(4, ls_usuario);
	    	    	 	pstm.setString(5, fecha_rpta);
	    	    	 	pstm.setString(6, "01");
	    	    	 	pstm.setInt(7, Integer.parseInt(ls_oficina));
	    				pstm.setInt(8, Integer.parseInt(ls_codigoPadre));
	    				pstm.setInt(9, Integer.parseInt(ls_secuencia));
	    					
	    				pstm.executeUpdate();
	    	 }
	    	 
	    	 
		    	/***	 ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento="+"'5'"+","+
			    	 "fecha_movimiento="+"'"+fecha_documento+"'"+","+"hora_movimiento="+
			    	 "'"+horaActual+"'"+","+"ultimo_usuario="+"'"+ls_usuario+"'"+
			    	 ","+"fecha_rpta="+"'"+fecha_rpta+"'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+ls_secuencia+"'"+"";
			    	//log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); ***/
			    	 
			    	 /********************registrando derivacion documento***********/
			    	 
			    	 //log.info("Si el valor es 0 a ingresar duplicacion derivacion");
				ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
    	 		" codigo_fondo=?  and codigo_oficina=? "+
    	 		" and codigo_documento=?  and secuencia_movimiento=? )";
				pstm = con.prepareStatement(ls_sql);
	    	 	pstm.setString(1, "01");
	    	 	pstm.setInt(2, Integer.parseInt(codigo_oficina));
				pstm.setInt(3, Integer.parseInt(ls_codigoPadre));
				pstm.setInt(4, li_secuencia_nueva);
					
				pstm.executeUpdate();
				
		 			/*** ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+"'"+li_secuencia_nueva+"'"+
		    	 		" )";
				    	 
			    	//log.info("El ls_sql insert recorrido_doc 2 documento es" + ls_sql);	 
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);***/
				
				
				ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
    	 		" codigo_fondo=?  and codigo_oficina=? "+
    	 		" and codigo_documento=?  and secuencia_movimiento=? )";
			 
				pstm = con.prepareStatement(ls_sql);
	    	 	pstm.setString(1, "01");
	    	 	pstm.setInt(2, Integer.parseInt(ls_oficina));
				pstm.setInt(3, Integer.parseInt(ls_codigoPadre));
				pstm.setInt(4, Integer.parseInt(ls_secuencia));
				pstm.executeUpdate();
			    	 
			   /*** 	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+"'"+ls_secuencia+"'"+
		    	 		" )";
			    	 
			    	 ////log.info("El ls_sql insert recorrido_doc 1 documento es" + ls_sql);
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	****/
				    
			    	  
			    	 //log.info("update a los estados del recorrido es:" + ls_secuencia );
				
				ls_sql = "UPDATE tramite.recorrido_doc SET estado=? "+
		    	 " where codigo_fondo=?  and codigo_oficina=? "+
		    	 " and codigo_documento=?  and secuencia_movimiento=? ";
				pstm = con.prepareStatement(ls_sql);
	    	 	pstm.setString(1, "2");
	    	 	pstm.setString(2, "01");
	    	 	pstm.setInt(3, Integer.parseInt(ls_oficina));
				pstm.setInt(4, Integer.parseInt(ls_codigoPadre));
				pstm.setInt(5, Integer.parseInt(ls_secuencia));
					
				pstm.executeUpdate();
				
		    	/***	 ls_sql = "UPDATE tramite.recorrido_doc SET estado="+"'2'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+ls_secuencia+"'"+"";
			    	// //log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); ***/
			    	 
			    	// //log.info("update a los estados 2 del recorrido es:" + ls_secuencia );
				
				ls_sql = "UPDATE tramite.recorrido_doc SET estado=? "+
		    	 " where codigo_fondo=?  and codigo_oficina=? "+
		    	 " and codigo_documento=?  and secuencia_movimiento=? ";
				
				pstm = con.prepareStatement(ls_sql);
	    	 	pstm.setString(1, "1");
	    	 	pstm.setString(2, "01");
	    	 	pstm.setInt(3, Integer.parseInt(codigo_oficina));
				pstm.setInt(4, Integer.parseInt(ls_codigoPadre));
				pstm.setInt(5, li_secuencia_nueva);
					
				pstm.executeUpdate();
				
		    	/***	 ls_sql = "UPDATE tramite.recorrido_doc SET estado="+"'1'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+li_secuencia_nueva+"'"+"";
			    	// //log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); ***/
			    	 
			    	 
			  x.cerrar_conexion(con,rs);
			  pstm.close();
			   
	    	}
	    	catch(Exception e){
	    		e.printStackTrace();
	    		x.cerrar_conexion(con);
	    	}

		}
	 
	 public  Collection of_lista_derivacion_documento(Connection cnx,int correla) throws Exception {
			
	        //log.info("ENTRO A  Lista Frame derivacion documento");
			Collection ListaDerivacionDocumento = new ArrayList();
			
			BMesaPartes BMesaPartesVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "select md.oficina_deriva,of.descripcion_oficina,md.codigo_motivo," +
	        			"pe.nombre_personal,md.destinatario,md.observa_movimiento,mt.descripcion_motivo" +
	        			" from tramite.movimientos_doc md,tramite.oficinas of,tramite.personal pe," +
	        			"tramite.motivo mt where md.oficina_deriva=of.codigo_oficina and" +
	        			" md.destinatario=pe.codigo_personal and md.codigo_motivo=mt.codigo_motivo" +
	        			" and md.correlativo_deriva="+"'"+correla+"'"+"";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BMesaPartesVO = new BMesaPartes();
					
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_motivo(rs.getString("descripcion_motivo"));	
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));	
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));	
					
					ListaDerivacionDocumento.add(BMesaPartesVO);

				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaDerivacionDocumento;
		                
		}
	 
	 public BPersonal  of_datos_personal(Connection cnx,String codpersonal) throws Exception {
			
	        //log.info("ENTRO A  Lista de Datos de Usuario");
			Collection ListaDatosPersonal = new ArrayList();
			
			BPersonal BPersonalVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "select codigo_personal,nombre_personal,c_usuario from tramite.personal " +
	        			"WHERE codigo_personal =" + "'" + codpersonal + "'"+ "";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BPersonalVO = new BPersonal();
					BPersonalVO.setCodigo_personal(rs.getString("codigo_personal"));
					BPersonalVO.setNombre_personal(rs.getString("nombre_personal"));
					BPersonalVO.setC_usuario(rs.getString("c_usuario"));
					

				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return BPersonalVO;
		                
		}
	 
	 public Collection of_lista_derivacion(Connection cnx,String codigo_oficina,
				String descripcion_oficina,String codigo_motivo,String descripcion_motivo,
				String destinatario,String nom_persona,String observacion) throws Exception {
			
	        //log.info("ENTRO A  Lista de Datos de Usuario");
			Collection listaDocumentos = new ArrayList();
			
			BPersonal BPersonalVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	
					
					BPersonalVO.setCodigo_oficina(codigo_oficina);
					BPersonalVO.setDescripcion_oficina(descripcion_oficina);
					BPersonalVO.setCodigo_motivo(codigo_motivo);
					BPersonalVO.setDescripcion_motivo(descripcion_motivo);
					BPersonalVO.setDestinatario(destinatario);
					BPersonalVO.setNom_persona(nom_persona);
					BPersonalVO.setObservacion(observacion);

					listaDocumentos.add(BPersonalVO);
				
	        } catch (Exception e) {
	             e.printStackTrace();
	        }
	        return listaDocumentos;
		                
		}
	 
	 public int parametro(Connection cnx) {
	    	int li_retorno;
	    	li_retorno = 0; 
	    	// obtenermos el valor maximo...
	    	Statement us  = null;
	    	ResultSet rs = null;
	    	ObtieneConexion 	x= new ObtieneConexion();
	    	Connection	cn = x.getConnection();
	    	String ls_sql = "";
	    	try{
	    		ls_sql = "update tramite.parametro set valor = valor + 1";
	    		us = cn.createStatement();
	    		us.executeUpdate(ls_sql);
	    		ls_sql = "Select valor from tramite.parametro";
	    		rs = us.executeQuery(ls_sql);
	    		while ( rs.next() ) { 
	    				            //log.info("dentro del whyle......." );
	    				            li_retorno = Integer.valueOf(rs.getString("valor")).intValue(); 
	    				            //log.info("ls_valor :" + rs.getString("valor"));
	    		}
	    		
	    		x.cerrar_conexion(cn,rs);
	    		us.close();
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );
	    		x.cerrar_conexion(cn,rs);
	    		
	    	} 
	    	return li_retorno;

		}
	 
	 public BMesaPartes  of_detalle_documento(Connection cnx,String oficina,String documento,String secuencia) throws Exception {
			
	        log.info("ENTRO Al detalle documento");
			
			
	        BMesaPartes BMesaPartesVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       Funciones funciones=new Funciones();
	       ObtieneConexion x= new ObtieneConexion();
			Connection	con= x.getConnection();
	        try {	
	        	
	        	

	        	String ls_sql = "select md.codigo_documento,md.fecha_movimiento,md.hora_movimiento," +
	        			"md.estado_movimiento,md.secuencia_movimiento,md.ultimo_usuario,md.doc_deriva," +
	        			"md.observa_movimiento,md.codigo_motivo,md.codigo_inicia,md.oficina_origen,md.oficina_deriva,md.codigo_recepcion,md.codigo_expediente,md.fecha_rpta,tp.descripcion_tipo," +
	        			"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,de.origen_documento," +
	        			"de.destino_documento,de.desc_origen,de.tipo,de.remitente,de.destinatario,de.firmadopor,of.codigo_oficina," +
	        			"of.descripcion_oficina,pr.codigo_personal,pr.nombre_personal,dc.fecha_registro," +
	        			"dc.hora_registro,dc.folios_documento,dc.observa_documento from tramite.movimientos_doc md," +
	        			"tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de,tramite.oficinas of," +
	        			"tramite.personal pr where tp.codigo_tipo=dc.codigo_tipo and " +
	        			"dc.codigo_documento=md.codigo_documento and dc.codigo_documento=de.codigo_documento and" +
	        			" md.codigo_documento=de.codigo_documento and de.destino_documento=of.codigo_oficina and" +
	        			" de.destinatario=pr.codigo_personal and" +
	        			" md.codigo_fondo = '01' and md.codigo_documento = " + "'" + documento + "'"+ " and md.secuencia_movimiento = " + "'" + secuencia + "'"+ "" +
	        			" order by  md.fecha_movimiento desc,md.hora_movimiento desc, md.codigo_documento desc";
	        	
	        	
	        	//log.info("El ls_sql Detalle" + ls_sql);
	        	
		    	us = con.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BMesaPartesVO = new BMesaPartes();
				
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(funciones.of_observacion_derivacion(cnx,rs.getString("codigo_documento")));
					//BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					
					//BMesaPartesVO.setDescripcion_motivo(rs.getString("descripcion_motivo"));
					BMesaPartesVO.setFecha_registro(rs.getString("fecha_registro"));
					BMesaPartesVO.setHora_registro(rs.getString("hora_registro"));
					BMesaPartesVO.setFolios_documento(rs.getString("folios_documento"));
					//BMesaPartesVO.setObserva_documento(funciones.of_observacion_registro(cnx,rs.getString("codigo_documento")));
					BMesaPartesVO.setObserva_documento(rs.getString("observa_documento"));
					//BMesaPartesVO.setObserva_registro(rs.getString("observa_registro"));
					
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					////log.info("La oficina origen es.."+rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_recepcion(rs.getString("codigo_recepcion"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setNombre_motivo(funciones.of_nombre_motivo_max(cnx,rs.getString("codigo_documento")));
					BMesaPartesVO.setNombre_oficina_origen(funciones.of_nombre_oficina(cnx,rs.getString("oficina_origen")));
					BMesaPartesVO.setNombre_oficina_destino(funciones.of_nombre_oficina(cnx,rs.getString("oficina_deriva")));
					BMesaPartesVO.setFirmadopor(rs.getString("firmadopor"));
				}	
	            
				x.cerrar_conexion(con, rs);
				us.close();
				
	        	
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con);
	        }
	        return BMesaPartesVO;
		                
		}
	 
	 public void of_archivar(Connection cnx,String ls_documento,String ls_oficina,
			 String ls_secuencia,String ls_observacion,String estado_movimiento) {
	    	
	     //   obtenermos el valor maximo...
	    	log.info("dentro de Archivar documento......." );
	    	int    li_retorno;
	    	int    li_parcial = 0 ;
	    	String ls_correlativo=null;
	    	String ls_ano=null;
	    	String ls_mes=null;
	    	String ls_dia=null;
	    	String fecha_consulta=null;
	    	int ls_estado=0;
	    	String codigo_fondo="01";
	    	li_retorno = 1;
	    	Statement us  = null;
			ResultSet rs = null;
			
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
	    		
	    		log.info("El Archivar estado_movimiento es" + estado_movimiento);
	    		Date fecha_c = new Date();
    			SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy");
    			SimpleDateFormat formatoFechaConsulta = new SimpleDateFormat("yyyyMMdd"); 
    			SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); 
    			String ls_hora_m=formatoHora.format(fecha_c);
    			String ls_fecha_m=formatoFecha.format(fecha_c);
    			String ls_fecha_consulta=formatoFechaConsulta.format(fecha_c);
    			
	    		int e_m=Integer.parseInt(estado_movimiento.trim());
		    		if(e_m ==3 || e_m==7){
		    			
		    			ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = " +"'4'"+
				    			","+"observa_movimiento ="+"'"+ls_observacion+"', fecha_movimiento = '"+ls_fecha_m+"'," +
				    			"hora_movimiento ='"+ls_hora_m+"',fecha_consulta='"+ ls_fecha_consulta+"' " +
				    			" where codigo_fondo='01' "
				    			+ " and codigo_oficina= "+ "'" +ls_oficina + "'" + " and codigo_documento="+"'"+ls_documento+"'"
				    			+ " and secuencia_movimiento="+"'"+ls_secuencia+"'"+"";
		    			log.info("El ls_sql 1 update archivar documento es" + ls_sql);
		    			 us = con.createStatement();
				    	 us.executeUpdate(ls_sql); 
				    	 
		    			ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = " +"'4'"+
		    			","+"observa_movimiento ="+"'"+ls_observacion+"', fecha_movimiento = '"+ls_fecha_m+"'," +
		    			"hora_movimiento ='"+ls_hora_m+"',fecha_consulta='"+ ls_fecha_consulta+"' " +
		    			" where codigo_fondo='01' "
		    			+ " and oficina_origen= "+ "" +ls_oficina + "" + " and codigo_documento="+"'"+ls_documento+"'"
		    			+ " and tipo_envio in ('C','R') and estado_movimiento in ('2','8')";
		        		
		        	log.info("El ls_sql update archivar documento es" + ls_sql);
					    	 us = con.createStatement();
					    	 us.executeUpdate(ls_sql); 
					    	 
			    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_documento+"'"+" and tipo_envio in ('C','R')" +
		    	 		" )";
			    	 
			    	log.info("El ls_sql insert recorrido_doc 1 archivar documento es" + ls_sql);
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
		    		}
		    		
		    		// //log.info("Para desarchivar documento");
		    		if(e_m==4){
		    			
		    			ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = " +"'3'"+
		    			","+"observa_movimiento ="+"'"+ls_observacion+"', fecha_movimiento = '"+ls_fecha_m+"'," +
		    			" hora_movimiento ='"+ls_hora_m+"',fecha_consulta='"+ ls_fecha_consulta+"'where codigo_fondo='01' "
		    			+ " and codigo_oficina= "+ "'" +ls_oficina + "'" + " and codigo_documento="+"'"+ls_documento+"'"
		    			+ " and secuencia_movimiento="+"'"+ls_secuencia+"'"+"";
		        		
		        		 log.info("El ls_sql update desarchivar documento es" + ls_sql);
					    	 us = con.createStatement();
					    	 us.executeUpdate(ls_sql); 
					    	 
				    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
			    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
			    	 		" and codigo_documento="+"'"+ls_documento+"'"+" and secuencia_movimiento="+"'"+ls_secuencia+"'"+
			    	 		" )";
				    	 
				    	log.info("El ls_sql insert recorrido_doc desarchivar documento es" + ls_sql);
				    	 
				    	 us = con.createStatement();
				    	 us.executeUpdate(ls_sql);	
					    	 
		    		}
	        		
		    		x.cerrar_conexion(con);
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );
	    		x.cerrar_conexion(con);
	    	}

		}
	 
	 public BCodPadre  of_obtener_padre(Connection cnx,String documento,String secuencia) throws Exception {
			
	        //log.info("ENTRO Al detalle Obtener codigo padre");
			
	        SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_sistema  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String yearactual = year.format(d);
	    	
	    	
	    	/*//log.info("FECHA fecha_sistema.... : " + fecha_sistema);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);*/
	    	

	        BCodPadre BCodPadreVO = null;
	        Connection conn = null;
			PreparedStatement pstmt = null;
			ObtieneConexion obt=new ObtieneConexion();
			ResultSet rs = null;
	       
	        try {	
	        	
	        
	        	String ls_sql = "select codigo_inicia,fecha_movimiento,fecha_rpta from tramite.movimientos_doc WHERE" +
	        	" codigo_documento=?  and secuencia_movimiento=? ";
	        	
	        	conn = obt.getConnection();
				log.info("query de actualizacion:   " +ls_sql);
				pstmt = conn.prepareStatement(ls_sql);

				pstmt.setInt(1, Integer.parseInt(documento));
				pstmt.setInt(2, Integer.parseInt(secuencia));
								
				rs=pstmt.executeQuery();
	    		
				while ( rs.next() ) { 
					
					BCodPadreVO = new BCodPadre();
					
					BCodPadreVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BCodPadreVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BCodPadreVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BCodPadreVO.setFecha_sistema(fecha_sistema);
					
				}	
	            
				obt.cerrar_conexion(conn, rs);
				pstmt.close();
				
	        	
	        } catch (SQLException e) {
	        	obt.cerrar_conexion(conn);
	             e.printStackTrace();
	        }
	        return BCodPadreVO;
		                
		}
	 
	 public Collection of_recorrido(Connection cnx,String cod_documento) throws Exception {
			
	        //log.info("ENTRO A  Lista de Recorrido Documento");
			Collection listaRecorrido = new ArrayList();
			
			BMesaPartes BMesaPartesVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	
	        	String ls_sql = "select de.desc_origen, re.codigo_documento,re.codigo_oficina,re.fecha_movimiento,re.hora_movimiento," +
	        			"re.estado_movimiento,re.codigo_inicia,re.secuencia_movimiento,re.ultimo_usuario," +
	        			"re.doc_deriva,re.observa_movimiento,re.codigo_motivo,re.desc_origen,re.tipo,re.fecha_rpta," +
	        			"re.estado,re.oficina_origen,re.oficina_deriva,re.destinatario as nombdestinatario,tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento," +
	        			"dc.asunto_documento,de.origen_documento,de.destino_documento,de.remitente,de.destinatario," +
	        			"of.codigo_oficina,of.descripcion_oficina as desc_oficina,of_a.descripcion_oficina," +
	        			"pr.codigo_personal,pr.nombre_personal from tramite.recorrido_doc re,tramite.tipo_documento tp," +
	        			"tramite.documento dc,tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a," +
	        			"tramite.personal pr where tp.codigo_tipo=dc.codigo_tipo and" +
	        			" dc.codigo_documento=re.codigo_documento and dc.codigo_documento=de.codigo_documento and" +
	        			" re.codigo_documento=de.codigo_documento and de.destinatario=pr.codigo_personal and" +
	        			" re.codigo_oficina=of.codigo_oficina and de.destino_documento=of_a.codigo_oficina and" +
	        			" re.codigo_documento = "+cod_documento+"  order by re.fecha_consulta desc," +
	        			"re.hora_movimiento desc,re.codigo_documento desc,re.secuencia_movimiento desc";
    	
	        	//log.info("El recorrido KKKKK XXXXXXXXX es..." + ls_sql);
	        	
		    	us = cnx.createStatement();
				rs = us.executeQuery(ls_sql);
				
				int contador=0;
				Funciones funciones=new Funciones();
			while ( rs.next() ) { 
				
				BMesaPartesVO = new BMesaPartes();
				
				contador=contador+1;
				////log.info("El contadore es contador" + contador);
				BMesaPartesVO.setContador(contador);
				BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
				BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
				BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
				BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
				//BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
				
	
				
				BMesaPartesVO.setEstado_movimiento(funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento")));
				
			
				BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
				
				BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
				BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
				BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
				BMesaPartesVO.setTipo(rs.getString("tipo"));
				BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
				BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
				BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
				BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
				BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
				BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
				BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
				BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
				BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
				BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
				
				BMesaPartesVO.setRemitente(rs.getString("remitente"));
				
				BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
				BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
				BMesaPartesVO.setDescripcion_oficina(rs.getString("desc_oficina"));
				BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
				BMesaPartesVO.setNombre_personal(funciones.of_nombre_persona(cnx,rs.getString("nombdestinatario")));
				BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
				BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
				BMesaPartesVO.setNombre_motivo(funciones.of_nombre_motivo(cnx,rs.getString("codigo_motivo")));
				BMesaPartesVO.setNombre_oficina_origen(funciones.of_nombre_corto_oficina(cnx,rs.getString("oficina_origen")));
				BMesaPartesVO.setNombre_oficina_destino(funciones.of_nombre_corto_oficina(cnx,rs.getString("oficina_deriva")));
				////log.info("La oficina origen es.."+ rs.getString("oficina_origen"));
				////log.info("La oficina deriva es.."+ rs.getString("oficina_deriva"));
				listaRecorrido.add(BMesaPartesVO);
	
			}	
        
				rs.close();
				
	        } catch (Exception e) {
	             e.printStackTrace();
	        }
	        return listaRecorrido;
		                
		}
	 
	 
	 public String of_ingresar_documento_interno(Connection cnx,String codigo_oficina,String medio,String codigo_tipo,String naturaleza_documento,String destino_documento,
				String contacto,String destinatario,String codigo_solicitud,String numero_documento,
				String fecha_registro,String hora,String folios_documento,String asunto_documento,
				String observa_documento,String usuario_actual,String firmadopor,String origen_documento,
				String desc_origen,String tipo,String persona,String fecha_rpta,String correlativorecepcion,String numero_referencia,String dirigido,String codigo_intitucion) {
	    	
	     //   obtenermos el valor maximo...
		 	log.info("Dentro del of_ingresar_documento_interno.......USADO POR LAS OFICINAS PARA REGISTRAR DOCUMENTOS INTERNOS" );
	    	
	    	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	
	    	Funciones funciones = new Funciones();
	    	Calendar calendario = new GregorianCalendar();
		    asunto_documento = funciones.convertir_comillas_simples(asunto_documento);
		    observa_documento = funciones.convertir_comillas_simples(observa_documento);
		    numero_referencia = funciones.convertir_comillas_simples(numero_referencia);
		    numero_documento = funciones.convertir_comillas_simples(numero_documento);
			
		    codigo_intitucion=(codigo_intitucion==null)?"1":codigo_intitucion;
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "2";
	    	String ls_valor  = "";
	    	int ls_secuencia_origen = 0;
   		 	int horadia = calendario.get(Calendar.HOUR_OF_DAY);
   		 	int minutos = calendario.get(Calendar.MINUTE);
   		 	int segundos = calendario.get(Calendar.SECOND);
	    	
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);*/
	    	
	    	
	    	int li_retorno = 1;
	    	int li_parcial = 0 ;
	    	int li_secuencia;
	    	int li_secuencia_oficina;
	    	String codigo_documento= "" ;
	    	String ls_extraer_year= "" ;
	    	//String naturaleza_documento = "E";
	    	String ls_correlativo=null;

	    	String fecha_consulta ="";
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			Statement us  = null;
			ResultSet rs = null;
			PreparedStatement pstmt = null;
			
	    	try{
	    		
	    /***		ls_sql = "Select max(codigo_documento) as c_valor from tramite.documento";
 			////log.info("ls_sql............   " + ls_sql );
 			us = cnx.createStatement();
		    	 rs = us.executeQuery(ls_sql);
		    	// //log.info("El resultset es: " + rs);
				
		    	 if (rs == null) 
		    		{
		    			////log.info("rs es nulo ......." );
		    			li_retorno = 1;
		    	    }
		    		else
		    		{
		    			//log.info("rs NO es nulo ......." );
			    		while ( rs.next() ) { 
			    				         //   //log.info("dentro del whyle......." );
			    				            if (rs.getString("c_valor") == null )
			    				            {
			    				    		//	//log.info("ta vacio nulo ......." );
			    				    			li_retorno = 1;
			    				    	    }
			    				            else
			    				    		{
			    				            //	//log.info("ls_valor :" + rs.getString("c_valor"));
			    				            	ls_valor=rs.getString("c_valor");
			    				            	////log.info("ls_extraer_year :" + ls_extraer_year);
			    				            	li_retorno = Integer.valueOf(ls_valor).intValue() + 1;
			    				            	
			    				    		}
			    				           
			    		}
			        }
		    	 
		    	 codigo_documento = String.valueOf(li_retorno);***/
		    	 
		    	 //log.info("El nuevo codigo documento DOC INTERNO es" + codigo_documento);
		    	 
	    		//Registramos un documento en la tabla tramite.documento
	    		
	    		ls_sql = "insert into tramite.documento(codigo_tipo,naturaleza_documento," +
	    		"numero_documento,fecha_documento,asunto_documento,folios_documento,observa_documento," +
    	 		"fecha_registro,hora_registro,ultima_modificacion,ultimo_usuario,estado_documento," +
    	 		"postergado,cargo,anio,dirigido,id_institucion) " +
    	 		"values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
	    	 	log.info("El primer ls_sql es" + ls_sql);
		    	 
	    	 	pstmt = con.prepareStatement(ls_sql);
		    	 //pstmt.setInt(1, li_retorno);
		    	 pstmt.setString(1, codigo_tipo);
		    	 pstmt.setString(2,naturaleza_documento);
		    	 pstmt.setString(3,numero_documento);
		    	 pstmt.setString(4,fecha_documento);
		    	 pstmt.setString(5,asunto_documento);
		    	 pstmt.setString(6,folios_documento);
		    	 pstmt.setString(7,observa_documento);
		    	 pstmt.setString(8,fecha_registro);
		    	 pstmt.setTime(9, Time.valueOf(hora+":00"));
		    	 pstmt.setString(10,fecha_documento);
		    	 pstmt.setString(11,usuario_actual);
		    	 pstmt.setString(12,estado_documento);
		    	 pstmt.setString(13,"N");
		    	 pstmt.setString(14,"N");
		    	 pstmt.setInt(15,Integer.parseInt(yearactual.trim()));
		    	 pstmt.setString(16,dirigido);
		    	 
		    	 pstmt.setInt(17,Integer.parseInt(codigo_intitucion));
		    	 
		    	 

		    	 pstmt.executeUpdate();
		    	 
		    	/*** ls_sql = "insert into tramite.documento(codigo_tipo,naturaleza_documento," +
		    	 		"numero_documento,fecha_documento,asunto_documento,folios_documento,observa_documento," +
		    	 		"fecha_registro,hora_registro,ultima_modificacion,ultimo_usuario,estado_documento," +
		    	 		"postergado,cargo,anio,dirigido) values('" + codigo_tipo + "'" +
		    	 		"," + "'" + naturaleza_documento + "'" +
		    	 		"," + "'" + numero_documento + "'" +
		    	 		"," + "'" + fecha_documento + "'" +
		    	 		"," + "'" + asunto_documento + "'" +
		    	 		"," + "'" + folios_documento + "'" +
		    	 		"," + "'" + observa_documento + "'" +
		    	 		"," + "'" + fecha_registro + "'" +
		    	 		"," + "'" + hora + "'" +
		    	 		"," + "'" + fecha_documento + "'" +
		    	 		"," + "'" + usuario_actual + "'" +
		    	 		"," + "'" + estado_documento + "'"+
		    	 		"," + "'N'"+
		    	 		"," + "'N'"+
		    	 		","+"'" + yearactual + "'"+
		    	 		","+"'" + dirigido + "'"+
		    	 		")";
		    	//log.info("El primer ls_sql es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);***/
		    	 
		    	 
		    	ls_sql="SELECT last_value as valor FROM tramite.seq_documento;";
		    	us = con.createStatement();
	 			rs = us.executeQuery(ls_sql);    		
	 			log.info("sql :"+ls_sql);
		 		while(rs.next()){
		 			li_retorno=(rs.getInt("valor"));

		 		}
		 		
		 		codigo_documento = String.valueOf(li_retorno);
		    	 
		    	 
		    	 
		    	 
//		    	------------------------Registramos la Oficina de Origen y Destino-------------------------//
		    	 
		    	 /*ls_sql = "insert into tramite.doc_interno_origen(codigo_documento,codigo_fondo,codigo_oficina,codigo_personal)" +
		    	 		" values(" + "'" + codigo_documento + "'"+ "," +"'01'"+ 
		    	 		"," +"'" + codigo_oficina + "'"+ "," +"'" + remitente + "'"+ ")";
	    	 
			    	 //log.info("El segundo ls_sql doc_interno_origen es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);
	    	 
			    	 
		    	 ls_sql = "insert into tramite.doc_interno_destino(codigo_documento,secuencia_documento,codigo_personal,codigo_fondo,codigo_oficina)" +
	    	 		" values(" + "'" + codigo_documento + "'"+ "," +"'1'"+ 
	    	 		"," +"'" + destinatario + "'"+ "," +"'01'"+"," +"'" + destino_documento + "'"+")";
 	 
		    	 //log.info("El tercero ls_sql doc_interno_destino es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);*/
		    	 
		    	 	//------------------------Registramos Origen y Destino del Documento-------------------------//
		    	 
		    	 ls_sql = "insert into tramite.doc_entrada(codigo_documento,destinatario,remitente,destino_documento," +
		    	 		"fondo_destino,origen_documento,medio,hora,firmadopor,codigo_solicitud,desc_origen,tipo) " +
		    	 		"values(?,?,?,?,?,?,?,?,?,?,?,?)";
		 		
		    	 pstmt = con.prepareStatement(ls_sql);
		    	 pstmt.setInt(1, li_retorno);
		    	 pstmt.setInt(2, Integer.parseInt(destinatario));
		    	 pstmt.setString(3, contacto);
		    	 pstmt.setInt(4, Integer.parseInt(destino_documento));
		    	 pstmt.setString(5, "01");
		    	 pstmt.setInt(6, Integer.parseInt(codigo_oficina));
		    	 pstmt.setString(7, medio);
		    	 pstmt.setString(8, hora);
		    	 pstmt.setString(9, firmadopor);
		    	 pstmt.setInt(10, Integer.parseInt(codigo_solicitud));
		    	 pstmt.setString(11, desc_origen);
		    	 pstmt.setString(12, tipo);
		    	 
		    	 pstmt.executeUpdate();
		    	 
		    	 
		    	 
		    	 
		    	 
		    	 if(codigo_intitucion.equals("2")){
		    		 
		    		 ls_sql = "insert into tramite.documento_fondecyt(codigo_documento_concytec) " +
		    	 		"values(?)";
		 		
			    	 pstmt = con.prepareStatement(ls_sql);
			    	 pstmt.setInt(1, li_retorno);
			    			    	 
			    	 pstmt.executeUpdate();
		    	 }
		    	 /**
		    	  * FIN
		    	  */
		    	 
		    	/**** ls_sql = "insert into tramite.doc_entrada(codigo_documento,destinatario,remitente,destino_documento," +
		    	 		"fondo_destino,origen_documento,medio,hora,firmadopor,codigo_solicitud,desc_origen,tipo) values(" + "'" + codigo_documento + "'"
		    	 		+ "," +"'" + destinatario + "'"+ "," +"'" + contacto  + "'"
		    	 		+ "," +"'" + destino_documento + "'"+ "," +"'01'"
		    	 		+ "," + "'" + codigo_oficina + "'"+ "," +"'" + medio + "'"
		    	 		+ "," +"'" + hora + "'"+ "," +"'" + firmadopor + "'"
		    	     	+ "," +"'" + codigo_solicitud + "'"
		    	 		+ "," +"'" + desc_origen + "'"
		    	 		+ "," +"'" + tipo + "'"+ ")";
		    	 
		    	//log.info("El cuarto ls_sql doc_interno es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);***/
		    	 
		    		//------------------------Registramos el movimiento del Documento-------------------------//
		    	/* ls_sql = "select count(codigo_documento) as c_valor from tramite.movimientos_doc where codigo_documento  = " + "'" + codigo_documento + "'"  + "";
		    	 us = cnx.createStatement();
		    	 rs = us.executeQuery(ls_sql);
		    	//log.info("El resultset es: " + rs);
		    	
		 		while ( rs.next() ) { 
		 				            //log.info("dentro del whyle......." );
		 				            ls_valor = rs.getString("c_valor"); 
		 				            //log.info("ls_valor :" + ls_valor );
		 				            
		 		}
		 		
		 		li_secuencia = Integer.valueOf(ls_valor).intValue() + 1;
		 		////log.info("li_secuencia: " + li_secuencia);
		    	 if (ls_valor.equals("0")) {*/
		 			
		    	
			        	
			      //   //log.info("fecha_consulta: " + fecha_consulta);
			   log.info("---> "+numero_referencia);
			   
		    	if(numero_referencia==null || numero_referencia.equals("") || numero_referencia.equals("0")){
	   					numero_referencia="0";
	   	   	 			log.info("La numero_referencia es null o igual a vacio.");
		   	   	 	 li_secuencia =1;
		   	   	 	 fecha_consulta = fecha_registro.substring(6,10)+fecha_registro.substring(3,5)+fecha_registro.substring(0,2);
	    		 
		   	   	ls_sql = "insert into tramite.movimientos_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
		 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
		 		"oficina_origen,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen) " +
		 		"values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)"; 
		   	   	 	 
		   	   	fecha_rpta = (fecha_rpta==null)? "":fecha_rpta;
	    		correlativorecepcion = (correlativorecepcion==null)? "":correlativorecepcion;
	    		numero_referencia = (numero_referencia==null)? "":numero_referencia;
	    		
	    		log.info("-->"+origen_documento+","+fecha_registro+","+fecha_consulta+","+observa_documento+","+usuario_actual+","+destinatario);
	    		log.info(","+desc_origen+","+tipo+","+fecha_rpta+",P,"+correlativorecepcion+","+numero_referencia);
	    		
	    		pstmt = con.prepareStatement(ls_sql);
	    		 pstmt.setInt(1, li_retorno);
		    	 pstmt.setString(2, "01");
		    	 pstmt.setInt(3, li_secuencia);
		    	 pstmt.setInt(4, Integer.parseInt(codigo_oficina));
		    	 pstmt.setString(5, "01");
		    	 pstmt.setString(6, origen_documento);
		    	 pstmt.setString(7, "5");
		    	 pstmt.setString(8, fecha_registro);
		    	 pstmt.setString(9, fecha_consulta);
		    	 pstmt.setTime(10, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
		    	 pstmt.setString(11, observa_documento);
		    	 pstmt.setInt(12, Integer.parseInt(codigo_documento));
		    	 pstmt.setString(13, usuario_actual);
		    	 pstmt.setString(14, "01");
		    	 pstmt.setInt(15, Integer.parseInt(destino_documento));
		    	 pstmt.setString(16, destinatario);
		    	 pstmt.setString(17, desc_origen);
		    	 pstmt.setString(18, tipo);
		    	 pstmt.setString(19, fecha_rpta);
		    	 pstmt.setInt(20, 0);
		    	 pstmt.setInt(21, Integer.parseInt(codigo_oficina));
		    	 pstmt.setInt(22, Integer.parseInt(correlativorecepcion));
		    	 pstmt.setInt(23, Integer.parseInt(numero_referencia));
		    	 pstmt.setString(24, "P");
		    	 pstmt.setInt(25, ls_secuencia_origen);
		    	 
		    	 pstmt.executeUpdate(); 
		    	 
	   	   	 	/**	ls_sql = "insert into tramite.movimientos_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
    		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
    		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
    		 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
    		 		"oficina_origen,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen) values(" + "'" + codigo_documento + "'"
	    	 		+ "," +"'01'"+","+"'"+ li_secuencia + "'"+ "," +"'" + codigo_oficina + "'"+ "," +"'01'"
	    	 		+ "," + "'" + origen_documento + "'"+ "," +"'5'"
	    	 		+ "," +"'" + fecha_registro + "'"+ "," +"'" + fecha_consulta + "'"+ "," +"'" + hora + "'"
	    	 		+ "," +"'" + observa_documento + "'"+ "," +"'" + codigo_documento + "'"
	    	 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+ "," +"'" + destino_documento + "'"+
	    	 		"," +"'" + destinatario + "'"+
	    	 		"," +"'" + desc_origen + "'"+
	    	 		"," +"'" + tipo + "'"+
	    	 		"," +"'" + fecha_rpta + "'"+
	    	 		"," +"'0'"+
	    	 		
	    	 		"," +"'" + codigo_oficina + "'"+
	    	 		"," +"'" + correlativorecepcion + "'"+
	    	 		"," +"'" + numero_referencia + "'"+
	    	 		",'P',"+ls_secuencia_origen+")";
	    	 
	    	//log.info("El tercer ls_sql registro de nuestra oficina origen es" + ls_sql);
	    	 us = con.createStatement();
	    	 us.executeUpdate(ls_sql);  ***/
	    	 
	    	 	li_secuencia_oficina = li_secuencia + 1;
		 		//log.info("li_secuencia_oficina: " + li_secuencia_oficina);
		 	
	    	 	ls_sql = "insert into tramite.movimientos_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
 		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
 		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
 		 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
 		 		"oficina_origen,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen) " +
 		 		"values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)"; 	
	    	 	
	    	 	pstmt = con.prepareStatement(ls_sql);
	    		 pstmt.setInt(1, li_retorno);
		    	 pstmt.setString(2, "01");
		    	 pstmt.setInt(3, li_secuencia_oficina);
		    	 pstmt.setInt(4, Integer.parseInt(destino_documento));
		    	 pstmt.setString(5, "01");
		    	 pstmt.setString(6, origen_documento);
		    	 pstmt.setString(7, "2");
		    	 pstmt.setString(8, fecha_registro);
		    	 pstmt.setString(9, fecha_consulta);
		    	 pstmt.setTime(10, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
		    	 pstmt.setString(11, observa_documento);
		    	 pstmt.setInt(12, Integer.parseInt(codigo_documento));
		    	 pstmt.setString(13, usuario_actual);
		    	 pstmt.setString(14, "01");
		    	 pstmt.setInt(15, Integer.parseInt(destino_documento));
		    	 pstmt.setString(16, destinatario);
		    	 pstmt.setString(17, desc_origen);
		    	 pstmt.setString(18, tipo);
		    	 pstmt.setString(19, fecha_rpta);
		    	 pstmt.setInt(20, 0);
		    	 pstmt.setInt(21, Integer.parseInt(codigo_oficina));
		    	 pstmt.setInt(22, Integer.parseInt(correlativorecepcion));
		    	 pstmt.setInt(23, Integer.parseInt(numero_referencia));
		    	 pstmt.setString(24, "P");
		    	 pstmt.setInt(25, li_secuencia);
		    	 
		    	 pstmt.executeUpdate();
	    	 	
	    	 	
	    	/*** ls_sql = "insert into tramite.movimientos_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
	 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
	 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
	 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
	 		"oficina_origen,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen) values(" + "'" + codigo_documento + "'"
 	 		+ "," +"'01'"+","+"'"+ li_secuencia_oficina + "'"+ "," +"'" + destino_documento + "'"+ "," +"'01'"
 	 		+ "," + "'" + origen_documento + "'"+ "," +"'2'"
 	 		+ "," +"'" + fecha_registro + "'"+ "," +"'" + fecha_consulta + "'"+ "," +"'" + hora + "'"
 	 		+ "," +"'" + observa_documento + "'"+ "," +"'" + codigo_documento + "'"
 	 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+ "," +"'" + destino_documento + "'"+
 	 		"," +"'" + destinatario + "'"+
 	 		"," +"'" + desc_origen + "'"+
 	 		"," +"'" + tipo + "'"+
 	 		"," +"'" + fecha_rpta + "'"+
	 		"," +"'0'"+
 	 		"," +"'" + codigo_oficina + "'"+
 	 		"," +"'" + correlativorecepcion + "'"+
	 		"," +"'" + numero_referencia + "'"+
 	 		",'P',"+li_secuencia+")";
 
		 	//log.info("El cuarto ls_sql oficina a las q se deriva el documento es" + ls_sql);
		 	 us = con.createStatement();
		 	 us.executeUpdate(ls_sql);****/
		   	
		    }else {
		    	log.info("La numero_referencia es ....."+numero_referencia);
		    	li_secuencia =1;
		    	fecha_consulta = fecha_registro.substring(6,10)+fecha_registro.substring(3,5)+fecha_registro.substring(0,2);
	    		 
		    	ls_sql = "insert into tramite.movimientos_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
		 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
		 		"oficina_origen,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen) " +
		 		"values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)"; 
		   	   	 	 
		   	   	fecha_rpta = (fecha_rpta==null)? "":fecha_rpta;
	    		correlativorecepcion = (correlativorecepcion==null)? "":correlativorecepcion;
	    		numero_referencia = (numero_referencia==null)? "":numero_referencia;
	    		
	    		log.info("-->"+origen_documento+","+fecha_registro+","+fecha_consulta+","+observa_documento+","+usuario_actual+","+destinatario);
	    		log.info(","+desc_origen+","+tipo+","+fecha_rpta+",P,"+correlativorecepcion+","+numero_referencia);
		    	
	    		pstmt = con.prepareStatement(ls_sql);
	    		 pstmt.setInt(1, li_retorno);
		    	 pstmt.setString(2, "01");
		    	 pstmt.setInt(3, li_secuencia);
		    	 pstmt.setInt(4, Integer.parseInt(codigo_oficina));
		    	 pstmt.setString(5, "01");
		    	 pstmt.setString(6, origen_documento);
		    	 pstmt.setString(7, "5");
		    	 pstmt.setString(8, fecha_registro);
		    	 pstmt.setString(9, fecha_consulta);
		    	 pstmt.setTime(10, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
		    	 pstmt.setString(11, observa_documento);
		    	 pstmt.setInt(12, Integer.parseInt(numero_referencia));
		    	 pstmt.setString(13, usuario_actual);
		    	 pstmt.setString(14, "01");
		    	 pstmt.setInt(15, Integer.parseInt(destino_documento));
		    	 pstmt.setString(16, destinatario);
		    	 pstmt.setString(17, desc_origen);
		    	 pstmt.setString(18, tipo);
		    	 pstmt.setString(19, fecha_rpta);
		    	 pstmt.setInt(20, 0);
		    	 pstmt.setInt(21, Integer.parseInt(codigo_oficina));
		    	 pstmt.setInt(22, Integer.parseInt(correlativorecepcion));
		    	 pstmt.setInt(23, Integer.parseInt(numero_referencia));
		    	 pstmt.setString(24, "P");
		    	 pstmt.setInt(25, ls_secuencia_origen);
		    	 
		    	 pstmt.executeUpdate(); 
		    	
	  /*** 	   	 	ls_sql = "insert into tramite.movimientos_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
   		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
   		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
   		 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
   		 		"oficina_origen,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen) values(" + "'" + codigo_documento + "'"
   	 		+ "," +"'01'"+","+"'"+ li_secuencia + "'"+ "," +"'" + codigo_oficina + "'"+ "," +"'01'"
   	 		+ "," + "'" + origen_documento + "'"+ "," +"'5'"
   	 		+ "," +"'" + fecha_registro + "'"+ "," +"'" + fecha_consulta + "'"+ "," +"'" + hora + "'"
   	 		+ "," +"'" + observa_documento + "'"+ "," +"'" + numero_referencia + "'"
   	 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+ "," +"'" + destino_documento + "'"+
   	 		"," +"'" + destinatario + "'"+
   	 		"," +"'" + desc_origen + "'"+
   	 		"," +"'" + tipo + "'"+
   	 		"," +"'" + fecha_rpta + "'"+
   	 		"," +"'0'"+
   	 		"," +"'" + codigo_oficina + "'"+
   	 		"," +"'" + correlativorecepcion + "'"+
   	 		"," +"'" + numero_referencia + "'"+
   	 		",'P',"+ls_secuencia_origen+")";
   	 
   	//log.info("El tercer ls_sql registro de nuestra oficina origen es" + ls_sql);
   	 us = con.createStatement();
   	 us.executeUpdate(ls_sql);***/
   	 
   	 	li_secuencia_oficina = li_secuencia + 1;
   	 	String estado_mov="2";
	 		//log.info("li_secuencia_oficina: " + li_secuencia_oficina);
 		if(destino_documento!=null && destino_documento.equals("1")){ estado_mov="8"; }
 		
 		ls_sql = "insert into tramite.movimientos_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
	 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
	 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
	 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
	 		"oficina_origen,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen) " +
	 		"values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)"; 	
 		
	 		 pstmt = con.prepareStatement(ls_sql);
			 pstmt.setInt(1, li_retorno);
		   	 pstmt.setString(2, "01");
		   	 pstmt.setInt(3, li_secuencia_oficina);
		   	 pstmt.setInt(4, Integer.parseInt(destino_documento));
		   	 pstmt.setString(5, "01");
		   	 pstmt.setString(6, origen_documento);
		   	 pstmt.setString(7, estado_mov);
		   	 pstmt.setString(8, fecha_registro);
		   	 pstmt.setString(9, fecha_consulta);
		   	 pstmt.setTime(10, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
		   	 pstmt.setString(11, observa_documento);
		   	 pstmt.setInt(12, Integer.parseInt(numero_referencia));
		   	 pstmt.setString(13, usuario_actual);
		   	 pstmt.setString(14, "01");
		   	 pstmt.setInt(15, Integer.parseInt(destino_documento));
		   	 pstmt.setString(16, destinatario);
		   	 pstmt.setString(17, desc_origen);
		   	 pstmt.setString(18, tipo);
		   	 pstmt.setString(19, fecha_rpta);
		   	 pstmt.setInt(20, 0);
		   	 pstmt.setInt(21, Integer.parseInt(codigo_oficina));
		   	 pstmt.setInt(22, Integer.parseInt(correlativorecepcion));
		   	 pstmt.setInt(23, Integer.parseInt(numero_referencia));
		   	 pstmt.setString(24, "P");
		   	 pstmt.setInt(25, li_secuencia);
		   	 
		   	 pstmt.executeUpdate();
 		
   	 /***ls_sql = "insert into tramite.movimientos_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
		"oficina_origen,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen) values(" + "'" + codigo_documento + "'"
 		+ "," +"'01'"+","+"'"+ li_secuencia_oficina + "'"+ "," +"'" + destino_documento + "'"+ "," +"'01'"
 		+ "," + "'" + origen_documento + "'"+ "," +"'"+estado_mov+"'"
 		+ "," +"'" + fecha_registro + "'"+ "," +"'" + fecha_consulta + "'"+ "," +"'" + hora + "'"
 		+ "," +"'" + observa_documento + "'"+ "," +"'" + numero_referencia + "'"
 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+ "," +"'" + destino_documento + "'"+
 		"," +"'" + destinatario + "'"+
 		"," +"'" + desc_origen + "'"+
 		"," +"'" + tipo + "'"+
 		"," +"'" + fecha_rpta + "'"+
		"," +"'0'"+
 		"," +"'" + codigo_oficina + "'"+
 		"," +"'" + correlativorecepcion + "'"+
		"," +"'" + numero_referencia + "'"+
 		",'P',"+li_secuencia+")";

	 	 us = con.createStatement();
	 	 us.executeUpdate(ls_sql);***/
	 	 
		    	
		    }
		    		 
			        	 
			 
			 	/***********************Registrando para el recorrido********************/
		    	 
		    	 ls_sql = "insert into tramite.recorrido_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
			 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
			 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
			 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
			 		"oficina_origen,estado,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen) " +
			 		"values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
		    	 
		    	 pstmt = con.prepareStatement(ls_sql);
	    		 pstmt.setInt(1, Integer.parseInt(codigo_documento));
		    	 pstmt.setString(2, "01");
		    	 pstmt.setInt(3, li_secuencia);
		    	 pstmt.setInt(4, Integer.parseInt(codigo_oficina));
		    	 pstmt.setString(5, "01");
		    	 pstmt.setString(6, origen_documento);
		    	 pstmt.setString(7, "1");
		    	 pstmt.setString(8, fecha_registro);
		    	 pstmt.setString(9, fecha_consulta);
		    	 pstmt.setTime(10, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
		    	 pstmt.setString(11, observa_documento);
		    	 pstmt.setInt(12, Integer.parseInt(codigo_documento));
		    	 pstmt.setString(13, usuario_actual);
		    	 pstmt.setString(14, "01");
		    	 pstmt.setInt(15, Integer.parseInt(destino_documento));
		    	 pstmt.setString(16, destinatario);
		    	 pstmt.setString(17, desc_origen);
		    	 pstmt.setString(18, tipo);
		    	 pstmt.setString(19, fecha_rpta);
		    	 pstmt.setInt(20, 0);
		    	 pstmt.setInt(21, Integer.parseInt(codigo_oficina));
		    	 pstmt.setString(22, "R");
		    	 pstmt.setInt(23, Integer.parseInt(correlativorecepcion));
		    	 pstmt.setInt(24, Integer.parseInt(numero_referencia));
		    	 pstmt.setString(25, "P");
		    	 pstmt.setInt(26, ls_secuencia_origen);
		    	 
		    	 pstmt.executeUpdate();
		    	 
			/***	 	ls_sql = "insert into tramite.recorrido_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
			 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
			 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
			 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
			 		"oficina_origen,estado,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen) values(" + "'" + codigo_documento + "'"
		 		+ "," +"'01'"+","+"'"+ li_secuencia + "'"+ "," +"'" + codigo_oficina + "'"+ "," +"'01'"
		 		+ "," + "'" + origen_documento + "'"+ "," +"'1'"
		 		+ "," +"'" + fecha_registro + "'"+ "," +"'" + fecha_consulta + "'"+ "," +"'" + hora + "'"
		 		+ "," +"'" + observa_documento + "'"+ "," +"'" + codigo_documento + "'"
		 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+ "," +"'" + destino_documento + "'"+
		 		"," +"'" + destinatario + "'"+
		 		"," +"'" + desc_origen + "'"+
		 		"," +"'" + tipo + "'"+
		 		"," +"'" + fecha_rpta + "'"+
		 		"," +"'0'"+
		 		"," +"'" + codigo_oficina + "'"+
		 		"," +"'R'"+
		 		"," +"'" + correlativorecepcion + "'"+
		 		"," +"'" + numero_referencia + "'"+
		 		",'P',"+ls_secuencia_origen+")";
		 
				// //log.info("El 1er ls_sql recorrido_doc registro de nuestra oficina origen es" + ls_sql);
				 us = con.createStatement();
				 us.executeUpdate(ls_sql);***/
		 
		    	 ls_sql = "insert into tramite.recorrido_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
			 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
			 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
			 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
			 		"oficina_origen,estado,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen)" +
			 		"values(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
		    	 
		    	 pstmt = con.prepareStatement(ls_sql);
	    		 pstmt.setInt(1, Integer.parseInt(codigo_documento));
		    	 pstmt.setString(2, "01");
		    	 pstmt.setInt(3, li_secuencia_oficina);
		    	 pstmt.setInt(4, Integer.parseInt(destino_documento));
		    	 pstmt.setString(5, "01");
		    	 pstmt.setString(6, origen_documento);
		    	 pstmt.setString(7, "2");
		    	 pstmt.setString(8, fecha_registro);
		    	 pstmt.setString(9, fecha_consulta);
		    	 pstmt.setTime(10, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
		    	 pstmt.setString(11, observa_documento);
		    	 pstmt.setInt(12, Integer.parseInt(codigo_documento));
		    	 pstmt.setString(13, usuario_actual);
		    	 pstmt.setString(14, "01");
		    	 pstmt.setInt(15, Integer.parseInt(destino_documento));
		    	 pstmt.setString(16, destinatario);
		    	 pstmt.setString(17, desc_origen);
		    	 pstmt.setString(18, tipo);
		    	 pstmt.setString(19, fecha_rpta);
		    	 pstmt.setInt(20, 0);
		    	 pstmt.setInt(21, Integer.parseInt(codigo_oficina));
		    	 pstmt.setString(22, "R");
		    	 pstmt.setInt(23, Integer.parseInt(correlativorecepcion));
		    	 pstmt.setInt(24, Integer.parseInt(numero_referencia));
		    	 pstmt.setString(25, "P");
		    	 pstmt.setInt(26, li_secuencia);
		    	 
		    	 pstmt.executeUpdate();
		    	 
		    	/*** ls_sql = "insert into tramite.recorrido_doc(codigo_documento,codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva,oficina_deriva," +
		 		"destinatario,desc_origen,tipo,fecha_rpta,codigo_expediente," +
		 		"oficina_origen,estado,codigo_recepcion,numero_referencia,tipo_envio,secuencia_origen) values(" + "'" + codigo_documento + "'"
		 		+ "," +"'01'"+","+"'"+ li_secuencia_oficina + "'"+ "," +"'" + destino_documento + "'"+ "," +"'01'"
		 		+ "," + "'" + origen_documento + "'"+ "," +"'2'"
		 		+ "," +"'" + fecha_registro + "'"+ "," +"'" + fecha_consulta + "'"+ "," +"'" + hora + "'"
		 		+ "," +"'" + observa_documento + "'"+ "," +"'" + codigo_documento + "'"
		 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+ "," +"'" + destino_documento + "'"+
		 		"," +"'" + destinatario + "'"+
		 		"," +"'" + desc_origen + "'"+
		 		"," +"'" + tipo + "'"+
		 		"," +"'" + fecha_rpta + "'"+
		 		"," +"'0'"+
		 		"," +"'" + codigo_oficina + "'"+
		 		"," +"'R'"+
		 		"," +"'" + correlativorecepcion + "'"+
		 		"," +"'" + numero_referencia + "'"+
		 		",'P',"+li_secuencia+")";

			 	 us = con.createStatement();
			 	 us.executeUpdate(ls_sql);***/
			 	 
			 	 x.cerrar_conexion(con,rs);
			 	 us.close();
			 	 pstmt.close();
			 	 
	    	}
	    	catch(Exception e){
	    		e.printStackTrace();
	    		x.cerrar_conexion(con);
	    	}
	    	return codigo_documento;

		}
	 
	 
	 public void of_ingresar_documento_interno_entrada(Connection cnx,String codigo_oficina,String codigo_tipo,
				String origen_documento,String numero_documento,String fecha_registro,String asunto_documento,
				String observa_documento,String usuario_actual,String ls_persona,String ls_codigoPadre,
				String ls_documento,String ls_secuencia_doc,String desc_origen,String ls_seleccion,String correlativo_deriva) {
	    	
	     //   obtenermos el valor maximo...
	    	//log.info("dentro del ingresar Nuevo Documento......." );
	    	
	    	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "2";
	    	String ls_valor  = "";
	    	
	    /*	//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);*/
	    	
	    	String horaActual = "00:00:00";
	    	Calendar cal = Calendar.getInstance();
	        Date hora = cal.getTime();
	        DateFormat df = DateFormat.getTimeInstance();
	        horaActual = df.format(hora);
	        
	        ////log.info("horaActual.... : " + horaActual);

	        
	    	int    li_retorno;
	    	int    li_parcial = 0 ;
	    	int li_secuencia;
	    	int li_secuencia_oficina;
	    	String codigo_documento= "" ;
	    	String ls_extraer_year= "" ;
	    	//String naturaleza_documento = "E";
	    	String ls_correlativo=null;
	    	li_retorno = 1;
	    	Statement us  = null;
			ResultSet rs = null;
			
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
	    		
	    		ls_sql = "Select max(codigo_documento) as c_valor from tramite.documento";
			////log.info("ls_sql............   " + ls_sql );
			us = cnx.createStatement();
		    	 rs = us.executeQuery(ls_sql);
		    	// //log.info("El resultset es: " + rs);
				
		    	 if (rs == null) 
		    		{
		    		//	//log.info("rs es nulo ......." );
		    			li_retorno = 1;
		    	    }
		    		else
		    		{
		    		//	//log.info("rs NO es nulo ......." );
			    		while ( rs.next() ) { 
			    				  //          //log.info("dentro del whyle......." );
			    				            if (rs.getString("c_valor") == null )
			    				            {
			    				    	//		//log.info("ta vacio nulo ......." );
			    				    			li_retorno = 1;
			    				    	    }
			    				            else
			    				    		{
			    				        //    	//log.info("ls_valor :" + rs.getString("c_valor"));
			    				            	
			    				            	ls_extraer_year = rs.getString("c_valor").substring(4);
			    				            //	//log.info("ls_extraer_year :" + ls_extraer_year);
			    				            	li_retorno = Integer.valueOf(ls_extraer_year).intValue() + 1;
			    				    		}
			    				           
			    		}
			        }
		    	 
		    	 codigo_documento = yearactual+ li_retorno;
		    	 
		    	 ////log.info("El nuevo codigo documento es" + codigo_documento);
//Registramos un documento en la tabla tramite.documento
		    	 
		    	 ls_sql = "insert into tramite.documento(codigo_documento,codigo_tipo,naturaleza_documento," +
		    	 		"numero_documento,fecha_documento,asunto_documento,observa_documento," +
		    	 		"fecha_registro,hora_registro,ultima_modificacion,ultimo_usuario,estado_documento," +
		    	 		"postergado,cargo,numero_documento_ant,anio) values(" + "'" + codigo_documento + "'" + "," + "'" + codigo_tipo + "'" +
		    	 		"," + "'W'" +
		    	 		"," + "'" + numero_documento + "'" +
		    	 		"," + "'" + fecha_documento + "'" +
		    	 		"," + "'" + asunto_documento + "'" +
		    	 		"," + "'" + observa_documento + "'" +
		    	 		"," + "'" + fecha_registro + "'" +
		    	 		"," + "'" + horaActual + "'" +
		    	 		"," + "'" + fecha_documento + "'" +
		    	 		"," + "'" + usuario_actual + "'" +
		    	 		"," + "'" + estado_documento + "'"+
		    	 		"," + "'N'"+
		    	 		"," + "'N'"+
		    	 		"," + "'" + ls_documento + "'"+
		    	 		","+"'" + yearactual + "'"+")";
		    	 ////log.info("El primer ls_sql es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);

//------------------------Registramos Origen y Destino del Documento-------------------------//
		    	 
		    	 ls_sql = "insert into tramite.doc_entrada(codigo_documento,destinatario,remitente,destino_documento," +
		    	 		"fondo_destino,origen_documento,hora,desc_origen) values(" + "'" + codigo_documento + "'"
		    	 		+ "," +"'10'"+ "," +"'" + codigo_oficina + "'"
		    	 		+ "," +"'" + codigo_oficina + "'"+ "," +"'01'"
		    	 		+ "," + "'" + codigo_oficina + "'"
		    	 		+ "," +"'" + horaActual + "'"
		    	 		+ "," +"'" + desc_origen + "'"
		    	 		+ ")";
		    	 
		    	// //log.info("El cuarto ls_sql doc_interno es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);

 	 
		    		//------------------------Registramos el movimiento del Documento-------------------------//
		    	 ls_sql = "select count(codigo_documento) as c_valor from tramite.movimientos_doc where codigo_documento  = " + "'" + codigo_documento + "'"  + "";
		    	 us = cnx.createStatement();
		    	 rs = us.executeQuery(ls_sql);
		    	// //log.info("El resultset es: " + rs);
		    	
		 		while ( rs.next() ) { 
		 				            //log.info("dentro del whyle......." );
		 				            ls_valor = rs.getString("c_valor"); 
		 				            //log.info("ls_valor :" + ls_valor );
		 				            
		 		}
		 		
		 		li_secuencia = Integer.valueOf(ls_valor).intValue() + 1;
		 		////log.info("li_secuencia: " + li_secuencia);
		    	 if (ls_valor.equals("0")) {
		 			
		    		 String fecha_consulta = fecha_registro.substring(6,10)+fecha_registro.substring(3,5)+fecha_registro.substring(0,2);
			        	
			     //    //log.info("fecha_consulta: " + fecha_consulta);
			         
			         
			        	 ls_sql = "insert into tramite.movimientos_doc(codigo_documento," +
		    		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
		    		 		"estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		    		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
		    		 		"desc_origen,oficina_origen,correlativo_deriva) values(" + "'" + codigo_documento + "'"
		    	 		+ "," +"'01'"+","+"'"+ li_secuencia + "'"+ "," +"'" + codigo_oficina + "'"+ "," +"'01'"
		    	 		+ "," +"'1'"
		    	 		+ "," +"'" + fecha_registro + "'"+ "," +"'" + fecha_consulta + "'"+ "," +"'" + horaActual  + "'"
		    	 		+ "," +"'" + observa_documento + "'"+ "," +"'" + ls_codigoPadre + "'"
		    	 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+
		    	 		"," +"'" + desc_origen + "'"+
		    	 		"," +"'" + codigo_oficina + "'"+
		    	 		"," +"'" + correlativo_deriva + "'"+
		    	 		")";
		    	 
		    	// //log.info("El primer ls_sql registro entrada interno es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);
		    	
		    	 /********************registrando documento interno recorrido***********/
		    	 
		    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
	    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
	    	 		" and codigo_documento="+"'"+codigo_documento+"'"+" and secuencia_movimiento="+"'"+li_secuencia+"'"+
	    	 		" )";
		    	 
		    	// //log.info("El ls_sql insert recorrido_doc 1 documento es" + ls_sql);
		    	 
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);	
			    	 
		    	
		 		}else{
		 			String ls_estado="A";
		 			ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = " + "'" + ls_estado  + "'"+
		 			"," + "fecha_movimiento=" + "'" + fecha_registro + "'"+ "," + " hora_movimiento=" +
		 			"'" + hora + "'"+ "," + " ultimo_usuario=" + "'" + usuario_actual + "'" +
		 			" where codigo_documento = " + "'" + codigo_documento + "'"+" and secuencia_movimiento = " +
		 			"'" + li_secuencia + "'" + " ";
		 			
		 		//	 //log.info("Para actualizar los movimientos es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);
		 		}
		    	
		    	 x.cerrar_conexion(con);
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		x.cerrar_conexion(con);
	    	}

		}
	 
	 public void of_registrar_derivacion_intent(Connection cnx,String ls_oficina,String codigo_oficina,String codigo_motivo,String observacion
	   			,String destinatario,String ls_documento,String ls_secuencia,String ls_usuario,String ls_codigoPadre,
	   			int correla,String fecha_rpta,String ls_correlativo_deriva,String ls_descripcion_oficina) {
	    	
	     //   obtenermos el valor maximo...
	    	//log.info("dentro del Registro derivacion......." );
	    	
	    	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	Calendar calendario = new GregorianCalendar();
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "2";
	    	String ls_valor  = "";
	    	String origen_documento  = "";
	    	
	    	String horaActual = "00:00:00";
	    	Calendar cal = Calendar.getInstance();
	        Date hora = cal.getTime();
	        DateFormat df = DateFormat.getTimeInstance();
	        horaActual = df.format(hora);
	        
	       // //log.info("horaActual.... : " + horaActual);
	       
	        
	    	int    li_retorno =0;
	    	int    li_secuencia =0;
	    	int    li_secuencia_nueva =0;
	    	int    li_secuencia_min =0;
	    	
	    	int    li_parcial = 0 ;
	    	
	    	String codigo_documento= "" ;
	    	String ls_extraer_year= "" ;
	    	
	    	String ls_correlativo=null;
	    	
	    	Statement us  = null;
			ResultSet rs = null;
			
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
	    		
	    	
	    		ls_sql = "Select max(secuencia_movimiento) as c_valor from tramite.movimientos_doc where codigo_documento =" + "'" + ls_documento + "'" + "";
 			////log.info("ls_sql............   " + ls_sql );
 			us = cnx.createStatement();
		    	 rs = us.executeQuery(ls_sql);
		    	// //log.info("El resultset es: " + rs);
				
		    	 if (rs == null) 
		    		{
		    			////log.info("rs es nulo ......." );
		    			li_secuencia_nueva = 1;
		    	    }
		    		else
		    		{
		    			////log.info("rs NO es nulo ......." );
			    		while ( rs.next() ) { 
			    				            //log.info("dentro del whyle......." );
			    				            if (rs.getString("c_valor") == null )
			    				            {
			    				    			////log.info("ta vacio nulo ......." );
			    				    			li_secuencia_nueva = 1;
			    				    	    }
			    				            else
			    				    		{
			    				            	//log.info("ls_valor :" + rs.getString("c_valor"));
			    				            	li_secuencia = Integer.valueOf(rs.getString("c_valor")).intValue();
			    				            	li_secuencia_nueva = Integer.valueOf(rs.getString("c_valor")).intValue() + 1;
			    				            	////log.info("nuevo li_secuencia :" + li_secuencia_nueva);
			    				    		}
			    				           
			    		}
			        }
		    	 
		    	 
		    	 ls_sql = "insert into tramite.movimientos_doc(codigo_documento," +
		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie,codigo_motivo," +
		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
		 		"oficina_deriva,destinatario,correlativo_deriva,fecha_rpta,oficina_origen,desc_origen) values(" + "'" + ls_documento + "'"
	 	 		+ "," +"'01'"+","+"'"+ li_secuencia_nueva + "'"+ "," +"'" + codigo_oficina + "'"+ "," +"'01'"
	 	 		+ "," + "'" + codigo_motivo + "'"+ "," + "'" + origen_documento + "'"+ "," +"'2'"
	 	 		+ "," +"'" + fecha_documento + "'"+ "," +"'" + fechaconsulta + "'"+ "," +"'" + horaActual + "'"
	 	 		+ "," +"'" + observacion + "'"+ "," +"'" + ls_codigoPadre + "'"
	 	 		+ "," +"'" + ls_usuario + "'"+ "," +"'01'"+ "," +"'" + codigo_oficina + "'"+
	 	 		"," +"'" + destinatario + "'"+","+"'"+correla+"'"+","+"'"+fecha_rpta+"'"+
	 			","+"'"+codigo_oficina+"'"+
	 	 		","+"'"+ls_descripcion_oficina+"'"+")";
		    	 
		    	// //log.info("El primer ls_sql es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);
		    	 
		    	 /********************registrando derivacion documento recorrido***********/
		    	 
		    	 
		    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
	    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
	    	 		" and codigo_documento="+"'"+ls_documento+"'"+" and secuencia_movimiento="+"'"+li_secuencia_nueva+"'"+
	    	 		" )";
		    	 
		    	// //log.info("El ls_sql insert recorrido_doc 1 interno entrada documento es" + ls_sql);
		    	 
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);	
		    	 /************************************************************************/
		    	 
			    	// //log.info("La secuencia del movimiento lista seleccionado es:" + ls_secuencia );
		    		 ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento="+"'5'"+","+
			    	 "fecha_movimiento="+"'"+fecha_documento+"'"+","+"hora_movimiento="+
			    	 "'"+horaActual+"'"+","+"ultimo_usuario="+"'"+ls_usuario+"'"+","+"oficina_deriva="+"'"+codigo_oficina+"'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_documento+"'"+" and secuencia_movimiento="+
			    	 "'"+ls_secuencia+"'"+"";
			    	// //log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); 
			    	 
			    	 /********************registrando el update del movimiento documento recorrido***********/
			    	 
			    	 
			    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_documento+"'"+" and secuencia_movimiento="+"'"+ls_secuencia+"'"+
		    	 		" )";
			    	 
			    	// //log.info("El ls_sql insert recorrido_doc 2 interno entrada documento es" + ls_sql);
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
			    	 /************************************************************************/
			    	 
			    	// //log.info("Actualizando el documento padre en presidencia");
			    	 ls_sql = "Select max(secuencia_movimiento) as c_valor from tramite.movimientos_doc where codigo_documento =" + "'" + ls_codigoPadre + "'" + "";
			 			////log.info("ls_sql............   " + ls_sql );
			 			us = cnx.createStatement();
					    	 rs = us.executeQuery(ls_sql);
					    	 //log.info("El resultset es: " + rs);
							
					    	 if (rs == null) 
					    		{
					    			//log.info("rs es nulo ......." );
					    			li_secuencia = 1;
					    	    }
					    		else
					    		{
					    			//log.info("rs NO es nulo ......." );
						    		while ( rs.next() ) { 
						    				            //log.info("dentro del whyle......." );
						    				            if (rs.getString("c_valor") == null )
						    				            {
						    				    			//log.info("ta vacio nulo ......." );
						    				    			li_secuencia = 1;
						    				    	    }
						    				            else
						    				    		{
						    				            	//log.info("ls_valor :" + rs.getString("c_valor"));
						    				            	li_secuencia = Integer.valueOf(rs.getString("c_valor")).intValue();
						    				            	//li_secuencia_nueva = Integer.valueOf(rs.getString("c_valor")).intValue() + 1;
						    				            	////log.info("nuevo li_secuencia :" + li_secuencia_nueva);
						    				    		}
						    				           
						    		}
						        }
					    	 
					   
					    	 ls_sql = "select count(codigo_documento) as c_valor from tramite.movimientos_doc where codigo_documento  = " +
					    	 "'" + ls_codigoPadre + "'" + " and correlativo_deriva  = " +
						     "'" + ls_correlativo_deriva + "'"+"";
					    	 
					    	 us = cnx.createStatement();
					    	 rs = us.executeQuery(ls_sql);
					    	// //log.info("El resultset es: " + rs);
					    	
					 		while ( rs.next() ) { 
					 				            //log.info("dentro del whyle......." );
					 				            ls_valor = rs.getString("c_valor"); 
					 				           // //log.info("ls_valor :" + ls_valor );
					 				            
					 		}
					 		
					 		//li_secuencia = Integer.valueOf(ls_valor).intValue() + 1;
					 		if(ls_valor.equals("1")){
					 			
					 			// //log.info("El ls_valor derivacion doc" + ls_valor);
					 			//li_secuencia= li_secuencia;
						    	 
					 			////log.info("El li_secuencia" + li_secuencia);
					 			
					 		}else if(ls_valor.equals("2")){
					 			
					 			 //log.info("El ls_valor derivacion 2 doc" + ls_valor);
					 			 
					 			li_secuencia= li_secuencia - 1;
					 			
					 		//	//log.info("El li_secuencia - 1" + li_secuencia);
					 			
					 		
						    	 
					 		}else if(ls_valor.equals("3")){
					 			
					 			 //log.info("El ls_valor derivacion 3 doc" + ls_valor);
					 			 
					 			li_secuencia= li_secuencia - 2;
					 			
					 		//	//log.info("El li_secuencia - 2" + li_secuencia);
					 		
						    	 
					 		}else if(ls_valor.equals("4")){
					 			
					 			 //log.info("El ls_valor derivacion 3 doc" + ls_valor);
					 			 
					 			li_secuencia= li_secuencia - 3;
					 			
					 		//	//log.info("El li_secuencia - 3" + li_secuencia);
					 		
						    	 
					 		}
					 		
					 		ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento="+"'5'"+","+
					    	 "fecha_movimiento="+"'"+fecha_documento+"'"+","+"hora_movimiento="+
					    	 "'"+horaActual+"'"+","+"ultimo_usuario="+"'"+ls_usuario+"'"+
					    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
					    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
					    	 "'"+li_secuencia+"'"+"";
					    	// //log.info("El segundo ls_sql UPDATE es" + ls_sql);
					    	 us = con.createStatement();
					    	 us.executeUpdate(ls_sql);
			    	  
					    	 ls_sql = "UPDATE tramite.doc_entrada SET destinatario="+"'"+destinatario+"'" +
					    	 " where codigo_documento="+"'"+ls_documento+"'"+"";
					    	// //log.info("El tercer update doc_entrada ls_sql UPDATE es" + ls_sql);
					    	 us = con.createStatement();
					    	 us.executeUpdate(ls_sql);
					    	 
					    	 ls_sql = "UPDATE tramite.documento SET naturaleza_documento="+"'I'" +
					    	 " where codigo_documento="+"'"+ls_documento+"'"+"";
					    	// //log.info("El cuarto update documento ls_sql UPDATE es" + ls_sql);
					    	 us = con.createStatement();
					    	 us.executeUpdate(ls_sql);
			    	 
			    	 /********************registrando derivacion documento PAdre recorrido***********/
			    	 
			    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+"'"+li_secuencia+"'"+
		    	 		" )";
				    	 
			    	// //log.info("El ls_sql insert recorrido_doc 3 derivacion interno entrada documento es" + ls_sql);	 
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
			    	 
			    	 ls_sql = "UPDATE tramite.recorrido_doc SET estado="+"'2'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+li_secuencia+"'"+"";
			    	// //log.info("El update al recorrido ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); 
			    	 
			    	 x.cerrar_conexion(con);

			    	 
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		x.cerrar_conexion(con);
	    	}

		}
	 
	 public void of_recibir_doc_mesapartes(Connection cnx,String oficina,String documento,String usuario,String fecha,
			 String hora,String observacion,String ls_estado_doc,String ls_correlativorecepcion) {
	    	
	     //   obtenermos el valor maximo...
	    	//log.info("dentro del recibir documento......." );
	    	int    li_retorno;
	    	int    li_parcial = 0 ;
	    	String ls_correlativo=null;
	    	String ls_ano=null;
	    	String ls_mes=null;
	    	String ls_dia=null;
	    	String fecha_consulta=null;
	    	String ls_estado_derivar="3";
	    	String ls_estado_preliq="6";
	    	String ls_estado_liquid="7";
	    	String codigo_fondo="01";
	    	li_retorno = 1;
	    	Statement us  = null;
			ResultSet rs = null;
			
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
	    		
	    		////log.info("fecha: " + fecha );
	        	ls_ano = fecha.substring(6, 10);
	        	ls_mes = fecha.substring(3, 5);
	        	ls_dia = fecha.substring(0, 2);
	        	/*//log.info("ls_ano: " + ls_ano );
	        	//log.info("ls_mes: " + ls_mes );
	        	//log.info("ls_dia: " + ls_dia );*/
	        	
	        	fecha_consulta = fecha.substring(6,10)+fecha.substring(3,5)+fecha.substring(0,2);
	        	
	        	////log.info("fecha_consulta: " + fecha_consulta);
		    
	        	if(ls_estado_doc.equals("2")){
	        	
	        		////log.info("Si el estado del documento es 2,pendiente");
	        		
	        		ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = " +"'"+ls_estado_preliq+
	        		"'"+ ","+"fecha_movimiento="+"'"+fecha+"'"+","+"fecha_consulta="+"'"+fecha_consulta+"'"+
	        		","+" hora_movimiento="+"'"+hora+"'"+"," + " ultimo_usuario=" + "'" +usuario+ "'"+"," +
	        		" observa_registro=" + "'" +observacion+ "'"+"," +
	        		" codigo_recepcion=" + "'" +ls_correlativorecepcion+ "'" + " where codigo_fondo="+ "'" + codigo_fondo +
	        		"'" + " and codigo_oficina= "+ "'" +oficina + "'" + " and codigo_documento="+"'"+documento+"'"+"";
	        		
	        		//  //log.info("El ls_sql update recibir documento es" + ls_sql);
	        	
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
			    	 
			    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'"+codigo_fondo+"'"+" and codigo_oficina="+"'"+oficina+"'"+
		    	 		" and codigo_documento="+"'"+documento+"'"+
		    	 		" )";
			    	 
			    	// //log.info("El ls_sql insert recorrido_doc documento es" + ls_sql);
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
	    	 
	        	}
	        	
	        	if(ls_estado_doc.equals("6")) {
	        	
	        		//log.info("Si el estado del documento es 6,preliquidado");
	        		
	        		ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = " +"'"+ls_estado_liquid+
	        		"'"+ ","+"fecha_movimiento="+"'"+fecha+"'"+","+"fecha_consulta="+"'"+fecha_consulta+"'"+
	        		","+" hora_movimiento="+"'"+hora+"'"+"," + " ultimo_usuario=" + "'" +usuario+ "'"+"," +
	        		" observa_registro=" + "'" +observacion+ "'"+"," +
	        		" codigo_recepcion=" + "'" +ls_correlativorecepcion+ "'" + " where codigo_fondo="+ "'" + codigo_fondo +
	        		"'" + " and codigo_oficina= "+ "'" +oficina + "'" + " and codigo_documento="+"'"+documento+"'"+"";
	        		
	        		//  //log.info("El ls_sql update recibir documento es" + ls_sql);
	        	
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
	    	 
			    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'"+codigo_fondo+"'"+" and codigo_oficina="+"'"+oficina+"'"+
		    	 		" and codigo_documento="+"'"+documento+"'"+
		    	 		" )";
			    	 
			    	// //log.info("El ls_sql insert recorrido_doc documento es" + ls_sql);
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
			    	 
	        	}
	        		
	        	x.cerrar_conexion(con);	
	    		
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		x.cerrar_conexion(con);
	    	}

		}
	 
	 public void of_modificar_procedencia(Connection cnx,String codigo,String descripcion,String tipopersona) {
	    	
	    	 Statement us  = null;
	    	 String ls_valor  = "";
	    	 int    li_retorno =0;

	    	 ObtieneConexion 	x= new ObtieneConexion();
		     Connection			cn = x.getConnection();
		    	
	    	 try{
	    		 		 			
 			String ls_sql = "UPDATE tramite.persona SET nombre_persona=" + "'" + descripcion + "'" + "," + " tipo=" + "'" + tipopersona + "'" +  " " + "WHERE codigo_persona =" + "'" + codigo + "'";
			//log.info("El ls_sql modificar persona es.." + ls_sql);
    		us = cn.createStatement();
    		us.executeUpdate(ls_sql);
	 	    		
    		x.cerrar_conexion(cn);
 
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		x.cerrar_conexion(cn);
	    	} 
	    	
	    }
	 
	 public void of_modificar_procedencia(String codigo,String descripcion,String tipopersona) {
	    	
    	 Statement us  = null;
    	 String ls_valor  = "";

    	 ObtieneConexion 	x= new ObtieneConexion();
	     Connection			cn = x.getConnection();
	    	
    	 try{
    		 		 			
		String ls_sql = "UPDATE tramite.persona SET nombre_persona='"+descripcion+"',tipo='"+tipopersona+"'  WHERE codigo_persona ="+codigo ;
		//log.info("El ls_sql modificar persona es.." + ls_sql);
		us = cn.createStatement();
		us.executeUpdate(ls_sql);
 	    		
		x.cerrar_conexion(cn);

    	}
    	catch(Exception e){
    		log.info("error en el Servlet : " + e.getMessage()  );	
    		x.cerrar_conexion(cn);
    	} 
    	
    }
	 
	 public void of_eliminar_procedencia(Connection cnx,String codigo,String tipopersona) {
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
	    	Connection			cn = x.getConnection();
	    	
	    	String ls_sql = "";
	    	 Statement us  = null;
	    	
	    	 
	    	 try{
	    		 
	    			 ls_sql = "delete from tramite.persona WHERE codigo_persona =" + "'" + codigo + "'";
	 	    		us = cn.createStatement();
	 	    		us.executeUpdate(ls_sql);
	 	    		x.cerrar_conexion(cn);
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		x.cerrar_conexion(cn);
	    	} 
	    	
	    }
	 
	 public void of_eliminar_procedencia(String codigo) {
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
	    	Connection			cn = x.getConnection();
	    	Statement us  = null;
	    	
	    	 
	    	 try{
	    		 
	    		 String ls_sql = "delete from tramite.persona WHERE codigo_persona ="+codigo;
	 	    		us = cn.createStatement();
	 	    		us.executeUpdate(ls_sql);
	 	    		x.cerrar_conexion(cn);
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		x.cerrar_conexion(cn);
	    	} 
	    	
	    }
	 
	 public void of_registrar_derivacion_interno(Connection cnx,String ls_oficina,String codigo_oficina,String codigo_motivo,String observacion
	   			,String destinatario,String ls_documento,String ls_secuencia,String ls_usuario,String ls_codigoPadre,
	   			int correla,String fecha_rpta,int codigo_expediente,String ls_descripcion_oficina,
	   			int codigo_recepcion,String doc_resp,String fecha_rpta_rq) {
	    	
	     //   obtenermos el valor maximo...
	    	//log.info("dentro del Registro derivacion......." );
	    	
	    	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	Calendar calendario = new GregorianCalendar();
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "2";
	    	String ls_valor  = "";
	    	String origen_documento  = "";
	    	
	    	String horaActual = "00:00:00";
	    	Calendar cal = Calendar.getInstance();
	        Date hora = cal.getTime();
	        DateFormat df = DateFormat.getTimeInstance();
	        horaActual = df.format(hora);
	       /* if(codigo_expediente==null){
	    			codigo_expediente="0";
	   	 			log.info("El codigo_expediente es Cero.");
	   	    		}
    		if(codigo_recepcion==null){
    			codigo_recepcion="0";
   	 			log.info("El codigo de recepcion es 0.");
   	    		}*/
	      //  //log.info("horaActual.... : " + horaActual);
	       
	        
	    	int    li_retorno =0;
	    	int    li_secuencia =0;
	    	int    li_secuencia_nueva =0;
	    	int    li_secuencia_recorrido =0;
	    	
	    	li_secuencia_recorrido=Integer.valueOf(ls_secuencia).intValue()+1;
	    	
	    	int    li_parcial = 0 ;
	    	
	    	String codigo_documento= "" ;
	    	String ls_extraer_year= "" ;
	    	
	    	String ls_correlativo=null;
	    	
	    	Statement us  = null;
			ResultSet rs = null;
			
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
	    		
	    	
	    		ls_sql = "Select max(secuencia_movimiento) as c_valor from tramite.movimientos_doc where codigo_documento =" + "'" + ls_codigoPadre + "'" + "";
 			////log.info("ls_sql............   " + ls_sql );
 			us = cnx.createStatement();
		    	 rs = us.executeQuery(ls_sql);
		    	// //log.info("El resultset es: " + rs);
				
		    	 if (rs == null) 
		    		{
		    		//	//log.info("rs es nulo ......." );
		    			li_secuencia_nueva = 1;
		    	    }
		    		else
		    		{
		    			////log.info("rs NO es nulo ......." );
			    		while ( rs.next() ) { 
			    				         //   //log.info("dentro del whyle......." );
			    				            if (rs.getString("c_valor") == null )
			    				            {
			    				    			////log.info("ta vacio nulo ......." );
			    				    			li_secuencia_nueva = 1;
			    				    	    }
			    				            else
			    				    		{
			    				            //	//log.info("ls_valor :" + rs.getString("c_valor"));
			    				            	li_secuencia = Integer.valueOf(rs.getString("c_valor")).intValue();
			    				            	li_secuencia_nueva = Integer.valueOf(rs.getString("c_valor")).intValue() + 1;
			    				            	////log.info("nuevo li_secuencia :" + li_secuencia_nueva);
			    				    		}
			    				           
			    		}
			        }
		    	 
		    	 ls_sql = "insert into tramite.movimientos_doc(codigo_documento," +
		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie,codigo_motivo," +
		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
		 		"oficina_deriva,destinatario,correlativo_deriva,fecha_rpta,oficina_origen,codigo_expediente," +
		 		"desc_origen,codigo_recepcion,doc_resp,fecha_rpta_rq) values(" + "'" + ls_codigoPadre + "'"
	 	 		+ "," +"'01'"+","+"'"+ li_secuencia_nueva + "'"+ "," +"'" + codigo_oficina + "'"+ "," +"'01'"
	 	 		+ "," + "'" + codigo_motivo + "'"+ "," + "'" + origen_documento + "'"+ "," +"'2'"
	 	 		+ "," +"'" + fecha_documento + "'"+ "," +"'" + fechaconsulta + "'"+ "," +"'" + horaActual + "'"
	 	 		+ "," +"'" + observacion + "'"+ "," +"'" + ls_codigoPadre + "'"
	 	 		+ "," +"'" + ls_usuario + "'"+ "," +"'01'"+ "," +"'" + codigo_oficina + "'"+
	 	 		"," +"'" + destinatario + "'"+","+"'"+correla+"'"+","+"'"+fecha_rpta+"'"+
	 	 		","+"'"+ls_oficina+"'"+
	 	 		","+codigo_expediente+
	 	 		","+"'"+ls_descripcion_oficina+"'"+
	 	 		","+codigo_recepcion+
	 	 		","+"'"+doc_resp+"'"+
	 	 		","+"'"+fecha_rpta_rq+"'"
	 	 		+")";
		    	 
		    	log.info("El primer ls_sql es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);
		    	 
		    	
			    	 //log.info("La secuencia del movimiento lista seleccionado es:" + ls_secuencia );
		    		 ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento="+"'5'"+","+
			    	 "fecha_movimiento="+"'"+fecha_documento+"'"+","+"hora_movimiento="+
			    	 "'"+horaActual+"'"+","+"ultimo_usuario="+"'"+ls_usuario+"'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+ls_secuencia+"'"+"";
			    	 log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); 
			    	 
			    	 /********************registrando derivacion documento***********/
			    	 
			    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+"'"+ls_secuencia+"'"+
		    	 		" )";
			    	 
			    	log.info("El ls_sql insert recorrido_doc 1 documento es" + ls_sql);
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
				    	 
			    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+"'"+li_secuencia_nueva+"'"+
		    	 		" )";
				    	 
			    	log.info("El ls_sql insert recorrido_doc 2 documento es" + ls_sql);	 
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
			    	 
			    	 x.cerrar_conexion(con);
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		 x.cerrar_conexion(con);
	    	}

		}
	 
	 public Collection  mesa_partes_naturaleza_buscar(Connection cnx,
			 String naturaleza,String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);
	    	//log.info(" naturaleza.... : " + naturaleza);
	    	*/
	    	
	    	
	        try {	
	        	
	        
	        		/*//log.info(" Si es una lista naTURALEZA BUSCAR");
	   
	              		 //log.info(" Si la naturaleza es diferente de Cero 0");*/
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and dc.naturaleza_documento =  " + "'" + naturaleza + "'"  +
		 				" and md.codigo_oficina like " + "'" + codigo_oficina + "'" + " " +
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        		//	//log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 
	 public Collection  mesa_partes_naturaleza_tipodoc_buscar(Connection cnx,String ls_naturaleza,
			 String tipodoc,String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes Naturaleza Tido Doc");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        
	        		/*//log.info(" Si es una lista naTURALEZA tipo doc BUSCAR");
	   
	              		 //log.info(" Si la naturaleza es diferente de Cero 0");*/
	        			
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and dc.naturaleza_documento =  " + "'" + ls_naturaleza + "'" + 
		 				" and dc.codigo_tipo = " + "'" + tipodoc + "'" +
		 				" and md.codigo_oficina like " + "'" + oficina + "'" + " " +
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	              		 
	    
	        			////log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_tipodoc_buscar(Connection cnx,String ls_tipodoc,String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Tipo Documento");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        	
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and dc.codigo_tipo = " + "'" + ls_tipodoc + "'" +
	 				" and md.codigo_oficina like " + "'" + codigo_oficina + "'" + " " +
	 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";


	        		 
	        	
	  
	        		// //log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_naturaleza_numeroreg_buscar(Connection cnx,String ls_naturaleza,
			 String numero_registro,String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes naturalezaza NUMERO DE REGISTRO");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	    	
	    	
	        try {	
	        	
	        	
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and dc.codigo_documento like " + "'" + numero_registro + "'" +
	 				" and dc.naturaleza_documento =  " + "'" + ls_naturaleza + "'" +
	 				" and md.codigo_oficina like " + "'" + codigo_oficina + "'" + " " +
	 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        		// //log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					String naturaleza_documento=rs.getString("naturaleza_documento");
				//	//log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_estado_buscar(Connection cnx,String fecha_inicio,String fecha_fin,
			 String estado,String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	////log.info(" naturaleza.... : " + naturaleza);
	    	
	        try {	
	        	
	        	//String ls_naturaleza=naturaleza.equals("*");
	        	//ls_naturaleza="";
	        	
	        			
	        		////log.info(" Si es una lista normal");
	        		
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento = " + "'" + estado + "'" +
	 				"and md.fecha_movimiento>= " + "'" + fecha_inicio + "'" +
	 				"  and md.fecha_movimiento <= " + "'" + fecha_fin + "'" + " and md.codigo_oficina like " + "'" + codigo_oficina + "'" + " " +
	 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        		// //log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_numeroexp_buscar(Connection cnx,String fecha_inicio,String fecha_fin,
			 String expediente,String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	////log.info(" naturaleza.... : " + naturaleza);
	    	
	        try {	
	        	
	        	//String ls_naturaleza=naturaleza.equals("*");
	        	//ls_naturaleza="";
	        	
	        			
	        		////log.info(" Si es una lista normal");
	        		
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and md.codigo_expediente = " + "'" + expediente + "'" +
	 				" and md.fecha_movimiento>= " + "'" + fecha_inicio + "'" +
	 				"  and md.fecha_movimiento <= " + "'" + fecha_fin + "'" + " and md.codigo_oficina like " + "'" + codigo_oficina + "'" + " " +
	 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        		// //log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_naturaleza_fechaini_fechafin_buscar(Connection cnx,String ls_naturaleza,
			 String ls_fecha_inicio,String ls_fecha_fin,String ls_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Naturaleza, Fecha Ini,Fecha Fin");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        	
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and dc.naturaleza_documento =  " + "'" + ls_naturaleza + "'"  +
	 				" and md.fecha_movimiento>= " + "'" + ls_fecha_inicio + "'" +
	 				"  and md.fecha_movimiento <= " + "'" + ls_fecha_fin + "'" + " and md.codigo_oficina like " + "'" + ls_oficina + "'" + " " +
	 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        	//	 //log.info("El ls_sql..otros naturaleza fechas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_naturaleza_estado_buscar(Connection cnx,String ls_naturaleza,
			 String ls_estado,String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Naturaleza Estado");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	     
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        	
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento = " + "'" + ls_estado + "'" +
	 				" and dc.naturaleza_documento =  " + "'" + ls_naturaleza + "'" +
	 				" and md.codigo_oficina like " + "'" + codigo_oficina + "'" + " " +
	 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        		// //log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_naturaleza_expediente_buscar(Connection cnx,String ls_naturaleza,
	 String ls_numero_expediente,String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Naturaleza, Numero Expediente");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        	
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and md.codigo_expediente = " + "'" + ls_numero_expediente + "'" +
	 				" and dc.naturaleza_documento =  " + "'" + ls_naturaleza + "'" +
	 				" and md.codigo_oficina like " + "'" + codigo_oficina + "'" + " " +
	 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        		// //log.info("El ls_sql..otros mesa de partes naturaleza expediente.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_tipodoc_numreg_buscar(Connection cnx,String ls_tipodoc,String ls_numero_registro,
				String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes Naturaleza Tido Doc");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        
	        		/*//log.info(" Si es una lista naTURALEZA tipo doc BUSCAR");
	   
	              		 //log.info(" Si la naturaleza es diferente de Cero 0");*/
	        			
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and dc.codigo_documento like " + "'" + ls_numero_registro + "'" + 
		 				" and dc.codigo_tipo = " + "'" + ls_tipodoc + "'" +
		 				" and md.codigo_oficina like " + "'" + codigo_oficina + "'" + " " +
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	              		 
	    
	        		//	//log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_tipodoc_fecini_fecfin_buscar(Connection cnx,String ls_tipodoc,String ls_fecha_inicio,String ls_fecha_fin,
				String ls_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de tipo doc, Fecha Ini,Fecha Fin");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        	
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina " +
	 				" and de.destino_documento=of_a.codigo_oficina and  dc.codigo_tipo = " + "'" + ls_tipodoc + "'"  +
	 				" and md.fecha_movimiento>= " + "'" + ls_fecha_inicio + "'" +
	 				"  and md.fecha_movimiento <= " + "'" + ls_fecha_fin + "'" + " and md.codigo_oficina like " + "'" + ls_oficina + "'" + " " +
	 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        		// //log.info("El ls_sql..otros naturaleza fechas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_tipodoc_estado_buscar(Connection cnx,String ls_tipodoc,String ls_estado,
				String ls_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de tipo doc, Estado");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        	
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and dc.codigo_tipo = " + "'" + ls_tipodoc + "'"  +
	 				" and md.estado_movimiento = " + "'" + ls_estado + "'"  +
	 				" and md.codigo_oficina like " + "'" + ls_oficina + "'" + " " +
	 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        		// //log.info("El ls_sql..otros estado fechas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_tipodoc_numexp_buscar(Connection cnx,String ls_tipodoc,String ls_numero_expediente,
				String ls_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de tipo doc, Numero Expediente");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        	
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and  dc.codigo_tipo = " + "'" + ls_tipodoc + "'"  +
	 				" and md.codigo_expediente = " + "'" + ls_numero_expediente + "'" +
	 				" and md.codigo_oficina like " + "'" + ls_oficina + "'" + " " +
	 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        		// //log.info("El ls_sql..otros estado fechas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_numreg_buscar(Connection cnx,String ls_numero_registro,
				String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes Numero de Registro");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        	
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and dc.codigo_documento like " + "'" + ls_numero_registro + "'" + 
		 				" and md.codigo_oficina like " + "'" + codigo_oficina + "'" + " " +
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	              		 
	    
	        		//	//log.info("El ls_sql..otros mesa de partes Num Registro.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_numreg_fechaini_fechafin_buscar(Connection cnx,String ls_numero_registro,String ls_fecha_inicio,String ls_fecha_fin,
				String ls_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Numero Registro, Fecha Ini,Fecha Fin");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        	
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina " +
	 				" and de.destino_documento=of_a.codigo_oficina and dc.codigo_documento like " + "'" + ls_numero_registro + "'"  +
	 				" and md.fecha_movimiento>= " + "'" + ls_fecha_inicio + "'" +
	 				"  and md.fecha_movimiento <= " + "'" + ls_fecha_fin + "'" + " and md.codigo_oficina like " + "'" + ls_oficina + "'" + " " +
	 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        		// //log.info("El ls_sql..otros naturaleza fechas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_numreg_estado_buscar(Connection cnx,String ls_numero_registro,String ls_estado,
				String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes Numero de Registro,Estado");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        	
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and dc.codigo_documento like " + "'" + ls_numero_registro + "'" + 
		 				" and md.estado_movimiento = " + "'" + ls_estado + "'"  +" and md.codigo_oficina like " + "'" + codigo_oficina + "'" + " " +
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	              		 
	    
	        			////log.info("El ls_sql..otros mesa de partes Num Registro.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_numreg_numexp_buscar(Connection cnx,String ls_numero_registro,String ls_numero_expediente,
				String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes Numero de Registro,Numnero Expediente");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        	
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and dc.codigo_documento like " + "'" + ls_numero_registro + "'" + 
		 				" and md.codigo_expediente = " + "'" + ls_numero_expediente + "'"  +" and md.codigo_oficina like " + "'" + codigo_oficina + "'" + " " +
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	              		 
	    
	        			////log.info("El ls_sql..otros mesa de partes Num Registro.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_estado_buscar(Connection cnx,String ls_estado,String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes Estado");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        	
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina " + 
		 				" and md.estado_movimiento = " + "'" + ls_estado + "'"  +" and md.codigo_oficina like " + "'" + codigo_oficina + "'" + " " +
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	              		 
	    
	        			////log.info("El ls_sql..otros mesa de partes Estado.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_estado_numexp_buscar(Connection cnx,String ls_estado,String ls_numero_expediente,String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes Estado,Numnero Expediente");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        	
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento = " + "'" + ls_estado + "'"  + 
		 				" and md.codigo_expediente = " + "'" + ls_numero_expediente + "'"  +" and md.codigo_oficina like " + "'" + codigo_oficina + "'" + " " +
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	              		 
	    
	        			////log.info("El ls_sql..otros mesa de partes Num Registro.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 public Collection  mesa_partes_numexp_buscar(Connection cnx,String ls_numero_expediente,String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes,Numnero Expediente");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        	
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina "  + 
		 				" and md.codigo_expediente = " + "'" + ls_numero_expediente + "'"  +" and md.codigo_oficina like " + "'" + codigo_oficina + "'" + " " +
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	              		 
	    
	        			////log.info("El ls_sql..otros mesa de partes Num Registro.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  of_lista_rango_codigos(Connection cnx,String oficina,String naturaleza,String fecha) throws Exception {
			
	        //log.info("ENTRO A  Lista de Rango de codigos");
			Collection ListaRangoCodigos = new ArrayList();
			
			BMesaPartes BMesaPartesVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "SELECT md.codigo_documento FROM tramite.movimientos_doc md,tramite.documento dc " +
	        			"WHERE  dc.codigo_documento = md.codigo_documento  and md.codigo_oficina like " +
	        			"'" + oficina + "'" +" AND md.codigo_fondo like '01'  AND md.fecha_movimiento = " +
	        			"'" + fecha + "'" +" AND dc.naturaleza_documento = " +"'" + naturaleza + "'" +"";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BMesaPartesVO = new BMesaPartes();
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					
					ListaRangoCodigos.add(BMesaPartesVO);

				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaRangoCodigos;
		                
		}
	 
	 public Collection  of_lista_reportes(Connection cnx,String oficina,String naturaleza,String fecha,
			 String cbodesde,String cbohasta) throws Exception {
			
	        //log.info("ENTRO A  Lista de Reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);
	    	//log.info(" naturaleza.... : " + naturaleza);
	    	*/
	    	
	    	
	        try {	
	        	
	        
	        		/*//log.info(" Si es una lista naTURALEZA BUSCAR");
	   
	              		 //log.info(" Si la naturaleza es diferente de Cero 0");*/
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and dc.naturaleza_documento =  " + "'" + naturaleza + "'" + "  and" +
		 				" md.fecha_movimiento= " + "'" + fecha + "'" + "" +
		 				" and md.codigo_documento>= " + "'" + cbodesde + "'" +
		 				" and md.codigo_documento <= " + "'" + cbohasta + "'" + 
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        			////log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public void of_modificar_fecharespuesta(Connection cnx,String oficina,String documento)  {
			
			String ls_sql = "";
			ObtieneConexion x= new ObtieneConexion();
			Connection	con= x.getConnection();
			PreparedStatement pstmt = null;
			
			try
			{
				
				ls_sql = "UPDATE tramite.movimientos_doc SET fecha_rpta=?  WHERE codigo_documento =?  and codigo_oficina=? ";
				
				////log.info("El ls_sql  fecha de respuesta a vacio modificar es.." + ls_sql);
				pstmt = con.prepareStatement(ls_sql);
				pstmt.setString(1, "");
				pstmt.setInt(2, Integer.parseInt(documento));
				pstmt.setInt(3, Integer.parseInt(oficina));
		    	 
		    	pstmt.executeUpdate();
				
		   	 
		    	 /*ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
	    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+oficina+"'"+
	    	 		" and codigo_documento="+"'"+documento+"'"+
	    	 		" )";
		    	 
		    	 //log.info("El ls_sql insert recorrido_doc documento fecha es" + ls_sql);
		    	 
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);*/	
		   	 x.cerrar_conexion(con);
		   	 pstmt.close();
			}
			catch (SQLException se)
			{
				System.err.println("Se ha producido un error de BD.");  
				System.err.println(se.getMessage());
				 x.cerrar_conexion(con);
			}
			}
	 
	 public Collection  reportes_todos_buscar(Connection cnx) throws Exception {
			
	        //log.info("ENTRO A  Reportes todos");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	////log.info(" naturaleza.... : " + naturaleza);
	    	
	        try {	
	        	
	        	//String ls_naturaleza=naturaleza.equals("*");
	        	//ls_naturaleza="";
	        	
	        			
	        		////log.info(" Si es una lista normal");
	        		
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina " +
	 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        		// //log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
				//	//log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 
	 public Collection  reportes_naturaleza_buscar(Connection cnx,String naturaleza) throws Exception {
			
	        //log.info("ENTRO A  Lista Naturaleza reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);
	    	*/
	    	
	    	
	    	
	        try {	
	        	
	        
	        		/*//log.info(" Si es una lista naTURALEZA BUSCAR");
	   
	              		 //log.info(" Si la naturaleza es diferente de Cero 0");*/
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and dc.naturaleza_documento =  " + "'" + naturaleza + "'" + 
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        		//	//log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    	//	//log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
						//	//log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_estado_buscar(Connection cnx,String estado) throws Exception {
			
	        //log.info("ENTRO A  Lista estado reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);
	    	*/
	    	
	    	
	    	
	        try {	
	        	
	        
	        		/*//log.info(" Si es una lista naTURALEZA BUSCAR");
	   
	              		 //log.info(" Si la naturaleza es diferente de Cero 0");*/
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento = " + "'" + estado + "'" + 
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        		//	//log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
						//	//log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 public Collection  reportes_tipodoc_buscar(Connection cnx,String tipodoc) throws Exception {
			
	        //log.info("ENTRO A  Lista Naturaleza reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);
	    	*/
	    	
	    	
	    	
	        try {	
	        	
	        
	        		/*//log.info(" Si es una lista naTURALEZA BUSCAR");
	   
	              		 //log.info(" Si la naturaleza es diferente de Cero 0");*/
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and dc.codigo_tipo = " + "'" + tipodoc + "'" + 
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        		//	//log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_tipodoc_estado_buscar(Connection cnx,String tipodoc,String estado) throws Exception {
			
	        //log.info("ENTRO A  Lista tipo doc estado reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);
	    	*/
	    	
	    	
	    	
	        try {	
	        	
	        
	        	/*	//log.info(" Si es una lista naTURALEZA BUSCAR");
	   
	              		 //log.info(" Si la naturaleza es diferente de Cero 0");*/
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and dc.codigo_tipo = " + "'" + tipodoc + "'" + 
		 				" and md.estado_movimiento = " + "'" + estado + "'" +" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        		//	//log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    	//	//log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_naturaleza_estado_buscar(Connection cnx,String naturaleza,String estado) throws Exception {
			
	        //log.info("ENTRO A  Lista Naturaleza Estado reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);
	    	*/
	    	
	    	
	    	
	        try {	
	        	
	        
	        		/*//log.info(" Si es una lista naTURALEZA BUSCAR");
	   
	              		 //log.info(" Si la naturaleza es diferente de Cero 0");*/
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and dc.naturaleza_documento =  " + "'" + naturaleza + "'" + 
		 				" and md.estado_movimiento = " + "'" + estado + "'" +" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        			////log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 public Collection  reportes_naturaleza_tipodoc_buscar(Connection cnx,String naturaleza,String tipodoc) throws Exception {
			
	        //log.info("ENTRO A  Lista Naturaleza Estado reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);
	    	*/
	    	
	    	
	    	
	        try {	
	        	
	        
	        		/*//log.info(" Si es una lista naTURALEZA BUSCAR");
	   
	              		 //log.info(" Si la naturaleza es diferente de Cero 0");*/
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and dc.naturaleza_documento =  " + "'" + naturaleza + "'" + 
		 				" and dc.codigo_tipo = " + "'" + tipodoc + "'" +" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        		//	//log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection reportes_naturaleza_estado_codigotipo_buscar(Connection cnx,String naturaleza,String estado,String codigo_tipo) throws Exception {
			
	        //log.info("ENTRO A  Lista Naturaleza Estado Codigo Tipo reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    	
	    	
	    	
	        try {	
	        	
	        
	        	/*	//log.info(" Si es una lista naTURALEZA BUSCAR");
	   
	              		 //log.info(" Si la naturaleza es diferente de Cero 0");*/
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and dc.naturaleza_documento =  " + "'" + naturaleza + "'" + 
		 				" and md.estado_movimiento = " + "'" + estado + "'" + " and dc.codigo_tipo = " + "'" + codigo_tipo + "'"+
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        			////log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
						//	//log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_usuario_buscar(Connection cnx,String usuario)  throws Exception {
			
	        //log.info("ENTRO A  Lista usuarios reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    	
	    	
	    	
	        try {	
	        	
	        
	        		////log.info(" Si es una lista usuarios BUSCAR");
	  
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and md.ultimo_usuario = " + "'" + usuario + "'"  + 
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        			////log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
						//	//log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_usuario_fecha_buscar(Connection cnx,String usuario,String fecha)  throws Exception {
			
	        //log.info("ENTRO A  Lista usuarios fecha reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    /*	//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    	
	    	
	    	
	        try {	
	        	
	        
	        		////log.info(" Si es una lista usuarios fecha BUSCAR");
	  
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and md.ultimo_usuario = " + "'" + usuario + "'"  + 
		 				" and md.fecha_movimiento like " + "'" + fecha + "'"  + " order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        			////log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_usuario_oficina_buscar(Connection cnx,String usuario,String oficina)  throws Exception {
			
	        //log.info("ENTRO A  Lista usuarios oficina reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    	
	    	
	    	
	        try {	
	        	
	        
	        		////log.info(" Si es una lista usuarios oficina BUSCAR");
	  
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and md.ultimo_usuario = " + "'" + usuario + "'"  + 
		 				" and md.codigo_oficina = " + "'" + oficina + "'"  + " order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        			////log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_fecha_buscar(Connection cnx,String fecha)  throws Exception {
			
	        //log.info("ENTRO A  Lista fecha reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    	
	    	
	    	
	        try {	
	        	
	        
	        		////log.info(" Si es una lista usuarios oficina BUSCAR");
	  
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and md.fecha_movimiento like " + "'" + fecha + "'"  + 
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        			////log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_fecha_oficina_buscar(Connection cnx,String fecha,String oficina)  throws Exception {
			
	        //log.info("ENTRO A  Lista fecha oficina reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    	
	    	
	    	
	        try {	
	        	
	        
	        	//	//log.info(" Si es una lista usuarios oficina BUSCAR");
	  
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and md.fecha_movimiento like " + "'" + fecha + "'"  + 
		 				" and md.codigo_oficina = " + "'" + oficina + "'"  + " order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        			////log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    	//	//log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_oficina_buscar(Connection cnx,String oficina)  throws Exception {
			
	        //log.info("ENTRO A  Lista oficina reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);
	    	
	    	
	    	
	    	*/
	        try {	
	        	
	        
	        		////log.info(" Si es una lista  oficina BUSCAR");
	  
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina "  + 
		 				" and md.codigo_oficina = " + "'" + oficina + "'"  + " order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        			////log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_oficina_usuario_fecha_buscar(Connection cnx,String oficina,String usuario,String fecha)  throws Exception {
			
	        //log.info("ENTRO A  Lista oficina,usuario,fecha reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    	
	    	
	    	
	        try {	
	        	
	        
	        		////log.info(" Si es una lista  oficina,usuario,fecha BUSCAR");
	  
	        			
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and md.fecha_movimiento like " + "'" + fecha + "'"  + 
	 				" and md.codigo_oficina = " + "'" + oficina + "'"  + " and md.ultimo_usuario = " + "'" + usuario + "'"+
	 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
              		 
	    
	        			////log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public void of_modificar_documento(Connection cnx,String codigo_documento,int codigo_expediente,
				String secuencia_movimiento,String codigo_oficina,String medio,String codigo_tipo,
				String ls_seleccion,String destino_documento,String origen_documento,String destinatario,
				String codigo_solicitud,String numero_documento,String fecha_registro,
				String hora,String folios_documento,String asunto_documento,String observa_documento,
				String usuario_actual,String firmadopor,String desc_origen,
				String tipo_persona,String persona,String fecha_rpta,int correlativorecepcion,
				String numero_referencia,String dirigido) {
	    	
	    	String ls_sql = "";
	    	 Statement us  = null;
	    	 ResultSet rs = null;
	    	 String ls_valor  = "";
	    	 int    li_retorno =0;

	    	 ObtieneConexion 	x= new ObtieneConexion();
		     Connection			cn = x.getConnection();
		    	
	    	 try{
	    		 		 			
			ls_sql = "UPDATE tramite.movimientos_doc SET fecha_movimiento=" + "'" + fecha_registro.trim() +"'" + "," +
			" hora_movimiento=" + "'" + hora.trim()+ "'"+ "," + " oficina_origen=" + "'" + codigo_oficina.trim() + "'"
			+ "," + " oficina_deriva=" + "'" + destino_documento.trim() + "'"
			+ "," + " observa_movimiento=" + "'" + observa_documento.trim() + "'"
			+ "," + " numero_referencia=" + "'" + numero_referencia.trim() + "'"
			+ "," + " destinatario=" + "'" + destinatario.trim() + "'"
			+ "," + " fecha_rpta=" + "'" + fecha_rpta.trim() + "'"
			+ "," + " tipo=" + "'" + tipo_persona.trim() + "'"
			+ "," + " desc_origen=" + "'" + desc_origen.trim() + "'"
			+  " " + "WHERE codigo_documento =" + "'" + codigo_documento.trim() + "'" +
			//" and codigo_oficina =" + "'" + codigo_oficina.trim() + "'";
			" and codigo_oficina =" + "'" + codigo_oficina.trim() + "'" +
			" and secuencia_movimiento =" + "'" + secuencia_movimiento.trim() + "'";
			log.info("El ls_sql modificar documento 1 movimientos_doc es.." + ls_sql);
	 		us = cn.createStatement();
	 		us.executeUpdate(ls_sql);
	 		
	 		int ls_secuencia =Integer.valueOf(secuencia_movimiento).intValue()+1;
	 		log.info("El ls_secuencia xxx es.." + ls_secuencia);
	 		ls_sql = "UPDATE tramite.movimientos_doc SET fecha_movimiento=" + "'" + fecha_registro.trim() +"'" + "," +
			" hora_movimiento=" + "'" + hora.trim()+ "'"+ "," + " oficina_origen=" + "'" + codigo_oficina.trim() + "'"
			+ "," + " oficina_deriva=" + "'" + destino_documento.trim() + "'"
			+ "," + " observa_movimiento=" + "'" + observa_documento.trim() + "'"
			+ "," + " numero_referencia=" + "'" + numero_referencia.trim() + "'"
			+ "," + " destinatario=" + "'" + destinatario.trim() + "'"
			+ "," + " fecha_rpta=" + "'" + fecha_rpta.trim() + "'"
			+ "," + " tipo=" + "'" + tipo_persona.trim() + "'"
			+ "," + " desc_origen=" + "'" + desc_origen.trim() + "'"
			+ "," + " codigo_oficina=" + "'" + destino_documento.trim() + "'"
			+  " " + "WHERE codigo_documento =" + "'" + codigo_documento.trim() + "'" +
			" and secuencia_movimiento =" + "'" + ls_secuencia + "'";
			log.info("El ls_sql modificar documento 2 movimientos_doc es.." + ls_sql);
	 		us = cn.createStatement();
	 		us.executeUpdate(ls_sql);
	 		
	 		
	 		ls_sql = "UPDATE tramite.documento SET folios_documento=" + "'" + folios_documento.trim() +"'" +
	 		"," + " codigo_tipo=" + "'" + codigo_tipo.trim() + "'"+
			"," + " numero_documento=" + "'" + numero_documento.trim() + "'"
			+ "," + " fecha_registro=" + "'" + fecha_registro.trim() + "'"
			+ "," + " hora_registro=" + "'" + hora.trim() + "'"
			+ "," + " asunto_documento=" + "'" + asunto_documento.trim() + "'"
			+ "," + " observa_documento=" + "'" + observa_documento.trim() + "'"
			+ "," + " dirigido=" + "'" + dirigido.trim() + "'"
			+  " " + "WHERE codigo_documento =" + "'" + codigo_documento.trim() + "'";
			//log.info("El ls_sql modificar documento 2 documento." + ls_sql);
	 		us = cn.createStatement();
	 		us.executeUpdate(ls_sql);
	 		
	 		ls_sql = "UPDATE tramite.doc_entrada SET medio=" + "'" + medio.trim() +"'" +
			"," + " firmadopor=" + "'" + firmadopor.trim() + "'"+
			"," + " remitente=" + "'" + origen_documento.trim() + "'"+
			"," + " codigo_solicitud=" + "'" + codigo_solicitud.trim() + "'"+
			"," + " origen_documento=" + "'" + origen_documento.trim() + "'"+
			"," + " tipo=" + "'" + tipo_persona.trim() + "'"+
			"," + " desc_origen=" + "'" + desc_origen.trim() + "'"+
			"," + " destino_documento=" + "'" + destino_documento.trim() + "'"+
			"," + " destinatario=" + "'" + destinatario.trim() + "'"
			+  " " + " WHERE codigo_documento =" + "'" + codigo_documento.trim() + "'";
			//log.info("El ls_sql modificar documento 2 documento." + ls_sql);
	 		us = cn.createStatement();
	 		us.executeUpdate(ls_sql);
	 		

	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    	} 
	    	
	    }
	 
	 public void of_eliminar_documento(Connection cnx,String codigo_documento,String oficina,String secuencia) {
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
	    	Connection			cn = x.getConnection();
	    	
	    	String ls_sql = "";
	    	 Statement us  = null;
	    	
	    	 
	    	 try{
	    		 
	    			ls_sql = "delete from tramite.movimientos_doc WHERE codigo_documento =" + "'" + codigo_documento + "'";
	    			
	    			//log.info("El ls_sql 1 delete: "+ ls_sql);	
	 	    		us = cn.createStatement();
	 	    		us.executeUpdate(ls_sql);
	 	    		
	 	    		ls_sql = "delete from tramite.documento WHERE codigo_documento =" + "'" + codigo_documento + "'";
	 	    		
	 	    		//log.info("El ls_sql 2 delete: "+ ls_sql);
	 	    		us = cn.createStatement();
	 	    		us.executeUpdate(ls_sql);
	 	    		
	 	    		ls_sql = "delete from tramite.doc_entrada WHERE codigo_documento =" + "'" + codigo_documento + "'";
	 	    		//log.info("El ls_sql 3 delete: "+ ls_sql);
	 	    		us = cn.createStatement();
	 	    		us.executeUpdate(ls_sql);
	 	    		
	 	    		x.cerrar_conexion(cn);
	 	    		us.close();
	 	    
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );
	    		x.cerrar_conexion(cn);
	    	} 
	    	
	    }
	 
	 public Collection  of_lista_frame_documentos(Connection cnx,String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista Frame Documentos");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	      
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	ObtieneConexion 	x= new ObtieneConexion();
	    	Connection			cn = x.getConnection();
	    	
	        try {	
	        	
	        	
	        		////log.info(" Si es una lista normal");
	        		
	        		 ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        			"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
	        			"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta,md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.codigo_recepcion," +
	        			"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	        			"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	        			"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino," +
	        			"pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc md," +
	        			"tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de,tramite.oficinas of," +
	        			"tramite.oficinas of_a,tramite.personal pr where tp.codigo_tipo=dc.codigo_tipo and" +
	        			" dc.codigo_documento=md.codigo_documento and dc.codigo_documento=de.codigo_documento and" +
	        			" md.codigo_documento=de.codigo_documento and de.destinatario=pr.codigo_personal and" +
	        			" md.codigo_oficina=of.codigo_oficina and de.destino_documento=of_a.codigo_oficina and" +
	        			" md.codigo_oficina like " + "'" + oficina + "'" + " and md.codigo_fondo like '01' order by" +
	        			"  md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	        		 
	        	
	  
	        		 ////log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
	 		    	us = cn.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					BMesaPartesVO.setCodigo_recepcion(rs.getString("codigo_recepcion"));
					
					//String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            x.cerrar_conexion(cn, rs);
				us.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(cn);
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection of_lista_frame_historial(Connection cnx,String cod_documento,String secuencia_movimiento,String numero_referencia) throws Exception {
			
	        log.info("Entry of_lista_frame_historial...");
			Collection listaHistorial = new ArrayList();
			
			BMesaPartes BMesaPartesVO = null;
			//Statement us  = null;
			PreparedStatement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	
	        	StringBuffer ls_sql = new StringBuffer("select md.codigo_documento as codigo_documento," +
	        			"md.codigo_oficina,md.fecha_movimiento as fecha_movimiento,md.hora_movimiento as" +
	        			" hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento as" +
	        			" secuencia_movimiento,md.ultimo_usuario," +
 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
 				"md.codigo_expediente,md.numero_referencia,md.oficina_origen,md.oficina_deriva,md.codigo_recepcion,md.destinatario as ofidestinatario,tp.descripcion_tipo," +
 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal " +
 				",(select to_date(fecha_movimiento,'dd/MM/YYYY')+ hora_movimiento from " +
		 		" tramite.recorrido_doc where codigo_documento = md.codigo_documento and secuencia_movimiento = md.secuencia_movimiento order by 1 limit 1) as fecha_envio,"+
		 		" (select to_date(fecha_movimiento,'dd/MM/YYYY')+ hora_movimiento from "+
		 		" tramite.recorrido_doc where codigo_documento = md.codigo_documento and secuencia_movimiento = md.secuencia_movimiento and estado_movimiento = 3 limit 1) as fecha_recepcion, "+
		 		" (select to_date(fecha_movimiento,'dd/MM/YYYY')+ hora_movimiento from "+
				" tramite.recorrido_doc where codigo_documento = md.codigo_documento and secuencia_movimiento = md.secuencia_movimiento and estado_movimiento = 5 limit 1) as fecha_derivacion," +
				" md.tipo_envio "+
 				" from tramite.movimientos_doc" +
 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina " +
 				" and md.estado_movimiento <>'A' "+
 				" and de.destino_documento=of_a.codigo_oficina and dc.codigo_documento = " + "'" +cod_documento+ "'");
	        	
	        	log.info("secuencia_movimiento2: " +secuencia_movimiento);
 				
 			if(secuencia_movimiento != null && !secuencia_movimiento.equals("") && secuencia_movimiento.trim().length()>=1){
 				//if(Integer.parseInt(secuencia_movimiento.trim().length())>=1)
 				ls_sql.append(" and md.secuencia_movimiento<>'1'");
		    		 ////log.info("Tipo Ren: " + ls_sql);

 				// " and md.secuencia_movimiento<>'2' " +
 				}
 				
 				if(numero_referencia != null && !numero_referencia.equals("")){
 					/*
		    		 ls_sql.append(" UNION select md1.codigo_documento,md1.codigo_oficina,md1.fecha_movimiento," +
		    		 		"md1.hora_movimiento,md1.estado_movimiento,md1.codigo_inicia," +
		    		 		"md1.secuencia_movimiento,md1.ultimo_usuario,md1.doc_deriva," +
		    		 		"md1.observa_movimiento,md1.codigo_motivo,md1.fecha_rpta,md1.codigo_expediente" +
		    		 		",md1.oficina_origen,md1.oficina_deriva," +
		    		 		"md1.codigo_recepcion,md1.numero_referencia,md1.destinatario as ofidestinatario,tp1.descripcion_tipo," +
		    		 		"dc1.numero_documento,dc1.naturaleza_documento,dc1.asunto_documento," +
		    		 		"dc1.numero_documento_ant,de1.origen_documento,de1.destino_documento," +
		    		 		"de1.desc_origen,de1.tipo,de1.remitente,de1.destinatario,of1.codigo_oficina," +
		    		 		"of1.descripcion_oficina,of_a1.descripcion_oficina as descripcion_destino," +
		    		 		"pr1.codigo_personal,pr1.nombre_personal " +
		    		 		
		    		 		" from tramite.movimientos_doc md1," +
		    		 		"tramite.tipo_documento tp1,tramite.documento dc1,tramite.doc_entrada de1," +
		    		 		"tramite.oficinas of1,tramite.oficinas of_a1,tramite.personal pr1 " +
		    		 		"where tp1.codigo_tipo=dc1.codigo_tipo and " +
		    		 		"dc1.codigo_documento=md1.codigo_documento and " +
		    		 		"dc1.codigo_documento=de1.codigo_documento and " +
		    		 		"md1.codigo_documento=de1.codigo_documento and" +
		    		 		" de1.destinatario=pr1.codigo_personal and md1.codigo_oficina=of1.codigo_oficina" +
		    		 		" and de1.destino_documento=of_a1.codigo_oficina and dc1.codigo_documento" +
		    		 		" like " + "'" +numero_referencia+ "'" +
		    		 		" and md1.secuencia_movimiento<>'1'");*/
		    		 //log.info("el codigo_expediente: " + ls_sql);
					}
 				
 				
 				
 				ls_sql.append(" order by secuencia_movimiento desc,codigo_documento desc, hora_movimiento desc, fecha_movimiento desc");
 				
 				String query = ls_sql.toString();
 				us = cnx.prepareStatement(query);
				rs = us.executeQuery();
				//log.info("Si ls_sql frame..: " + ls_sql);

		    	/*us = cnx.createStatement();
				rs = us.executeQuery(ls_sql);*/
				////log.info("El ls_sql" + ls_sql);
				
				int contador=0;
			Funciones funciones=new Funciones();	
			while ( rs.next() ) { 
				
				BMesaPartesVO = new BMesaPartes();
				
				
				BMesaPartesVO.setTipo_envio(rs.getString("tipo_envio"));
				BMesaPartesVO.setFecha_envio(rs.getTimestamp("fecha_envio"));
				BMesaPartesVO.setFecha_recepcion(rs.getTimestamp("fecha_recepcion"));
				BMesaPartesVO.setFecha_derivacion(rs.getTimestamp("fecha_derivacion"));
				BMesaPartesVO.setTiempo_bandeja_automatico();
				
				BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
				BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
				BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
				BMesaPartesVO.setEstado_movimiento(funciones.of_nombre_estado_seguimiento(cnx, rs.getString("estado_movimiento")));
				BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
				
				BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
				BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
				
				BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
				BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
				BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
				BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
				BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
				BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
				BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
				BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
				BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
				BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
				BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
				BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
				BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
				BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
				BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
				BMesaPartesVO.setTipo(rs.getString("tipo"));
				BMesaPartesVO.setRemitente(rs.getString("remitente"));
				
				BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
				BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
				BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
				BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
				BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
				BMesaPartesVO.setNombre_personal(funciones.of_nombre_persona(cnx, rs.getString("ofidestinatario")));
				//BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
				BMesaPartesVO.setCodigo_recepcion(rs.getString("codigo_recepcion"));
				BMesaPartesVO.setNumero_referencia(rs.getString("numero_referencia"));
				BMesaPartesVO.setNombre_oficina_origen(funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_origen")));
				BMesaPartesVO.setNombre_oficina_destino(funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_deriva")));
				
				listaHistorial.add(BMesaPartesVO);
	
			}	
     
				rs.close();
				
	        } catch (Exception e) {
	             e.printStackTrace();
	        }
	        return listaHistorial;
		                
		}
	 
	 public Collection  mesa_partes_procedencia_buscar(Connection cnx,String ls_procedencia,String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Procedencia");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        	
	        	ls_procedencia= "%"+ls_procedencia+"%";
	        	
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina  and md.desc_origen like " + "'" +ls_procedencia+ "'" +  
		 				
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		
	              		 
	        			////log.info("El ls_sql..otros mesa de partes Num Registro.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  mesa_partes_fecha_buscar(Connection cnx,String ls_sle_fecha,String oficina)  throws Exception {
			
	        //log.info("ENTRO A  Lista fecha oficina reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        
	        		////log.info(" Si es una lista fechas oficina");
	  
	        			
	        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and md.fecha_movimiento like " + "'" + ls_sle_fecha + "'"  + 
		 				" and md.codigo_oficina = " + "'" + oficina + "'"  + " order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        			////log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_solicitud_buscar(Connection cnx,String solicitud,String oficina)  throws Exception {
			
	        //log.info("ENTRO A  Lista solicitudes reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        
        			ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
        					"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
        					"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
        					"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva," +
        					"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento," +
        					"dc.numero_documento_ant,de.origen_documento,de.destino_documento,de.desc_origen," +
        					"de.tipo,de.remitente,de.destinatario,de.codigo_solicitud,of.codigo_oficina," +
        					"of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino," +
        					"pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc md," +
        					"tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
        					"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where " +
        					"tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and " +
        					"dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento " +
        					"and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and " +
        					"de.destino_documento=of_a.codigo_oficina and de.codigo_solicitud = " + "'" + solicitud + "'"  +
        					" and md.codigo_oficina = " + "'" + oficina + "'"  + " order by " +
        					" md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		 
	    
	        			////log.info("El ls_sql..solicitud.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_numexpediente_buscar(Connection cnx,String numexpediente,String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista Expedientes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        	
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and md.codigo_expediente = " + "'" + numexpediente + "'" +
	 				" and md.codigo_oficina = " + "'" + oficina + "'"  + " order by md.fecha_movimiento desc," +
	 				" md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        		// //log.info("El ls_sql..otros expedientes.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_medio_buscar(Connection cnx,String medio,String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista Medios");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        	
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and de.medio = " + "'" + medio + "'" +
	 				" and md.codigo_oficina = " + "'" + oficina + "'"  + " order by md.fecha_movimiento desc," +
	 				" md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        	//	 //log.info("El ls_sql..otros expedientes.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    	//	//log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 
	 public Collection  reportes_codtipo_buscar(Connection cnx,String ls_codigo_tipo,String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista Codigo Tipo");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        	
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and dc.codigo_tipo = " + "'" + ls_codigo_tipo + "'" +
	 				" and md.codigo_oficina = " + "'" + oficina + "'"  + " order by md.fecha_movimiento desc," +
	 				" md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        		// //log.info("El ls_sql..otros expedientes.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_numregistro_buscar(Connection cnx,String ls_numero_registro,String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista numero registro");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        	
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and md.codigo_documento = " + "'" + ls_numero_registro + "'" +
	 				" and md.codigo_oficina = " + "'" + oficina + "'"  + " order by md.fecha_movimiento desc," +
	 				" md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        	//	 //log.info("El ls_sql..otros expedientes.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
				//	//log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public void of_modificar_usuarioclave(Connection cnx,String usuario,String clave,
			 String clavenueva,String confirmarclavenueva) {
	    	
	    	String ls_sql = "";
	    	 Statement us  = null;
	    	 ResultSet rs = null;
	    	 String ls_valor  = "";
	    	 int    li_retorno =0;

	    	 ObtieneConexion 	x= new ObtieneConexion();
		     Connection			con = x.getConnection();
		    	
	    	 try{
	    		
	    		 
	    	/*ls_sql = "select usuario,clave  from tramite.usuarios WHERE " +
     			"usuario=" + "'" + usuario + "'" +" and clave=" + "'" + clave + "'" + "";
     	
		    us = cnx.createStatement();
	 		rs = us.executeQuery(ls_sql);*/
 		
	 		ls_sql = "select count(usuario) as c_valor from tramite.usuarios WHERE " +
     			"usuario=" + "'" + usuario + "'" +" and clave=" + "'" + clave + "'" + "";
	 		
	 		////log.info("El ls_sql es: " + ls_sql);
	 		
	    	 us = cnx.createStatement();
	    	 rs = us.executeQuery(ls_sql);
	    	// //log.info("El resultset es: " + rs);
	    	
	 		while ( rs.next() ) { 
	 				          //  //log.info("dentro del whyle......." );
	 				            ls_valor = rs.getString("c_valor"); 
	 				           // //log.info("ls_valor :" + ls_valor );
	 				            
	 		}
	 		
	 		
	    	 if (ls_valor.equals("1")) {
	    		
	    		 
	    		 ls_sql = "UPDATE tramite.usuarios SET usuario=" + "'" + usuario +"'" + "," +
	 			" clave=" + "'" + clavenueva+ "'"
	 			+  " " + "WHERE usuario =" + "'" + usuario + "'";
	 			////log.info("El ls_sql modificar usuario y clave es.." + ls_sql);
	 	 		us = con.createStatement();
	 	 		us.executeUpdate(ls_sql);
	 	 		
	 	 		
	    	 }
			
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    	} 
	    	
	    }
	 
	 
	 public Collection  reportes_codtipo_procedencia_buscar(Connection cnx,String ls_codigo_tipo,String ls_procedencia,String ls_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Codigo Tipo Procedencia buscar");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        	
	        	ls_procedencia= "%"+ls_procedencia+"%";
	        	
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina " +
		 				" and dc.codigo_tipo = " + "'" + ls_codigo_tipo + "'"+
		 				" and de.destino_documento=of_a.codigo_oficina  and md.desc_origen like " + "'" +ls_procedencia+ "'" +  
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		
	              		 
	        			////log.info("El ls_sql..otros codigo tipo procedencia.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
						//	//log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_codtipo_firmadopor_buscar(Connection cnx,String ls_codigo_tipo,String ls_firmadopor,String ls_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Codigo Tipo Firmado por buscar");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        	
	        	ls_firmadopor= "%"+ls_firmadopor+"%";
	        	
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina " +
		 				" and de.destino_documento=of_a.codigo_oficina " +
		 				" and dc.codigo_tipo = " + "'" + ls_codigo_tipo + "'"+
		 				" and de.firmadopor like  " + "'" + ls_firmadopor + "'"+
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		
	              		 
	        		//	//log.info("El ls_sql..otros codigo tipo procedencia.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
						//	//log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 
	 public Collection  reportes_procedencia_buscar(Connection cnx,String ls_procedencia,String ls_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista Procedencia buscar");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        	
	        	ls_procedencia= "%"+ls_procedencia+"%";
	        	
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina " +
		 				" and de.destino_documento=of_a.codigo_oficina  and md.desc_origen like " + "'" +ls_procedencia+ "'" +  
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		
	              		 
	        		//	//log.info("El ls_sql..otros codigo tipo procedencia.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    	//	//log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_procedencia_firmadopor_buscar(Connection cnx,String ls_procedencia,String ls_firmadopor,String ls_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista Reportes Procedencia");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        	
	        	ls_firmadopor= "%"+ls_firmadopor+"%";
	        	
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina " +
		 				" and de.destino_documento=of_a.codigo_oficina  " +
		 				" and md.desc_origen like " + "'" +ls_procedencia+ "'" + 
		 				" and de.firmadopor like  " + "'" + ls_firmadopor + "'"+
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		
	              		 
	        			////log.info("El ls_sql..otros codigo tipo procedencia.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_firmadopor_buscar(Connection cnx,String ls_firmadopor,String ls_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista Reportes Firmado por");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        	
	        	ls_firmadopor= "%"+ls_firmadopor+"%";
	        	
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina " +
		 				" and de.destino_documento=of_a.codigo_oficina  " +
		 				" and de.firmadopor like  " + "'" + ls_firmadopor + "'"+
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		
	              		 
	        			////log.info("El ls_sql..otros codigo tipo procedencia.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
						//	//log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection reportes_codtipo_procedencia_firmadopor_buscar(Connection cnx,String ls_codigo_tipo,String ls_procedencia,String ls_firmadopor,String ls_oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista codigo tipo, procedencia, firmado por");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	      
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	 
	        try {	
	        	
	        	
	        	ls_firmadopor= "%"+ls_firmadopor+"%";
	        	
	              		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina " +
		 				" and de.destino_documento=of_a.codigo_oficina " +
		 				" and de.firmadopor like  " + "'" + ls_firmadopor + "'"+
		 				" and md.desc_origen like " + "'" +ls_procedencia+ "'" + 
		 				" and dc.codigo_tipo = " + "'" + ls_codigo_tipo + "'"+
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc";
	              		
	              		 
	        			////log.info("El ls_sql..otros codigo tipo procedencia.. : " + ls_sql);
		 		    	us = cnx.createStatement();
		 	    		rs = us.executeQuery(ls_sql);
		 	    		
		 	    		
			    		////log.info(" ls_sql.... : " + ls_sql);
			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  reportes_codtipo_buscar(Connection cnx,String ls_codigo_tipo) throws Exception {
			
	        //log.info("ENTRO A  Lista Codigo Tipo");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	
	        try {	
	        	
	        	
	        		ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
	 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
	 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
	 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 				" de.destino_documento=of_a.codigo_oficina and dc.codigo_tipo = " + "'" + ls_codigo_tipo + "'" +
	 				" order by md.fecha_movimiento desc," +
	 				" md.hora_movimiento desc, md.codigo_documento desc";

	        	
	        		// //log.info("El ls_sql..otros expedientes.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
				while ( rs.next() ) { 
					
					
					BMesaPartesVO = new BMesaPartes();
					
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
					
					String naturaleza_documento=rs.getString("naturaleza_documento");
					////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
					ListaMesaPartes.add(BMesaPartesVO);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 
	 public Collection  lista_recepcion_documentos(Connection cnx,String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			//Statement us  = null;
			PreparedStatement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	String ls_num_upload="";
	    	String ls_valor  = "";
	    	//String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    	Date fecha_recep = new Date(); // fecha y hora locales 
    		SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
    		SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); 
    		/*//log.info("la fecha es.."+ formatoFecha.format(fecha_recep) ); 
    		//log.info("la hora es.."+ formatoHora.format(fecha_recep) );*/ 
	    		
	    		
	        try {	
	        	
	        	//String ls_naturaleza=naturaleza.equals("*");
	        	//ls_naturaleza="";
	        	
	        			
	        		//log.info(" Si es una lista normal");
	        		
	        	StringBuffer  ls_sql = new StringBuffer("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        		 		"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
	        		 		"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	        		 		"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion," +
	        		 		"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento," +
	        		 		"dc.numero_documento_ant,de.origen_documento,de.destino_documento,de.desc_origen," +
	        		 		"de.tipo,de.remitente,de.destinatario,of.codigo_oficina,of.descripcion_oficina," +
	        		 		"of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal, md.doc_resp " +
	        		 		" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
	        		 		"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr" +
	        		 		" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	        		 		" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	        		 		" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	        		 		//" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento in ('2','3','5') and" +
	        		 		" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento ='2' and" +
	        		 		" md.codigo_fondo like '01' ");
				        	//if(!oficina.equals("1")){
					    	ls_sql.append(" and md.codigo_oficina like '"+ oficina  +"' order by md.codigo_documento desc");
					    		 //log.info("el ls_codigo_oficina: " + ls_sql);
								//}
				        	//ls_sql.append(" order by md.codigo_documento desc");
	  
				        	String query = ls_sql.toString();
							
							log.info("Si el ls_sql lista_recepcion_documentos..: " + ls_sql);
							
							us = cnx.prepareStatement(query);
							rs = us.executeQuery();

	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
	    		Funciones funciones=new Funciones();
	    		 String ls_codigo_recepcion="";
		    	 String ls_codigo_documento="";
		    	 String ls_codigo_documento_cont="";
		    	 String ls_codigo_expediente="";
		    	 String ls_codigo_expediente_cont="";
		    	 String ls_secuencia_movimiento="";
		    	 
		    	 String ls_ant_codigo_recepcion="";
		    	 String ls_ant_codigo_documento="";
		    	 String ls_ant_codigo_expediente="";
		    	 String ls_ant_secuencia_movimiento="";
		    	 String ls_naturaleza_documento="";
		    	 int contador=0;

	    		
				while ( rs.next() ) { 
					
					
					//BMesaPartesVO = new BMesaPartes();
					contador=contador+1;
					String ls_estado_mov=rs.getString("estado_movimiento");
					ls_codigo_recepcion=rs.getString("codigo_recepcion").trim();
					ls_codigo_documento=rs.getString("codigo_documento").trim();
					ls_codigo_expediente=rs.getString("codigo_expediente").trim();
					ls_secuencia_movimiento=rs.getString("secuencia_movimiento").trim();
					
					Hashtable objListaDoc = new Hashtable();
					
					if(contador==1){

					String seleccionar = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar('"+ rs.getString("observa_movimiento") +"','" + rs.getString("codigo_documento") + "', " + "'"
			        + rs.getString("codigo_expediente") + "'"+ "," 
			        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
			        + "'"+ rs.getString("numero_documento") + "'"+ "," 
			        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
			        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
			       // + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
			       // + "'"+ rs.getString("hora_movimiento") + "'"+ ","
			        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
				    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
			        + "'"+ rs.getString("observa_registro") + "'"+ ","
			        //+ "'"+ rs.getString("codigo_recepcion") + "'"+ ","
			        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
			        + "'"+ rs.getString("naturaleza_documento") + "'"
			        + ");\" " + ">Seleccionar</label>";
					
					 ls_codigo_expediente_cont = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar('"+ rs.getString("observa_movimiento") +"','" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
					    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
				        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
				       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
					
					 ls_codigo_documento_cont = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar('"+ rs.getString("observa_movimiento") +"','" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
					    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
				        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
				       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ rs.getString("codigo_documento")+"</label>";
					
					String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar('"+ rs.getString("observa_movimiento") +"','" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
					    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
				        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
				       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ rs.getString("numero_documento")+"</label>";
					
					String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar('"+ rs.getString("observa_movimiento") +"','" +  rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
					    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
				        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
				       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
					
					String ls_fecha_movimiento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar('"+ rs.getString("observa_movimiento") +"','" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
					    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
				        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
				       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ rs.getString("fecha_movimiento")+"</label>";
					
					String ls_oficina_deriva = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar('"+ rs.getString("observa_movimiento") +"','" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
					    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
				        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
				       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim())+"</label>";
					
					objListaDoc.put("ACTION", seleccionar);
					objListaDoc.put("codigo_documento", ls_codigo_documento_cont);
					objListaDoc.put("codigo_expediente", ls_codigo_expediente_cont);
					objListaDoc.put("numero_documento", ls_numero_documento);
					objListaDoc.put("oficina_origen", ls_oficina_origen);
					objListaDoc.put("oficina_deriva", ls_oficina_deriva);
					if(ls_estado_mov.equals("5")){
						objListaDoc.put("estado_movimiento", "<FONT color='#009900'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");	
					}else{
						objListaDoc.put("estado_movimiento", "<FONT color='#FF0000'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");
					}
					
					
					objListaDoc.put("fecha_movimiento", ls_fecha_movimiento);
					objListaDoc.put("hora", rs.getString("hora_movimiento"));
					objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
					//objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
					/*String ls_ruta="N:\\DocumentosTramite\\"+rs.getString("codigo_expediente").trim()+".PDF";
					//log.info("El ls_ruta pendiente es.." + ls_ruta);*/
					ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
					
					////log.info("El ls_num_upload es..: " + ls_num_upload);
					if(ls_num_upload.equals("0")){
						
						objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
						
					}else {
						
						objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
						"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");

					}

					/*objListaDoc.put("view_archivo", "<A id='A1' target='_blank' href='N:\\DocumentosTramite\\" +
							rs.getString("codigo_expediente").trim()+".PDF"+"'"+
							"><img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'>  </A>");*/
					/*objListaDoc.put("view_archivo", "<A id='A1' target='_blank' href='javascript:ver_documento()'"+
					"><img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'>  </A>");*/
					ListaMesaPartes.add(objListaDoc);
					
					ls_ant_codigo_recepcion=ls_codigo_recepcion;
					ls_ant_codigo_documento=ls_codigo_documento;
					ls_ant_codigo_expediente=ls_codigo_expediente;
					ls_ant_secuencia_movimiento=ls_secuencia_movimiento;

					}
					else if(contador>1){
						////log.info("Si el contador es mayor a cero es....: ");
						
						if(ls_ant_codigo_documento.equals(ls_codigo_documento)){
							////log.info("Los codigos son iguales me imprime una lista ji ji....: ");
							
							
							
							////log.info("--------------------------------------------------- ");
						}else {
							
							String seleccionar = "<label style='cursor: hand;' align='center' " 
								+ "onclick=\"fn_editar('"+ rs.getString("observa_movimiento") +"','" +  rs.getString("codigo_documento") + "', " + "'"
						        + rs.getString("codigo_expediente") + "'"+ "," 
						        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
						        + "'"+ rs.getString("numero_documento") + "'"+ "," 
						        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
						        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
						       // + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
						       // + "'"+ rs.getString("hora_movimiento") + "'"+ ","
						        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
							    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
						        + "'"+ rs.getString("observa_registro") + "'"+ ","
						        //+ "'"+ rs.getString("codigo_recepcion") + "'"+ ","
						        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
						        + "'"+ rs.getString("naturaleza_documento") + "'"
						        + ");\" " + ">Seleccionar</label>";
								
								 ls_codigo_expediente_cont = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar('"+ rs.getString("observa_movimiento") +"','" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
								
								 ls_codigo_documento_cont = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar('"+ rs.getString("observa_movimiento") +"','" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ rs.getString("codigo_documento")+"</label>";
								
								String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar('"+ rs.getString("observa_movimiento") +"','" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ rs.getString("numero_documento")+"</label>";
								
								String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar('"+ rs.getString("observa_movimiento") +"','" +  rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
								
								String ls_fecha_movimiento = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar('"+ rs.getString("observa_movimiento") +"','" +  rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ rs.getString("fecha_movimiento")+"</label>";
								
								String ls_oficina_deriva = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar('"+ rs.getString("observa_movimiento") +"','" +  rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim())+"</label>";
								
								objListaDoc.put("ACTION", seleccionar);
								objListaDoc.put("codigo_documento", ls_codigo_documento_cont);
								objListaDoc.put("codigo_expediente", ls_codigo_expediente_cont);
								objListaDoc.put("numero_documento", ls_numero_documento);
								objListaDoc.put("oficina_origen", ls_oficina_origen);
								objListaDoc.put("oficina_deriva", ls_oficina_deriva);
								if(ls_estado_mov.equals("5")){
									objListaDoc.put("estado_movimiento", "<FONT color='#009900'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");	
								}else{
									objListaDoc.put("estado_movimiento", "<FONT color='#FF0000'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");
								}
								
								
								objListaDoc.put("fecha_movimiento", ls_fecha_movimiento);
								objListaDoc.put("hora", rs.getString("hora_movimiento"));
								objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
								//objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
								/*String ls_ruta="N:\\DocumentosTramite\\"+rs.getString("codigo_expediente").trim()+".PDF";
								//log.info("El ls_ruta pendiente es.." + ls_ruta);*/
								ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
								
								////log.info("El ls_num_upload es..: " + ls_num_upload);
								if(ls_num_upload.equals("0")){
									
									objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
									
								}else {
									
									objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
									"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");

								}
								ListaMesaPartes.add(objListaDoc);
		
						}
						ls_ant_codigo_recepcion=ls_codigo_recepcion;
						ls_ant_codigo_documento=ls_codigo_documento;
						ls_ant_codigo_expediente=ls_codigo_expediente;
						ls_ant_secuencia_movimiento=ls_secuencia_movimiento;

						}

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public int  total_recepcion_documentos(String oficina) throws Exception {
			
	        log.info("ENTRO A  total_recepcion_documentos");

			PreparedStatement pstmt  = null;
			ResultSet rs = null;
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			int contador=0;	
	    		
	        try {	
	        		
	        	StringBuffer ls_sql = new StringBuffer("select count(md.codigo_documento) as total ");
    			ls_sql.append(" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc,");
    			ls_sql.append("tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr");
    			ls_sql.append(" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and");
    			ls_sql.append(" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento");
    			ls_sql.append(" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and");
    			ls_sql.append(" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento ='2' and");
    			ls_sql.append(" md.codigo_fondo like '01' and md.codigo_oficina =? ");
    			ls_sql.append(" and md.secuencia_movimiento = (select max(secuencia_movimiento) from tramite.movimientos_doc where codigo_documento=md.codigo_documento and codigo_oficina=? )");
	
	
				log.info("Si el ls_sql lista_recepcion_documentos..: " + ls_sql);
				pstmt = con.prepareStatement(ls_sql.toString());
				pstmt.setInt(1, Integer.parseInt(oficina));
				pstmt.setInt(2, Integer.parseInt(oficina));
				
				rs=pstmt.executeQuery();

				while (rs.next()){
					contador = rs.getInt("total");
				}	
	            
				x.cerrar_conexion(con, rs);
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con);
	        }
	        return contador;
		                
		}
	 
	 public int[]  total_control_recepcion_documentos(String oficina,String codigo_persona,String accesooficinas) throws Exception {
			
	        log.info("ENTRO A  total_control_recepcion_documentos");
			
			
			PreparedStatement pstmt  = null;
			ResultSet rs = null;
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();

			int[] cantidades =new int[6];
			Date fechaActual = new Date();
	        SimpleDateFormat formateador = new SimpleDateFormat("dd/MM/yyyy");
	        String fechaSistema=formateador.format(fechaActual);
			int contadorUno=0; //TOTAL MOTIVO ATENCION URGENTE
			int contadorDos=0; //TOTAL FECHA EN PLAZO
			int contadorTres=0; //TOTAL FECHA EN LIMITE
			int contadorCuatro=0; //TOTAL FECHA FUERA
			int temp=0;
			String ls_ant_codigo_documento="";
			codigo_persona=(codigo_persona==null)? "":codigo_persona.trim();
			log.info("codigo_persona - >"+codigo_persona);
			log.info("oficina - >"+oficina);
			DocumentosInternosService service = new DocumentosInternosServiceImplement();
			BDatosFirmante resultado= new BDatosFirmante();
			String tempaccesosoficina=null;
			String accesocodigospersonales="";
			tempaccesosoficina=service.getAccesosaOficinas(codigo_persona);
			resultado=service.getDatosFirmantexCodigo(codigo_persona);
			
			String accesoaoficinas=service.getAccesosaOficinas(codigo_persona);
			if(accesoaoficinas != null){
				accesoaoficinas=oficina+","+accesoaoficinas;
			}else{
				accesoaoficinas=oficina;
			}
			
			log.info("accesooficinas -total_control  >"+accesoaoficinas);
			
			if(resultado.isEsresponsable() || resultado.isEssecretaria()){
				System.out.println("ES RESPONSALE");
				
				accesocodigospersonales=service.getCodigosPersonalesResponsables(accesoaoficinas);
							
				if(accesocodigospersonales!=null){
					accesocodigospersonales = (accesocodigospersonales.trim().length()>0)?  accesocodigospersonales.substring(0, accesocodigospersonales.length()-1): accesocodigospersonales;
				}
				
			}else{
				System.out.println("NO ES RESPONSALE");
				if(tempaccesosoficina!=null){
				
				if(resultado.isEsresponsable() || resultado.isEssecretaria()){
					//ve todos usuarios
					accesocodigospersonales=service.getAccesosaPersonas(tempaccesosoficina,true,null);
				}else {
					//ve solo su usuario
					//accesocodigospersonales=service.getAccesosaPersonas(tempaccesosoficina,false,persona);
					accesocodigospersonales=codigo_persona+",";
				}
				
				accesocodigospersonales = (accesocodigospersonales.trim().length()>0)?  accesocodigospersonales.substring(0, accesocodigospersonales.length()-1): accesocodigospersonales;
			}
				
			}
			if(accesocodigospersonales!="" && accesocodigospersonales.length()>0){
				codigo_persona=  codigo_persona +","+ accesocodigospersonales;
			}
			
			
			log.info("accesopersonas -total_control  >"+codigo_persona);
			
	        try {	
	        	
	        	
	        	StringBuilder ls_sql = new StringBuilder("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,");
    			ls_sql.append("md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.secuencia_origen, ");
    			ls_sql.append("md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta,");
    			ls_sql.append("md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion,");
				ls_sql.append("md.flag,tp.descripcion_tipo,md.desc_origen,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,");
				ls_sql.append("dc.numero_documento_ant,dc.observa_documento,dc.fecha_registro,dc.hora_registro,dc.dirigido,de.origen_documento,de.destino_documento,de.desc_origen as nombre_procedencia,");
				ls_sql.append("de.tipo,de.remitente,md.destinatario,de.firmadopor,de.medio,de.codigo_solicitud,of.codigo_oficina,of.descripcion_oficina,");
				ls_sql.append("of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal, md.doc_resp");
				
				ls_sql.append(",(select count(tdetu.codigo_documento) from tramite.tbl_det_upload  tdetu  where tdetu.codigo_documento = md.codigo_documento) as numupload ");
				ls_sql.append(",tedoc.estado_expediente as estado_expediente ");
				ls_sql.append(",(select tofi.descripcion_oficina from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_origen) as nombre_oficina_origen");
				ls_sql.append(",(select tofi.descripcion_oficina from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_deriva) as nombre_oficina_deriva ");
				ls_sql.append(",(select tpers.nombre_personal from tramite.personal tpers where tpers.codigo_personal=md.destinatario) as destinatario_movimiento ");
				
				ls_sql.append(" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc,");
				ls_sql.append(" tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr,tramite.estados_doc tedoc ");
				
				ls_sql.append(" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and");
				ls_sql.append(" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento");
				ls_sql.append(" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and");
				ls_sql.append(" de.destino_documento=of_a.codigo_oficina  and md.estado_movimiento=tedoc.codigo_estado and md.estado_movimiento in (2,8) and");
				ls_sql.append(" md.codigo_fondo like '01' and md.codigo_oficina in ("+accesoaoficinas+")  ");
					        	
	        	ls_sql.append(" and md.destinatario in ("+codigo_persona+")   ");
	        	ls_sql.append(" order by md.codigo_documento desc;");
					//con = x.getConnection();
					pstmt = con.prepareStatement(ls_sql.toString());
					//pstmt.setInt(1, Integer.parseInt(oficina));
					//pstmt.setString(2, codigo_persona);
					
		    		log.info("ls_sql.... : " + pstmt);
					rs = pstmt.executeQuery();	
	        	
	        	log.info("ls_sql...total0 : " + ls_sql);

				int contador=0;
				int total=0;
				while (rs.next()){ 
									
					contador=contador+1;
					if(contador==1){						
						total=total+1;
						ls_ant_codigo_documento=rs.getString("codigo_documento").trim();
					}
					
					if(contador>1){
						if(!ls_ant_codigo_documento.equals(rs.getString("codigo_documento").trim())){
							total=total+1;
						}
						ls_ant_codigo_documento=rs.getString("codigo_documento").trim();
					}
					
				}
				cantidades[0] =total;
				
				/***EN BANDEJA DE TRAMITE **/

				total=0;
				
				ls_sql = new StringBuilder("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,");
        		ls_sql.append("md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.secuencia_origen,");
        		ls_sql.append("md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,");
        		ls_sql.append("md.fecha_rpta,md.codigo_expediente,md.oficina_origen,md.oficina_deriva,");
        		ls_sql.append("md.correlativo_deriva,md.observa_registro,md.codigo_recepcion,md.flag,");
        		ls_sql.append("tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,");
        		ls_sql.append("dc.asunto_documento,dc.numero_documento_ant,de.origen_documento,");
        		ls_sql.append("de.destino_documento,de.desc_origen,de.tipo,de.remitente,de.destinatario,");
        		ls_sql.append("of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino,");
        		ls_sql.append("pr.codigo_personal,pr.nombre_personal");
        		
				ls_sql.append(",(select count(tdetu.codigo_documento) from tramite.tbl_det_upload  tdetu  where tdetu.codigo_documento = md.codigo_documento) as numupload ");
				ls_sql.append(",tedoc.estado_expediente as estado_expediente ");
				ls_sql.append(",(select tofi.descripcion_oficina from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_origen) as nombre_oficina_origen");
				ls_sql.append(",(select tofi.descripcion_oficina from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_deriva) as nombre_oficina_deriva ");
				ls_sql.append(",(select tpers.nombre_personal from tramite.personal tpers where tpers.codigo_personal=md.destinatario) as destinatario_movimiento  ");
				
				ls_sql.append(",(select  codigo_estado_documento  from tramite.documento_tipo_documento_interno "); 
				ls_sql.append("where codigo_documento = md.codigo_documento  AND codigo_oficina_pertenece = ?  AND  secuencia_movimiento=md.secuencia_movimiento "); 
				ls_sql.append("AND  tipo_envio = 'D' AND codigo_estado_documento NOT IN (3,7,8) ) as  codigo_estado_documento");
				
				ls_sql.append(",(SELECT  count(b.codigos_documento_interno_proyecto)  ");
				ls_sql.append(" FROM tramite.documento_tipo_documento_interno a, tramite.tbl_cab_upinternos b, tramite.tbl_det_upinternos c ");
				ls_sql.append(" WHERE a.codigo_tipo_documento_interno IN (1,2,3,4,5,8)	AND a.codigo_documento_interno = b.codigo_documento_interno ");
				ls_sql.append(" AND a.codigo_documento_interno IN (SELECT  codigo_documento_interno  FROM tramite.documento_tipo_documento_interno "); 
				ls_sql.append(" where codigo_documento= md.codigo_documento  and codigo_oficina_pertenece= md.oficina_origen  and  secuencia_movimiento_destino=md.secuencia_movimiento  AND codigo_oficina = ? ");
				ls_sql.append(" and codigo_estado_documento IN (3) ) and b.id_cab_upinternos = c.id_cab_upinternos  AND b.estado NOT IN ('E') ");
				ls_sql.append(" and c.estado_usuario_origen like 'C'  and c.estado_usuario_fin like 'A') as  codigo_documento_interno_origen  ");
        				
        		ls_sql.append("from  tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc,");
        		ls_sql.append("tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,");
        		ls_sql.append("tramite.personal pr,tramite.estados_doc tedoc  ");
        		
        		ls_sql.append("where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento  ");
        		ls_sql.append("and dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento ");
        		ls_sql.append("and de.destinatario=pr.codigo_personal  and md.codigo_oficina=of.codigo_oficina ");
        		ls_sql.append("and de.destino_documento=of_a.codigo_oficina  and md.estado_movimiento=tedoc.codigo_estado  and  md.estado_movimiento = '3'  ");
        		ls_sql.append("and md.codigo_fondo like '01' and  md.codigo_oficina in ("+accesoaoficinas+")  ");
        		ls_sql.append("and md.codigo_documento not in (select codigo_documento from tramite.movimientos_doc where estado_movimiento = '3' and  codigo_fondo like '01' and codigo_oficina in ("+accesoaoficinas+")  and flag ='I') ");
        		
        		ls_sql.append(" and  md.destinatario in ("+codigo_persona+")  ");
        		
        		ls_sql.append("order by md.codigo_documento desc");
        		
        		pstmt = con.prepareStatement(ls_sql.toString());
        		pstmt.setInt(1, Integer.parseInt(oficina));
   	    	 	pstmt.setInt(2, Integer.parseInt(oficina));
					
		    		log.info("ls_sql.... : " + pstmt);
					rs = pstmt.executeQuery();	
	        	
				log.info("ls_sql_bderivacion.... : " + ls_sql);
				contador=0;

				while (rs.next()){ 
									
					contador=contador+1;
					if(contador==1){						
						total=total+1;
						ls_ant_codigo_documento=rs.getString("codigo_documento").trim();
					}
					
					if(contador>1){
						if(!ls_ant_codigo_documento.equals(rs.getString("codigo_documento").trim())){
							total=total+1;
						}
						ls_ant_codigo_documento=rs.getString("codigo_documento").trim();
					}
					
				}
				cantidades[1] =total;
				
				
				
				/***FIN ***/
				
				StringBuilder ls_sql1 = new StringBuilder("select md.codigo_documento, md.fecha_rpta, md.codigo_motivo ");
				ls_sql1.append(" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc,");
				ls_sql1.append("tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr ");
				ls_sql1.append(" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and ");
				ls_sql1.append(" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento");
				ls_sql1.append(" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and ");
				ls_sql1.append(" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento ='2' and ");
				ls_sql1.append("md.codigo_fondo like '01' and md.codigo_oficina =? ");
				ls_sql1.append("and md.secuencia_movimiento = (select max(secuencia_movimiento) ");
				ls_sql1.append("from tramite.movimientos_doc where codigo_documento=md.codigo_documento and codigo_oficina=? ) ");
				ls_sql1.append("and md.fecha_rpta <> ''");
				if(!codigo_persona.equals("")){	ls_sql1.append("  and md.destinatario = ?  "); }
				
				ls_sql1.append("  UNION  ");
				ls_sql1.append("select md.codigo_documento, md.fecha_rpta, md.codigo_motivo ");
				ls_sql1.append(" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc,");
				ls_sql1.append("tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr ");
				ls_sql1.append(" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and ");
				ls_sql1.append(" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento");
				ls_sql1.append(" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and ");
				ls_sql1.append(" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento ='2' and ");
				ls_sql1.append("md.codigo_fondo like '01' and md.codigo_oficina =? ");
				ls_sql1.append("and md.secuencia_movimiento = (select max(secuencia_movimiento) ");
				ls_sql1.append("from tramite.movimientos_doc where codigo_documento=md.codigo_documento and codigo_oficina=? ) ");
				ls_sql1.append("and md.codigo_motivo=2 ");
				if(!codigo_persona.equals("")){	ls_sql1.append("  and md.destinatario = ?  "); }
				
				ls_sql1.append("order by 1; ");
	
				log.info("Si el ls_sql lista_recepcion_documentos..: " + ls_sql1);
				pstmt = con.prepareStatement(ls_sql1.toString());
				
				if(!codigo_persona.equals("")){	
					pstmt.setInt(1, Integer.parseInt(oficina));
					pstmt.setInt(2, Integer.parseInt(oficina));
					pstmt.setString(3, codigo_persona);
					pstmt.setInt(4, Integer.parseInt(oficina));
					pstmt.setInt(5, Integer.parseInt(oficina));
					pstmt.setString(6, codigo_persona);
				}else{
					pstmt.setInt(1, Integer.parseInt(oficina));
					pstmt.setInt(2, Integer.parseInt(oficina));
					pstmt.setInt(3, Integer.parseInt(oficina));
					pstmt.setInt(4, Integer.parseInt(oficina));	
				}
								
				rs=pstmt.executeQuery();
				

				while (rs.next()){
					if(rs.getString("fecha_rpta")==null || rs.getString("fecha_rpta").equals("")){
						contadorUno++;
					}else{
						/***
						 * hacer comparaciones de fecha y segun eso entregar valores
						 */
						temp=compararFechasConDate(rs.getString("fecha_rpta").trim(),fechaSistema);
						if(temp==1){
							contadorDos++;
						}
						if(temp==2){
							contadorTres++;
						}
						if(temp==3){
							contadorCuatro++;
						}
						
					}
				}	
				
				cantidades[2]=contadorUno;
				cantidades[3]=contadorDos;
				cantidades[4]=contadorTres;
				cantidades[5]=contadorCuatro;
				
				log.info("---"+cantidades[0]+","+cantidades[1]+","+cantidades[2]+","+cantidades[3]+","+cantidades[4]+","+cantidades[5]);
				x.cerrar_conexion(con, rs);
				pstmt.close();
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con);
	        }
	        return cantidades;
		                
		}
	 
	 public int  total_derivacion_documentos(String oficina) throws Exception {
			
	        log.info("ENTRO A  total_derivacion_documentos");
			
			
			PreparedStatement us  = null;
			ResultSet rs = null;
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			int contador=0;	
	    		
	        try {	
	        		
	        	StringBuffer ls_sql = new StringBuffer("select count(md.codigo_documento) as total " +
     		 		" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
     		 		"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr" +
     		 		" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
     		 		" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
     		 		" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
     		 		" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento ='2' and" +
     		 		" md.codigo_fondo like '01' and md.codigo_oficina ="+oficina+" "+
     		 		" and md.secuencia_movimiento = (select max(secuencia_movimiento) from tramite.movimientos_doc where codigo_documento=md.codigo_documento and codigo_oficina="+oficina+")");
     	
     	
				log.info("Si el ls_sql lista_recepcion_documentos..: " + ls_sql);
				
				us = con.prepareStatement(ls_sql.toString());
				rs = us.executeQuery();

				while (rs.next()){
					contador = rs.getInt("total");
				}	
	            
				x.cerrar_conexion(con, rs);
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con);
	        }
	        return contador;
		                
		}
	 
	 
	 public Collection  lista_preliquidar_documentos(Connection cnx,String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			//Statement us  = null;
			PreparedStatement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	String ls_num_upload="";
	    	String ls_valor  = "";
	    	//String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    	Date fecha_recep = new Date(); // fecha y hora locales 
 		SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
 		SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); 
 		/*//log.info("la fecha es.."+ formatoFecha.format(fecha_recep) ); 
 		//log.info("la hora es.."+ formatoHora.format(fecha_recep) );*/ 
	    		
	    		
	        try {	
	        	
	        	//String ls_naturaleza=naturaleza.equals("*");
	        	//ls_naturaleza="";
	        	
	        			
	        		//log.info(" Si es una lista normal");
	        		
	        	StringBuffer  ls_sql = new StringBuffer("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        		 		"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
	        		 		"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	        		 		"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion," +
	        		 		"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento," +
	        		 		"dc.numero_documento_ant,de.origen_documento,de.destino_documento,de.desc_origen," +
	        		 		"de.tipo,de.remitente,de.destinatario,of.codigo_oficina,of.descripcion_oficina," +
	        		 		"of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal" +
	        		 		" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
	        		 		"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr" +
	        		 		" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	        		 		" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	        		 		" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	        		 		//" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento in ('2','3','5') and" +
	        		 		" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento ='8' and" +
	        		 		" md.codigo_fondo like '01' ");
				        	//if(!oficina.equals("1")){
					    	ls_sql.append(" and md.codigo_oficina like '"+ oficina  +"' order by md.codigo_documento desc");
					    		 //log.info("el ls_codigo_oficina: " + ls_sql);
								//}
				        	//ls_sql.append(" order by md.codigo_documento desc");
	  
				        	String query = ls_sql.toString();
							
							log.info("Si el ls_sql lista_recepcion_documentos..: " + ls_sql);
							
							us = cnx.prepareStatement(query);
							rs = us.executeQuery();

	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
	    		Funciones funciones=new Funciones();
	    		 String ls_codigo_recepcion="";
		    	 String ls_codigo_documento="";
		    	 String ls_codigo_documento_cont="";
		    	 String ls_codigo_expediente="";
		    	 String ls_codigo_expediente_cont="";
		    	 String ls_secuencia_movimiento="";
		    	 
		    	 String ls_ant_codigo_recepcion="";
		    	 String ls_ant_codigo_documento="";
		    	 String ls_ant_codigo_expediente="";
		    	 String ls_ant_secuencia_movimiento="";
		    	 String ls_naturaleza_documento="";
		    	 int contador=0;

	    		
				while ( rs.next() ) { 
					
					
					//BMesaPartesVO = new BMesaPartes();
					contador=contador+1;
					String ls_estado_mov=rs.getString("estado_movimiento");
					ls_codigo_recepcion=rs.getString("codigo_recepcion").trim();
					ls_codigo_documento=rs.getString("codigo_documento").trim();
					ls_codigo_expediente=rs.getString("codigo_expediente").trim();
					ls_secuencia_movimiento=rs.getString("secuencia_movimiento").trim();
					
					Hashtable objListaDoc = new Hashtable();
					
					
					if(contador==1){

					String seleccionar = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
			        + rs.getString("codigo_expediente") + "'"+ "," 
			        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
			        + "'"+ rs.getString("numero_documento") + "'"+ "," 
			        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
			        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
			       // + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
			       // + "'"+ rs.getString("hora_movimiento") + "'"+ ","
			        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
				    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
			        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
			        //+ "'"+ rs.getString("codigo_recepcion") + "'"+ ","
			        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
			        + "'"+ rs.getString("naturaleza_documento") + "'"
			        + ");\" " + ">Seleccionar</label>";
					
					 ls_codigo_expediente_cont = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
					    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
				        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
				       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
					
					 ls_codigo_documento_cont = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
					    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
				        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
				       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ rs.getString("codigo_documento")+"</label>";
					
					String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
					    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
				        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
				       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ rs.getString("numero_documento")+"</label>";
					
					String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
					    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
				        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
				       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
					
					String ls_fecha_movimiento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
					    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
				        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
				       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ rs.getString("fecha_movimiento")+"</label>";
					
					String ls_oficina_deriva = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
					    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
				        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
				       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim())+"</label>";
					
					objListaDoc.put("ACTION", seleccionar);
					objListaDoc.put("codigo_documento", ls_codigo_documento_cont);
					objListaDoc.put("codigo_expediente", ls_codigo_expediente_cont);
					objListaDoc.put("numero_documento", ls_numero_documento);
					objListaDoc.put("oficina_origen", ls_oficina_origen);
					objListaDoc.put("oficina_deriva", ls_oficina_deriva);
					if(ls_estado_mov.equals("5")){
						objListaDoc.put("estado_movimiento", "<FONT color='#009900'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");	
					}else{
						objListaDoc.put("estado_movimiento", "<FONT color='#FF0000'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");
					}
					
					
					objListaDoc.put("fecha_movimiento", ls_fecha_movimiento);
					objListaDoc.put("hora", rs.getString("hora_movimiento"));
					objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
					//objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
					/*String ls_ruta="N:\\DocumentosTramite\\"+rs.getString("codigo_expediente").trim()+".PDF";
					//log.info("El ls_ruta pendiente es.." + ls_ruta);*/
					ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
					
					////log.info("El ls_num_upload es..: " + ls_num_upload);
					if(ls_num_upload.equals("0")){
						
						objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
						
					}else {
						
						objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
						"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");

					}

					/*objListaDoc.put("view_archivo", "<A id='A1' target='_blank' href='N:\\DocumentosTramite\\" +
							rs.getString("codigo_expediente").trim()+".PDF"+"'"+
							"><img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'>  </A>");*/
					/*objListaDoc.put("view_archivo", "<A id='A1' target='_blank' href='javascript:ver_documento()'"+
					"><img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'>  </A>");*/
					ListaMesaPartes.add(objListaDoc);
					
					ls_ant_codigo_recepcion=ls_codigo_recepcion;
					ls_ant_codigo_documento=ls_codigo_documento;
					ls_ant_codigo_expediente=ls_codigo_expediente;
					ls_ant_secuencia_movimiento=ls_secuencia_movimiento;

					}
					else if(contador>1){
						////log.info("Si el contador es mayor a cero es....: ");
						
						if(ls_ant_codigo_documento.equals(ls_codigo_documento)){
							////log.info("Los codigos son iguales me imprime una lista ji ji....: ");
							
							
							
							////log.info("--------------------------------------------------- ");
						}else {
							
							String seleccionar = "<label style='cursor: hand;' align='center' " 
								+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
						        + rs.getString("codigo_expediente") + "'"+ "," 
						        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
						        + "'"+ rs.getString("numero_documento") + "'"+ "," 
						        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
						        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
						       // + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
						       // + "'"+ rs.getString("hora_movimiento") + "'"+ ","
						        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
							    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
						        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
						        //+ "'"+ rs.getString("codigo_recepcion") + "'"+ ","
						        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
						        + "'"+ rs.getString("naturaleza_documento") + "'"
						        + ");\" " + ">Seleccionar</label>";
								
								 ls_codigo_expediente_cont = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
								
								 ls_codigo_documento_cont = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ rs.getString("codigo_documento")+"</label>";
								
								String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ rs.getString("numero_documento")+"</label>";
								
								String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
								
								String ls_fecha_movimiento = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ rs.getString("fecha_movimiento")+"</label>";
								
								String ls_oficina_deriva = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim())+"</label>";
								
								objListaDoc.put("ACTION", seleccionar);
								objListaDoc.put("codigo_documento", ls_codigo_documento_cont);
								objListaDoc.put("codigo_expediente", ls_codigo_expediente_cont);
								objListaDoc.put("numero_documento", ls_numero_documento);
								objListaDoc.put("oficina_origen", ls_oficina_origen);
								objListaDoc.put("oficina_deriva", ls_oficina_deriva);
								if(ls_estado_mov.equals("5")){
									objListaDoc.put("estado_movimiento", "<FONT color='#009900'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");	
								}else{
									objListaDoc.put("estado_movimiento", "<FONT color='#FF0000'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");
								}
								
								
								objListaDoc.put("fecha_movimiento", ls_fecha_movimiento);
								objListaDoc.put("hora", rs.getString("hora_movimiento"));
								objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
								//objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
								/*String ls_ruta="N:\\DocumentosTramite\\"+rs.getString("codigo_expediente").trim()+".PDF";
								//log.info("El ls_ruta pendiente es.." + ls_ruta);*/
								ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
								
								////log.info("El ls_num_upload es..: " + ls_num_upload);
								if(ls_num_upload.equals("0")){
									
									objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
									
								}else {
									
									objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
									"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");

								}
								ListaMesaPartes.add(objListaDoc);
		
						}
						ls_ant_codigo_recepcion=ls_codigo_recepcion;
						ls_ant_codigo_documento=ls_codigo_documento;
						ls_ant_codigo_expediente=ls_codigo_expediente;
						ls_ant_secuencia_movimiento=ls_secuencia_movimiento;

						}

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public void of_recibir_doc_edit(Connection cnx,String oficina,String documento,String usuario,String fecha,
			 String hora,String observacion,String ls_estado_doc,String ls_correlativorecepcion,String secuencia_moviemiento) {
	    	
	     //   obtenermos el valor maximo...
	    	//log.info("dentro del recibir documento......." );
	    	int    li_retorno;
	    	int    li_parcial = 0 ;
	    	String ls_correlativo=null;
	    	String ls_ano=null;
	    	String ls_mes=null;
	    	String ls_dia=null;
	    	String fecha_consulta=null;
	    	String ls_estado_derivar="3";
	    	String ls_estado_preliq="6";
	    	String ls_estado_liquid="7";
	    	String codigo_fondo="01";
	    	li_retorno = 1;
	    	Statement us  = null;
			ResultSet rs = null;
			
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
	    		
	    		//log.info("fecha: " + fecha );
	        	ls_ano = fecha.substring(6, 10);
	        	ls_mes = fecha.substring(3, 5);
	        	ls_dia = fecha.substring(0, 2);
	        	/*//log.info("ls_ano: " + ls_ano );
	        	//log.info("ls_mes: " + ls_mes );
	        	//log.info("ls_dia: " + ls_dia );*/
	        	
	        	fecha_consulta = fecha.substring(6,10)+fecha.substring(3,5)+fecha.substring(0,2);
	        	
	        		ls_sql = "UPDATE tramite.movimientos_doc SET fecha_movimiento="+"'"+fecha+"'"+","+"fecha_consulta="+"'"+fecha_consulta+"'"+
	        		","+" hora_movimiento="+"'"+hora+"'"+"," + " ultimo_usuario=" + "'" +usuario+ "'"+"," +
	        		" observa_registro=" + "'" +observacion+ "'"+"," +
	        		" codigo_recepcion=" + "'" +ls_correlativorecepcion+ "'" + " where codigo_fondo="+ "'" + codigo_fondo +
	        		"'" + " and codigo_oficina= "+ "'" +oficina + "'" + " and codigo_documento="+"'"+documento+"' and secuencia_movimiento = "+secuencia_moviemiento;
	        		
	        		//  //log.info("El ls_sql update recibir documento es" + ls_sql);
	        	
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
			    	 
			    	 x.cerrar_conexion(con);	
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );
	    		 x.cerrar_conexion(con);
	    	}

		}
	 
	 public Collection  lista_derivacion_documentos(Connection cnx) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	//String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    	Date fecha_recep = new Date(); // fecha y hora locales 
 		SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
 		SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); 
 		/*//log.info("la fecha es.."+ formatoFecha.format(fecha_recep) ); 
 		//log.info("la hora es.."+ formatoHora.format(fecha_recep) );*/ 
	    		
	    		
	        try {	
	        	
	        	//String ls_naturaleza=naturaleza.equals("*");
	        	//ls_naturaleza="";
	        	
	        			
	        		//log.info(" Si es una lista normal");
	        		
	        		 StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        		 		"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
	        		 		"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	        		 		"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro," +
	        		 		"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento," +
	        		 		"dc.numero_documento_ant,de.origen_documento,de.destino_documento,de.desc_origen," +
	        		 		"de.tipo,de.remitente,de.destinatario,of.codigo_oficina,of.descripcion_oficina," +
	        		 		"of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal" +
	        		 		" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
	        		 		"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr" +
	        		 		" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	        		 		" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	        		 		" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	        		 		" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento ='3'  and" +
	        		 		" md.codigo_fondo like '01' order by md.fecha_movimiento desc, md.hora_movimiento desc," +
	        		 		" md.codigo_documento desc ");
	        		 
	        			  
	        		// //log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql.toString());
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
	    		Funciones funciones=new Funciones();
				while ( rs.next() ) { 
					
					
					//BMesaPartesVO = new BMesaPartes();
					
					Hashtable objListaDoc = new Hashtable();
					String seleccionar = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
			        + rs.getString("codigo_expediente") + "'"+ "," 
			        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
			        + "'"+ rs.getString("numero_documento") + "'"+ "," 
			        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
			        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
			        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
			        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
			        + "'"+ rs.getString("observa_registro") + "'"
			        + ");\" " + ">ver</label>";
					
					objListaDoc.put("ACTION", seleccionar);
					objListaDoc.put("codigo_documento", rs.getString("codigo_documento"));
					objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
					objListaDoc.put("numero_documento", rs.getString("numero_documento"));
					objListaDoc.put("oficina_origen", funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim()));
					objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
					
					objListaDoc.put("estado_movimiento", rs.getString("estado_movimiento"));
					
					objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
					objListaDoc.put("hora", rs.getString("hora_movimiento"));
					objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
					objListaDoc.put("view_archivo", "<A id='A1' target='_blank' href='N:\\DocumentosTramite\\" +
							rs.getString("codigo_expediente").trim()+".PDF"+"'"+
							"><img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'>  </A>");
					
					ListaMesaPartes.add(objListaDoc);
					

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  of_lista_personal(Connection cnx) throws Exception {
			
	        //log.info("ENTRO A  Lista de Personas por oficinas");
			Collection ListaPersonasOficinas = new ArrayList();
			
			BPersonal BPersonalVO = null;
			Statement us  = null;
			ResultSet rs = null;
			ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
	        try {	
	        	
	        	String ls_sql = "SELECT pe.nombre_personal,pe.codigo_personal,of.codigo_oficina FROM" +
	        			" tramite.oficinas of,tramite.personal pe WHERE pe.codigo_oficina =of.codigo_oficina" +
	        			" order by pe.nombre_personal asc";
	        	
	        	us = con.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BPersonalVO = new BPersonal();
					
					BPersonalVO.setNombre_personal(rs.getString("nombre_personal"));
					BPersonalVO.setCodigo_personal(rs.getString("codigo_personal"));
					BPersonalVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					
					String nombre_personal=rs.getString("nombre_personal");
					String codigo_personal=rs.getString("codigo_personal");
					String codigo_oficina=rs.getString("codigo_oficina");
					
					/* //log.info("nombre_personal es "+ nombre_personal);
					 //log.info("codigo_personal es "+ codigo_personal);
					 //log.info("codigo_oficina es "+ codigo_oficina);*/
					 
					ListaPersonasOficinas.add(BPersonalVO);

				}	
	            x.cerrar_conexion(con, rs);
				
	            
	        } catch (SQLException e) {
	        	x.cerrar_conexion(con, rs);
	             e.printStackTrace();
	        }
	        return ListaPersonasOficinas;
		                
		}
	 
	 
	 
	 public FFormMantArchivar obtenerDetalleBandejaArchivo(Connection cnx,
			String codigo_documento, String secuencia_movimiento) {
		// TODO Auto-generated method stub
		 FFormMantArchivar bArc=null;
			
		 Funciones funciones=new Funciones();
		    Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	        String ls_desde;
	        String ls_hasta;
	       
	        SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
			SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm");

			
	        Date fecha_recep = new Date(); // fecha y hora locales 
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	String ls_estado_mov="";
	    	String ls_num_upload="";
	    	
	    	
		 try{
		    ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	        			"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	        			"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.codigo_recepcion," +
	        			"md.doc_deriva,md.observa_movimiento,md.codigo_motivo," +
	        			"md.fecha_rpta,tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento," +
	        			"dc.asunto_documento,dc.fecha_registro,dc.hora_registro,dc.codigo_tipo,dc.numero_documento_ant," +
	        			"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	        			"de.destinatario,de.codigo_solicitud,de.firmadopor,de.medio,of.codigo_oficina," +
	        			"of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino," +
	        			"pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc md," +
	        			"tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	        			"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where " +
	        			"tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento" +
	        			" and dc.codigo_documento=de.codigo_documento and" +
	        			" md.codigo_documento=de.codigo_documento and de.destinatario=pr.codigo_personal" +
	        			" and md.codigo_oficina=of.codigo_oficina  " +	        			
	        			" and de.destino_documento=of_a.codigo_oficina and md.codigo_fondo like '01'" +
	        			" and md.codigo_documento ='"+codigo_documento+"'" +
	        			" and md.secuencia_movimiento = '"+secuencia_movimiento+"'";
	        				
	 
         us = cnx.createStatement();
	        rs = us.executeQuery(ls_sql);
	        
	        if(rs.next()){
	        	bArc=new FFormMantArchivar();
	        	bArc.setCodigo_documento(rs.getString("codigo_documento"));
	        	bArc.setCodigo_expediente(rs.getString("codigo_expediente"));
	        	bArc.setDescripcion_tipo(rs.getString("descripcion_tipo").trim());
	        	bArc.setNumero_documento(rs.getString("numero_documento"));
	        	bArc.setCodigo_oficina(rs.getString("codigo_oficina"));
	        	bArc.setEstado_movimiento(rs.getString("estado_movimiento"));
	        	//bArc.setFecha(rs.getString("fecha_movimiento"));
	        	//bArc.setHora(rs.getString("hora_movimiento"));
	        	bArc.setCodigo_inicia(rs.getString("codigo_inicia"));
	        	bArc.setNaturaleza_documento(rs.getString("naturaleza_documento"));
	        	
	        	
	        	bArc.setFecha(formatoFecha.format(fecha_recep) );
	        	bArc.setHora(formatoHora.format(fecha_recep) );	        	
	        	bArc.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
		        
	        	 
	        }
	        
	        rs.close();
		 }  catch (SQLException e) {
          e.printStackTrace();
	     }

		return bArc;
	}

	/* (non-Javadoc)
	 * @see tramitedoc.concytec.dao.interfaces.IUsuarioDAO#visualizar_detalle_derivacion(java.lang.String, java.lang.String)
	 */
	public FFormMantDerivar obtenerDetalleBandejaDerivacion(Connection cnx,
			String codigo_documento, String secuencia_movimiento,String secuencia_origen, String tipo_busqueda) {

		FFormMantDerivar bDer=null;
		
		 //Funciones funciones=new Funciones();
		    Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			ResultSet rs = null;
			PreparedStatement pstmt = null;
			
	        String ls_desde;
	        String ls_hasta;
	       
	        SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
			SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm");

			
	        Date fecha_recep = new Date(); // fecha y hora locales 
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	String ls_estado_mov="";
	    	String ls_num_upload="";
	    	
	    	
		 try{
			 ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
				"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
				"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo," +
				"md.fecha_rpta,md.codigo_expediente,md.oficina_origen,md.oficina_deriva," +
				"md.correlativo_deriva,md.observa_registro,md.codigo_recepcion,md.flag," +
				"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento," +
				"dc.asunto_documento,dc.numero_documento_ant,de.origen_documento," +
				"de.destino_documento,de.desc_origen,de.tipo,de.remitente,de.destinatario," +
				"of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from" +
				" tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
				"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a," +
				"tramite.personal pr where tp.codigo_tipo=dc.codigo_tipo and " +
				"dc.codigo_documento=md.codigo_documento and " +
				"dc.codigo_documento=de.codigo_documento and " +
				"md.codigo_documento=de.codigo_documento and de.destinatario=pr.codigo_personal" +
				" and md.codigo_oficina=of.codigo_oficina and " +
				"de.destino_documento=of_a.codigo_oficina and md.estado_movimiento = '3'" +
				" and md.codigo_fondo like '01' and md.codigo_documento =?  " +
				" and md.secuencia_movimiento =? "; 
			 

			 pstmt = con.prepareStatement(ls_sql);

	    	 pstmt.setInt(1, Integer.parseInt(codigo_documento));
	    	 pstmt.setInt(2, Integer.parseInt(secuencia_origen));
	    	 
	    	 rs=pstmt.executeQuery();
	        
	        if(rs.next()){
	        	bDer=new FFormMantDerivar();
	        	bDer.setCodigo_documento(rs.getString("codigo_documento"));
	        	bDer.setCodigo_expediente(Integer.parseInt(rs.getString("codigo_expediente")));
	        	bDer.setDescripcion_tipo(rs.getString("descripcion_tipo").trim());
	        	bDer.setNumero_documento(rs.getString("numero_documento"));
	        	bDer.setCodigo_oficina(rs.getString("codigo_oficina"));
	        	bDer.setEstado_movimiento(rs.getString("estado_movimiento"));
	        	//bDer.setFecha(rs.getString("fecha_movimiento"));
	        	//bDer.setHora(rs.getString("hora_movimiento"));
	        	bDer.setCodigo_inicia(rs.getString("codigo_inicia"));
	        	bDer.setNaturaleza_documento(rs.getString("naturaleza_documento"));
	        	bDer.setCodigo_recepcion(Integer.parseInt(rs.getString("codigo_recepcion").trim()));
	        	
	        	bDer.setFecha(formatoFecha.format(fecha_recep) );
	        	bDer.setHora(formatoHora.format(fecha_recep) );
	        	
	        	bDer.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
	        	
	        	/*
	        	
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
				        + "'"+ rs.getString("codigo_recepcion").trim() + "'"
				        + "
	        	 * */
	        	 
	        }
	        
	       
	        
	        if(tipo_busqueda.equals("O")){
				ls_sql = "select * from tramite.movimientos_doc  where codigo_documento=? and secuencia_movimiento=?  ";
	    		
				pstmt = con.prepareStatement(ls_sql);

		    	 pstmt.setInt(1, Integer.parseInt(codigo_documento));
		    	 pstmt.setInt(2, Integer.parseInt(secuencia_movimiento));
		    	 
		    	 rs=pstmt.executeQuery();
	    		
				while ( rs.next() ) { 
					bDer.setObservacion(rs.getString("observa_movimiento"));
					bDer.setCodigo_motivo(rs.getString("codigo_motivo"));
					bDer.setCodigo_oficina_que_observa(rs.getString("codigo_oficina"));
					bDer.setCodigo_persona_que_observa(rs.getString("destinatario"));
					bDer.setDoc_resp(rs.getString("doc_resp"));
					//log.info("doc_resp = "+rs.getString("doc_resp"));
					/*ultimo_usuario = rs.getString("ultimo_usuario");
					fecha_movimiento = rs.getString("fecha_movimiento");
					tipo_envio =rs.getString("tipo_envio");
					oficina_origen = rs.getInt("oficina_origen");*/
				}
			}
	        x.cerrar_conexion(con,rs);
	    	pstmt.close();
	        
		 }  catch (SQLException e) {
			 x.cerrar_conexion(con);
          e.printStackTrace();
	     }

		return bDer;
	}
	
	public FFormMantRecepcion obtenerDetalleBandejaRecepcion(Connection cnx,
			String codigo_documento, String secuencia_movimiento) {

		 
		 FFormMantRecepcion bRec=new FFormMantRecepcion();
		 Funciones funciones=new Funciones();
		    Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			
			ObtieneConexion obt=new ObtieneConexion();
			Connection conn = obt.getConnection();
			
			
	        String ls_desde;
	        String ls_hasta;
	       
	        SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
			SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm");

			
	        Date fecha_recep = new Date(); // fecha y hora locales 
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	String ls_estado_mov="";
	    	String ls_num_upload="";
	    	
	    	
		 try{
		    ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	 		"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
	 		"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	 		"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion," +
	 		"md.flag,tp.descripcion_tipo,md.desc_origen,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento," +
	 		"dc.numero_documento_ant,dc.observa_documento,dc.fecha_registro,dc.hora_registro,dc.dirigido,de.origen_documento,de.destino_documento,de.desc_origen as nombre_procedencia," +
	 		"de.tipo,de.remitente,md.destinatario,de.firmadopor,de.medio,de.codigo_solicitud,of.codigo_oficina,of.descripcion_oficina," +
	 		"of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal, md.doc_resp" +
	 		" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
	 		"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr" +
	 		" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	 		" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	 		" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	 		" de.destino_documento=of_a.codigo_oficina " +
	 		" and md.codigo_documento = ?  and md.secuencia_movimiento = ? ";
	 
		    
			pstmt = conn.prepareStatement(ls_sql.toString());
			pstmt.setInt(1, Integer.parseInt(codigo_documento));
			pstmt.setInt(2, Integer.parseInt(secuencia_movimiento));
			rs = pstmt.executeQuery();
	        
	        if(rs.next()){
	        	bRec.setCodigo_documento(rs.getString("codigo_documento"));
	        	bRec.setAsunto_documento(rs.getString("asunto_documento"));
	        	bRec.setObserva_documento(rs.getString("observa_documento"));
	        	bRec.setCodigo_expediente(rs.getString("codigo_expediente"));
	        	bRec.setDescripcion_tipo(rs.getString("descripcion_tipo"));
	        	bRec.setNumero_documento(rs.getString("numero_documento"));
	        	bRec.setCodigo_oficina(rs.getString("codigo_oficina"));
	        	bRec.setEstado_movimiento(rs.getString("estado_movimiento"));
	        	
	        	
	        	bRec.setFecha(formatoFecha.format(fecha_recep) );
	        	bRec.setHora(formatoHora.format(fecha_recep) );
	        	
	        	bRec.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
	        	bRec.setAsunto_documento(rs.getString("asunto_documento"));
	        	bRec.setCodigo_recepcion(rs.getString("codigo_recepcion"));
	        	
	    		bRec.setFecha_registro(rs.getString("fecha_registro").trim() );
	    		bRec.setHora_registro(rs.getString("hora_registro").trim() );
	        	bRec.setProcedencia(rs.getString("nombre_procedencia"));
	        	bRec.setFirmadopor(rs.getString("firmadopor"));
	        	
	        	 
			        
	        	bRec.setDirigido(funciones.of_nombre_documento_dirigido(cnx, rs.getString("codigo_documento")));
	        	bRec.setCodigo_solicitud(funciones.of_solicitud_documento(cnx, rs.getString("codigo_solicitud")).trim() );
	        	bRec.setMedio(funciones.of_medio_documento(cnx, rs.getString("medio")).trim() );
	        	bRec.setObserva_documento(rs.getString("observa_movimiento"));
	        	bRec.setDoc_respuesta(rs.getString("doc_resp"));

	        }
	        
	        obt.cerrar_conexion(conn,rs);
		 }  catch (SQLException e) {
			 obt.cerrar_conexion(conn);
             e.printStackTrace();
	     }

		return bRec;
	}


	public Collection  lista_derivacion_documentos(Connection cnx,String oficina,String accesoaoficinas,String inicia, int valor) throws Exception {
			
	        log.info("ENTRO A  lista_derivacion_documentos....lista_derivacion_documentos");
			Collection ListaMesaPartes = new ArrayList();
			DocumentosInternosService service = new DocumentosInternosServiceImplement();	
						
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			Statement us  = null;
			ResultSet rs = null;
			PreparedStatement pstmt = null;
			
		   	int li_retorno=0;
	    	int codigo_temporal = 0;
	    	int estado_temporal = 0;
			
			String accesocodigospersonales=null;
			accesocodigospersonales=service.getCodigosPersonalesResponsables(accesoaoficinas);
						
			if(accesocodigospersonales!=null){
				accesocodigospersonales = (accesocodigospersonales.trim().length()>0)?  accesocodigospersonales.substring(0, accesocodigospersonales.length()-1): accesocodigospersonales;
			}
	    	log.info("-->"+accesocodigospersonales);
			
 		    try {	

	        		StringBuilder ls_sql = new StringBuilder("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,");
	        		ls_sql.append("md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.secuencia_origen,");
	        		ls_sql.append("md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,");
	        		ls_sql.append("md.fecha_rpta,md.codigo_expediente,md.oficina_origen,md.oficina_deriva,");
	        		ls_sql.append("md.correlativo_deriva,md.observa_registro,md.codigo_recepcion,md.flag,");
	        		ls_sql.append("tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,");
	        		ls_sql.append("dc.asunto_documento,dc.numero_documento_ant,de.origen_documento,");
	        		ls_sql.append("de.destino_documento,de.desc_origen,de.tipo,de.remitente,de.destinatario,");
	        		ls_sql.append("of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino,");
	        		ls_sql.append("pr.codigo_personal,pr.nombre_personal");
	        		
					ls_sql.append(",(select count(tdetu.codigo_documento) from tramite.tbl_det_upload  tdetu  where tdetu.codigo_documento = md.codigo_documento) as numupload ");
					ls_sql.append(",tedoc.estado_expediente as estado_expediente ");
					ls_sql.append(",(select tofi.descripcion_oficina from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_origen) as nombre_oficina_origen");
					ls_sql.append(",(select tofi.descripcion_oficina from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_deriva) as nombre_oficina_deriva ");
					ls_sql.append(",(select tpers.nombre_personal from tramite.personal tpers where tpers.codigo_personal=md.destinatario) as destinatario_movimiento  ");
					
					ls_sql.append(",(select  codigo_estado_documento  from tramite.documento_tipo_documento_interno "); 
					ls_sql.append("where codigo_documento = md.codigo_documento  AND codigo_oficina_pertenece = ?  AND  secuencia_movimiento=md.secuencia_movimiento "); 
					ls_sql.append("AND  tipo_envio = 'D' AND codigo_estado_documento NOT IN (3,7,8) ) as  codigo_estado_documento");
					
					ls_sql.append(",(SELECT  count(b.codigos_documento_interno_proyecto)  ");
					ls_sql.append(" FROM tramite.documento_tipo_documento_interno a, tramite.tbl_cab_upinternos b, tramite.tbl_det_upinternos c ");
					ls_sql.append(" WHERE a.codigo_tipo_documento_interno IN (1,2,3,4,5,8)	AND a.codigo_documento_interno = b.codigo_documento_interno ");
					ls_sql.append(" AND a.codigo_documento_interno IN (SELECT  codigo_documento_interno  FROM tramite.documento_tipo_documento_interno "); 
					ls_sql.append(" where codigo_documento= md.codigo_documento  and codigo_oficina_pertenece= md.oficina_origen  and  secuencia_movimiento_destino=md.secuencia_movimiento  AND codigo_oficina = ? ");
					ls_sql.append(" and codigo_estado_documento IN (3) ) and b.id_cab_upinternos = c.id_cab_upinternos  AND b.estado NOT IN ('E') ");
					ls_sql.append(" and c.estado_usuario_origen like 'C'  and c.estado_usuario_fin like 'A') as  codigo_documento_interno_origen  ");
	        				
	        		ls_sql.append("from  tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc,");
	        		ls_sql.append("tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,");
	        		ls_sql.append("tramite.personal pr,tramite.estados_doc tedoc  ");
	        		
	        		ls_sql.append("where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento  ");
	        		ls_sql.append("and dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento ");
	        		ls_sql.append("and de.destinatario=pr.codigo_personal  and md.codigo_oficina=of.codigo_oficina ");
	        		ls_sql.append("and de.destino_documento=of_a.codigo_oficina  and md.estado_movimiento=tedoc.codigo_estado  and  md.estado_movimiento = '3'  ");
	        		ls_sql.append("and md.codigo_fondo like '01' and  md.codigo_oficina in ("+accesoaoficinas+")  ");
	        		ls_sql.append("and md.codigo_documento not in (select codigo_documento from tramite.movimientos_doc where estado_movimiento = '3' and  codigo_fondo like '01' and codigo_oficina in ("+accesoaoficinas+")  and flag ='I') ");
	        		
	        		ls_sql.append(" and  md.destinatario in ("+accesocodigospersonales+")  ");
	        		
	        		ls_sql.append("order by md.codigo_documento desc");
	        		
	        		
				 pstmt = con.prepareStatement(ls_sql.toString());
		    	 pstmt.setInt(1, Integer.parseInt(oficina));
		    	 pstmt.setInt(2, Integer.parseInt(oficina));
		    	 //pstmt.setInt(3, Integer.parseInt(oficina));
		    	 //pstmt.setString(3, accesoaoficinas);
		    	 //pstmt.setInt(4, Integer.parseInt(oficina));
		    	 //pstmt.setString(4, accesoaoficinas);
		    	 
		    	log.info(" ls_sql derivacion.... : " + ls_sql);
		    	 
		    	rs=pstmt.executeQuery();
	        		 	 
		    	int contador=0;
		    	String ls_codigo_estado_documento="";
		    	String ls_codigo_documento_interno_origen="";
		    	String ls_ant_codigo_documento="";

		    	log.info("---Antes del While");
				while (rs.next()) { 
					StringBuilder constantea = new StringBuilder("");
					StringBuilder constanteb = new StringBuilder("");
					contador=contador+1;
					Hashtable objListaDoc = new Hashtable();
					
					 constantea.append("<label style='cursor: hand;' align='center' onclick=fn_editar_copia('");
					 constantea.append(rs.getString("codigo_documento").trim());
					 constantea.append("','");
					 constantea.append(rs.getString("secuencia_movimiento").trim());
					 constantea.append("');>");
		 
					 constanteb.append("</label>");
										
										
					ls_codigo_estado_documento = (rs.getString("codigo_estado_documento")==null)? "0": rs.getString("codigo_estado_documento");
					ls_codigo_documento_interno_origen = (rs.getString("codigo_documento_interno_origen")==null)? "0": rs.getString("codigo_documento_interno_origen");
					//log.info("ls_codigo_estado_documento "+ls_codigo_estado_documento+", ls_codigo_documento_interno_origen "+ls_codigo_documento_interno_origen);
					 
					if(contador==1){

					objListaDoc.put("codigo_documento", constantea+rs.getString("codigo_documento")+constanteb);
					objListaDoc.put("codigo_expediente", constantea+rs.getString("codigo_expediente")+constanteb);
					objListaDoc.put("numero_documento", constantea+rs.getString("numero_documento")+constanteb);
					objListaDoc.put("oficina_origen", constantea+rs.getString("nombre_oficina_origen")+constanteb);
					objListaDoc.put("fecha_movimiento", constantea+rs.getString("fecha_movimiento")+constanteb);
					
					objListaDoc.put("estado_movimiento","<FONT color='#00CC00'>"+rs.getString("estado_expediente").trim()+"</FONT>");
										
					if(rs.getInt("numupload")==0){
						objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
					}else {
						objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
						"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
					}
									
					/**
					 * INSERCION DE LINK FIRMA DIGITAL
					 */
					
					
					//ESTADO TEMPORAL,  SI ES CERO SIGNIFICA QUE NO TIENE HISTORIAL 
					if(ls_codigo_estado_documento.equals("0")){
						//preparar respuesta
						if(!ls_codigo_documento_interno_origen.equals("0")){
							objListaDoc.put("documento_respuesta", "<A id='A1' title='Preparar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
							"<img src='img/send_doc.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
							"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+ls_codigo_documento_interno_origen.trim()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
						}else{
							objListaDoc.put("documento_respuesta", "<A id='A1' title='Preparar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
							"<img src='img/send_doc.png' height='20'  border='0'></A>");
						}

					}else{
						if(ls_codigo_estado_documento.equals("1")){
							//modificar respuesta
							if(!ls_codigo_documento_interno_origen.equals("0")){
								objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
								"<img src='img/edit_doc.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
								"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+ls_codigo_documento_interno_origen.trim()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
							}else{
								objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
								"<img src='img/edit_doc.png' height='20'  border='0'></A>");
							}
							
						}else{
							if(ls_codigo_estado_documento.equals("5")){
								//firmar
								
								if(valor==0){//indica que no tiene firma
									objListaDoc.put("documento_respuesta", "<A id='A1' title='Ir a Bandeja documentos por firmar' href='FormularioBusquedaDocumentoInterno.do?inicia=SI&tipo=vista' ><img src='img/send-bandeja-icon.png' height='20'  border='0'></A>");
									//FormularioBusquedaDocumentoInterno.do?inicia=SI&tipo=firma
								}else{
									if(!ls_codigo_documento_interno_origen.equals("0")){
										objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
										"<img src='img/03firmar.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
										"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+ls_codigo_documento_interno_origen.trim()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
									}else{
										objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
										"<img src='img/03firmar.png' height='20'  border='0'></A>");
									}	
								}
								
								
							}else{
								if(estado_temporal == 3){
									//firmar
									objListaDoc.put("documento_respuesta", ls_codigo_estado_documento);
								}
							}
							
						}
					}
					/***
					 * OBSERVAR
					 */
					objListaDoc.put("observar", "<A id='A1' href='javascript:Observar("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+","+rs.getString("secuencia_movimiento").trim()+","+rs.getString("secuencia_origen").trim()+");' >"+
					"<img src='img/07observar.png' height='20' title='Observar' border='0'></A>");
					
					ListaMesaPartes.add(objListaDoc);
					
					
					ls_ant_codigo_documento=rs.getString("codigo_documento").trim();

					
					}else if(contador>1){
							
							if(!ls_ant_codigo_documento.equals(rs.getString("codigo_documento").trim())){

								
								objListaDoc.put("codigo_documento", constantea+rs.getString("codigo_documento")+constanteb);
								objListaDoc.put("codigo_expediente", constantea+rs.getString("codigo_expediente")+constanteb);
								objListaDoc.put("numero_documento", constantea+rs.getString("numero_documento")+constanteb);
								objListaDoc.put("oficina_origen", constantea+rs.getString("nombre_oficina_origen")+constanteb);
								objListaDoc.put("fecha_movimiento", constantea+rs.getString("fecha_movimiento")+constanteb);
								objListaDoc.put("estado_movimiento","<FONT color='#00CC00'>"+rs.getString("estado_expediente").trim()+"</FONT>");
								
								if(rs.getInt("numupload")==0){
									objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
								}else {
									objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
									"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
								}
									
								
								
								/**
								 * INSERCION DE LINK FIRMA DIGITAL
								 */
								//ESTADO TEMPORAL,  SI ES CERO SIGNIFICA QUE NO TIENE HISTORIAL 
								
								if(ls_codigo_estado_documento.equals("0")){
									//preparar respuesta
									if(!ls_codigo_documento_interno_origen.equals("0")){
										objListaDoc.put("documento_respuesta", "<A id='A1' title='Preparar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
										"<img src='img/send_doc.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
										"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+ls_codigo_documento_interno_origen.trim()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
									}else{
										objListaDoc.put("documento_respuesta", "<A id='A1' title='Preparar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
										"<img src='img/send_doc.png' height='20'  border='0'></A>");
									}

								}else{
									if(ls_codigo_estado_documento.equals("1")){
										//modificar respuesta
										if(!ls_codigo_documento_interno_origen.equals("0")){
											objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
											"<img src='img/edit_doc.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
											"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+ls_codigo_documento_interno_origen.trim()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
										}else{
											objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
											"<img src='img/edit_doc.png' height='20'  border='0'></A>");
										}
										
									}else{
										if(ls_codigo_estado_documento.equals("5")){
											//firmar
											
											if(valor==0){//indica que no tiene firma
												objListaDoc.put("documento_respuesta", "<A id='A1' title='Ir a Bandeja documentos por firmar' href='FormularioBusquedaDocumentoInterno.do?inicia=SI&tipo=vista' ><img src='img/send-bandeja-icon.png' height='20'  border='0'></A>");

											}else{
												if(!ls_codigo_documento_interno_origen.equals("0")){
													objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
													"<img src='img/03firmar.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
													"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+ls_codigo_documento_interno_origen.trim()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
												}else{
													objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
													"<img src='img/03firmar.png' height='20'  border='0'></A>");
												}	
											}
											
											
										}else{
											if(estado_temporal == 3){
												//firmar
												objListaDoc.put("documento_respuesta", ls_codigo_estado_documento);
											}
										}
										
									}
								}
								/***
								 * OBSERVAR
								 */
								objListaDoc.put("observar", "<A id='A1' href='javascript:Observar("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+","+rs.getString("secuencia_movimiento").trim()+","+rs.getString("secuencia_origen").trim()+");' >"+
								"<img src='img/07observar.png' height='20' title='Observar' border='0'></A>");
									
									ListaMesaPartes.add(objListaDoc);
									
							
							}
							
							ls_ant_codigo_documento=rs.getString("codigo_documento").trim();
								
					}
						
				}	
	            
				x.cerrar_conexion(con, rs);
	        	pstmt.close();
	            
	        } catch (SQLException e) {
	        	x.cerrar_conexion(con);
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	
	public Collection  lista_derivacion_documentos(Connection cnx,String oficina,String accesoaoficinas,String persona, String inicia, int valor) throws Exception {
		
        log.info("ENTRO A  lista_derivacion_documentos....lista_derivacion_documentos persona");
		Collection ListaMesaPartes = new ArrayList();
		DocumentosInternosService service = new DocumentosInternosServiceImplement();
		BDatosFirmante resultado= new BDatosFirmante();
		
		String tempaccesosoficina=null;
		String accesocodigospersonales="";
		tempaccesosoficina=service.getAccesosaOficinas(persona);
		resultado=service.getDatosFirmantexCodigo(persona);
		
		if(tempaccesosoficina!=null){
			
			if(resultado.isEsresponsable() || resultado.isEssecretaria()){
				//ve todos usuarios
				accesocodigospersonales=service.getAccesosaPersonas(tempaccesosoficina,true,null);
			}else {
				//ve solo su usuario
				//accesocodigospersonales=service.getAccesosaPersonas(tempaccesosoficina,false,persona);
				accesocodigospersonales=persona+",";
			}
					

			accesocodigospersonales = (accesocodigospersonales.trim().length()>0)?  accesocodigospersonales.substring(0, accesocodigospersonales.length()-1): accesocodigospersonales;
		}
		
		if(accesocodigospersonales!="" && accesocodigospersonales.length()>0){
			persona=persona+","+accesocodigospersonales;
		}
		
		ObtieneConexion  x= new ObtieneConexion();
		Connection	con= x.getConnection();
		Statement us  = null;
		ResultSet rs = null;
		PreparedStatement pstmt = null;
		
	   	int li_retorno=0;
    	int codigo_temporal = 0;
    	int estado_temporal = 0;
    		    
		    try {	

        		StringBuilder ls_sql = new StringBuilder("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,");
        		ls_sql.append("md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.secuencia_origen,");
        		ls_sql.append("md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,");
        		ls_sql.append("md.fecha_rpta,md.codigo_expediente,md.oficina_origen,md.oficina_deriva,");
        		ls_sql.append("md.correlativo_deriva,md.observa_registro,md.codigo_recepcion,md.flag,");
        		ls_sql.append("tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,");
        		ls_sql.append("dc.asunto_documento,dc.numero_documento_ant,de.origen_documento,");
        		ls_sql.append("de.destino_documento,de.desc_origen,de.tipo,de.remitente,de.destinatario,");
        		ls_sql.append("of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino,");
        		ls_sql.append("pr.codigo_personal,pr.nombre_personal");
        		
				ls_sql.append(",(select count(tdetu.codigo_documento) from tramite.tbl_det_upload  tdetu  where tdetu.codigo_documento = md.codigo_documento) as numupload ");
				ls_sql.append(",tedoc.estado_expediente as estado_expediente ");
				ls_sql.append(",(select tofi.descripcion_oficina from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_origen) as nombre_oficina_origen");
				ls_sql.append(",(select tofi.descripcion_oficina from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_deriva) as nombre_oficina_deriva ");
				ls_sql.append(",(select tpers.nombre_personal from tramite.personal tpers where tpers.codigo_personal=md.destinatario) as destinatario_movimiento  ");
				
				ls_sql.append(",(select  codigo_estado_documento  from tramite.documento_tipo_documento_interno "); 
				ls_sql.append("where codigo_documento = md.codigo_documento  AND codigo_oficina_pertenece = ?  AND  secuencia_movimiento=md.secuencia_movimiento "); 
				ls_sql.append("AND  tipo_envio = 'D' AND codigo_estado_documento NOT IN (3,7,8) ) as  codigo_estado_documento");
				
				ls_sql.append(",(SELECT  count(b.codigos_documento_interno_proyecto)  ");
				ls_sql.append(" FROM tramite.documento_tipo_documento_interno a, tramite.tbl_cab_upinternos b, tramite.tbl_det_upinternos c ");
				ls_sql.append(" WHERE a.codigo_tipo_documento_interno IN (1,2,3,4,5,8)	AND a.codigo_documento_interno = b.codigo_documento_interno ");
				ls_sql.append(" AND a.codigo_documento_interno IN (SELECT  codigo_documento_interno  FROM tramite.documento_tipo_documento_interno "); 
				ls_sql.append(" where codigo_documento= md.codigo_documento  and codigo_oficina_pertenece= md.oficina_origen  and  secuencia_movimiento_destino=md.secuencia_movimiento  AND codigo_oficina = ? ");
				ls_sql.append(" and codigo_estado_documento IN (3) ) and b.id_cab_upinternos = c.id_cab_upinternos  AND b.estado NOT IN ('E') ");
				ls_sql.append(" and c.estado_usuario_origen like 'C'  and c.estado_usuario_fin like 'A') as  codigo_documento_interno_origen  ");
        				
        		ls_sql.append("from  tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc,");
        		ls_sql.append("tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,");
        		ls_sql.append("tramite.personal pr,tramite.estados_doc tedoc  ");
        		
        		ls_sql.append("where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento  ");
        		ls_sql.append("and dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento ");
        		ls_sql.append("and de.destinatario=pr.codigo_personal  and md.codigo_oficina=of.codigo_oficina ");
        		ls_sql.append("and de.destino_documento=of_a.codigo_oficina  and md.estado_movimiento=tedoc.codigo_estado  and  md.estado_movimiento = '3'  ");
        		ls_sql.append("and md.codigo_fondo like '01' and  md.codigo_oficina in ("+accesoaoficinas+")  ");
        		ls_sql.append("and md.codigo_documento not in (select codigo_documento from tramite.movimientos_doc where estado_movimiento = '3' and  codigo_fondo like '01' and codigo_oficina in ("+accesoaoficinas+")  and flag ='I') ");
        		
        		ls_sql.append(" and md.destinatario in ("+persona+")  ");
        		
        		ls_sql.append("order by md.codigo_documento desc");
        		
        		
			 pstmt = con.prepareStatement(ls_sql.toString());
	    	 pstmt.setInt(1, Integer.parseInt(oficina));
	    	 pstmt.setInt(2, Integer.parseInt(oficina));
	    	 //pstmt.setInt(3, Integer.parseInt(oficina));
	    	 //pstmt.setString(3, accesoaoficinas);
	    	 //pstmt.setInt(3, Integer.parseInt(oficina));
	    	 //pstmt.setString(4, accesoaoficinas);
	    	 
	    	 //pstmt.setInt(3, Integer.parseInt(persona));
	    	 
	    	log.info(" ls_sql.... : " + pstmt);
	    	 
	    	rs=pstmt.executeQuery();
        		 	 
	    	int contador=0;
	    	String ls_codigo_estado_documento="";
	    	String ls_codigo_documento_interno_origen="";
	    	String ls_ant_codigo_documento="";

	    	log.info("---Antes del While");
			while (rs.next()) { 
				//log.info("--->");
				StringBuilder constantea = new StringBuilder("");
				StringBuilder constanteb = new StringBuilder("");
				contador=contador+1;
				Hashtable objListaDoc = new Hashtable();
				
				 constantea.append("<label style='cursor: hand;' align='center' onclick=fn_editar_copia('");
				 constantea.append(rs.getString("codigo_documento").trim());
				 constantea.append("','");
				 constantea.append(rs.getString("secuencia_movimiento").trim());
				 constantea.append("');>");
	 
				 constanteb.append("</label>");
									
									
				ls_codigo_estado_documento = (rs.getString("codigo_estado_documento")==null)? "0": rs.getString("codigo_estado_documento");
				ls_codigo_documento_interno_origen = (rs.getString("codigo_documento_interno_origen")==null)? "0": rs.getString("codigo_documento_interno_origen");
				//log.info("ls_codigo_estado_documento "+ls_codigo_estado_documento+", ls_codigo_documento_interno_origen "+ls_codigo_documento_interno_origen);
				 
				if(contador==1){

				objListaDoc.put("codigo_documento", constantea+rs.getString("codigo_documento")+constanteb);
				objListaDoc.put("codigo_expediente", constantea+rs.getString("codigo_expediente")+constanteb);
				objListaDoc.put("numero_documento", constantea+rs.getString("numero_documento")+constanteb);
				objListaDoc.put("oficina_origen", constantea+rs.getString("nombre_oficina_origen")+constanteb);
				objListaDoc.put("fecha_movimiento", constantea+rs.getString("fecha_movimiento")+constanteb);
				
				objListaDoc.put("estado_movimiento","<FONT color='#00CC00'>"+rs.getString("estado_expediente").trim()+"</FONT>");
									
				if(rs.getInt("numupload")==0){
					objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
				}else {
					objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
					"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
				}
								
				/**
				 * INSERCION DE LINK FIRMA DIGITAL
				 */
				
				
				//ESTADO TEMPORAL,  SI ES CERO SIGNIFICA QUE NO TIENE HISTORIAL 
				if(ls_codigo_estado_documento.equals("0")){
					//preparar respuesta
					if(!ls_codigo_documento_interno_origen.equals("0")){
						objListaDoc.put("documento_respuesta", "<A id='A1' title='Preparar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
						"<img src='img/send_doc.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
						"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+ls_codigo_documento_interno_origen.trim()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
					}else{
						objListaDoc.put("documento_respuesta", "<A id='A1' title='Preparar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
						"<img src='img/send_doc.png' height='20'  border='0'></A>");
					}

				}else{
					if(ls_codigo_estado_documento.equals("1")){
						//modificar respuesta
						if(!ls_codigo_documento_interno_origen.equals("0")){
							objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
							"<img src='img/edit_doc.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
							"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+ls_codigo_documento_interno_origen.trim()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
						}else{
							objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
							"<img src='img/edit_doc.png' height='20'  border='0'></A>");
						}
						
					}else{
						if(ls_codigo_estado_documento.equals("5")){
							//firmar
							
							if(valor==0){//indica que no tiene firma
								objListaDoc.put("documento_respuesta", "<A id='A1' title='Ir a Bandeja documentos por firmar' href='FormularioBusquedaDocumentoInterno.do?inicia=SI&tipo=vista' ><img src='img/send-bandeja-icon.png' height='20'  border='0'></A>");
								//FormularioBusquedaDocumentoInterno.do?inicia=SI&tipo=firma
							}else{
								if(!ls_codigo_documento_interno_origen.equals("0")){
									objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
									"<img src='img/03firmar.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
									"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+ls_codigo_documento_interno_origen.trim()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
								}else{
									objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
									"<img src='img/03firmar.png' height='20'  border='0'></A>");
								}	
							}
							
							
						}else{
							if(estado_temporal == 3){
								//firmar
								objListaDoc.put("documento_respuesta", ls_codigo_estado_documento);
							}
						}
						
					}
				}
				/***
				 * OBSERVAR
				 */
				objListaDoc.put("observar", "<A id='A1' href='javascript:Observar("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+","+rs.getString("secuencia_movimiento").trim()+","+rs.getString("secuencia_origen").trim()+");' >"+
				"<img src='img/07observar.png' height='20' title='Observar' border='0'></A>");
				
				ListaMesaPartes.add(objListaDoc);
				
				
				ls_ant_codigo_documento=rs.getString("codigo_documento").trim();

				
				}else if(contador>1){
						
						if(!ls_ant_codigo_documento.equals(rs.getString("codigo_documento").trim())){

							
							objListaDoc.put("codigo_documento", constantea+rs.getString("codigo_documento")+constanteb);
							objListaDoc.put("codigo_expediente", constantea+rs.getString("codigo_expediente")+constanteb);
							objListaDoc.put("numero_documento", constantea+rs.getString("numero_documento")+constanteb);
							objListaDoc.put("oficina_origen", constantea+rs.getString("nombre_oficina_origen")+constanteb);
							objListaDoc.put("fecha_movimiento", constantea+rs.getString("fecha_movimiento")+constanteb);
							objListaDoc.put("estado_movimiento","<FONT color='#00CC00'>"+rs.getString("estado_expediente").trim()+"</FONT>");
							
							if(rs.getInt("numupload")==0){
								objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
							}else {
								objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
								"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
							}
								
							
							
							/**
							 * INSERCION DE LINK FIRMA DIGITAL
							 */
							//ESTADO TEMPORAL,  SI ES CERO SIGNIFICA QUE NO TIENE HISTORIAL 
							
							if(ls_codigo_estado_documento.equals("0")){
								//preparar respuesta
								if(!ls_codigo_documento_interno_origen.equals("0")){
									objListaDoc.put("documento_respuesta", "<A id='A1' title='Preparar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
									"<img src='img/send_doc.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
									"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+ls_codigo_documento_interno_origen.trim()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
								}else{
									objListaDoc.put("documento_respuesta", "<A id='A1' title='Preparar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
									"<img src='img/send_doc.png' height='20'  border='0'></A>");
								}

							}else{
								if(ls_codigo_estado_documento.equals("1")){
									//modificar respuesta
									if(!ls_codigo_documento_interno_origen.equals("0")){
										objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
										"<img src='img/edit_doc.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
										"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+ls_codigo_documento_interno_origen.trim()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
									}else{
										objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
										"<img src='img/edit_doc.png' height='20'  border='0'></A>");
									}
									
								}else{
									if(ls_codigo_estado_documento.equals("5")){
										//firmar
										
										if(valor==0){//indica que no tiene firma
											objListaDoc.put("documento_respuesta", "<A id='A1' title='Ir a Bandeja documentos por firmar' href='FormularioBusquedaDocumentoInterno.do?inicia=SI&tipo=vista' ><img src='img/send-bandeja-icon.png' height='20'  border='0'></A>");

										}else{
											if(!ls_codigo_documento_interno_origen.equals("0")){
												objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
												"<img src='img/03firmar.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
												"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+ls_codigo_documento_interno_origen.trim()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
											}else{
												objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
												"<img src='img/03firmar.png' height='20'  border='0'></A>");
											}	
										}
										
										
									}else{
										if(estado_temporal == 3){
											//firmar
											objListaDoc.put("documento_respuesta", ls_codigo_estado_documento);
										}
									}
									
								}
							}
							/***
							 * OBSERVAR
							 */
							objListaDoc.put("observar", "<A id='A1' href='javascript:Observar("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+","+rs.getString("secuencia_movimiento").trim()+","+rs.getString("secuencia_origen").trim()+");' >"+
							"<img src='img/07observar.png' height='20' title='Observar' border='0'></A>");
								
								ListaMesaPartes.add(objListaDoc);
								
						
						}
						
						ls_ant_codigo_documento=rs.getString("codigo_documento").trim();
							
				}
				
			}	
            
			x.cerrar_conexion(con, rs);
        	pstmt.close();
            
        } catch (SQLException e) {
        	x.cerrar_conexion(con);
             e.printStackTrace();
        }
        return ListaMesaPartes;
	                
	}
	
	public Collection  lista_observacion_documentos(Connection cnx,String oficina,String inicia) throws Exception {
		
        log.info("ENTRO A  Lista Observacion de Mesa de Partes");
        log.info("--> "+oficina);
		Collection ListaMesaPartes = new ArrayList();
		DocumentosInternosService service = new DocumentosInternosServiceImplement();	
		
		BCorrelativos BCorrelativosVO = null;
		BTipoDocumento BTipoDocumentoVO = null;
		BOficinas BOficinasVO = null;
		BFondo BFondoVO = null;
		BMesaPartes BMesaPartesVO = null;
		
		ObtieneConexion  x= new ObtieneConexion();
		Connection	con= x.getConnection();
		Statement us  = null;
		ResultSet rs = null;
		PreparedStatement pstmt = null;
		
       String ls_desde;
       String ls_hasta;
       
       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
    	
    	Date d= new Date(); 
    	String fecha_documento  = fechaActual.format(d);
    	String fechaconsulta = fechaConsulta.format(d);
    	String fechaformat = fechaActualFormat.format(d);
    	String yearactual = year.format(d);
    	String estado_documento = "1";
    	String fondo = "01";
    	String ls_correla= "";
    	String ls_num_upload="";
    	String ls_valor  = "";
    	//String ls_sql ="";
    	int li_retorno=0;
    	int codigo_temporal = 0;
    	int estado_temporal = 0;
    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
    	//log.info("Año yearactual.... : " + yearactual);
    	//log.info(" fechaformat.... : " + fechaformat);*/
    	
    	Date fecha_recep = new Date(); // fecha y hora locales 
		SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
		SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); 
		/*//log.info("la fecha es.."+ formatoFecha.format(fecha_recep) ); 
		//log.info("la hora es.."+ formatoHora.format(fecha_recep) );*/ 
    
		Funciones funcion=new Funciones();
		
		/*int li_retorno_correlativo = funcion.parametro(cnx);
	 ls_correla   = String.valueOf(li_retorno_correlativo);
	 
	//log.info("El correla es sqlUsuario es... :" + ls_correla);*/
        try {	
        	
        	//String ls_naturaleza=naturaleza.equals("*");
        	//ls_naturaleza="";
        	
        			
        		//log.info(" Si es una lista normal");
        		
        		 /*ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
        		 		"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
        		 		"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
        		 		"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion," +
        		 		"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento," +
        		 		"dc.numero_documento_ant,de.origen_documento,de.destino_documento,de.desc_origen," +
        		 		"de.tipo,de.remitente,de.destinatario,of.codigo_oficina,of.descripcion_oficina," +
        		 		"of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal" +
        		 		" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
        		 		"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr" +
        		 		" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
        		 		" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
        		 		" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
        		 		" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento = '3' and" +
        		 		" md.codigo_fondo like '01' and md.codigo_oficina like " + "'" + oficina + "'" + " order by md.fecha_consulta desc, md.hora_movimiento desc," +
        		 		" md.codigo_documento desc";*/
        		
        		StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        				"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.secuencia_origen," +
	        				"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo," +
	        				"md.fecha_rpta,md.codigo_expediente,md.oficina_origen,md.oficina_deriva," +
	        				"md.correlativo_deriva,md.observa_registro,md.codigo_recepcion,md.flag," +
	        				"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento," +
	        				"dc.asunto_documento,dc.numero_documento_ant,de.origen_documento," +
	        				"de.destino_documento,de.desc_origen,de.tipo,de.remitente,de.destinatario," +
	        				"of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	        				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from" +
	        				" tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
	        				"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a," +
	        				"tramite.personal pr where tp.codigo_tipo=dc.codigo_tipo and " +
	        				"dc.codigo_documento=md.codigo_documento and " +
	        				"dc.codigo_documento=de.codigo_documento and " +
	        				"md.codigo_documento=de.codigo_documento and de.destinatario=pr.codigo_personal" +
	        				" and md.codigo_oficina=of.codigo_oficina and " +
	        				"de.destino_documento=of_a.codigo_oficina and md.estado_movimiento ='A'" +
	        				" and md.codigo_fondo like '01' and md.oficina_origen = ?  " + 
	        				" and md.codigo_documento not in (select codigo_documento from " +
	        				"tramite.movimientos_doc where estado_movimiento ='A' and" +
	        				" codigo_fondo like '01' and oficina_origen=?  and flag ='I') " +
	        				"order by md.codigo_documento desc");
        		 
	        	if(inicia!=null && inicia.equals("SI")){
					ls_sql.append(" limit 30");
				}
        		
        		//log.info("El ls_sql..otros mesa de partes oficinas DERIVACION.. : " + ls_sql);
	        	pstmt = con.prepareStatement(ls_sql.toString());

		    	 pstmt.setInt(1, Integer.parseInt(oficina));
		    	 pstmt.setInt(2, Integer.parseInt(oficina));
		    	 
		    	 rs=pstmt.executeQuery();
        		
        	
    		log.info(" ls_sql lista observa.... : " + ls_sql);
    		
    		Funciones funciones=new Funciones();
    		
    		 String ls_ant_codigo_recepcion="";
	    	 String ls_ant_codigo_documento="";
	    	 String ls_ant_codigo_expediente="";
	    	 String ls_ant_secuencia_movimiento="";
	    	 String ls_naturaleza_documento="";
	    	 
	    	 String ls_codigo_recepcion="";
	    	 String ls_codigo_documento="";
	    	 String ls_codigo_documento_cont="";
	    	 String ls_codigo_expediente="";
	    	 String ls_codigo_expediente_cont="";
	    	 String ls_secuencia_movimiento="";
	    	 String ls_secuencia_origen="";
	    	 int contador=0;

	    	 
			while (rs.next()) { 
				
				
				//BMesaPartesVO = new BMesaPartes();
				
				contador=contador+1;
				 Hashtable objListaDoc = new Hashtable();
				 ////log.info("Imprime listas XXX...." + contador);
					////log.info("Imprime listas...." + contador);
					
					ls_codigo_recepcion=rs.getString("codigo_recepcion").trim();
					ls_codigo_documento=rs.getString("codigo_documento").trim();
					ls_codigo_expediente=rs.getString("codigo_expediente").trim();
					ls_secuencia_movimiento=rs.getString("secuencia_movimiento").trim();
					ls_secuencia_origen=rs.getString("secuencia_origen").trim();
						
					if(contador==1){

				log.info("aqui");
				String seleccionar = "<label style='cursor: hand;' align='center' " 
				+ "onclick=\"fn_editar_copia_obs('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"','"+ls_secuencia_origen+"');\" " + ">Seleccionar</label>";
				
				 ls_codigo_expediente_cont = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar_copia_obs('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"','"+ls_secuencia_origen+"');\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
				
				 ls_codigo_documento_cont = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar_copia_obs('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"','"+ls_secuencia_origen+"');\" " + ">"+ rs.getString("codigo_documento")+"</label>";
				
				String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar_copia_obs('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"','"+ls_secuencia_origen+"');\" " + ">"+ rs.getString("numero_documento")+"</label>";
				
				String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar_copia_obs('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"','"+ls_secuencia_origen+"');\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
				
				String ls_fecha_movimiento = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar_copia_obs('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"','"+ls_secuencia_origen+"');\" " + ">"+ rs.getString("fecha_movimiento")+"</label>";
				
				objListaDoc.put("ACTION", seleccionar);
				objListaDoc.put("codigo_documento", ls_codigo_documento_cont);
				objListaDoc.put("codigo_expediente", ls_codigo_expediente_cont);
				objListaDoc.put("numero_documento", ls_numero_documento);
				objListaDoc.put("oficina_origen", ls_oficina_origen);
				objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
				objListaDoc.put("estado_movimiento","<FONT color='#00CC00'>"
						+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");
				objListaDoc.put("fecha_movimiento", ls_fecha_movimiento);
				objListaDoc.put("hora", rs.getString("hora_movimiento"));
				objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
				objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
				
				objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
				objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
				//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
				objListaDoc.put("naturaleza_documento", rs.getString("naturaleza_documento"));
				
				ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
				
				////log.info("El ls_num_upload es..: " + ls_num_upload);
				if(ls_num_upload.equals("0")){
					
					objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
					
				}else {
					
					objListaDoc.put("view_archivo", "<A id='A1' title='Ver Documento' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
					"<img src='img/copy_f2.png' height='20'  border='0'></A>");

				}
				/**
				 * INSERCION DE LINK FIRMA DIGITAL
				 */
				
				
				BInfoListaReiterativo infoLista = new BInfoListaReiterativo();
				
				infoLista = service.getCodigoDocumentoInternoDerivadoObservado(rs.getString("codigo_documento").trim(),oficina,rs.getString("secuencia_movimiento").trim());
				estado_temporal = infoLista.getEstado_documento_interno();
				
				
				if(estado_temporal == 0){
					//preparar respuesta
					objListaDoc.put("documento_respuesta", "<A id='A1' title='Preparar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&sec="+rs.getString("secuencia_movimiento").trim()+"' >"+
					"<img src='img/send_doc.png' height='20'  border='0'></A>");
				}else{
					if(estado_temporal == 1){
						//modificar respuesta
						objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&sec="+rs.getString("secuencia_movimiento").trim()+"' >"+
						"<img src='img/edit_doc.png' height='20'  border='0'></A>");
					}else{
						if(estado_temporal == 5){
							//firmar
							objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&sec="+rs.getString("secuencia_movimiento").trim()+"' >"+
							"<img src='img/03firmar.png' height='20'  border='0'></A>");
							
						}else{
							if(estado_temporal == 9){
								//modificar respuesta
								objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_origen").trim()+"&codproy=0' >"+
								"<img src='img/edit_doc.png' height='20'  border='0'></A>");
								
							}else{
								if(estado_temporal == 10){
									//firmar respuesta
									objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_origen").trim()+"&secini="+rs.getString("secuencia_movimiento").trim()+"&codproy=0' >"+
									"<img src='img/03firmar.png' height='20'  border='0'></A>");
									
								}
							}
						}
						
					}
				}
				
				/*objListaDoc.put("view_archivo", "<A id='A1' target='_blank' href='N:\\DocumentosTramite\\" +
						rs.getString("codigo_expediente").trim()+".PDF"+"'"+
						"><img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'>  </A>");*/
				
				ListaMesaPartes.add(objListaDoc);
				
				ls_ant_codigo_recepcion=ls_codigo_recepcion;
				ls_ant_codigo_documento=ls_codigo_documento;
				ls_ant_codigo_expediente=ls_codigo_expediente;
				ls_ant_secuencia_movimiento=ls_secuencia_movimiento;

				
					}
					else if(contador>1){
						////log.info("Si el contador es mayor a cero es....: ");
						
						if(ls_ant_codigo_documento.equals(ls_codigo_documento)){
							////log.info("Los codigos son iguales me imprime una lista ji ji....: ");
							
							
							
							////log.info("--------------------------------------------------- ");
						}else {
							
							String seleccionar = "<label style='cursor: hand;' align='center' " 
								+ "onclick=\"fn_editar_copia_obs('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"','"+ls_secuencia_origen+"');\" " + ">Seleccionar</label>";
								
								 ls_codigo_expediente_cont = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar_copia_obs('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"','"+ls_secuencia_origen+"');\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
								
								 ls_codigo_documento_cont = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar_copia_obs('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"','"+ls_secuencia_origen+"');\" " + ">"+ rs.getString("codigo_documento")+"</label>";
								
								String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar_copia_obs('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"','"+ls_secuencia_origen+"');\" " + ">"+ rs.getString("numero_documento")+"</label>";
								
								String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar_copia_obs('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"','"+ls_secuencia_origen+"');\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
								
								String ls_fecha_movimiento = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar_copia_obs('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"','"+ls_secuencia_origen+"');\" " + ">"+ rs.getString("fecha_movimiento")+"</label>";
								
								objListaDoc.put("ACTION", seleccionar);
								objListaDoc.put("codigo_documento", ls_codigo_documento_cont);
								objListaDoc.put("codigo_expediente", ls_codigo_expediente_cont);
								objListaDoc.put("numero_documento", ls_numero_documento);
								objListaDoc.put("oficina_origen", ls_oficina_origen);
								objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
								objListaDoc.put("estado_movimiento","<FONT color='#00CC00'>"
										+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");
								objListaDoc.put("fecha_movimiento", ls_fecha_movimiento);
								objListaDoc.put("hora", rs.getString("hora_movimiento"));
								objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
								objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
								
								objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
								objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
								//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
								objListaDoc.put("naturaleza_documento", rs.getString("naturaleza_documento"));
								
								ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
								
								////log.info("El ls_num_upload es..: " + ls_num_upload);
								if(ls_num_upload.equals("0")){
									
									objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
									
								}else {
									
									objListaDoc.put("view_archivo", "<A id='A1' title='Ver Documento' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
									"<img src='img/copy_f2.png' height='20'  border='0'></A>");

								}	
								
								/**
								 * INSERCION DE LINK FIRMA DIGITAL
								 */
								BInfoListaReiterativo infoLista = new BInfoListaReiterativo();
								
								infoLista = service.getCodigoDocumentoInternoDerivadoObservado(rs.getString("codigo_documento").trim(),oficina,rs.getString("secuencia_movimiento").trim());
								estado_temporal = infoLista.getEstado_documento_interno();
								
								if(estado_temporal == 0){
									//preparar respuesta
									objListaDoc.put("documento_respuesta", "<A id='A1' title='Preparar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&sec="+rs.getString("secuencia_movimiento").trim()+"' >"+
									"<img src='img/send_doc.png' height='20'  border='0'></A>");
								}else{
									if(estado_temporal == 1){
										//modificar respuesta
										objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&sec="+rs.getString("secuencia_movimiento").trim()+"' >"+
										"<img src='img/edit_doc.png' height='20'  border='0'></A>");
									}else{
										if(estado_temporal == 5){
											//firmar
											objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&sec="+rs.getString("secuencia_movimiento").trim()+"' >"+
											"<img src='img/03firmar.png' height='20'  border='0'></A>");
											
										}else{
											if(estado_temporal == 9){
												//modificar respuesta
												objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_origen").trim()+"&codproy=0' >"+
												"<img src='img/edit_doc.png' height='20'  border='0'></A>");
												
											}else{
												if(estado_temporal == 10){
													//firmar respuesta
													objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_origen").trim()+"&secini="+rs.getString("secuencia_movimiento").trim()+"&codproy=0' >"+
													"<img src='img/03firmar.png' height='20'  border='0'></A>");
													
												}
											}
									}
								}
								}
								ListaMesaPartes.add(objListaDoc);
								
						}
						ls_ant_codigo_recepcion=ls_codigo_recepcion;
						ls_ant_codigo_documento=ls_codigo_documento;
						ls_ant_codigo_expediente=ls_codigo_expediente;
						ls_ant_secuencia_movimiento=ls_secuencia_movimiento;
						
							
						}
					
					
			}	
            
			x.cerrar_conexion(con, rs);
        	pstmt.close();
        	
            
        } catch (SQLException e) {
        	x.cerrar_conexion(con, rs);
             e.printStackTrace();
        }
        return ListaMesaPartes;
	                
	}
	 
	 public void of_derivar_doc_edit(Connection cnx,String oficina,String documento,String usuario,String fecha,
			 String hora,String observacion,String ls_estado_doc,String ls_correlativorecepcion) {
	    	
	     //   obtenermos el valor maximo...
	    	//log.info("dentro del recibir documento......." );
	    	int    li_retorno;
	    	int    li_parcial = 0 ;
	    	String ls_correlativo=null;
	    	String ls_ano=null;
	    	String ls_mes=null;
	    	String ls_dia=null;
	    	String fecha_consulta=null;
	    	String ls_estado_derivar="3";
	    	String ls_estado_preliq="6";
	    	String ls_estado_liquid="7";
	    	String codigo_fondo="01";
	    	li_retorno = 1;
	    	Statement us  = null;
			ResultSet rs = null;
			
	    	String ls_sql = "";
	    	
	    	ObtieneConexion x= new ObtieneConexion();
			Connection	con= x.getConnection();
			
	    	try{
	    		
	    		//log.info("fecha: " + fecha );
	        	ls_ano = fecha.substring(6, 10);
	        	ls_mes = fecha.substring(3, 5);
	        	ls_dia = fecha.substring(0, 2);
	        	/*//log.info("ls_ano: " + ls_ano );
	        	//log.info("ls_mes: " + ls_mes );
	        	//log.info("ls_dia: " + ls_dia );*/
	        	
	        	fecha_consulta = fecha.substring(6,10)+fecha.substring(3,5)+fecha.substring(0,2);
	        	
	        		ls_sql = "UPDATE tramite.movimientos_doc SET fecha_movimiento="+"'"+fecha+"'"+","+"fecha_consulta="+"'"+fecha_consulta+"'"+
	        		","+" hora_movimiento="+"'"+hora+"'"+"," + " ultimo_usuario=" + "'" +usuario+ "'"+"," +
	        		" observa_movimiento=" + "'" +observacion+ "'"+"," +
	        		" codigo_recepcion=" + "'" +ls_correlativorecepcion+ "'" + " where codigo_fondo="+ "'" + codigo_fondo +
	        		"'" + " and codigo_oficina= "+ "'" +oficina + "'" + " and codigo_documento="+"'"+documento+"'"+"";
	        		
	        		//  //log.info("El ls_sql update recibir documento es" + ls_sql);
	        	
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
			    	 
			    	 x.cerrar_conexion(con);
			    	 us.close();
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    	}

		}
	 
	 public Collection  lista_documentos_todos(Connection cnx,String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de todos los documentos");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	String ls_correla= "";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	int li_retorno=0;
	    	
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    	Date fecha_recep = new Date(); // fecha y hora locales 
		SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
		SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); 
		/*//log.info("la fecha es.."+ formatoFecha.format(fecha_recep) ); 
		//log.info("la hora es.."+ formatoHora.format(fecha_recep) );*/ 
	    
		Funciones funcion=new Funciones();
		
		int li_retorno_correlativo = funcion.parametro();
		ls_correla   = String.valueOf(li_retorno_correlativo);
		 
		ObtieneConexion x= new ObtieneConexion();
		Connection	con= x.getConnection();
		//log.info("El correla es sqlUsuario es... :" + ls_correla);
	        try {	
	        	
	        	//String ls_naturaleza=naturaleza.equals("*");
	        	//ls_naturaleza="";
	        	
	        			
	        		//log.info(" Si es una lista normal");
	        		
	        		 ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        		 		"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
	        		 		"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	        		 		"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion," +
	        		 		"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento," +
	        		 		"dc.numero_documento_ant,de.origen_documento,de.destino_documento,de.desc_origen," +
	        		 		"de.tipo,de.remitente,de.destinatario,of.codigo_oficina,of.descripcion_oficina," +
	        		 		"of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal" +
	        		 		" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
	        		 		"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr" +
	        		 		" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	        		 		" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	        		 		" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	        		 		" de.destino_documento=of_a.codigo_oficina and" +
	        		 		" md.codigo_fondo like '01' and md.codigo_oficina like " + "'" + oficina + "'" + " order by md.fecha_movimiento desc, md.hora_movimiento desc," +
	        		 		" md.codigo_documento desc";
	        		 
	        	
	  
	        		 ////log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
	 		    	us = con.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
	    		Funciones funciones=new Funciones();
				while ( rs.next() ) { 
					
					
					//BMesaPartesVO = new BMesaPartes();
					
					Hashtable objListaDoc = new Hashtable();
					String seleccionar = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
			        + rs.getString("codigo_expediente") + "'"+ "," 
			        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
			        + "'"+ rs.getString("numero_documento") + "'"+ "," 
			        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
			        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
			        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
			        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
			        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
			        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
			        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
			        + "'"+ ls_correla + "'"
			        + ");\" " + ">Seleccionar</label>";
					
					String ls_codigo_expediente = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
				        + "'"+ ls_correla + "'"
				        + ");\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
					
					String ls_codigo_documento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
				        + "'"+ ls_correla + "'"
				        + ");\" " + ">"+ rs.getString("codigo_documento")+"</label>";
					
					String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
				        + "'"+ ls_correla + "'"
				        + ");\" " + ">"+ rs.getString("numero_documento")+"</label>";
					
					String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
				        + "'"+ ls_correla + "'"
				        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
					
					objListaDoc.put("ACTION", seleccionar);
					objListaDoc.put("codigo_documento", ls_codigo_documento);
					objListaDoc.put("codigo_expediente", ls_codigo_expediente);
					objListaDoc.put("numero_documento", ls_numero_documento);
					objListaDoc.put("oficina_origen", ls_oficina_origen);
					objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
					objListaDoc.put("estado_movimiento", funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim()));
					objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
					objListaDoc.put("hora", rs.getString("hora_movimiento"));
					objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
					objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
					
					objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
					objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
					//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
					objListaDoc.put("naturaleza_documento", rs.getString("naturaleza_documento"));
					
					ListaMesaPartes.add(objListaDoc);
					

				}	
	            x.cerrar_conexion(con, rs);
				us.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con);
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection of_busca_documentos_especial_xls(Connection cnx,String codigoOficinaDelUSuario,String procedencia,
			 String sle_fecha,String medio,String codigo_tipo,String codigo_oficina,String codigo_solicitud,
			 String codigo_documento,String codigo_expediente,String firmadopor,String dirigido
			 ,String estado,String numero_documento,String doc_resp,String asunto_documento
			 ,String sle_fecha_inicio,String sle_fecha_fin,String codigo_motivo,String flag,String observacion) throws Exception{
			
			////log.info("ENTRO A BUSCAR Documentos");
			//BDocumentos BDocumentosVO= null;
		 	log.info("Dentro de of_busca_documentos_especial_xls" );
			Collection ListaMesaPartes = new ArrayList();
			
			
			PreparedStatement us  = null;
			ResultSet rs = null;
			String tokens[]=null;
			//StringBuffer ls_sql ="";
			Funciones funciones=new Funciones();
			ObtieneConexion x= new ObtieneConexion();
			Connection	con= x.getConnection();
			try 
			{	
	
				StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.secuencia_movimiento,md.codigo_oficina,md.fecha_movimiento" +
						",md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.ultimo_usuario," +
						"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.codigo_recepcion,md.fecha_rpta," +
						"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.fecha_registro," +
						"(substr(dc.fecha_registro,7,10) || substr(dc.fecha_registro,4,2) || substr(dc.fecha_registro,0,3)) as fecha_consulta_reg," +
						"dc.hora_registro,dc.codigo_tipo,de.origen_documento,de.destino_documento,de.desc_origen,de.tipo," +
						"de.remitente,de.destinatario,de.codigo_solicitud,de.firmadopor,de.medio,of.codigo_oficina," +
						"of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal," +
						"pr.nombre_personal,md.observa_movimiento  from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
						"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where " +
						"tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
						" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento and " +
						"de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
						" de.destino_documento=of_a.codigo_oficina and md.codigo_fondo like '01' and md.estado_movimiento<>'A' ");
				
				
				
				if(observacion != null && !observacion.equals("") && !observacion.equals("null")){
		    		 //ls_sql.append(" and md.observa_movimiento ilike '"+ observacion +"%' ");

		    		 observacion = observacion.trim();
						tokens=observacion.split(" ");
						for(int i=0;i<tokens.length;i++){
							ls_sql.append(" and md.observa_movimiento ilike  '%"+ tokens[i] +"%' ");	
						} 
						
					}
				
					if(procedencia != null && !procedencia.equals("") && !procedencia.equals("null")){
			    		 ls_sql.append(" and md.desc_origen ilike '"+ procedencia +"%' ");
			    		 //log.info("el codigo_documento: " + ls_sql);
						}
					
					if(sle_fecha != null && !sle_fecha.equals("") && !sle_fecha.equals("null")){
			    		 ls_sql.append(" and dc.fecha_registro = '"+ sle_fecha +"' and md.estado_movimiento ='5' and md.secuencia_movimiento ='1'");
			    		 //log.info("el codigo_expediente: " + ls_sql);
					}
					
					boolean fecha_inicio_valido = funciones.esFechaValida(sle_fecha_inicio);
					log.info("Fecha de Inicio "+fecha_inicio_valido+",fecha_origen = "+sle_fecha_inicio+" fecha="+funciones.cambiarFormato(sle_fecha_inicio));
					
					boolean fecha_fin_valido = funciones.esFechaValida(sle_fecha_fin);
					log.info("Fecha de Fin "+fecha_fin_valido+", fecha="+ funciones.cambiarFormato(sle_fecha_fin));
					
					
					if(sle_fecha_inicio != null && !sle_fecha_inicio.equals("") && !sle_fecha_inicio.equals("null") && fecha_inicio_valido){
			    		 ls_sql.append(" and to_date(dc.fecha_registro,'DD/MM/YYYY') >= '"+ funciones.cambiarFormato(sle_fecha_inicio) +"' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
					}
					
					if(sle_fecha_fin != null && !sle_fecha_fin.equals("") && !sle_fecha_fin.equals("null")  && fecha_fin_valido){
			    		 ls_sql.append(" and to_date(dc.fecha_registro,'DD/MM/YYYY') <= '"+ funciones.cambiarFormato(sle_fecha_fin) +"' ");			    		 
					}
					
					if(codigo_tipo != null && !codigo_tipo.equals("0") && !codigo_tipo.equals("null")){
			    		 ls_sql.append(" and dc.codigo_tipo = '"+ codigo_tipo +"' ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
					}
					
					if(asunto_documento != null && !asunto_documento.trim().equals("") && !asunto_documento.equals("null")){
						asunto_documento = asunto_documento.trim();
						tokens=asunto_documento.split(" ");
						for(int i=0;i<tokens.length;i++){
							ls_sql.append(" and dc.asunto_documento ilike  '%"+ tokens[i] +"%' ");	
						} 
					}
					
					if(codigo_solicitud != null && !codigo_solicitud.equals("0") && !codigo_solicitud.equals("null")){
			    		 ls_sql.append(" and de.codigo_solicitud = '"+ codigo_solicitud +"' ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
						}
					
					if(medio != null && !medio.equals("0") && !medio.equals("null")){
			    		 ls_sql.append(" and de.medio = '"+ medio +"' ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
						}
					
					//log.info("Antes codigo_oficina: " + codigo_oficina);
					//log.info("Antes oficina: " + oficina);
					
					if(codigo_oficina != null && !codigo_oficina.equals("0") && !codigo_oficina.equals("null")){
			    		 ls_sql.append(" and md.codigo_oficina = '"+ codigo_oficina +"' ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
						}
					else{
						
						log.info("La oficina ES : " + codigoOficinaDelUSuario);
						
						if(flag.equals("N")){
							log.info("Es un usuario normal");
							ls_sql.append("and ( md.codigo_oficina = "+ codigoOficinaDelUSuario +" or md.oficina_origen = "+ codigoOficinaDelUSuario +" or md.oficina_deriva = "+ codigoOficinaDelUSuario +")");
						}
						
						//log.info("el ls_codigo_oficina: " + ls_sql);
					}
					//log.info("Despues codigo_oficina: " + codigo_oficina);
					//log.info("Despues oficina: " + oficina);
					
					if(codigo_documento != null && !codigo_documento.equals("") && !codigo_documento.equals("null")){
			    		 ls_sql.append(" and md.codigo_documento = '"+ codigo_documento +"' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(codigo_expediente != null && !codigo_expediente.equals("") && !codigo_expediente.equals("null")){
			    		 ls_sql.append(" and md.codigo_expediente = '"+ codigo_expediente +"' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(firmadopor != null && !firmadopor.equals("") && !firmadopor.equals("null")){
			    		 ls_sql.append(" and de.firmadopor ilike '"+ firmadopor.toUpperCase() +"%' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(dirigido != null && !dirigido.equals("") && !procedencia.equals("null")){
			    		 ls_sql.append(" and dc.dirigido ilike '"+ dirigido +"%' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(numero_documento != null && !numero_documento.equals("") && !numero_documento.equals("null")){
						numero_documento = numero_documento.trim();
						tokens=numero_documento.split(" ");
						for(int i=0;i<tokens.length;i++){
							ls_sql.append(" and dc.numero_documento ilike '%"+ tokens[i] +"%' ");	
						}
			    		 
						}
					
					if(estado != null && !estado.equals("0") && !estado.equals("null")){
			    		 ls_sql.append(" and md.estado_movimiento = '"+ estado +"' ");
			    		 //log.info("el estado: " + ls_sql);
						}
					
					if(doc_resp != null && !doc_resp.equals("") && !doc_resp.equals("null")){
			    		 ls_sql.append(" and md.doc_resp ilike '%"+ doc_resp.toUpperCase() +"%' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(codigo_motivo != null && !codigo_motivo.equals("0") && !codigo_motivo.equals("null")){
			    		 ls_sql.append(" and md.codigo_motivo = '"+ codigo_motivo +"' ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
						}
					
					ls_sql.append(" and md.secuencia_movimiento = (select max(secuencia_movimiento) from tramite.movimientos_doc where codigo_documento=md.codigo_documento and codigo_oficina="+codigoOficinaDelUSuario+") ");
					
					ls_sql.append(" order by  md.codigo_documento desc,md.secuencia_movimiento desc");
					
					String query = ls_sql.toString();
					
					log.info("Si el ls_sql Busca Documento Seguimiento..: " + ls_sql);
					
					us = con.prepareStatement(query);
					rs = us.executeQuery();
					
			    	 ////log.info("Si el tipo es Rendicion: " + rs);
					String ls_num_upload="";
					String ls_nomb_upload="";
			    	// Funciones funciones=new Funciones();
			    	 String ls_codigo_recepcion="";
			    	 String ls_codigo_documento="";
			    	 String ls_codigo_expediente="";
			    	 String ls_secuencia_movimiento="";
			    	 
			    	 String ls_ant_codigo_recepcion="";
			    	 String ls_ant_codigo_documento="";
			    	 String ls_ant_codigo_expediente="";
			    	 String ls_ant_secuencia_movimiento="";
			    	 String ls_naturaleza_documento="";
			    	 String ls_estado_mov="";
			    	 String ls_numero_referencia="";
			    	 String ls_oficina_origen="";
			    	 String ls_oficina_deriva="";
			    	 String ls_estado_movimiento="";
			    	 int contador=0;
			    	 
			    	// log.info("Antes del While....");
			    	 
			    	 while (rs.next()) { 
							
							 Hashtable objListaDoc = new Hashtable();
							
									objListaDoc.put("codigo_documento", rs.getString("codigo_documento").trim());
									objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente").trim());
									objListaDoc.put("fecha_registro",rs.getString("fecha_registro"));
									objListaDoc.put("numero_documento", rs.getString("numero_documento").trim());
									objListaDoc.put("codigo_oficina", funciones.of_nombre_corto_oficina(cnx, rs.getString("codigo_oficina").trim()));
									objListaDoc.put("oficina_origen",funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_origen").trim()));
									objListaDoc.put("oficina_deriva",funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_deriva").trim()));									
									objListaDoc.put("observa_movimiento",rs.getString("observa_movimiento").trim());
									ls_estado_mov=rs.getString("estado_movimiento").trim();
									objListaDoc.put("estado_movimiento",funciones.of_nombre_estado(cnx,ls_estado_mov ));
									
									objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
									objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));	
									ls_naturaleza_documento=rs.getString("naturaleza_documento");
									if(ls_naturaleza_documento.equals("I")){
										ls_naturaleza_documento="Interno";
									}else{
										ls_naturaleza_documento="Externo";
									}
									
									objListaDoc.put("naturaleza_documento", ls_naturaleza_documento);
									objListaDoc.put("desc_origen", rs.getString("desc_origen").trim());
									objListaDoc.put("firmadopor",rs.getString("firmadopor").trim());
									//objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()) );
																	
									
									//objListaDoc.put("secuencia_movimiento", ls_secuencia_movimiento);
									//objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
									//objListaDoc.put("codigo_oficina", funciones.of_nombre_corto_oficina(cnx, rs.getString("codigo_oficina").trim()));
									//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
									
									
									/*ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
									
									if(ls_num_upload.equals("0")){
										objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
									}else {
										objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
										"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
									}*/

									ListaMesaPartes.add(objListaDoc);

								
			    	 }
				
				x.cerrar_conexion(con, rs);
				us.close();
				
			} catch (SQLException e){
				 e.printStackTrace();
				 x.cerrar_conexion(con);
			}
			return ListaMesaPartes;
	                
			}
	 
	 public Collection of_busca_documentos(Connection cnx,String codigoOficinaDelUSuario,String procedencia,
			 String sle_fecha,String medio,String codigo_tipo,String codigo_oficina_formulario,String codigo_solicitud,
			 String codigo_documento,String codigo_expediente,String firmadopor,String dirigido
			 ,String estado,String numero_documento,String doc_resp,String asunto_documento
			 ,String sle_fecha_inicio,String sle_fecha_fin,String codigo_motivo,String flag,String observacion) throws Exception{
			
			log.info("ENTRO A of_busca_documentos");
			Collection ListaMesaPartes = new ArrayList();
			String tokens[]=null;
			int contadorItem=0;
			int contadorLista=1;
			
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			
			Connection conn = null;
			ObtieneConexion obt=new ObtieneConexion();

			Funciones funciones=new Funciones();

			try 
			{	
				
				StringBuilder ls_sql = new StringBuilder("select md.codigo_documento,md.secuencia_movimiento,md.codigo_oficina,md.fecha_movimiento");
						ls_sql.append(",md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.ultimo_usuario,");
						ls_sql.append("md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.codigo_recepcion,md.fecha_rpta,");
						ls_sql.append("tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.fecha_registro,");
						ls_sql.append("(substr(dc.fecha_registro,7,10) || substr(dc.fecha_registro,4,2) || substr(dc.fecha_registro,0,3)) as fecha_consulta_reg,");
						ls_sql.append("dc.hora_registro,dc.codigo_tipo,de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,");
						ls_sql.append("de.remitente,de.destinatario,de.codigo_solicitud,de.firmadopor,de.medio,of.codigo_oficina,");
						ls_sql.append("of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,");
						ls_sql.append("pr.nombre_personal,md.observa_movimiento,(select count(tdetu.codigo_documento) from tramite.tbl_det_upload  tdetu  where tdetu.codigo_documento = md.codigo_documento) as numupload, ");
						ls_sql.append("(select tedoc.estado_expediente from tramite.estados_doc tedoc where md.estado_movimiento=tedoc.codigo_estado) as estado_expediente, ");
						ls_sql.append("(select tofi.siglas_oficina  from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_origen) as nombre_oficina_origen,");
						ls_sql.append("(select tofi.siglas_oficina  from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_deriva) as nombre_oficina_deriva, ");
						ls_sql.append("(case  dc.naturaleza_documento when 'I' then 'Interno' when 'E' then 'Externo' else 'None' end ) as naturaleza_documento_report  ");

						ls_sql.append("from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc,");
						ls_sql.append("tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr ");


						ls_sql.append("where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and");
						ls_sql.append(" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento and ");
						ls_sql.append("de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and");
						ls_sql.append(" de.destino_documento=of_a.codigo_oficina and md.codigo_fondo like '01'  and  md.estado_movimiento<>'A' ");
		
				
				
				if(observacion != null && !observacion.equals("") && !observacion.equals("null")){
		    		 //ls_sql.append(" and md.observa_movimiento ilike '"+ observacion +"%' ");

	    		 	observacion = observacion.trim();
					tokens=observacion.split(" ");
					for(int i=0;i<tokens.length;i++){
						ls_sql.append(" and md.observa_movimiento ilike  '%"+tokens[i]+"%' ");	
					} 
						
				}
				
					if(procedencia != null && !procedencia.equals("") && !procedencia.equals("null")){
			    		 ls_sql.append(" and md.desc_origen ilike '"+procedencia+"%' ");
			    		 //log.info("el codigo_documento: " + ls_sql);
						}
					
					if(sle_fecha != null && !sle_fecha.equals("") && !sle_fecha.equals("null")){
			    		 ls_sql.append(" and dc.fecha_registro =? and md.estado_movimiento ='5' and  md.secuencia_movimiento =1 ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
					}
					
					if(sle_fecha_inicio != null && !sle_fecha_inicio.equals("") && !sle_fecha_inicio.equals("null") ){
						log.info("Fecha de Inicio  fecha_origen = "+sle_fecha_inicio);
			    		 ls_sql.append(" and to_date(dc.fecha_registro,'DD/MM/YYYY') >= to_date(?,'DD/MM/YYYY') ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
					}
					
					if(sle_fecha_fin != null && !sle_fecha_fin.equals("") && !sle_fecha_fin.equals("null")){
						log.info("Fecha de Fin  fecha="+ sle_fecha_fin);
			    		 ls_sql.append(" and to_date(dc.fecha_registro,'DD/MM/YYYY') <= to_date(?,'DD/MM/YYYY') ");			    		 
					}
					
					if(codigo_tipo != null && !codigo_tipo.equals("0") && !codigo_tipo.equals("null")){
			    		 ls_sql.append(" and dc.codigo_tipo = ? ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
					}
					
					if(asunto_documento != null && !asunto_documento.trim().equals("") && !asunto_documento.equals("null")){
						asunto_documento = asunto_documento.trim();
						tokens=asunto_documento.split(" ");
						for(int i=0;i<tokens.length;i++){
							ls_sql.append(" and dc.asunto_documento ilike  '%"+ tokens[i] +"%' ");	
						} 
					}
					
					if(codigo_solicitud != null && !codigo_solicitud.equals("0") && !codigo_solicitud.equals("null")){
			    		 ls_sql.append(" and de.codigo_solicitud = ? ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
						}
					
					if(medio != null && !medio.equals("0") && !medio.equals("null")){
			    		 ls_sql.append(" and de.medio = ? ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
						}
					
					//log.info("Antes codigo_oficina: " + codigo_oficina);
					//log.info("Antes oficina: " + oficina);
					
					if(codigo_oficina_formulario != null && !codigo_oficina_formulario.equals("0") && !codigo_oficina_formulario.equals("null")){
			    		 ls_sql.append(" and md.codigo_oficina = ? ");
			    		 log.info("el ls_codigo_oficina: " + codigo_oficina_formulario);
					}else{
						log.info("La oficina ES : " + codigoOficinaDelUSuario);
						
						if(flag.equals("N")){
							log.info("Es un usuario normal");
							
							if(codigoOficinaDelUSuario.equals("58")){
								ls_sql.append("and ( md.codigo_oficina in (?,5)  or md.oficina_origen in (?,5)  or md.oficina_deriva in (?,5) )");
							}else{
								ls_sql.append("and ( md.codigo_oficina = ?  or md.oficina_origen = ?  or md.oficina_deriva = ? )");
							}
							
						}
						
						//log.info("el ls_codigo_oficina: " + ls_sql);
					}
					//log.info("Despues codigo_oficina: " + codigo_oficina);
					//log.info("Despues oficina: " + oficina);
					
					if(codigo_documento != null && !codigo_documento.equals("") && !codigo_documento.equals("null")){
			    		 ls_sql.append(" and md.codigo_documento =? ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(codigo_expediente != null && !codigo_expediente.equals("") && !codigo_expediente.equals("null")){
			    		 ls_sql.append(" and md.codigo_expediente = ? ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(firmadopor != null && !firmadopor.equals("") && !firmadopor.equals("null")){
			    		 ls_sql.append(" and de.firmadopor ilike '"+ firmadopor.toUpperCase() +"%' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(dirigido != null && !dirigido.equals("") && !procedencia.equals("null")){
			    		 ls_sql.append(" and dc.dirigido ilike '"+ dirigido +"%' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(numero_documento != null && !numero_documento.equals("") && !numero_documento.equals("null")){
						numero_documento = numero_documento.trim();
						tokens=numero_documento.split(" ");
						for(int i=0;i<tokens.length;i++){
							ls_sql.append(" and dc.numero_documento ilike '%"+ tokens[i] +"%' ");	
						}
			    		 
						}
					
					if(estado != null && !estado.equals("0") && !estado.equals("null")){
			    		 ls_sql.append(" and md.estado_movimiento = ? ");
			    		 //log.info("el estado: " + ls_sql);
						}
					
					if(doc_resp != null && !doc_resp.equals("") && !doc_resp.equals("null")){
			    		 ls_sql.append(" and md.doc_resp ilike '%"+ doc_resp.toUpperCase() +"%' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(codigo_motivo != null && !codigo_motivo.equals("0") && !codigo_motivo.equals("null")){
			    		 ls_sql.append(" and md.codigo_motivo = ? ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
						}
					
					//ls_sql.append(" and md.secuencia_movimiento = (select max(secuencia_movimiento) from tramite.movimientos_doc where codigo_documento=md.codigo_documento and codigo_oficina=?) ");
					ls_sql.append(" order by  md.codigo_documento desc,md.secuencia_movimiento desc");

					
					conn = obt.getConnection();
					pstmt = conn.prepareStatement(ls_sql.toString());
					
					if(sle_fecha != null && !sle_fecha.equals("") && !sle_fecha.equals("null")){contadorItem=contadorItem+1; pstmt.setString(contadorItem, sle_fecha);}
					if(sle_fecha_inicio != null && !sle_fecha_inicio.equals("") && !sle_fecha_inicio.equals("null") ){contadorItem=contadorItem+1; pstmt.setString(contadorItem, sle_fecha_inicio);} //pstmt.setString(contadorItem, funciones.cambiarFormato(sle_fecha_inicio));}
					if(sle_fecha_fin != null && !sle_fecha_fin.equals("") && !sle_fecha_fin.equals("null")){contadorItem=contadorItem+1; pstmt.setString(contadorItem, sle_fecha_fin);}
					if(codigo_tipo != null && !codigo_tipo.equals("0") && !codigo_tipo.equals("null")){	contadorItem=contadorItem+1; pstmt.setString(contadorItem, codigo_tipo);}
					if(codigo_solicitud != null && !codigo_solicitud.equals("0") && !codigo_solicitud.equals("null")){contadorItem=contadorItem+1; pstmt.setInt(contadorItem, Integer.parseInt(codigo_solicitud));}
					if(medio != null && !medio.equals("0") && !medio.equals("null")){contadorItem=contadorItem+1; pstmt.setString(contadorItem, medio);}
					
					if(codigo_oficina_formulario != null && !codigo_oficina_formulario.equals("0") && !codigo_oficina_formulario.equals("null")){contadorItem=contadorItem+1; pstmt.setInt(contadorItem, Integer.parseInt(codigo_oficina_formulario));}
					else{
						if(flag.equals("N")){
							contadorItem=contadorItem+1; pstmt.setInt(contadorItem, Integer.parseInt(codigoOficinaDelUSuario));
							contadorItem=contadorItem+1; pstmt.setInt(contadorItem, Integer.parseInt(codigoOficinaDelUSuario));
							contadorItem=contadorItem+1; pstmt.setInt(contadorItem, Integer.parseInt(codigoOficinaDelUSuario));
						}
					}
					
					if(codigo_documento != null && !codigo_documento.equals("") && !codigo_documento.equals("null")){contadorItem=contadorItem+1; pstmt.setInt(contadorItem, Integer.parseInt(codigo_documento));}
					if(codigo_expediente != null && !codigo_expediente.equals("") && !codigo_expediente.equals("null")){contadorItem=contadorItem+1; pstmt.setInt(contadorItem, Integer.parseInt(codigo_expediente));}
					if(estado != null && !estado.equals("0") && !estado.equals("null")){contadorItem=contadorItem+1; pstmt.setString(contadorItem, estado);}
					if(codigo_motivo != null && !codigo_motivo.equals("0") && !codigo_motivo.equals("null")){contadorItem=contadorItem+1; pstmt.setInt(contadorItem, Integer.parseInt(codigo_motivo));}
					
					/**contadorItem=contadorItem+1;
					pstmt.setInt(contadorItem, Integer.parseInt(codigoOficinaDelUSuario));**/
					
					log.info(pstmt);
					rs = pstmt.executeQuery();
			    	 
			    	log.info("---------------------Antes del While....");
			    	 /***
			    	  * nuevo while
			    	  */
			    	String ls_ant_codigo_documento="";
			    	int contador=0;

			    	 while (rs.next()) { 
							Hashtable objListaDoc = new Hashtable();
							StringBuilder constantea = new StringBuilder("");
							StringBuilder constanteb = new StringBuilder("");
							contador=contador+1;
							
							constantea.append("<A id='A1' target='_parent' href='ListaDocumentos.do?tipo=detalleseg&operacion=S&codigo_documento=");
							constantea.append(rs.getString("codigo_documento").trim());
							constantea.append("&codigo_expediente=");
							constantea.append(rs.getString("codigo_expediente").trim());
							constantea.append("&numero_documento=0&oficina_origen=");
							constantea.append(rs.getString("oficina_origen").trim());
							constantea.append("&oficina_deriva=");
							constantea.append(rs.getString("oficina_deriva").trim());
							constantea.append("&secuencia_movimiento=");
							constantea.append(rs.getString("secuencia_movimiento").trim());
							constantea.append("&fecha_rpta=");
							constantea.append(rs.getString("fecha_rpta"));
							constantea.append("&tiposegumiento=R'<font color='#0000FF'>");
							
							constanteb.append("</font> </A>");
							
							if(contador==1){						
								objListaDoc.put("codigo_documento", constantea+rs.getString("codigo_documento").trim()+constanteb);
								objListaDoc.put("codigo_expediente", constantea+rs.getString("codigo_expediente").trim()+constanteb);
								objListaDoc.put("numero_documento", constantea+rs.getString("numero_documento").trim()+constanteb);
								
								/***objListaDoc.put("oficina_origen", constantea+funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_origen").trim())+constanteb);
								objListaDoc.put("oficina_deriva", constantea+funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_deriva").trim())+constanteb);**/
								
								objListaDoc.put("oficina_origen", constantea+rs.getString("nombre_oficina_origen").trim()+constanteb);
								objListaDoc.put("oficina_deriva", constantea+rs.getString("nombre_oficina_deriva").trim()+constanteb);

								
								if(rs.getString("estado_movimiento").trim().equals("5")){
									objListaDoc.put("estado_movimiento", "<FONT color='#996633'>Derivado</FONT>");	
								}
								else if(rs.getString("estado_movimiento").trim().equals("2")){
									objListaDoc.put("estado_movimiento", "<FONT color='#FF0000 '>Por Recibir</FONT>");	
								}
								else{
									//objListaDoc.put("estado_movimiento", "<FONT color='#00CC00'>"+funciones.of_nombre_estado(cnx, ls_estado_mov)+"</FONT>");
									objListaDoc.put("estado_movimiento", "<FONT color='#00CC00'>"+rs.getString("estado_expediente").trim()+"</FONT>");
								}
								
								
								objListaDoc.put("fecha_registro", constantea+rs.getString("fecha_registro")+constanteb);
								objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
								objListaDoc.put("firmadopor",constantea+rs.getString("desc_origen").trim()+" - " +rs.getString("firmadopor").trim()+constanteb);

								/*
								 * ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
								 * if(ls_num_upload.equals("0")){
									objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
								}else {
									objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
									"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
								}*/
								
								if(rs.getInt("numupload")==0){
									objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
								}else {
									objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
									"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
								}
								
								/***
								 * PARA REPORTE
								 */
								
								objListaDoc.put("codigo_documento_reporte", rs.getString("codigo_documento").trim());
								objListaDoc.put("codigo_expediente_reporte", rs.getString("codigo_expediente").trim());
								objListaDoc.put("fecha_registro_reporte",rs.getString("fecha_registro"));
								objListaDoc.put("numero_documento_reporte", rs.getString("numero_documento").trim());
								//objListaDoc.put("codigo_oficina_reporte", funciones.of_nombre_corto_oficina(cnx, rs.getString("codigo_oficina").trim()));
								objListaDoc.put("codigo_oficina_reporte", rs.getString("descripcion_oficina").trim());
								objListaDoc.put("oficina_origen_reporte",rs.getString("nombre_oficina_origen").trim());
								objListaDoc.put("oficina_deriva_reporte",rs.getString("nombre_oficina_deriva").trim());									
								objListaDoc.put("observa_movimiento_reporte",rs.getString("observa_movimiento").trim());
								objListaDoc.put("estado_movimiento_reporte",rs.getString("estado_expediente").trim());
								objListaDoc.put("fecha_movimiento_reporte", rs.getString("fecha_movimiento"));
								objListaDoc.put("asunto_documento_reporte", rs.getString("asunto_documento"));	
								objListaDoc.put("naturaleza_documento_reporte", rs.getString("naturaleza_documento_report"));
								objListaDoc.put("desc_origen_reporte", rs.getString("desc_origen").trim());
								objListaDoc.put("firmadopor_reporte",rs.getString("firmadopor").trim());
								
								ListaMesaPartes.add(objListaDoc);
								ls_ant_codigo_documento=rs.getString("codigo_documento").trim();
							}
							
							if(contador>1){
								if(!ls_ant_codigo_documento.equals(rs.getString("codigo_documento").trim())){
									objListaDoc.put("codigo_documento", constantea+rs.getString("codigo_documento").trim()+constanteb);
									objListaDoc.put("codigo_expediente", constantea+rs.getString("codigo_expediente").trim()+constanteb);
									objListaDoc.put("numero_documento", constantea+rs.getString("numero_documento").trim()+constanteb);
									
									/***objListaDoc.put("oficina_origen", constantea+funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_origen").trim())+constanteb);
									objListaDoc.put("oficina_deriva", constantea+funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_deriva").trim())+constanteb);**/
									
									objListaDoc.put("oficina_origen", constantea+rs.getString("nombre_oficina_origen").trim()+constanteb);
									objListaDoc.put("oficina_deriva", constantea+rs.getString("nombre_oficina_deriva").trim()+constanteb);

									
									if(rs.getString("estado_movimiento").trim().equals("5")){
										objListaDoc.put("estado_movimiento", "<FONT color='#996633'>Derivado</FONT>");	
									}
									else if(rs.getString("estado_movimiento").trim().equals("2")){
										objListaDoc.put("estado_movimiento", "<FONT color='#FF0000 '>Por Recibir</FONT>");	
									}
									else{
										//objListaDoc.put("estado_movimiento", "<FONT color='#00CC00'>"+funciones.of_nombre_estado(cnx, ls_estado_mov)+"</FONT>");
										objListaDoc.put("estado_movimiento", "<FONT color='#00CC00'>"+rs.getString("estado_expediente").trim()+"</FONT>");
									}
									
									
									objListaDoc.put("fecha_registro", constantea+rs.getString("fecha_registro")+constanteb);
									objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
									objListaDoc.put("firmadopor",constantea+rs.getString("desc_origen").trim()+" - " +rs.getString("firmadopor").trim()+constanteb);

									/*
									 * ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
									 * if(ls_num_upload.equals("0")){
										objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
									}else {
										objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
										"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
									}*/
									
									if(rs.getInt("numupload")==0){
										objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
									}else {
										objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
										"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
									}
									
									/***
									 * PARA REPORTE
									 */
									
									objListaDoc.put("codigo_documento_reporte", rs.getString("codigo_documento").trim());
									objListaDoc.put("codigo_expediente_reporte", rs.getString("codigo_expediente").trim());
									objListaDoc.put("fecha_registro_reporte",rs.getString("fecha_registro"));
									objListaDoc.put("numero_documento_reporte", rs.getString("numero_documento").trim());
									//objListaDoc.put("codigo_oficina_reporte", funciones.of_nombre_corto_oficina(cnx, rs.getString("codigo_oficina").trim()));
									objListaDoc.put("codigo_oficina_reporte", rs.getString("descripcion_oficina").trim());
									objListaDoc.put("oficina_origen_reporte",rs.getString("nombre_oficina_origen").trim());
									objListaDoc.put("oficina_deriva_reporte",rs.getString("nombre_oficina_deriva").trim());									
									objListaDoc.put("observa_movimiento_reporte",rs.getString("observa_movimiento").trim());
									objListaDoc.put("estado_movimiento_reporte",rs.getString("estado_expediente").trim());
									objListaDoc.put("fecha_movimiento_reporte", rs.getString("fecha_movimiento"));
									objListaDoc.put("asunto_documento_reporte", rs.getString("asunto_documento"));	
									objListaDoc.put("naturaleza_documento_reporte", rs.getString("naturaleza_documento_report"));
									objListaDoc.put("desc_origen_reporte", rs.getString("desc_origen").trim());
									objListaDoc.put("firmadopor_reporte",rs.getString("firmadopor").trim());
									
									ListaMesaPartes.add(objListaDoc);
								}
								ls_ant_codigo_documento=rs.getString("codigo_documento").trim();
							}
							/**
							 * fin del while
							 */
						}
			
			    	obt.cerrar_conexion(conn, rs);
			 		pstmt.close();
				
			} catch (SQLException e){
				 e.printStackTrace();
				 obt.cerrar_conexion(conn);
			}
			return ListaMesaPartes;
	                
			}

	 public Collection of_busca_documentos_tramite(Connection cnx,String codigoOficinaDelUSuario,String procedencia,
			 String sle_fecha,String medio,String codigo_tipo,String codigo_oficina_formulario,String codigo_solicitud,
			 String codigo_documento,String codigo_expediente,String firmadopor,String dirigido
			 ,String estado,String numero_documento,String doc_resp,String asunto_documento
			 ,String sle_fecha_inicio,String sle_fecha_fin,String codigo_motivo,String flag,String observacion) throws Exception{
			
			log.info("ENTRO A of_busca_documentos_tramite");
			Collection ListaMesaPartes = new ArrayList();
			String tokens[]=null;
			int contadorItem=0;
			int contadorLista=1;
			
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			
			Connection conn = null;
			ObtieneConexion obt=new ObtieneConexion();

			Funciones funciones=new Funciones();

			try 
			{	
				
				StringBuilder ls_sql = new StringBuilder("select e.estado_expediente, ");
				
				ls_sql.append(" md.codigo_documento,md.secuencia_movimiento,md.codigo_oficina,md.fecha_movimiento");
					ls_sql.append(",md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.ultimo_usuario,");
					ls_sql.append("md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.codigo_recepcion,md.fecha_rpta,");
					ls_sql.append("(select tp.descripcion_tipo  from  tramite.tipo_documento tp where tp.codigo_tipo=dc.codigo_tipo) as descripcion_tipo, ");
					ls_sql.append(" dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.fecha_registro,");
					ls_sql.append("(substr(dc.fecha_registro,7,10) || substr(dc.fecha_registro,4,2) || substr(dc.fecha_registro,0,3)) as fecha_consulta_reg,");
					ls_sql.append("dc.hora_registro,dc.codigo_tipo,de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,");
					ls_sql.append("de.remitente,de.destinatario,de.codigo_solicitud,de.firmadopor,de.medio,of.codigo_oficina,");
					ls_sql.append(" of.descripcion_oficina,");
					ls_sql.append(" (select of_a.descripcion_oficina from  tramite.oficinas of_a where de.destino_documento=of_a.codigo_oficina) as descripcion_destino,");
					ls_sql.append(" pr.codigo_personal,");
					ls_sql.append(" pr.nombre_personal,");
					ls_sql.append(" md.observa_movimiento,(select count(tdetu.codigo_documento) from tramite.tbl_det_upload  tdetu  where tdetu.codigo_documento = md.codigo_documento) as numupload, ");
				
				ls_sql.append("(select tedoc.estado_expediente from tramite.estados_doc tedoc where md.estado_movimiento=tedoc.codigo_estado) as estado_expediente, ");
				ls_sql.append("(select tofi.siglas_oficina  from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_origen) as nombre_oficina_origen,");
				ls_sql.append("(select tofi.siglas_oficina  from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_deriva) as nombre_oficina_deriva, ");
				ls_sql.append("(case  dc.naturaleza_documento when 'I' then 'Interno' when 'E' then 'Externo' else 'None' end ) as naturaleza_documento_report  ");
				
				ls_sql.append(" from tramite.movimientos_doc md ");

				ls_sql.append(" left join tramite.estados_doc e on md.estado_movimiento=e.codigo_estado ");
				ls_sql.append(" left join tramite.documento dc on dc.codigo_documento=md.codigo_documento ");
				ls_sql.append(" left join tramite.doc_entrada de  on md.codigo_documento=de.codigo_documento ");
				ls_sql.append(" left join tramite.oficinas of  on md.codigo_oficina=of.codigo_oficina ");
				ls_sql.append(" left join tramite.personal pr  on de.destinatario=pr.codigo_personal ");
				
				
				ls_sql.append(" where md.codigo_oficina = 2 ");
				ls_sql.append(" and md.estado_movimiento=3 ");
				ls_sql.append(" and md.codigo_fondo like '01'  and  md.estado_movimiento<>'A' ");
				ls_sql.append(" order by md.codigo_documento desc;");
	
				conn = obt.getConnection();
				pstmt = conn.prepareStatement(ls_sql.toString());
				
									
				log.info(pstmt);
				rs = pstmt.executeQuery();
		    	 

			    	 while (rs.next()) { 
							Hashtable objListaDoc = new Hashtable();
							StringBuilder constantea = new StringBuilder("");
							StringBuilder constanteb = new StringBuilder("");
							
							constantea.append("<A id='A1' target='_parent' href='ListaDocumentos.do?tipo=detalleseg&operacion=S&codigo_documento=");
							constantea.append(rs.getString("codigo_documento").trim());
							constantea.append("&codigo_expediente=");
							constantea.append(rs.getString("codigo_expediente").trim());
							constantea.append("&numero_documento=0&oficina_origen=");
							constantea.append(rs.getString("oficina_origen").trim());
							constantea.append("&oficina_deriva=");
							constantea.append(rs.getString("oficina_deriva").trim());
							constantea.append("&secuencia_movimiento=");
							constantea.append(rs.getString("secuencia_movimiento").trim());
							constantea.append("&fecha_rpta=");
							constantea.append(rs.getString("fecha_rpta"));
							constantea.append("&tiposegumiento=R'<font color='#0000FF'>");
							
							constanteb.append("</font> </A>");
							
					
							objListaDoc.put("codigo_documento", constantea+rs.getString("codigo_documento").trim()+constanteb);
							objListaDoc.put("codigo_expediente", constantea+rs.getString("codigo_expediente").trim()+constanteb);
							
							objListaDoc.put("numero_documento", constantea+rs.getString("numero_documento").trim()+constanteb);
							objListaDoc.put("oficina_origen", constantea+rs.getString("nombre_oficina_origen").trim()+constanteb);
							objListaDoc.put("oficina_deriva", constantea+rs.getString("nombre_oficina_deriva").trim()+constanteb);

								
								if(rs.getString("estado_movimiento").trim().equals("5")){
									objListaDoc.put("estado_movimiento", "<FONT color='#996633'>Derivado</FONT>");	
								}
								else if(rs.getString("estado_movimiento").trim().equals("2")){
									objListaDoc.put("estado_movimiento", "<FONT color='#FF0000 '>Por Recibir</FONT>");	
								}
								else{
									
									objListaDoc.put("estado_movimiento", "<FONT color='#00CC00'>"+rs.getString("estado_expediente").trim()+"</FONT>");
								}
								
								
								objListaDoc.put("fecha_registro", constantea+rs.getString("fecha_registro")+constanteb);
								objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
								objListaDoc.put("firmadopor",constantea+rs.getString("desc_origen").trim()+" - " +rs.getString("firmadopor").trim()+constanteb);

								
								
								if(rs.getInt("numupload")==0){
									objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
								}else {
									objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
									"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
								}
								
								/***
								 * PARA REPORTE
								 */
								
								objListaDoc.put("codigo_documento_reporte", rs.getString("codigo_documento").trim());
								objListaDoc.put("codigo_expediente_reporte", rs.getString("codigo_expediente").trim());
								
								
								//objListaDoc.put("fecha_registro_reporte",rs.getString("fecha_registro"));
								objListaDoc.put("fecha_registro_reporte",rs.getString("fecha_movimiento"));
								
								
								
								objListaDoc.put("numero_documento_reporte", rs.getString("numero_documento").trim());
								
								objListaDoc.put("codigo_oficina_reporte", rs.getString("descripcion_oficina").trim());
								objListaDoc.put("oficina_origen_reporte",rs.getString("nombre_oficina_origen").trim());
								objListaDoc.put("oficina_deriva_reporte",rs.getString("nombre_oficina_deriva").trim());									
								objListaDoc.put("observa_movimiento_reporte",rs.getString("observa_movimiento").trim());
								objListaDoc.put("estado_movimiento_reporte",rs.getString("estado_expediente").trim());
								objListaDoc.put("fecha_movimiento_reporte", rs.getString("fecha_movimiento"));
								objListaDoc.put("asunto_documento_reporte", rs.getString("asunto_documento"));	
								objListaDoc.put("naturaleza_documento_reporte", rs.getString("naturaleza_documento_report"));
								objListaDoc.put("desc_origen_reporte", rs.getString("desc_origen").trim());
								objListaDoc.put("firmadopor_reporte",rs.getString("firmadopor").trim());
								
								ListaMesaPartes.add(objListaDoc);
								
						}
			
			    	obt.cerrar_conexion(conn, rs);
			 		pstmt.close();
				
			} catch (SQLException e){
				 e.printStackTrace();
				 obt.cerrar_conexion(conn);
			}
			return ListaMesaPartes;
	                
			}
	 public Collection  lista_documentos_archivar(Connection cnx,String oficina,String codigo_doc) throws Exception {
			
	        log.info("ENTRO A  Lista archivar documentos"+codigo_doc);
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	String ls_correla= "";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	int li_retorno=0;
	    	
	   
	    	
	    Date fecha_recep = new Date(); // fecha y hora locales 
		SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
		SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); 
		
		
	        try {	
	        	
	        	
	        	
	        	ls_sql="select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	        			"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	        			"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.codigo_recepcion," +
	        			"md.doc_deriva,md.observa_movimiento,md.codigo_motivo," +
	        			"md.fecha_rpta,tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento," +
	        			"dc.asunto_documento,dc.fecha_registro,dc.hora_registro,dc.codigo_tipo,dc.numero_documento_ant," +
	        			"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	        			"de.destinatario,de.codigo_solicitud,de.firmadopor,de.medio,of.codigo_oficina," +
	        			"of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino," +
	        			"pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc md," +
	        			"tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	        			"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where " +
	        			"tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento" +
	        			" and dc.codigo_documento=de.codigo_documento and" +
	        			" md.codigo_documento=de.codigo_documento and de.destinatario=pr.codigo_personal" +
	        			" and md.codigo_oficina=of.codigo_oficina  " +
	        			" and ( md.estado_movimiento in (3,7) " +
	        			" and ( de.destino_documento=of_a.codigo_oficina and md.codigo_fondo like '01'" +
	        			" and md.secuencia_movimiento =(select max(secuencia_movimiento) from" +
	        			" tramite.movimientos_doc where codigo_documento=md.codigo_documento and codigo_oficina =" + "'" + oficina + "')"  +
	        			" and md.codigo_oficina =" + "'" + oficina + "' ))";
	        	
	        	if(codigo_doc!=null && !codigo_doc.trim().equals("")){
	        		ls_sql=ls_sql+" and md.codigo_documento = '"+codigo_doc+"' ";
	        	}
	        	
	        	/*ls_sql=ls_sql + " UNION select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
    			"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
    			"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.codigo_recepcion," +
    			"md.doc_deriva,md.observa_movimiento,md.codigo_motivo," +
    			"md.fecha_rpta,tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento," +
    			"dc.asunto_documento,dc.fecha_registro,dc.hora_registro,dc.codigo_tipo,dc.numero_documento_ant," +
    			"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
    			"de.destinatario,de.codigo_solicitud,de.firmadopor,de.medio,of.codigo_oficina," +
    			"of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino," +
    			"pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc md," +
    			"tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
    			"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where " +
    			"tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento" +
    			" and dc.codigo_documento=de.codigo_documento and" +
    			" md.codigo_documento=de.codigo_documento and de.destinatario=pr.codigo_personal" +
    			" and md.codigo_oficina=of.codigo_oficina  " +
    			" and md.estado_movimiento = 4 ";*/
	        	
	        	/*if(codigo_doc!=null && !codigo_doc.trim().equals("")){
	        		ls_sql=ls_sql+" and md.codigo_documento = '"+codigo_doc+"' ";
	        	}*/
	        	
	        	ls_sql=ls_sql+" order by codigo_documento desc limit 30 offset 0";
	  
	        		log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	 	    		 String ls_codigo_documento="";
			    	 String ls_codigo_expediente="";
			    	 String ls_codigo_recepcion="";
			    	 String ls_codigo_expediente_ant="";
			    	 String ls_codigo_documento_ant="";
			    	 String ls_secuencia_movimiento="";
	 	    		 String ls_ant_codigo_recepcion="";
			    	 String ls_ant_codigo_documento="";
			    	 String ls_ant_codigo_expediente="";
			    	 String ls_ant_secuencia_movimiento="";
			    	 String ls_naturaleza_documento="";
			    	 int contador=0;	    		 

	    		Funciones funciones=new Funciones();
				while (rs.next()) { 
					
					contador=contador+1;
					Hashtable objListaDoc = new Hashtable();
					ls_codigo_recepcion=rs.getString("codigo_recepcion").trim();
					ls_codigo_documento=rs.getString("codigo_documento").trim();
					ls_codigo_expediente=rs.getString("codigo_expediente").trim();
					ls_secuencia_movimiento=rs.getString("secuencia_movimiento").trim();

					if(contador==1){
					String seleccionar = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">Seleccionar</label>";
					
					ls_codigo_expediente_ant = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
					
					ls_codigo_documento_ant = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("codigo_documento")+"</label>";
					
					String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("numero_documento")+"</label>";
					
					String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
					
					objListaDoc.put("ACTION", seleccionar);
					objListaDoc.put("codigo_documento", ls_codigo_documento_ant);
					objListaDoc.put("codigo_expediente", ls_codigo_expediente_ant);
					objListaDoc.put("numero_documento", ls_numero_documento);
					objListaDoc.put("oficina_origen", ls_oficina_origen);
					objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
					objListaDoc.put("estado_movimiento", funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim()));
					objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
					objListaDoc.put("hora", rs.getString("hora_movimiento"));
					objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
					objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
					
					objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
					objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
					//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
					objListaDoc.put("naturaleza_documento", rs.getString("naturaleza_documento"));
					
					ListaMesaPartes.add(objListaDoc);
					
					ls_ant_codigo_recepcion=ls_codigo_recepcion;
					ls_ant_codigo_documento=ls_codigo_documento;
					ls_ant_codigo_expediente=ls_codigo_expediente;
					ls_ant_secuencia_movimiento=ls_secuencia_movimiento;

					}
					else if(contador>1){
						//log.info("Si el contador es mayor a cero es....: ");
						
						if(ls_ant_codigo_documento.equals(ls_codigo_documento)){
							
						}else {
							
							String seleccionar = "<label style='cursor: hand;' align='center' " 
								+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">Seleccionar</label>";
								
								ls_codigo_expediente_ant = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
								
								ls_codigo_documento_ant = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("codigo_documento")+"</label>";
								
								String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("numero_documento")+"</label>";
								
								String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
								
								objListaDoc.put("ACTION", seleccionar);
								objListaDoc.put("codigo_documento", ls_codigo_documento_ant);
								objListaDoc.put("codigo_expediente", ls_codigo_expediente_ant);
								objListaDoc.put("numero_documento", ls_numero_documento);
								objListaDoc.put("oficina_origen", ls_oficina_origen);
								objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
								objListaDoc.put("estado_movimiento", funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim()));
								objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
								objListaDoc.put("hora", rs.getString("hora_movimiento"));
								objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
								objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
								
								objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
								objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
								//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
								objListaDoc.put("naturaleza_documento", rs.getString("naturaleza_documento"));
								
								ListaMesaPartes.add(objListaDoc);
	
						}
						ls_ant_codigo_recepcion=ls_codigo_recepcion;
						ls_ant_codigo_documento=ls_codigo_documento;
						ls_ant_codigo_expediente=ls_codigo_expediente;
						ls_ant_secuencia_movimiento=ls_secuencia_movimiento;

						}
				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection  lista_documentos_anular(Connection cnx,String oficina,String codigo_doc,String document) throws Exception {
			
	        //log.info("ENTRO A  Lista archivar documentos");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			ResultSet rs = null;
			PreparedStatement pstmt = null;
			
			
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	String ls_correla= "";
	    	
	    	String ls_valor  = "";
	    	//String ls_sql ="";
	    	int li_retorno=0;
	    	
	    /*	//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    Date fecha_recep = new Date(); // fecha y hora locales 
		SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
		SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); 
		/*//log.info("la fecha es.."+ formatoFecha.format(fecha_recep) ); 
		//log.info("la hora es.."+ formatoHora.format(fecha_recep) );*/ 
	    
		
	        try {	
	        	
	        	
	        	
	        	StringBuffer ls_sql=new StringBuffer("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
	        			"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
	        			"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.codigo_recepcion," +
	        			"md.doc_deriva,md.observa_movimiento,md.codigo_motivo," +
	        			"md.fecha_rpta,tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento," +
	        			"dc.asunto_documento,dc.fecha_registro,dc.hora_registro,dc.codigo_tipo,dc.numero_documento_ant," +
	        			"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
	        			"de.destinatario,de.codigo_solicitud,de.firmadopor,de.medio,of.codigo_oficina," +
	        			"of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino," +
	        			"pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc md," +
	        			"tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de,");
	        			
	        			if(document.equals("SI")){
	        				ls_sql.append("tramite.documento_tipo_documento_interno di,"+
	        				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where " +
		    	        			"tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento" +
		    	        			" and dc.codigo_documento=de.codigo_documento" +
		    	        			" and dc.codigo_documento=di.codigo_documento" +
		    	        			" and md.codigo_documento=de.codigo_documento and de.destinatario=pr.codigo_personal" +
		    	        			" and md.codigo_oficina=of.codigo_oficina and md.estado_movimiento in (2,3) and " +
		    	        			" de.destino_documento=of_a.codigo_oficina and md.codigo_fondo like '01'" +
		    	        			" and md.secuencia_movimiento =(select max(secuencia_movimiento) from" +
		    	        			" tramite.movimientos_doc where codigo_documento=md.codigo_documento and oficina_origen =? )"  +
		    	        			" and md.oficina_origen =? ");
	        				        				
	        			}else{
		        			ls_sql.append("tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where " +
		    	        			"tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento" +
		    	        			" and dc.codigo_documento=de.codigo_documento" +
		    	        			" and md.codigo_documento=de.codigo_documento and de.destinatario=pr.codigo_personal" +
		    	        			" and md.codigo_oficina=of.codigo_oficina and md.estado_movimiento in (2,3) and " +
		    	        			" de.destino_documento=of_a.codigo_oficina and md.codigo_fondo like '01'" +
		    	        			" and md.secuencia_movimiento =(select max(secuencia_movimiento) from" +
		    	        			" tramite.movimientos_doc where codigo_documento=md.codigo_documento and oficina_origen =? )"  +
		    	        			" and md.oficina_origen =? ");
	        			}
	        			

	        	
	        	if(codigo_doc!=null && !codigo_doc.trim().equals("")){
	        		ls_sql.append(" and md.codigo_documento = ? ");
	        	}
	        	ls_sql.append(" order by md.codigo_documento desc limit 30 offset 0; ");
	  
	        	 pstmt = con.prepareStatement(ls_sql.toString());
		    	 pstmt.setInt(1, Integer.parseInt(oficina));
		    	 pstmt.setInt(2, Integer.parseInt(oficina));
		    	 if(codigo_doc!=null && !codigo_doc.trim().equals("")){
		    		 pstmt.setInt(3, Integer.parseInt(codigo_doc));
		    	 }
		    	
		    	 log.info("sql "+pstmt);
		    	 rs=pstmt.executeQuery();
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	 	    		 String ls_codigo_documento="";
			    	 String ls_codigo_expediente="";
			    	 String ls_codigo_recepcion="";
			    	 String ls_codigo_expediente_ant="";
			    	 String ls_codigo_documento_ant="";
			    	 String ls_secuencia_movimiento="";
	 	    		 String ls_ant_codigo_recepcion="";
			    	 String ls_ant_codigo_documento="";
			    	 String ls_ant_codigo_expediente="";
			    	 String ls_ant_secuencia_movimiento="";
			    	 String ls_naturaleza_documento="";
			    	 int contador=0;	    		 

	    		Funciones funciones=new Funciones();
				while ( rs.next() ) { 
					
					
					contador=contador+1;
					Hashtable objListaDoc = new Hashtable();
					ls_codigo_recepcion=rs.getString("codigo_recepcion").trim();
					ls_codigo_documento=rs.getString("codigo_documento").trim();
					ls_codigo_expediente=rs.getString("codigo_expediente").trim();
					ls_secuencia_movimiento=rs.getString("secuencia_movimiento").trim();

					if(contador==1){
					String seleccionar = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
			        + rs.getString("codigo_expediente") + "'"+ "," 
			        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
			        + "'"+ rs.getString("numero_documento") + "'"+ "," 
			        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
			        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
			        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
			        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
			        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
			        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
			        + "'"+ rs.getString("naturaleza_documento") + "'"
			        + ");\" " + ">Seleccionar</label>";
					
					ls_codigo_expediente_ant = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
					
					ls_codigo_documento_ant = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ rs.getString("codigo_documento")+"</label>";
					
					String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ rs.getString("numero_documento")+"</label>";
					
					String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"
				        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
					
					objListaDoc.put("ACTION", seleccionar);
					objListaDoc.put("codigo_documento", ls_codigo_documento_ant);
					objListaDoc.put("codigo_expediente", ls_codigo_expediente_ant);
					objListaDoc.put("numero_documento", ls_numero_documento);
					objListaDoc.put("oficina_origen", ls_oficina_origen);
					objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
					objListaDoc.put("estado_movimiento", funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim()));
					objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
					objListaDoc.put("hora", rs.getString("hora_movimiento"));
					objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
					objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
					
					objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
					objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
					//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
					objListaDoc.put("naturaleza_documento", rs.getString("naturaleza_documento"));
					
					ListaMesaPartes.add(objListaDoc);
					
					ls_ant_codigo_recepcion=ls_codigo_recepcion;
					ls_ant_codigo_documento=ls_codigo_documento;
					ls_ant_codigo_expediente=ls_codigo_expediente;
					ls_ant_secuencia_movimiento=ls_secuencia_movimiento;

					}
					else if(contador>1){
						//log.info("Si el contador es mayor a cero es....: ");
						
						if(ls_ant_codigo_documento.equals(ls_codigo_documento)){
							//log.info("Los codigos son iguales me imprime una lista ji ji....: ");
							
							
							
							//log.info("--------------------------------------------------- ");
						}else {
							
							String seleccionar = "<label style='cursor: hand;' align='center' " 
								+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
						        + rs.getString("codigo_expediente") + "'"+ "," 
						        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
						        + "'"+ rs.getString("numero_documento") + "'"+ "," 
						        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
						        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
						        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
						        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
						        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
						        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
						        + "'"+ rs.getString("naturaleza_documento") + "'"
						        + ");\" " + ">Seleccionar</label>";
								
								ls_codigo_expediente_ant = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
							        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
								
								ls_codigo_documento_ant = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
							        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ rs.getString("codigo_documento")+"</label>";
								
								String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
							        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ rs.getString("numero_documento")+"</label>";
								
								String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
							        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"
							        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
								
								objListaDoc.put("ACTION", seleccionar);
								objListaDoc.put("codigo_documento", ls_codigo_documento_ant);
								objListaDoc.put("codigo_expediente", ls_codigo_expediente_ant);
								objListaDoc.put("numero_documento", ls_numero_documento);
								objListaDoc.put("oficina_origen", ls_oficina_origen);
								objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
								objListaDoc.put("estado_movimiento", funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim()));
								objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
								objListaDoc.put("hora", rs.getString("hora_movimiento"));
								objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
								objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
								
								objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
								objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
								//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
								objListaDoc.put("naturaleza_documento", rs.getString("naturaleza_documento"));
								
								ListaMesaPartes.add(objListaDoc);
	
						}
						ls_ant_codigo_recepcion=ls_codigo_recepcion;
						ls_ant_codigo_documento=ls_codigo_documento;
						ls_ant_codigo_expediente=ls_codigo_expediente;
						ls_ant_secuencia_movimiento=ls_secuencia_movimiento;

						}
				}	
	            
				x.cerrar_conexion(con,rs);
		    	pstmt.close();
	        	
	            
	        } catch (SQLException e) {
	        	x.cerrar_conexion(con);
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public void of_anular(Connection cnx,String ls_documento,String ls_oficina,
			 String ls_secuencia,String ls_observacion,String estado_movimiento) {
	    	
	     //   obtenermos el valor maximo...
	    	//log.info("dentro de Anular documento......." );
	    	int    li_retorno;
	    	int    li_parcial = 0 ;
	    	String ls_correlativo=null;
	    	String ls_ano=null;
	    	String ls_mes=null;
	    	String ls_dia=null;
	    	String fecha_consulta=null;
	    	int ls_estado=0;
	    	String codigo_fondo="01";
	    	li_retorno = 1;

			
	    	String ls_sql = "";
	    	
			ObtieneConexion obt=new ObtieneConexion();
	    	Connection conn = obt.getConnection();
			PreparedStatement pstmt = null;

			
	    	try{
	    			
	    			ls_observacion=(ls_observacion==null)? "":ls_observacion.trim();
		    		
		    		log.info("Para anular documento estado " + estado_movimiento);
		    		if(Integer.parseInt(estado_movimiento.trim())==3 || Integer.parseInt(estado_movimiento.trim())==2){
		    			
	    			ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = ? ,observa_movimiento =?  " +
	    					"where codigo_fondo=?  and oficina_origen=?  and codigo_documento=?  and secuencia_movimiento=? ";
		        		
	    			
	    			log.info("query de actualizacion:   " +ls_sql);
	    			pstmt = conn.prepareStatement(ls_sql);

	    			pstmt.setString(1, "9");
	    			pstmt.setString(2, ls_observacion);
	    			pstmt.setString(3, "01");
	    			pstmt.setInt(4, Integer.parseInt(ls_oficina));
	    			pstmt.setInt(5, Integer.parseInt(ls_documento));
	    			pstmt.setInt(6, Integer.parseInt(ls_secuencia));
	    			
	    			pstmt.executeUpdate();
					    	 
			    	ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
	    	 		" codigo_fondo=?  and oficina_origen=?  and codigo_documento=?  and secuencia_movimiento=? "+
	    	 		" )";
			    	 
			    	pstmt = conn.prepareStatement(ls_sql);

	    			pstmt.setString(1, "01");
	    			pstmt.setInt(2, Integer.parseInt(ls_oficina));
	    			pstmt.setInt(3, Integer.parseInt(ls_documento));
	    			pstmt.setInt(4, Integer.parseInt(ls_secuencia));
	    				    			
	    			pstmt.executeUpdate();
			    	 
			    	 /***
			    	  * PARA ACTUALIZAR LA TABLA DOCUMENTO INTERNO
			    	  */
			    	 ls_sql = "UPDATE tramite.documento_tipo_documento_interno SET codigo_estado_documento =?, observacion =?  " +
			    	 		"where  codigo_oficina_pertenece= ?  and codigo_documento=?  and secuencia_movimiento_destino=? ";
		        		
		        		log.info("El ls_sql update PARA ACTUALIZAR LA TABLA DOCUMENTO INTERNO " + ls_sql);
		        		pstmt = conn.prepareStatement(ls_sql);

		    			pstmt.setInt(1, 6);
		    			pstmt.setString(2, ls_observacion);
		    			pstmt.setInt(3, Integer.parseInt(ls_oficina));
		    			pstmt.setInt(4, Integer.parseInt(ls_documento));
		    			pstmt.setInt(5, Integer.parseInt(ls_secuencia));
		    				    			
		    			pstmt.executeUpdate();
					  /***
					   * FIN
					   */
					    	 
		    		}
		    		
		    		
		    		if(Integer.parseInt(estado_movimiento.trim())==9){
		    			log.info("Para desanular documento");
		    			
		    			ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = ?, observa_movimiento =? " +
		    					" where codigo_fondo=?   and oficina_origen =?  and codigo_documento=?  and secuencia_movimiento=? ";
		        		
		    			pstmt = conn.prepareStatement(ls_sql);

		    			pstmt.setString(1, "3");
		    			pstmt.setString(2, ls_observacion);
		    			pstmt.setString(3, "01");
		    			pstmt.setInt(4, Integer.parseInt(ls_oficina));
		    			pstmt.setInt(5, Integer.parseInt(ls_documento));
		    			pstmt.setInt(6, Integer.parseInt(ls_secuencia));
		    			
		    			pstmt.executeUpdate();
					    	 
				    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
			    	 		" codigo_fondo=?  and oficina_origen = ?  and codigo_documento=?  and secuencia_movimiento=? "+
			    	 		" )";
				    	 
				    	// //log.info("El ls_sql insert recorrido_doc desarchivar documento es" + ls_sql);
					    	pstmt = conn.prepareStatement(ls_sql);

			    			pstmt.setString(1, "01");
			    			pstmt.setInt(2, Integer.parseInt(ls_oficina));
			    			pstmt.setInt(3, Integer.parseInt(ls_documento));
			    			pstmt.setInt(4, Integer.parseInt(ls_secuencia));
			    				    			
			    			pstmt.executeUpdate();
					    	 
		    		}
	        		
		    		 obt.cerrar_conexion(conn);		
		    		 pstmt.close();
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		obt.cerrar_conexion(conn);	
	    	}

		}
	 
	 
	 public void of_modificar_doc(Connection cnx,String codigo_oficina,String codigo_documento,String usuario,
			 String fecha,String hora,String observacion,String estado_movimiento,String fecha_registro,
			 String procedencia,String hora_registro,String firmadopor,String dirigido,String medio
			 ,String codigo_solicitud,String numero_documento,String asunto_documento) {
	    	
	     //   obtenermos el valor maximo...
	    	//log.info("dentro de Modificar documento......." );
	    	int    li_retorno;
	    	int    li_parcial = 0 ;
	    	String ls_correlativo=null;
	    	String ls_ano=null;
	    	String ls_mes=null;
	    	String ls_dia=null;
	    	String fecha_consulta=null;
	    	int ls_estado=0;
	    	String codigo_fondo="01";
	    	li_retorno = 1;
	    	Statement us  = null;
			ResultSet rs = null;
			
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
	    		
		    	ls_sql = "UPDATE tramite.documento SET fecha_registro = " +"'"+fecha_registro+"'" +
		    			","+"hora_registro ="+"'"+hora_registro+"'" +
		    			","+"numero_documento ="+"'"+numero_documento+"'" +
		    			","+"dirigido ="+"'"+dirigido+"'" +
		    			","+"asunto_documento ="+"'"+asunto_documento+"'" +
		    			","+"observa_documento ="+"'"+observacion+"'" +
		    			" where codigo_documento="+"'"+codigo_documento+"'";
		    	//log.info("El ls_sql update tramite.documento documento es" + ls_sql);
				    	 us = con.createStatement();
				    	 us.executeUpdate(ls_sql); 
				    	 
				    	 
				    	 ls_sql = "UPDATE tramite.doc_entrada SET firmadopor = " +"'"+firmadopor+"'" +
				    	 	","+"codigo_solicitud ="+"'"+codigo_solicitud+"'" +
				    	 	","+"medio ="+"'"+medio+"'" +
			    			" where codigo_documento="+"'"+codigo_documento+"'";
				    	 //log.info("El ls_sql update tramite.doc_entrada documento es" + ls_sql);
					    	 us = con.createStatement();
					    	 us.executeUpdate(ls_sql); 				    	 
					    	 
					    	 
	    		ls_sql = "UPDATE tramite.movimientos_doc SET fecha_movimiento="+"'"+fecha+"'"+","+"fecha_consulta="+"'"+fecha_consulta+"'"+
        		","+" hora_movimiento="+"'"+hora+"'"+"," + " ultimo_usuario=" + "'" +usuario+ "'"
        		+ " where codigo_fondo="+ "'01'" +
        		" and codigo_oficina= "+ "'" +codigo_oficina + "'" + " and codigo_documento="+"'"+codigo_documento+"'"+"";
	    		 //log.info("El ls_sql update movimientos_doc documento es" + ls_sql);
					    	 us = con.createStatement();
					    	 us.executeUpdate(ls_sql); 
					    		    	 
			    	 /*ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
		    	 		" and codigo_documento="+"'"+codigo_documento+"'"+" and secuencia_movimiento="+"'"+ls_secuencia+"'"+
		    	 		" )";*/
			    	 
			    	// //log.info("El ls_sql insert recorrido_doc 1 archivar documento es" + ls_sql);
			    	 
			    	/* us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
		    	*/
					    	 x.cerrar_conexion(con);
	    	}
	    	catch(Exception e){
	    		x.cerrar_conexion(con);
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    	}

		}
	 
	 
	 public Collection  lista_documentos_modificar(Connection cnx,String oficina) throws Exception {
			
	        log.info("ENTRO A  Lista de todos los documentos");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       String ls_ant_codigo_recepcion="";
	       String ls_ant_codigo_documento="";
	       String ls_ant_codigo_expediente="";
	       String ls_ant_secuencia_movimiento="";
	       String ls_codigo_documento_cont="";
	       String ls_codigo_expediente_cont="";
	    
	       String ls_codigo_recepcion="";
	       String ls_codigo_documento="";
	       String ls_codigo_expediente="";
	       String ls_secuencia_movimiento="";
			
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	String ls_correla= "";
	    	 int contador=0;

	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	int li_retorno=0;
	    	String ls_codigo_solicitud="";
			String ls_medio="";
			String ls_num_upload="";
			String ls_estado_mov="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    	Date fecha_recep = new Date(); // fecha y hora locales 
		SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
		SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); 
		/*//log.info("la fecha es.."+ formatoFecha.format(fecha_recep) ); 
		//log.info("la hora es.."+ formatoHora.format(fecha_recep) );*/ 
	    
		Funciones funcion=new Funciones();
		
		int li_retorno_correlativo = funcion.parametro(cnx);
		 ls_correla   = String.valueOf(li_retorno_correlativo);
		 
		////log.info("El correla es sqlUsuario es... :" + ls_correla);
	        try {	
	        	
	        	//String ls_naturaleza=naturaleza.equals("*");
	        	//ls_naturaleza="";
	        	
	        			
	        		////log.info(" Si es una lista normal");
	        		
	        		 /*ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        		 		"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
	        		 		"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	        		 		"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion," +
	        		 		"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento," +
	        		 		"dc.numero_documento_ant,de.origen_documento,de.destino_documento,de.desc_origen," +
	        		 		"de.tipo,de.remitente,de.destinatario,of.codigo_oficina,of.descripcion_oficina," +
	        		 		"of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal" +
	        		 		" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
	        		 		"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr" +
	        		 		" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	        		 		" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	        		 		" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	        		 		" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento in ('2','3','5') and" +
	        		 		" md.codigo_fondo like '01' and md.codigo_oficina like " + "'" + oficina + "'" + " order by md.codigo_documento desc";
	        		 */
	        	ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        			"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
	        			"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo," +
	        			"md.fecha_rpta,md.codigo_expediente,md.oficina_origen,md.oficina_deriva," +
	        			"md.correlativo_deriva,md.observa_registro,md.codigo_recepcion,md.flag," +
	        			"tp.descripcion_tipo,md.desc_origen,dc.numero_documento,dc.naturaleza_documento," +
	        			"dc.asunto_documento,dc.numero_documento_ant,dc.fecha_registro," +
	        			"dc.hora_registro,dc.dirigido,dc.observa_documento,de.origen_documento,de.destino_documento," +
	        			"de.desc_origen as nombre_procedencia,de.tipo,de.remitente,de.destinatario," +
	        			"de.firmadopor,de.medio,de.codigo_solicitud,of.codigo_oficina," +
	        			"of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino," +
	        			"pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc md," +
	        			"tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
	        			"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
	        			" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento" +
	        			" and dc.codigo_documento=de.codigo_documento and" +
	        			" md.codigo_documento=de.codigo_documento and de.destinatario=pr.codigo_personal" +
	        			" and md.codigo_oficina=of.codigo_oficina and " +
	        			"de.destino_documento=of_a.codigo_oficina and md.estado_movimiento ='2'" +
	        			" and md.codigo_fondo like '01' and md.codigo_oficina like " + "'" + oficina + "'" + " and" +
	        			" md.codigo_documento not in (select codigo_documento from tramite.movimientos_doc" +
	        			" where estado_movimiento = '2' and codigo_fondo like '01' and codigo_oficina" +
	        			" like " + "'" + oficina + "'" + " and flag ='I') order by " +
	        			" md.codigo_documento desc  limit 30";
	  
	        		//log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	 	    		 

	    		//log.info(" ls_sql.... : " + ls_sql);
	    		
	    		Funciones funciones=new Funciones();
				while ( rs.next() ) { 
					
					
					//BMesaPartesVO = new BMesaPartes();
					
					contador=contador+1;
					Hashtable objListaDoc = new Hashtable();
					
					ls_codigo_recepcion=rs.getString("codigo_recepcion").trim();
					ls_codigo_documento=rs.getString("codigo_documento").trim();
					ls_codigo_expediente=rs.getString("codigo_expediente").trim();
					ls_secuencia_movimiento=rs.getString("secuencia_movimiento").trim();
					ls_codigo_solicitud=rs.getString("codigo_solicitud").trim();
					ls_medio=rs.getString("medio").trim();
					
					if(contador==1){
						
						String seleccionar = "<label style='cursor: hand;' align='center' " 
							+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento").trim() + "', " + "'"
					        + rs.getString("codigo_expediente").trim() + "'"+ "," 
					        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
					        + "'"+ rs.getString("numero_documento") + "'"+ "," 
					        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
					        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
					       // + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
					       // + "'"+ rs.getString("hora_movimiento") + "'"+ ","
					        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
						    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
					      //  + "'"+ rs.getString("observa_registro").trim() + "'"+ ","
					        //+ "'"+ rs.getString("codigo_recepcion") + "'"+ ","
					        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
					        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
					        + "'"+ rs.getString("asunto_documento") + "'"+ ","
					        + "'"+ rs.getString("codigo_recepcion").trim() + "'"+ ","
					        + "'"+ rs.getString("fecha_registro").trim() + "'"+ ","
					        + "'"+ rs.getString("hora_registro").trim() + "'"+ ","
					        + "'"+ rs.getString("nombre_procedencia").trim() + "'"+ ","
					        + "'"+ rs.getString("firmadopor").trim() + "'"+ ","
					        + "'"+funciones.of_nombre_documento_dirigido(cnx, rs.getString("codigo_documento")) +"'"+ ","
					        + "'"+ls_codigo_solicitud +"'"+ ","
					        + "'"+ls_medio +"'"+ ","
					        + "'"+rs.getString("observa_documento").trim() +"'"
					        //+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+
					        + ");\" " + ">Seleccionar</label>";
							 //log.info("El seleccionar XXXXX.. : " + seleccionar);
							 ls_codigo_expediente_cont = "<label style='cursor: hand;' align='center' " 
								+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
						        + rs.getString("codigo_expediente").trim() + "'"+ "," 
						        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
						        + "'"+ rs.getString("numero_documento") + "'"+ "," 
						        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
						        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
						        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
							    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							//    + "'"+ rs.getString("observa_registro") + "'"+ ","
						        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
						       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
						        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
						        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
						        + "'"+ rs.getString("asunto_documento") + "'"+ ","
						        + "'"+ rs.getString("codigo_recepcion").trim() + "'"+ ","
						        + "'"+ rs.getString("fecha_registro").trim() + "'"+ ","
						        + "'"+ rs.getString("hora_registro").trim() + "'"+ ","
						        + "'"+ rs.getString("nombre_procedencia").trim() + "'"+ ","
						        + "'"+ rs.getString("firmadopor").trim() + "'"+ ","
						        + "'"+ funciones.of_nombre_documento_dirigido(cnx, rs.getString("codigo_documento"))+"'"+ ","
						        + "'"+ls_codigo_solicitud +"'"+ ","
						        + "'"+ls_medio +"'"+ ","
						        + "'"+rs.getString("observa_documento").trim() +"'"
						        + ");\" " + ">"+ rs.getString("codigo_expediente").trim()+"</label>";
							 ////log.info("El ls_codigo_expediente.. : " + ls_codigo_expediente.trim());
							 ls_codigo_documento_cont = "<label style='cursor: hand;' align='center' " 
								+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
						        + rs.getString("codigo_expediente").trim() + "'"+ "," 
						        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
						        + "'"+ rs.getString("numero_documento") + "'"+ "," 
						        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
						        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
						        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
							    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							 //   + "'"+ rs.getString("observa_registro") + "'"+ ","
						        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
						       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
						        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
						        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
						        + "'"+ rs.getString("asunto_documento") + "'"+ ","
						        + "'"+ rs.getString("codigo_recepcion").trim() + "'"+ ","
						        + "'"+ rs.getString("fecha_registro").trim() + "'"+ ","
						        + "'"+ rs.getString("hora_registro").trim() + "'"+ ","
						        + "'"+ rs.getString("nombre_procedencia").trim() + "'"+ ","
						        + "'"+ rs.getString("firmadopor").trim() + "'"+ ","
						        + "'"+ funciones.of_nombre_documento_dirigido(cnx, rs.getString("codigo_documento"))+"'"+ ","
						        + "'"+ls_codigo_solicitud +"'"+ ","
						        + "'"+ls_medio +"'"+ ","
						        + "'"+rs.getString("observa_documento").trim() +"'"
						        + ");\" " + ">"+ rs.getString("codigo_documento")+"</label>";
							////log.info("El ls_codigo_documento.. : " + ls_codigo_documento);
							String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
								+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
						        + rs.getString("codigo_expediente").trim() + "'"+ "," 
						        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
						        + "'"+ rs.getString("numero_documento") + "'"+ "," 
						        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
						        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
						        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
							    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							 //   + "'"+ rs.getString("observa_registro") + "'"+ ","
						        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
						       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
						        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
						        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
						        + "'"+ rs.getString("asunto_documento") + "'"+ ","
						        + "'"+ rs.getString("codigo_recepcion").trim() + "'"+ ","
						        + "'"+ rs.getString("fecha_registro").trim() + "'"+ ","
						        + "'"+ rs.getString("hora_registro").trim() + "'"+ ","
						        + "'"+ rs.getString("nombre_procedencia").trim() + "'"+ ","
						        + "'"+ rs.getString("firmadopor").trim() + "'"+ ","
						        + "'"+ funciones.of_nombre_documento_dirigido(cnx, rs.getString("codigo_documento"))+"'"+ ","
						        + "'"+ls_codigo_solicitud +"'"+ ","
						        + "'"+ls_medio +"'"+ ","
						        + "'"+rs.getString("observa_documento").trim() +"'"
						        + ");\" " + ">"+ rs.getString("numero_documento")+"</label>";
							////log.info("El ls_numero_documento.. : " + ls_numero_documento);
							String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
								+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
						        + rs.getString("codigo_expediente").trim() + "'"+ "," 
						        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
						        + "'"+ rs.getString("numero_documento") + "'"+ "," 
						        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
						        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
						        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
							    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
							//    + "'"+ rs.getString("observa_registro") + "'"+ ","
						        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
						       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
						        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
						        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
						        + "'"+ rs.getString("asunto_documento") + "'"+ ","
						        + "'"+ rs.getString("codigo_recepcion").trim() + "'"+ ","
						        + "'"+ rs.getString("fecha_registro").trim() + "'"+ ","
						        + "'"+ rs.getString("hora_registro").trim() + "'"+ ","
						        + "'"+ rs.getString("nombre_procedencia").trim() + "'"+ ","
						        + "'"+ rs.getString("firmadopor").trim() + "'"+ ","
						        +  "'"+ funciones.of_nombre_documento_dirigido(cnx, rs.getString("codigo_documento"))+"'"+ ","
						        + "'"+ls_codigo_solicitud +"'"+ ","
						        + "'"+ls_medio +"'"+ ","
						        + "'"+rs.getString("observa_documento").trim() +"'"
						        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
							////log.info("El ls_oficina_origen.. : " + ls_oficina_origen);
							objListaDoc.put("ACTION", seleccionar);
							objListaDoc.put("codigo_documento", ls_codigo_documento_cont);
							objListaDoc.put("codigo_expediente", ls_codigo_expediente_cont);
							objListaDoc.put("numero_documento", ls_numero_documento);
							objListaDoc.put("oficina_origen", ls_oficina_origen);
							objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
							if(ls_estado_mov.equals("5")){
								objListaDoc.put("estado_movimiento", "<FONT color='#009933'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");	
							}
							else if(ls_estado_mov.equals("2")){
								objListaDoc.put("estado_movimiento", "<FONT color='#FF0000 '>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");	
							}
							else{
								objListaDoc.put("estado_movimiento", "<FONT color='#00CC00'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");
							}
							
							/*objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
							objListaDoc.put("hora", rs.getString("hora_movimiento"));
							objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
							*/
							objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion").trim());
							objListaDoc.put("fecha_registro", rs.getString("fecha_registro").trim());
							objListaDoc.put("tipo_doc", rs.getString("descripcion_tipo").trim());
							
							ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
							////log.info("El lls_num_upload.. : " + ls_num_upload);
							if(ls_num_upload.equals("0")){
								
								objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
								
							}else {
								
								objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
								"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");

							}

					
					ListaMesaPartes.add(objListaDoc);
					
					ls_ant_codigo_recepcion=ls_codigo_recepcion;
					ls_ant_codigo_documento=ls_codigo_documento;
					ls_ant_codigo_expediente=ls_codigo_expediente;
					ls_ant_secuencia_movimiento=ls_secuencia_movimiento;

					}else if(contador>1){
						//log.info("Si el contador es mayor a cero es....: ");
						
						/*//log.info("Si ls_ant_codigo_documento a cero es....: " + ls_ant_codigo_documento);
						//log.info("Si ls_codigo_documento a cero es....: " + ls_codigo_documento);*/
						if(ls_ant_codigo_documento.equals(ls_codigo_documento)){
							////log.info("Los codigos son iguales me imprime una lista ji ji....: ");
							
							
							
						//	//log.info("--------------------------------------------------- ");
						}else {
							
							String seleccionar = "<label style='cursor: hand;' align='center' " 
								+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento").trim() + "', " + "'"
						        + rs.getString("codigo_expediente").trim() + "'"+ "," 
						        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
						        + "'"+ rs.getString("numero_documento") + "'"+ "," 
						        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
						        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
						       // + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
						       // + "'"+ rs.getString("hora_movimiento") + "'"+ ","
						        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
							    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
						      //  + "'"+ rs.getString("observa_registro").trim() + "'"+ ","
						        //+ "'"+ rs.getString("codigo_recepcion") + "'"+ ","
						        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
						        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
						        + "'"+ rs.getString("asunto_documento") + "'"+ ","
						        + "'"+ rs.getString("codigo_recepcion").trim() + "'"+ ","
						        + "'"+ rs.getString("fecha_registro").trim() + "'"+ ","
						        + "'"+ rs.getString("hora_registro").trim() + "'"+ ","
						        + "'"+ rs.getString("nombre_procedencia").trim() + "'"+ ","
						        + "'"+ rs.getString("firmadopor").trim() + "'"+ ","
						        + "'"+funciones.of_nombre_documento_dirigido(cnx, rs.getString("codigo_documento")) +"'"+ ","
						        + "'"+ls_codigo_solicitud +"'"+ ","
						        + "'"+ls_medio +"'"+ ","
						        + "'"+rs.getString("observa_documento").trim() +"'"
						        //+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+
						        + ");\" " + ">Seleccionar</label>";
								 //log.info("El seleccionar XXXXX.. : " + seleccionar);
								 ls_codigo_expediente_cont = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente").trim() + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
								//    + "'"+ rs.getString("observa_registro") + "'"+ ","
							        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
							        + "'"+ rs.getString("asunto_documento") + "'"+ ","
							        + "'"+ rs.getString("codigo_recepcion").trim() + "'"+ ","
							        + "'"+ rs.getString("fecha_registro").trim() + "'"+ ","
							        + "'"+ rs.getString("hora_registro").trim() + "'"+ ","
							        + "'"+ rs.getString("nombre_procedencia").trim() + "'"+ ","
							        + "'"+ rs.getString("firmadopor").trim() + "'"+ ","
							        + "'"+ funciones.of_nombre_documento_dirigido(cnx, rs.getString("codigo_documento"))+"'"+ ","
							        + "'"+ls_codigo_solicitud +"'"+ ","
							        + "'"+ls_medio +"'"+ ","
							        + "'"+rs.getString("observa_documento").trim() +"'"
							        + ");\" " + ">"+ rs.getString("codigo_expediente").trim()+"</label>";
								 ////log.info("El ls_codigo_expediente.. : " + ls_codigo_expediente.trim());
								 ls_codigo_documento_cont = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente").trim() + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
								 //   + "'"+ rs.getString("observa_registro") + "'"+ ","
							        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
							        + "'"+ rs.getString("asunto_documento") + "'"+ ","
							        + "'"+ rs.getString("codigo_recepcion").trim() + "'"+ ","
							        + "'"+ rs.getString("fecha_registro").trim() + "'"+ ","
							        + "'"+ rs.getString("hora_registro").trim() + "'"+ ","
							        + "'"+ rs.getString("nombre_procedencia").trim() + "'"+ ","
							        + "'"+ rs.getString("firmadopor").trim() + "'"+ ","
							        + "'"+ funciones.of_nombre_documento_dirigido(cnx, rs.getString("codigo_documento"))+"'"+ ","
							        + "'"+ls_codigo_solicitud +"'"+ ","
							        + "'"+ls_medio +"'"+ ","
							        + "'"+rs.getString("observa_documento").trim() +"'"
							        + ");\" " + ">"+ rs.getString("codigo_documento")+"</label>";
								////log.info("El ls_codigo_documento.. : " + ls_codigo_documento);
								String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente").trim() + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
								 //   + "'"+ rs.getString("observa_registro") + "'"+ ","
							        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
							        + "'"+ rs.getString("asunto_documento") + "'"+ ","
							        + "'"+ rs.getString("codigo_recepcion").trim() + "'"+ ","
							        + "'"+ rs.getString("fecha_registro").trim() + "'"+ ","
							        + "'"+ rs.getString("hora_registro").trim() + "'"+ ","
							        + "'"+ rs.getString("nombre_procedencia").trim() + "'"+ ","
							        + "'"+ rs.getString("firmadopor").trim() + "'"+ ","
							        + "'"+ funciones.of_nombre_documento_dirigido(cnx, rs.getString("codigo_documento"))+"'"+ ","
							        + "'"+ls_codigo_solicitud +"'"+ ","
							        + "'"+ls_medio +"'"+ ","
							        + "'"+rs.getString("observa_documento").trim() +"'"
							        + ");\" " + ">"+ rs.getString("numero_documento")+"</label>";
								////log.info("El ls_numero_documento.. : " + ls_numero_documento);
								String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente").trim() + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+  formatoFecha.format(fecha_recep) + "'"+ ","
								    + "'"+ formatoHora.format(fecha_recep) + "'"+ ","
								//    + "'"+ rs.getString("observa_registro") + "'"+ ","
							        //+ "'"+ rs.getString("observa_registro") + "'"+ ","
							       // + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
							        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
							        + "'"+ rs.getString("asunto_documento") + "'"+ ","
							        + "'"+ rs.getString("codigo_recepcion").trim() + "'"+ ","
							        + "'"+ rs.getString("fecha_registro").trim() + "'"+ ","
							        + "'"+ rs.getString("hora_registro").trim() + "'"+ ","
							        + "'"+ rs.getString("nombre_procedencia").trim() + "'"+ ","
							        + "'"+ rs.getString("firmadopor").trim() + "'"+ ","
							        +  "'"+ funciones.of_nombre_documento_dirigido(cnx, rs.getString("codigo_documento"))+"'"+ ","
							        + "'"+ls_codigo_solicitud +"'"+ ","
							        + "'"+ls_medio +"'"+ ","
							        + "'"+rs.getString("observa_documento").trim() +"'"
							        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
								////log.info("El ls_oficina_origen.. : " + ls_oficina_origen);
								objListaDoc.put("ACTION", seleccionar);
								objListaDoc.put("codigo_documento", ls_codigo_documento_cont);
								objListaDoc.put("codigo_expediente", ls_codigo_expediente_cont);
								objListaDoc.put("numero_documento", ls_numero_documento);
								objListaDoc.put("oficina_origen", ls_oficina_origen);
								objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
								if(ls_estado_mov.equals("5")){
									objListaDoc.put("estado_movimiento", "<FONT color='#009933'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");	
								}
								else if(ls_estado_mov.equals("2")){
									objListaDoc.put("estado_movimiento", "<FONT color='#FF0000 '>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");	
								}
								else{
									objListaDoc.put("estado_movimiento", "<FONT color='#00CC00'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");
								}
								
								/*objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
								objListaDoc.put("hora", rs.getString("hora_movimiento"));
								objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
								*/
								objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion").trim());
								objListaDoc.put("fecha_registro", rs.getString("fecha_registro").trim());
								objListaDoc.put("tipo_doc", rs.getString("descripcion_tipo").trim());
								
								ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
								////log.info("El lls_num_upload.. : " + ls_num_upload);
								if(ls_num_upload.equals("0")){
									
									objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
									
								}else {
									
									objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
									"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");

								}	
							
								ListaMesaPartes.add(objListaDoc);

						}
						ls_ant_codigo_recepcion=ls_codigo_recepcion;
						ls_ant_codigo_documento=ls_codigo_documento;
						ls_ant_codigo_expediente=ls_codigo_expediente;
						ls_ant_secuencia_movimiento=ls_secuencia_movimiento;

				}}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public void of_preliquidar_doc(Connection cnx,String codigo_oficina,String codigo_documento,String usuario,
			 String fecha,String hora,String observacion,String estado_movimiento,
			 String secuencia_movimiento,String asunto_documento,String codigo_tipo,
			 String codigooficina,String cod_ruta,String cod_modalidad,
			 String descripcion) {
	    	
	     //   obtenermos el valor maximo...
	    	//log.info("dentro del preliquidar documento......." );
	    	int    li_retorno;
	    	int    li_parcial = 0 ;
	    	String ls_correlativo=null;
	    	String ls_ano=null;
	    	String ls_mes=null;
	    	String ls_dia=null;
	    	String fecha_consulta=null;
	    	String ls_estado_derivar="3";
	    	String ls_estado_preliq="6";
	    	String ls_estado_liquid="7";
	    	String codigo_fondo="01";
	    	li_retorno = 1;
	    	Statement us  = null;
			ResultSet rs = null;
			
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
	    		
	    		////log.info("fecha: " + fecha );
	        	ls_ano = fecha.substring(6, 10);
	        	ls_mes = fecha.substring(3, 5);
	        	ls_dia = fecha.substring(0, 2);
	        /*	//log.info("ls_ano: " + ls_ano );
	        	//log.info("ls_mes: " + ls_mes );
	        	//log.info("ls_dia: " + ls_dia );*/
	        	
	        	fecha_consulta = fecha.substring(6,10)+fecha.substring(3,5)+fecha.substring(0,2);
	        	
	        //	//log.info("fecha_consulta: " + fecha_consulta);
		    
	        	
	        	
	        	//	//log.info("Si el estado del documento es 2,pendiente");
	        		
	        		ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = " +"'"+ls_estado_preliq+
	        		"'"+ ","+"fecha_movimiento="+"'"+fecha+"'"+","+"fecha_consulta="+"'"+fecha_consulta+"'"+
	        		","+" hora_movimiento="+"'"+hora+"'"+"," + " ultimo_usuario=" + "'" +usuario+ "'"+
	        		"," +" observa_registro=" + "'" +observacion+ "'"+ 
	        		"," +" codigo_tipo=" + "'" +codigo_tipo+ "'"+
	        		"," +" cod_oficina_rem=" + "'" +codigooficina+ "'"+
	        		"," +" cod_ruta=" + "'" +cod_ruta+ "'"+
	        		"," +" cod_modalidad=" + "'" +cod_modalidad+ "'"+
	        		"," +" descripcion=" + "'" +descripcion+ "'"
	        		+ " where codigo_fondo="+ "'" + codigo_fondo +"'" + " and codigo_oficina= "+ "'" +codigo_oficina + "'" + " and codigo_documento="+"'"+codigo_documento+"'"+
	        		" and secuencia_movimiento="+"'"+secuencia_movimiento+"'"+"";
	        		
	        		log.info("El ls_sql update recibir documento es:" + ls_sql);
	        	
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
			    	 
			    	 ls_sql = "UPDATE tramite.documento SET asunto_documento = " +"'"+asunto_documento+
		        		"'" + " where codigo_documento="+ "'" + codigo_documento +"'";
			    	 
		        	//	//log.info("El ls_sql update tramite.documento documento es" + ls_sql);
		        	
				    	 us = con.createStatement();
				    	 us.executeUpdate(ls_sql);	
				    	 
			    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'"+codigo_fondo+"'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
		    	 		" and codigo_documento="+"'"+codigo_documento+"'"+
		    	 		" )";
			    	 
			    //	 //log.info("El ls_sql insert recorrido_doc documento es" + ls_sql);
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
				    	 
	        	
	        
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    	}

		}
	 
	 public Collection  lista_liquidar_documentos(Connection cnx,String oficina) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			Statement us  = null;
			ResultSet rs = null;
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    	Date fecha_recep = new Date(); // fecha y hora locales 
 		SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
 		SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); 
 		/*//log.info("la fecha es.."+ formatoFecha.format(fecha_recep) ); 
 		//log.info("la hora es.."+ formatoHora.format(fecha_recep) );*/ 
	    		
	    		
	        try {	
	        	
	        	//String ls_naturaleza=naturaleza.equals("*");
	        	//ls_naturaleza="";
	        	
	        			
	        		////log.info(" Si es una lista normal");
	        		
	        		 ls_sql = "select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        		 		"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
	        		 		"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	        		 		"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion," +
	        		 		"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento," +
	        		 		"dc.numero_documento_ant,de.origen_documento,de.destino_documento,de.desc_origen," +
	        		 		"de.tipo,de.remitente,de.destinatario,of.codigo_oficina,of.descripcion_oficina," +
	        		 		"of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal" +
	        		 		" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
	        		 		"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr" +
	        		 		" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	        		 		" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	        		 		" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	        		 		" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento in ('6','7') and" +
	        		 		" md.codigo_fondo like '01' and md.codigo_oficina like " + "'" + oficina + "'" + " order by md.fecha_movimiento desc, md.hora_movimiento desc," +
	        		 		" md.codigo_documento desc";
	        		 
	        	
	  
	        		// //log.info("El ls_sql..otros mesa de partes oficinas.. : " + ls_sql);
	 		    	us = cnx.createStatement();
	 	    		rs = us.executeQuery(ls_sql);
	        		
	        	
	    		//log.info(" ls_sql.... : " + ls_sql);
	    		
	    		Funciones funciones=new Funciones();
	    		
	    		 String ls_codigo_recepcion="";
		    	 String ls_codigo_documento="";
		    	 String ls_codigo_documento_cont="";
		    	 String ls_codigo_expediente="";
		    	 String ls_codigo_expediente_cont="";
		    	 String ls_secuencia_movimiento="";
		    	 
		    	 String ls_ant_codigo_recepcion="";
		    	 String ls_ant_codigo_documento="";
		    	 String ls_ant_codigo_expediente="";
		    	 String ls_ant_secuencia_movimiento="";
		    	 String ls_naturaleza_documento="";
		    	 int contador=0;

	    		
				while ( rs.next() ) { 
					
					
					//BMesaPartesVO = new BMesaPartes();
					
					contador=contador+1;
					 Hashtable objListaDoc = new Hashtable();
					 ////log.info("Imprime listas XXX...." + contador);
						////log.info("Imprime listas...." + contador);
						
						ls_codigo_recepcion=rs.getString("codigo_recepcion").trim();
						ls_codigo_documento=rs.getString("codigo_documento").trim();
						ls_codigo_expediente=rs.getString("codigo_expediente").trim();
						ls_secuencia_movimiento=rs.getString("secuencia_movimiento").trim();
					
						if(contador==1){
	
					String seleccionar = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
			        + rs.getString("codigo_expediente") + "'"+ "," 
			        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
			        + "'"+ rs.getString("numero_documento") + "'"+ "," 
			        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
			        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
			        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
			        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
			        + "'"+ rs.getString("observa_registro") + "'"+ ","
			        + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
			        + "'"+ rs.getString("secuencia_movimiento") + "'"
			        + ");\" " + ">Seleccionar</label>";
					
					 ls_codigo_expediente_cont = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("observa_registro") + "'"+ ","
				        + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"
				        + ");\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
					
					 ls_codigo_documento_cont = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("observa_registro") + "'"+ ","
				        + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"
				        + ");\" " + ">"+ rs.getString("codigo_documento")+"</label>";
					
					String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("observa_registro") + "'"+ ","
				        + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"
				        + ");\" " + ">"+ rs.getString("numero_documento")+"</label>";
					
					String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("observa_registro") + "'"+ ","
				        + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"
				        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
					
					objListaDoc.put("ACTION", seleccionar);
					objListaDoc.put("codigo_documento", ls_codigo_documento_cont);
					objListaDoc.put("codigo_expediente", ls_codigo_expediente_cont);
					objListaDoc.put("numero_documento", ls_numero_documento);
					objListaDoc.put("oficina_origen", ls_oficina_origen);
					objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
					objListaDoc.put("estado_movimiento", funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim()));
					objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
					objListaDoc.put("hora", rs.getString("hora_movimiento"));
					objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
					objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
					
					ListaMesaPartes.add(objListaDoc);
					
					ls_ant_codigo_recepcion=ls_codigo_recepcion;
					ls_ant_codigo_documento=ls_codigo_documento;
					ls_ant_codigo_expediente=ls_codigo_expediente;
					ls_ant_secuencia_movimiento=ls_secuencia_movimiento;

						}
						else if(contador>1){
							////log.info("Si el contador es mayor a cero es....: ");
							
							if(ls_ant_codigo_documento.equals(ls_codigo_documento)){
								////log.info("Los codigos son iguales me imprime una lista ji ji....: ");
								
								
								
								////log.info("--------------------------------------------------- ");
							}else {
								
								String seleccionar = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
							        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
							        + "'"+ rs.getString("observa_registro") + "'"+ ","
							        + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento") + "'"
							        + ");\" " + ">Seleccionar</label>";
									
									 ls_codigo_expediente_cont = "<label style='cursor: hand;' align='center' " 
										+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
								        + rs.getString("codigo_expediente") + "'"+ "," 
								        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
								        + "'"+ rs.getString("numero_documento") + "'"+ "," 
								        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
								        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
								        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
								        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
								        + "'"+ rs.getString("observa_registro") + "'"+ ","
								        + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
								        + "'"+ rs.getString("secuencia_movimiento") + "'"
								        + ");\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
									
									 ls_codigo_documento_cont = "<label style='cursor: hand;' align='center' " 
										+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
								        + rs.getString("codigo_expediente") + "'"+ "," 
								        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
								        + "'"+ rs.getString("numero_documento") + "'"+ "," 
								        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
								        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
								        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
								        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
								        + "'"+ rs.getString("observa_registro") + "'"+ ","
								        + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
								        + "'"+ rs.getString("secuencia_movimiento") + "'"
								        + ");\" " + ">"+ rs.getString("codigo_documento")+"</label>";
									
									String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
										+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
								        + rs.getString("codigo_expediente") + "'"+ "," 
								        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
								        + "'"+ rs.getString("numero_documento") + "'"+ "," 
								        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
								        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
								        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
								        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
								        + "'"+ rs.getString("observa_registro") + "'"+ ","
								        + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
								        + "'"+ rs.getString("secuencia_movimiento") + "'"
								        + ");\" " + ">"+ rs.getString("numero_documento")+"</label>";
									
									String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
										+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
								        + rs.getString("codigo_expediente") + "'"+ "," 
								        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
								        + "'"+ rs.getString("numero_documento") + "'"+ "," 
								        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
								        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
								        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
								        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
								        + "'"+ rs.getString("observa_registro") + "'"+ ","
								        + "'"+ rs.getString("codigo_recepcion") + "'"+ ","
								        + "'"+ rs.getString("secuencia_movimiento") + "'"
								        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
									
									objListaDoc.put("ACTION", seleccionar);
									objListaDoc.put("codigo_documento", ls_codigo_documento_cont);
									objListaDoc.put("codigo_expediente", ls_codigo_expediente_cont);
									objListaDoc.put("numero_documento", ls_numero_documento);
									objListaDoc.put("oficina_origen", ls_oficina_origen);
									objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
									objListaDoc.put("estado_movimiento", funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim()));
									objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
									objListaDoc.put("hora", rs.getString("hora_movimiento"));
									objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
									objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
							
									ListaMesaPartes.add(objListaDoc);

							}
							ls_ant_codigo_recepcion=ls_codigo_recepcion;
							ls_ant_codigo_documento=ls_codigo_documento;
							ls_ant_codigo_expediente=ls_codigo_expediente;
							ls_ant_secuencia_movimiento=ls_secuencia_movimiento;
							
						} 

				}	
	            
				rs.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public void of_liquidar_doc(Connection cnx,String codigo_oficina,String codigo_documento,String usuario,
			 String fecha,String hora,String observacion,String estado_movimiento,String secuencia_movimiento) {
	    	
	     //   obtenermos el valor maximo...
	    	//log.info("dentro del liquidar documento......." );
	    	int    li_retorno;
	    	int    li_parcial = 0 ;
	    	String ls_correlativo=null;
	    	String ls_ano=null;
	    	String ls_mes=null;
	    	String ls_dia=null;
	    	String fecha_consulta=null;
	    	String ls_estado_derivar="3";
	    	String ls_estado_preliq="6";
	    	String ls_estado_liquid="7";
	    	String codigo_fondo="01";
	    	li_retorno = 1;
	    	Statement us  = null;
			ResultSet rs = null;
			
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
	    		
	    		//log.info("fecha: " + fecha );
	        	ls_ano = fecha.substring(6, 10);
	        	ls_mes = fecha.substring(3, 5);
	        	ls_dia = fecha.substring(0, 2);
	        	/*//log.info("ls_ano: " + ls_ano );
	        	//log.info("ls_mes: " + ls_mes );
	        	//log.info("ls_dia: " + ls_dia );*/
	        	
	        	fecha_consulta = fecha.substring(6,10)+fecha.substring(3,5)+fecha.substring(0,2);
	        	
	        	////log.info("fecha_consulta: " + fecha_consulta);
		    
	        	
	        	
	        		//log.info("Si el estado del documento es 2,pendiente");
	        		
	        		ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = " +"'"+ls_estado_liquid+
	        		"'"+ ","+"fecha_movimiento="+"'"+fecha+"'"+","+"fecha_consulta="+"'"+fecha_consulta+"'"+
	        		","+" hora_movimiento="+"'"+hora+"'"+"," + " ultimo_usuario=" + "'" +usuario+ "'"+"," +
	        		" observa_registro=" + "'" +observacion+ "'" + " where codigo_fondo="+ "'" + codigo_fondo +
	        		"'" + " and codigo_oficina= "+ "'" +codigo_oficina + "'" + " and codigo_documento="+"'"+codigo_documento+"'"+
	        		" and secuencia_movimiento="+"'"+secuencia_movimiento+"'"+"";
	        		
	        		//  //log.info("El ls_sql update recibir documento es" + ls_sql);
	        	
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
			    	 
			    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'"+codigo_fondo+"'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
		    	 		" and codigo_documento="+"'"+codigo_documento+"'"+
		    	 		" )";
			    	 
			    	// //log.info("El ls_sql insert recorrido_doc documento es" + ls_sql);
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
				    	 
	        	
	        
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    	}

		}
	 
	 public Collection  reportes_criteriousuario_buscar(Connection cnx,String ls_codigo_oficina,String usuario
			 ,String fecha,String codigo_oficina,String estado,String codigo_tipo,String procedencia
			 ,String firmadopor,String fecha_rpta,String numero_referencia)  throws Exception {
			
	        //log.info("ENTRO A  Lista usuarios reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			/*Statement us  = null;
			ResultSet rs = null;*/
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	//String ls_sql ="";
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);
	    	//log.info(" fechaformat.... : " + fechaformat);*/
	    	
	    	PreparedStatement us  = null;
			ResultSet rs = null;

	    	
	    	
	        try {	
	        	
	        
	        		//log.info(" Si es una lista usuarios BUSCAR");
	  
	        			
	        		StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta,md.numero_referencia," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.desc_origen,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant,dc.codigo_tipo," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,de.firmadopor,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina and md.secuencia_movimiento = " +
		 				"(select max(secuencia_movimiento) from tramite.movimientos_doc where " +
		 				"codigo_documento=md.codigo_documento)");
		 				/*" de.destino_documento=of_a.codigo_oficina and md.ultimo_usuario = " + "'" + usuario + "'"  + 
		 				" order by md.fecha_movimiento desc, md.hora_movimiento desc, md.codigo_documento desc");*/
	              		 
	        		if(usuario != null && !usuario.equals("0")){
			    		 ls_sql.append(" and md.ultimo_usuario like '%"+ usuario +"%' ");
			    	//	 //log.info("el ultimo_usuario: " + ls_sql);
						}
					
					if(fecha != null && !fecha.equals("")){
			    		 ls_sql.append(" and md.fecha_movimiento like '"+ fecha +"%' ");
			    	//	 //log.info("el fecha: " + ls_sql);
						}
					
					/*if(codigo_oficina != null && !codigo_oficina.equals("0")){
			    		 ls_sql.append(" and md.codigo_oficina like '"+ codigo_oficina +"%' ");
			    	//	 //log.info("el codigo_oficina: " + ls_sql);
						}else{
							
							if(!ls_codigo_oficina.equals("2")){
								
								ls_sql.append(" and md.codigo_oficina like '"+ ls_codigo_oficina +"%' ");
					    	//	 //log.info("el ls_codigo_oficina: " + ls_sql);
					    		 
							}
						}
					*/
					
					
					if(estado != null && !estado.equals("0")){
			    		 ls_sql.append(" and md.estado_movimiento like '"+ estado +"%' ");
			    	//	 //log.info("el estado: " + ls_sql);
						}
					
					if(codigo_tipo != null && !codigo_tipo.equals("0")){
			    		 ls_sql.append(" and dc.codigo_tipo like '"+ codigo_tipo +"%' ");
			    	//	 //log.info("el codigo_tipo: " + ls_sql);
						}
					
					if(procedencia != null && !procedencia.equals("")){
			    		 ls_sql.append(" and md.desc_origen like '%"+ procedencia +"%' ");
			    	//	 //log.info("el procedencia: " + ls_sql);
						}
					if(firmadopor != null && !firmadopor.equals("")){
			    		 ls_sql.append(" and de.firmadopor like '%"+ firmadopor +"%' ");
			    		// //log.info("el firmadopor: " + ls_sql);
						}
					if(fecha_rpta != null && !fecha_rpta.equals("")){
			    		 ls_sql.append(" and md.fecha_rpta like '"+ fecha_rpta +"%' ");
			    	//	 //log.info("el fecha_rpta: " + ls_sql);
						}
					if(numero_referencia != null && !numero_referencia.equals("")){
			    		 ls_sql.append(" and md.numero_referencia like '%"+ numero_referencia +"%' ");
			    	//	 //log.info("el numero_referencia: " + ls_sql);
						}
					
	        		ls_sql.append(" order by md.codigo_documento desc");
	        		Funciones funciones=new Funciones();
	        		
	        		String query = ls_sql.toString();
					
					us = cnx.prepareStatement(query);
					rs = us.executeQuery();
					
			    	//log.info("Si el tipo es Rendicion---Reporte: " + ls_sql);

			    		
						while ( rs.next() ) { 
							
							
							BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(funciones.of_nombre_corto_oficina(cnx,rs.getString("oficina_origen")));
							BMesaPartesVO.setOficina_deriva(funciones.of_nombre_corto_oficina(cnx,rs.getString("oficina_deriva")));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							BMesaPartesVO.setNumero_referencia(rs.getString("numero_referencia"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							

						}	
			            
						rs.close();
	        		
	        		

	        	
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 public Collection of_busca_documentos_pendientes(Connection cnx,String numero_registro,String codigo_oficina) throws Exception{
			
			//log.info("ENTRO A BUSCAR Documentos");
			//BDocumentos BDocumentosVO= null;
			
			Collection ListaMesaPartes = new ArrayList();
			log.info("Uso esta funcion >>>>>>>>>>>>");
			
			PreparedStatement us  = null;
			ResultSet rs = null;
			//StringBuffer ls_sql ="";
			
			try 
			{	
	
					StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        		 		"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
	        		 		"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	        		 		"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion," +
	        		 		"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento," +
	        		 		"dc.numero_documento_ant,de.origen_documento,de.destino_documento,de.desc_origen," +
	        		 		"de.tipo,de.remitente,de.destinatario,de.medio,of.codigo_oficina,of.descripcion_oficina," +
	        		 		"of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal" +
	        		 		" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
	        		 		"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr" +
	        		 		" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	        		 		" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	        		 		" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	        		 		" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento = '2' and" +
	        		 		" md.codigo_fondo like '01' ");
					
					if(codigo_oficina != null && !codigo_oficina.equals("")){
			    		 ls_sql.append(" and md.oficina_origen = "+ codigo_oficina +" ");
			    		// //log.info("el numero_registro: " + ls_sql);
						}
					
					
					if(numero_registro != null && !numero_registro.equals("")){
			    		 ls_sql.append(" and md.codigo_documento like '"+ numero_registro +"%' ");
			    		// //log.info("el numero_registro: " + ls_sql);
						}
					
					/*if(codigo_expediente != null && !codigo_expediente.equals("")){
			    		 ls_sql.append(" and md.codigo_expediente like '"+ codigo_expediente +"%' ");
			    		// //log.info("el codigo_expediente: " + ls_sql);
						}*/
					
					ls_sql.append(" order by md.codigo_documento desc");
					
					String query = ls_sql.toString();
					
					us = cnx.prepareStatement(query);
					rs = us.executeQuery();
					////log.info("Si ls_sql ....: " + ls_sql);
			    	 ////log.info("Si el tipo es Rendicion: " + rs);
			    	 
			    	 Funciones funciones=new Funciones();
			    	 
					 while (rs.next()){ 
							
						 Hashtable objListaDoc = new Hashtable();
											
							objListaDoc.put("ACTION", "<A id='A1' target='_parent' href='ListaDocumentos.do?tipo=detalleseg&operacion=S" +
									"&codigo_documento="+rs.getString("codigo_documento").trim()+"&codigo_expediente="+rs.getString("codigo_expediente").trim() +
									"&numero_documento=0&oficina_origen="+rs.getString("oficina_origen").trim()+
									"&oficina_deriva="+rs.getString("oficina_deriva").trim()+"&secuencia_movimiento="+rs.getString("secuencia_movimiento").trim()+"&fecha_rpta="+rs.getString("fecha_rpta").trim()+"'"+
									"<font color='#0000FF'>Seleccionar</font> </A>");
							objListaDoc.put("codigo_documento", rs.getString("codigo_documento").trim());
							objListaDoc.put("codigo_expediente",rs.getString("codigo_expediente").trim());
							objListaDoc.put("numero_documento", rs.getString("numero_documento").trim());
							objListaDoc.put("oficina_origen", funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim()));
							objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
							objListaDoc.put("estado_movimiento",  "<FONT color='#FF0000'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");
							objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
							objListaDoc.put("hora", rs.getString("hora_movimiento"));
							objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
							//objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
							
							objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
							objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
							//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
							objListaDoc.put("naturaleza_documento", rs.getString("naturaleza_documento"));
							objListaDoc.put("medio", funciones.of_medio_documento(cnx, rs.getString("medio").trim()));
							
						//	//log.info("Si objListaDoc ....: " + objListaDoc);
							objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+");' >"+
							"<img src='img/copy_f2.png' height='20' alt='Ver Hoja de Ruta' border='0'></A>");
							ListaMesaPartes.add(objListaDoc);
						}	
					 
				
				
				rs.close();
				
			} catch (SQLException e) 
			{
				 e.printStackTrace();
			}
			return ListaMesaPartes;
	                
			}
	 
	 
	 public Collection of_procedencia_listar(Connection cnx,String Tipo,String Cadena) throws Exception{
			
			//log.info("ENTRO A BUSCAR de Procedencias");
			//BDocumentos BDocumentosVO= null;
			
			Collection listaProcedencia = new ArrayList();
			BPersona BPersonaVO= null;
			PreparedStatement us  = null;
			ResultSet rs = null;
			//StringBuffer ls_sql ="";
			
			try 
			{	
	
					StringBuffer ls_sql = new StringBuffer("SELECT * FROM tramite.persona");
					
					if(Tipo != null && !Tipo.equals("0")){
			    		 ls_sql.append(" WHERE  tipo like '"+ Tipo +"%'");
			    		// //log.info("el Tipo: " + ls_sql);
			    		 
						}else{
							ls_sql.append(" WHERE  nombre_persona like '"+ Cadena +"'");
				    	//	 //log.info("el nombre_persona: " + Cadena);
							
						}
					
					if((Tipo != null && !Tipo.equals("0"))&&(Cadena != null && !Cadena.equals(""))){
			    		 ls_sql.append(" WHERE  tipo like '"+ Tipo +"%' and nombre_persona like '"+ Cadena +"'");
			    	//	 //log.info("el tipo es..: " + Tipo+" y la persona es.."+ Cadena);
						}
					
					ls_sql.append(" order by nombre_persona asc");
					
					String query = ls_sql.toString();
					
					//log.info("El ls_sql persona es..: " + ls_sql);
					
					us = cnx.prepareStatement(query);
					rs = us.executeQuery();
					
			    	 ////log.info("Si el tipo es Rendicion: " + rs);
			    	 
			    	 Funciones funciones=new Funciones();
			    	 
					 while ( rs.next() ) { 
							
						
						 BPersonaVO = new BPersona();
							
						 BPersonaVO.setCodigo_persona(rs.getString("codigo_persona"));
						 BPersonaVO.setNombre_persona(rs.getString("nombre_persona"));
						 BPersonaVO.setTipo(rs.getString("tipo"));		
							
						 listaProcedencia.add(BPersonaVO);

						}	
					 
				
				
				rs.close();
				
			} catch (SQLException e) 
			{
				 e.printStackTrace();
			}
			return listaProcedencia;
	                
			}
	 
	 public Collection of_procedencia_listar(String Tipo,String Cadena) throws Exception{
			
			Collection listaProcedencia = new ArrayList();
			Collection listaProcedenciaTemp = new ArrayList();
			boolean existe;
			
			BPersona BPersonaVO= null;
			ResultSet rs = null;
			ObtieneConexion x= new ObtieneConexion();
			Connection	con= x.getConnection();
			PreparedStatement pstmt = null;
			try 
			{	
					/***BUSQUEDA DERECHA***/
					StringBuffer ls_sql = new StringBuffer("SELECT * FROM tramite.persona");
			    		 		ls_sql.append(" WHERE  nombre_persona ILIKE '"+ Cadena +"%'");
			    		 		
			    		 		if(!Tipo.equals("0")){
			    		 			ls_sql.append(" and  tipo = '"+ Tipo +"'");
			    		 		}
			    		 		
			    		 		ls_sql.append(" order by nombre_persona asc limit 5 offset 0;");
					
					pstmt = con.prepareStatement(ls_sql.toString());
					log.info(pstmt);
					rs = pstmt.executeQuery();  
					 while ( rs.next() ) { 
						 BPersonaVO = new BPersona();
							
						 BPersonaVO.setCodigo_persona(rs.getString("codigo_persona"));
						 BPersonaVO.setNombre_persona(rs.getString("nombre_persona"));
						 BPersonaVO.setTipo(rs.getString("tipo"));		
							
						 listaProcedencia.add(BPersonaVO);
						}	

					 if(listaProcedencia!=null && listaProcedencia.size()>0){
						 listaProcedenciaTemp.addAll(listaProcedencia);
					 }
					 /*****BUSQUEDA IZQUIERDA**/
					 					 
					 StringBuffer ls_sql2 = new StringBuffer("SELECT * FROM tramite.persona");
	    		 		ls_sql2.append(" WHERE  nombre_persona ILIKE '%"+ Cadena +"%'");
	    		 		if(!Tipo.equals("0")){
	    		 			ls_sql2.append(" and  tipo = '"+ Tipo +"'");
	    		 		}
	    		 		
	    		 		ls_sql2.append(" order by nombre_persona asc limit 20 offset 0;");
			
	    		 	 pstmt = con.prepareStatement(ls_sql2.toString());
	    		 	 rs = pstmt.executeQuery();  
	    		 	 while ( rs.next() ) { 
	    		 		 BPersonaVO = new BPersona();
	    					
	    		 		 BPersonaVO.setCodigo_persona(rs.getString("codigo_persona"));
	    		 		 BPersonaVO.setNombre_persona(rs.getString("nombre_persona"));
	    		 		 BPersonaVO.setTipo(rs.getString("tipo"));		
	    		 		 existe = false; 
	    		 		 
	    		 		if(listaProcedenciaTemp!=null && listaProcedenciaTemp.size()>0){
	    	  				Iterator it=listaProcedenciaTemp.iterator();
	    	  				
	    	  				while(it.hasNext()){
	    	  					BPersona BPersonaVOTemp=(BPersona)it.next();
	    	  					if(BPersonaVO.getCodigo_persona().equals(BPersonaVOTemp.getCodigo_persona())){
	    	  						existe = true;
	    	  					}
	    	  				}
	    		 		}
	    		 		
	    		 		if(!existe){
	    		 			listaProcedencia.add(BPersonaVO);
	    		 		}
	    		 	 }	

	    		 	 x.cerrar_conexion(con, rs);
	    		 	 pstmt.close();
					         
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con, rs);
	        }
			return listaProcedencia;
	                
			}
	 
	 public Collection of_procedencia_interno_listar(String Cadena) throws Exception{
			
			Collection listaProcedencia = new ArrayList();
			Collection listaProcedenciaTemp = new ArrayList();
			boolean existe;
			
			BPersona BPersonaVO= null;
			ResultSet rs = null;
			ObtieneConexion x= new ObtieneConexion();
			Connection	con= x.getConnection();
			PreparedStatement pstmt = null;
			try 
			{	
					/***BUSQUEDA DERECHA***/
					StringBuffer ls_sql = new StringBuffer("SELECT pr.codigo_personal,pr.nombre_personal,ofi.siglas_oficina,ofi.descripcion_oficina ");
					ls_sql.append("FROM tramite.personal pr left join tramite.oficinas ofi on pr.codigo_oficina = ofi.codigo_oficina ");
			    	ls_sql.append(" WHERE  pr.nombre_personal ILIKE '"+ Cadena +"%' and pr.validacion=1 ");
			    		 		
			    	ls_sql.append(" order by pr.nombre_personal asc limit 5 offset 0;");
					
					pstmt = con.prepareStatement(ls_sql.toString());
					log.info(pstmt);
					rs = pstmt.executeQuery();  
					 while ( rs.next() ) { 
						 BPersonaVO = new BPersona();
							
						 BPersonaVO.setCodigo_persona(rs.getString("codigo_personal"));
						 BPersonaVO.setNombre_persona(rs.getString("nombre_personal"));
						 BPersonaVO.setOficina_pertenece(rs.getString("siglas_oficina")+"-"+rs.getString("descripcion_oficina"));
						 BPersonaVO.setTipo("N");		
							
						 listaProcedencia.add(BPersonaVO);
						}	

					 if(listaProcedencia!=null && listaProcedencia.size()>0){
						 listaProcedenciaTemp.addAll(listaProcedencia);
					 }
					 /*****BUSQUEDA IZQUIERDA**/
					 					 
					 StringBuffer ls_sql2 = new StringBuffer("SELECT pr.codigo_personal,pr.nombre_personal,ofi.siglas_oficina,ofi.descripcion_oficina ");
						ls_sql2.append("FROM tramite.personal pr left join tramite.oficinas ofi on pr.codigo_oficina = ofi.codigo_oficina ");
				    	ls_sql2.append(" WHERE  pr.nombre_personal ILIKE '%"+ Cadena +"%' and pr.validacion=1 ");
    		 		
	    		 		ls_sql2.append(" order by pr.nombre_personal asc limit 20 offset 0;");
			
	    		 	 pstmt = con.prepareStatement(ls_sql2.toString());
	    		 	 rs = pstmt.executeQuery();  
	    		 	 while ( rs.next() ) { 
	    		 		 BPersonaVO = new BPersona();
	    					
	    		 		 BPersonaVO.setCodigo_persona(rs.getString("codigo_personal"));
	    		 		 BPersonaVO.setNombre_persona(rs.getString("nombre_personal"));
	    		 		BPersonaVO.setOficina_pertenece(rs.getString("siglas_oficina")+"-"+rs.getString("descripcion_oficina"));
	    		 		 BPersonaVO.setTipo("N");		
	    		 		 existe = false; 
	    		 		 
	    		 		if(listaProcedenciaTemp!=null && listaProcedenciaTemp.size()>0){
	    	  				Iterator it=listaProcedenciaTemp.iterator();
	    	  				
	    	  				while(it.hasNext()){
	    	  					BPersona BPersonaVOTemp=(BPersona)it.next();
	    	  					if(BPersonaVO.getCodigo_persona().equals(BPersonaVOTemp.getCodigo_persona())){
	    	  						existe = true;
	    	  					}
	    	  				}
	    		 		}
	    		 		
	    		 		if(!existe){
	    		 			listaProcedencia.add(BPersonaVO);
	    		 		}
	    		 	 }	

	    		 	 x.cerrar_conexion(con, rs);
	    		 	 pstmt.close();
					         
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con, rs);
	        }
			return listaProcedencia;
	                
			}
	 
	 public BPersona of_busca_persona(int codigo) throws Exception{
			
			Collection listaProcedencia = new ArrayList();
			boolean existe;
			
			BPersona BPersonaVO= null;
			ResultSet rs = null;
			ObtieneConexion x= new ObtieneConexion();
			Connection	con= x.getConnection();
			PreparedStatement pstmt = null;
			try 
			{	
					StringBuffer ls_sql = new StringBuffer("SELECT codigo_persona,nombre_persona,tipo FROM tramite.persona");
			    		 		ls_sql.append(" WHERE  codigo_persona = "+ codigo +";");

					pstmt = con.prepareStatement(ls_sql.toString());
					log.info(pstmt);
					rs = pstmt.executeQuery();  
					 while ( rs.next() ) { 
						 BPersonaVO = new BPersona();
							
						 BPersonaVO.setCodigo_persona(rs.getString("codigo_persona"));
						 BPersonaVO.setNombre_persona(rs.getString("nombre_persona"));
						 BPersonaVO.setTipo(rs.getString("tipo"));		
						}	

	    		 	 x.cerrar_conexion(con, rs);
	    		 	 pstmt.close();
					         
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con, rs);
	        }
			return BPersonaVO;
	                
			}
	 
	 public JSONObject of_procedencia_listar(String Cadena) throws Exception{
			
			Collection listaProcedencia = new ArrayList();
			Collection listaProcedenciaTemp = new ArrayList();
			boolean existe;
			JSONObject obj = new JSONObject();
			
			BPersona BPersonaVO= null;
			ResultSet rs = null;
			ObtieneConexion x= new ObtieneConexion();
			Connection	con= x.getConnection();
			PreparedStatement pstmt = null;
			try 
			{	
					/***BUSQUEDA DERECHA***/
					StringBuffer ls_sql = new StringBuffer("SELECT * FROM tramite.persona");
			    		 		ls_sql.append(" WHERE  nombre_persona ILIKE '"+ Cadena +"%'");
			    		 		ls_sql.append(" order by nombre_persona asc limit 5 offset 0;");
					
					pstmt = con.prepareStatement(ls_sql.toString());
					rs = pstmt.executeQuery();  
					 while ( rs.next() ) { 
						 BPersonaVO = new BPersona();
							
						 BPersonaVO.setCodigo_persona(rs.getString("codigo_persona"));
						 BPersonaVO.setNombre_persona(rs.getString("nombre_persona"));
						 BPersonaVO.setTipo(rs.getString("tipo"));		
							
						 listaProcedencia.add(BPersonaVO);
						 obj.put(BPersonaVO.getNombre_persona().trim(),BPersonaVO.getNombre_persona().trim());
						}	

					 if(listaProcedencia!=null && listaProcedencia.size()>0){
						 listaProcedenciaTemp.addAll(listaProcedencia);
					 }
					 /*****BUSQUEDA IZQUIERDA**/
					 					 
					 StringBuffer ls_sql2 = new StringBuffer("SELECT * FROM tramite.persona");
	    		 		ls_sql2.append(" WHERE  nombre_persona ILIKE '%"+ Cadena +"%'");
	    		 		ls_sql2.append(" order by nombre_persona asc limit 15 offset 0;");
			
	    		 	 pstmt = con.prepareStatement(ls_sql2.toString());
	    		 	 rs = pstmt.executeQuery();  
	    		 	 while ( rs.next() ) { 
	    		 		 BPersonaVO = new BPersona();
	    					
	    		 		 BPersonaVO.setCodigo_persona(rs.getString("codigo_persona"));
	    		 		 BPersonaVO.setNombre_persona(rs.getString("nombre_persona"));
	    		 		 BPersonaVO.setTipo(rs.getString("tipo"));		
	    		 		 existe = false; 
	    		 		 
	    		 		if(listaProcedenciaTemp!=null && listaProcedenciaTemp.size()>0){
	    	  				Iterator it=listaProcedenciaTemp.iterator();
	    	  				
	    	  				while(it.hasNext()){
	    	  					BPersona BPersonaVOTemp=(BPersona)it.next();
	    	  					if(BPersonaVO.getCodigo_persona().equals(BPersonaVOTemp.getCodigo_persona())){
	    	  						existe = true;
	    	  						break;
	    	  					}
	    	  				}
	    		 		}
	    		 		
	    		 		if(!existe){
	    		 			listaProcedencia.add(BPersonaVO);
	    		 			obj.put(BPersonaVO.getNombre_persona().trim(),BPersonaVO.getNombre_persona().trim());
	    		 		}
	    		 	 }	

	    		 	 x.cerrar_conexion(con, rs);
					         
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con, rs);
	        }
			return obj;
	                
			}
	 
	 
	 public JSONObject of_dirigido_listar(String Cadena) throws Exception{
			
			Collection listaProcedencia = new ArrayList();
			Collection listaProcedenciaTemp = new ArrayList();
			boolean existe;
			JSONObject obj = new JSONObject();
			
			BPersona BPersonaVO= null;
			ResultSet rs = null;
			ObtieneConexion x= new ObtieneConexion();
			Connection	con= x.getConnection();
			PreparedStatement pstmt = null;
			try 
			{	
					/***BUSQUEDA DERECHA***/
					StringBuffer ls_sql = new StringBuffer("SELECT  codigo_personal,nombre_personal  FROM tramite.personal");
			    		 		ls_sql.append(" WHERE  nombre_personal ILIKE '"+ Cadena +"%' and validacion=1 ");
			    		 		ls_sql.append(" order by nombre_personal asc limit 5 offset 0;");
					
					pstmt = con.prepareStatement(ls_sql.toString());
					rs = pstmt.executeQuery();  
					 while ( rs.next() ) { 
						 BPersonaVO = new BPersona();
							
						 BPersonaVO.setCodigo_persona(rs.getString("codigo_personal"));
						 BPersonaVO.setNombre_persona(rs.getString("nombre_personal"));
						 //BPersonaVO.setTipo(rs.getString("tipo"));		
							
						 listaProcedencia.add(BPersonaVO);
						 obj.put(BPersonaVO.getNombre_persona().trim(),BPersonaVO.getNombre_persona().trim());
						}	

					 if(listaProcedencia!=null && listaProcedencia.size()>0){
						 listaProcedenciaTemp.addAll(listaProcedencia);
					 }
					 /*****BUSQUEDA IZQUIERDA**/
					 					 
					 StringBuffer ls_sql2 = new StringBuffer("SELECT  codigo_personal,nombre_personal  FROM tramite.personal");
	    		 		ls_sql2.append(" WHERE  nombre_personal ILIKE '%"+ Cadena +"%' and validacion=1 ");
	    		 		ls_sql2.append(" order by nombre_personal asc limit 15 offset 0;");
			
	    		 	 pstmt = con.prepareStatement(ls_sql2.toString());
	    		 	 rs = pstmt.executeQuery();  
	    		 	 while ( rs.next() ) { 
	    		 		 BPersonaVO = new BPersona();
	    					
	    		 		 BPersonaVO.setCodigo_persona(rs.getString("codigo_personal"));
	    		 		 BPersonaVO.setNombre_persona(rs.getString("nombre_personal"));
	    		 		 //BPersonaVO.setTipo(rs.getString("tipo"));		
	    		 		 existe = false; 
	    		 		 
	    		 		if(listaProcedenciaTemp!=null && listaProcedenciaTemp.size()>0){
	    	  				Iterator it=listaProcedenciaTemp.iterator();
	    	  				
	    	  				while(it.hasNext()){
	    	  					BPersona BPersonaVOTemp=(BPersona)it.next();
	    	  					if(BPersonaVO.getCodigo_persona().equals(BPersonaVOTemp.getCodigo_persona())){
	    	  						existe = true;
	    	  						break;
	    	  					}
	    	  				}
	    		 		}
	    		 		
	    		 		if(!existe){
	    		 			listaProcedencia.add(BPersonaVO);
	    		 			obj.put(BPersonaVO.getNombre_persona().trim(),BPersonaVO.getNombre_persona().trim());
	    		 		}
	    		 	 }	

	    		 	 x.cerrar_conexion(con, rs);
					         
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con, rs);
	        }
			return obj;
	                
			}
	 
	 public JSONObject of_dirigido_listar(String Cadena, String institucion) throws Exception{
			
			Collection listaProcedencia = new ArrayList();
			Collection listaProcedenciaTemp = new ArrayList();
			boolean existe;
			JSONObject obj = new JSONObject();
			
			BPersona BPersonaVO= null;
			ResultSet rs = null;
			ObtieneConexion x= new ObtieneConexion();
			Connection	con= x.getConnection();
			PreparedStatement pstmt = null;
			try 
			{	
					/***BUSQUEDA DERECHA***/
					StringBuffer ls_sql = new StringBuffer("SELECT  pe.codigo_personal,pe.nombre_personal  FROM tramite.personal pe , tramite.oficinas ofi ,tramite.usuarios usu ");
			    		 		ls_sql.append(" WHERE  pe.nombre_personal ILIKE '"+ Cadena +"%' and pe.validacion=1  and pe.codigo_oficina=ofi.codigo_oficina  and  ofi.institucion="+institucion.trim()+"  and pe.c_usuario=usu.usuario and usu.estado='A' ");
			    		 		ls_sql.append(" order by pe.nombre_personal asc limit 5 offset 0;");
					
					pstmt = con.prepareStatement(ls_sql.toString());
					rs = pstmt.executeQuery();  
					 while ( rs.next() ) { 
						 BPersonaVO = new BPersona();
							
						 BPersonaVO.setCodigo_persona(rs.getString("codigo_personal"));
						 BPersonaVO.setNombre_persona(rs.getString("nombre_personal"));
						 //BPersonaVO.setTipo(rs.getString("tipo"));		
							
						 listaProcedencia.add(BPersonaVO);
						 obj.put(BPersonaVO.getNombre_persona().trim(),BPersonaVO.getNombre_persona().trim());
						}	

					 if(listaProcedencia!=null && listaProcedencia.size()>0){
						 listaProcedenciaTemp.addAll(listaProcedencia);
					 }
					 /*****BUSQUEDA IZQUIERDA**/
					 					 
					 StringBuffer ls_sql2 = new StringBuffer("SELECT  pe.codigo_personal,pe.nombre_personal  FROM tramite.personal pe , tramite.oficinas ofi ,tramite.usuarios usu ");
	    		 		ls_sql2.append(" WHERE  pe.nombre_personal ILIKE '%"+ Cadena +"%' and  pe.validacion=1  and pe.codigo_oficina=ofi.codigo_oficina  and  ofi.institucion="+institucion.trim()+"  and pe.c_usuario=usu.usuario and usu.estado='A' ");
	    		 		ls_sql2.append(" order by pe.nombre_personal asc limit 15 offset 0;");
			
	    		 	 pstmt = con.prepareStatement(ls_sql2.toString());
	    		 	 rs = pstmt.executeQuery();  
	    		 	 while ( rs.next() ) { 
	    		 		 BPersonaVO = new BPersona();
	    					
	    		 		 BPersonaVO.setCodigo_persona(rs.getString("codigo_personal"));
	    		 		 BPersonaVO.setNombre_persona(rs.getString("nombre_personal"));
	    		 		 //BPersonaVO.setTipo(rs.getString("tipo"));		
	    		 		 existe = false; 
	    		 		 
	    		 		if(listaProcedenciaTemp!=null && listaProcedenciaTemp.size()>0){
	    	  				Iterator it=listaProcedenciaTemp.iterator();
	    	  				
	    	  				while(it.hasNext()){
	    	  					BPersona BPersonaVOTemp=(BPersona)it.next();
	    	  					if(BPersonaVO.getCodigo_persona().equals(BPersonaVOTemp.getCodigo_persona())){
	    	  						existe = true;
	    	  						break;
	    	  					}
	    	  				}
	    		 		}
	    		 		
	    		 		if(!existe){
	    		 			listaProcedencia.add(BPersonaVO);
	    		 			obj.put(BPersonaVO.getNombre_persona().trim(),BPersonaVO.getNombre_persona().trim());
	    		 		}
	    		 	 }	

	    		 	 x.cerrar_conexion(con, rs);
					         
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con, rs);
	        }
			return obj;
	                
			}
	 
	 public JSONObject of_firmadox_listar(String Cadena) throws Exception{
			
			Collection listaProcedencia = new ArrayList();
			Collection listaProcedenciaTemp = new ArrayList();
			boolean existe;
			JSONObject obj = new JSONObject();
			
			BPersona BPersonaVO= null;
			ResultSet rs = null;
			ObtieneConexion x= new ObtieneConexion();
			Connection	con= x.getConnection();
			PreparedStatement pstmt = null;
			try 
			{	
					/***BUSQUEDA DERECHA***/
					StringBuffer ls_sql = new StringBuffer("SELECT  origen_documento,firmadopor  FROM tramite.doc_entrada");
			    		 		ls_sql.append(" WHERE  firmadopor ILIKE '"+ Cadena +"%' ");
			    		 		ls_sql.append(" order by firmadopor asc limit 5 offset 0;");
					
					pstmt = con.prepareStatement(ls_sql.toString());
					rs = pstmt.executeQuery();  
					 while ( rs.next() ) { 
						 BPersonaVO = new BPersona();
							
						 BPersonaVO.setCodigo_persona(rs.getString("origen_documento"));
						 BPersonaVO.setNombre_persona(rs.getString("firmadopor"));
						 //BPersonaVO.setTipo(rs.getString("tipo"));		
							
						 listaProcedencia.add(BPersonaVO);
						 obj.put(BPersonaVO.getNombre_persona().trim(),BPersonaVO.getNombre_persona().trim());
						}	

					 if(listaProcedencia!=null && listaProcedencia.size()>0){
						 listaProcedenciaTemp.addAll(listaProcedencia);
					 }
					 /*****BUSQUEDA IZQUIERDA**/
					 					 
					 StringBuffer ls_sql2 = new StringBuffer("SELECT  origen_documento,firmadopor  FROM tramite.doc_entrada");
	    		 		ls_sql2.append(" WHERE  firmadopor ILIKE '%"+ Cadena +"%' ");
	    		 		ls_sql2.append(" order by firmadopor asc limit 15 offset 0;");
			
	    		 	 pstmt = con.prepareStatement(ls_sql2.toString());
	    		 	 rs = pstmt.executeQuery();  
	    		 	 while ( rs.next() ) { 
	    		 		 BPersonaVO = new BPersona();
	    					
	    		 		 BPersonaVO.setCodigo_persona(rs.getString("origen_documento"));
	    		 		 BPersonaVO.setNombre_persona(rs.getString("firmadopor"));
	    		 		 //BPersonaVO.setTipo(rs.getString("tipo"));		
	    		 		 existe = false; 
	    		 		 
	    		 		if(listaProcedenciaTemp!=null && listaProcedenciaTemp.size()>0){
	    	  				Iterator it=listaProcedenciaTemp.iterator();
	    	  				
	    	  				while(it.hasNext()){
	    	  					BPersona BPersonaVOTemp=(BPersona)it.next();
	    	  					if(BPersonaVO.getNombre_persona().equals(BPersonaVOTemp.getNombre_persona())){
	    	  						existe = true;
	    	  						break;
	    	  					}
	    	  				}
	    		 		}
	    		 		
	    		 		if(!existe){
	    		 			listaProcedencia.add(BPersonaVO);
	    		 			obj.put(BPersonaVO.getNombre_persona().trim(),BPersonaVO.getNombre_persona().trim());
	    		 		}
	    		 	 }	
	    		 	
	    		 	 x.cerrar_conexion(con, rs);
					         
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con, rs);
	        }
			return obj;
	                
			}
	 
	 public Collection of_lista_busqueda_linea(Connection cnx,String anio,String num_exp) throws Exception{
			
			//log.info("ENTRO A BUSCAR Documentos");
			//BDocumentos BDocumentosVO= null;
			log.info("Entry of_lista_busqueda_linea ...");
			Collection ListaMesaPartes = new ArrayList();
			BMesaPartes BMesaPartesVO = null;
			
			PreparedStatement us  = null;
			ResultSet rs = null;
			//StringBuffer ls_sql ="";
			
			try 
			{	
	
					StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        		 		"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
	        		 		"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	        		 		"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion," +
	        		 		"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento," +
	        		 		"dc.numero_documento_ant,dc.fecha_registro,dc.anio,de.origen_documento,de.destino_documento,de.desc_origen," +
	        		 		"de.tipo,de.remitente,de.destinatario,de.medio,of.codigo_oficina,of.descripcion_oficina," +
	        		 		"of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal" +
	        		 		" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
	        		 		"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr" +
	        		 		" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	        		 		" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	        		 		" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	        		 		" de.destino_documento=of_a.codigo_oficina and" +
	        		 		" md.codigo_fondo like '01' ");
					
					if(anio != null && !anio.equals("")){
			    		 ls_sql.append(" and dc.anio like '"+ anio +"%' ");
			    		// //log.info("el anio: " + ls_sql);
						}
					
					if(num_exp != null && !num_exp.equals("")){
			    		 ls_sql.append(" and md.codigo_expediente like '"+ num_exp +"%' ");
			    		// //log.info("el num_exp: " + ls_sql);
						}
					
					ls_sql.append(" order by md.fecha_movimiento desc, md.hora_movimiento desc," +
	        		 		" md.codigo_documento desc");
					
					String query = ls_sql.toString();
					log.info("query: "+query);	
					us = cnx.prepareStatement(query);
					rs = us.executeQuery();
					
			    	// //log.info("Si el tipo es Rendicion: " + rs);
			    	 
			    	 Funciones funciones=new Funciones();
			    	 
					 while ( rs.next() ) { 
							
						 BMesaPartesVO = new BMesaPartes();
							
							
							BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
							BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
							BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
							BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
							BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
							
							BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
							BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
							
							BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
							BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
							BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
							BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
							BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
							BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
							BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
							BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
							BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
							BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
							BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
							BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
							BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
							BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
							BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
							BMesaPartesVO.setTipo(rs.getString("tipo"));
							BMesaPartesVO.setRemitente(rs.getString("remitente"));
							
							BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
							BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
							BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
							BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
							BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
							BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
							BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
							
							String naturaleza_documento=rs.getString("naturaleza_documento");
							////log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
							ListaMesaPartes.add(BMesaPartesVO);
							
							//ListaMesaPartes.add(objListaDoc);
						}	
					 
				
				
				rs.close();
				
			} catch (SQLException e) 
			{
				 e.printStackTrace();
			}
			return ListaMesaPartes;
	                
			}
	 
	 
	 
	 
	public Collection  lista_recepcion_documentos_normal(Connection cnx,String oficina,String accesoaoficinas,String inicia) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes Recepcion Normal..");
			Collection ListaMesaPartes = new ArrayList();
			
			DocumentosInternosService service = new DocumentosInternosServiceImplement();
				
			String accesocodigospersonales=null;
			accesocodigospersonales=service.getCodigosPersonalesResponsables(accesoaoficinas);
						
			if(accesocodigospersonales!=null){
				accesocodigospersonales = (accesocodigospersonales.trim().length()>0)?  accesocodigospersonales.substring(0, accesocodigospersonales.length()-1): accesocodigospersonales;
			}
						
			/**
			 BCorrelativos BCorrelativosVO = null;
			 BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_estado_mov="";
	    	String ls_num_upload="";
	    	
	    	Date fecha_recep = new Date(); // fecha y hora locales 
 		    SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
 		    SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); 
			 */
			
			

			PreparedStatement pstmt = null;
			ResultSet rs = null;
			ObtieneConexion obt=new ObtieneConexion();
			Connection conn = obt.getConnection();
			

	        try {	        	
	        	
	        		
	        	StringBuilder ls_sql = new StringBuilder("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,");
	        			ls_sql.append("md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.secuencia_origen, ");
	        			ls_sql.append("md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta,");
	        			ls_sql.append("md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion,");
						ls_sql.append("md.flag,tp.descripcion_tipo,md.desc_origen,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,");
						ls_sql.append("dc.numero_documento_ant,dc.observa_documento,dc.fecha_registro,dc.hora_registro,dc.dirigido,de.origen_documento,de.destino_documento,de.desc_origen as nombre_procedencia,");
						ls_sql.append("de.tipo,de.remitente,md.destinatario,de.firmadopor,de.medio,de.codigo_solicitud,of.codigo_oficina,of.descripcion_oficina,");
						ls_sql.append("of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal, md.doc_resp");
						
						ls_sql.append(",(select count(tdetu.codigo_documento) from tramite.tbl_det_upload  tdetu  where tdetu.codigo_documento = md.codigo_documento) as numupload ");
						ls_sql.append(",tedoc.estado_expediente as estado_expediente ");
						ls_sql.append(",(select tofi.descripcion_oficina from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_origen) as nombre_oficina_origen");
						ls_sql.append(",(select tofi.descripcion_oficina from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_deriva) as nombre_oficina_deriva ");
						ls_sql.append(",(select tpers.nombre_personal from tramite.personal tpers where tpers.codigo_personal=md.destinatario) as destinatario_movimiento ");
						
						ls_sql.append(" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc,");
						ls_sql.append("tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr,tramite.estados_doc tedoc ");
						
						ls_sql.append(" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and");
						ls_sql.append(" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento");
						ls_sql.append(" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and");
						ls_sql.append(" de.destino_documento=of_a.codigo_oficina  and md.estado_movimiento=tedoc.codigo_estado and md.estado_movimiento ='2' and");
						ls_sql.append(" md.codigo_fondo like '01' and md.codigo_oficina in ("+accesoaoficinas+")  ");
						
						ls_sql.append(" and  md.destinatario in ("+accesocodigospersonales+")  ");
						
						ls_sql.append(" order by md.codigo_documento desc");
	        	
	        	/*if(inicia!=null && inicia.equals("SI")){
					ls_sql.append(" limit 30 offset 0 ");
				}*/
	        	
	        	
				pstmt = conn.prepareStatement(ls_sql.toString());
				//pstmt.setInt(1, Integer.parseInt(oficina));
				log.info(pstmt);
				rs = pstmt.executeQuery();	
	        	
	        	/**	
	        	String ls_dirigido= "";
	    		Funciones funciones=new Funciones();
	    		
	    		String ls_codigo_solicitud="";
	    		String ls_medio="";
	    		
	    		 String ls_ant_codigo_recepcion="";
		    	 String ls_ant_codigo_expediente="";
		    	 String ls_ant_secuencia_movimiento="";
		    	 String ls_naturaleza_documento="";
		    	 String ls_codigo_recepcion="";
		    	 String ls_codigo_documento="";
		    	 String ls_codigo_documento_cont="";
		    	 String ls_codigo_expediente_cont="";
		    	 
		    	 String ls_codigo_expediente="";
		    	 String ls_secuencia_movimiento="";
		    	***/ 
				
				String ls_ant_codigo_documento="";
		    	String ls_secuencia_origen="";
		    	int contador=0;

		    	log.info("-------------- antes del while");
				while ( rs.next() ) { 
					StringBuilder constantea = new StringBuilder("");
					StringBuilder constanteb = new StringBuilder("");
					StringBuilder constantec = new StringBuilder("");
					
					
					contador=contador+1;
					Hashtable objListaDoc = new Hashtable();
					
					/***SETEO VALORES**/
					//ls_codigo_recepcion=rs.getString("codigo_recepcion").trim();
	//				ls_codigo_documento=rs.getString("codigo_documento").trim();
					//ls_codigo_expediente=rs.getString("codigo_expediente").trim();
	//				ls_secuencia_movimiento=rs.getString("secuencia_movimiento").trim();
					//ls_codigo_solicitud=funciones.of_solicitud_documento(cnx, rs.getString("codigo_solicitud")).trim();
					//ls_medio=funciones.of_medio_documento(cnx, rs.getString("medio")).trim();
					//String ls_doc_respuesta = (rs.getString("doc_resp")==null)?"":rs.getString("doc_resp");
					//ls_estado_mov=rs.getString("estado_movimiento");
					//String asunto_documento = funciones.convertir_comillas(rs.getString("asunto_documento"));
					
					
					ls_secuencia_origen=rs.getString("secuencia_origen").trim();
					ls_secuencia_origen= (ls_secuencia_origen==null)? "0":ls_secuencia_origen;
					
					/*String ls_observa_movimiento = rs.getString("observa_movimiento");
					ls_observa_movimiento = ls_observa_movimiento==null?"":ls_observa_movimiento;*/
					/**FIN SETEO VALORES***/
					
					 constantea.append("<label style='cursor: hand;' align='center' onclick=fn_editar_cop('");
					 constantea.append(rs.getString("codigo_documento").trim());
					 constantea.append("','");
					 constantea.append(rs.getString("secuencia_movimiento").trim());
					 constantea.append("');>");
		 
					 constanteb.append("</label>");
					 
					if(contador==1){						

						objListaDoc.put("codigo_documento", constantea+rs.getString("codigo_documento")+constanteb);
						objListaDoc.put("codigo_expediente", constantea+ rs.getString("codigo_expediente").trim()+constanteb);
						objListaDoc.put("numero_documento", constantea+rs.getString("numero_documento")+constanteb);
						objListaDoc.put("oficina_origen",  constantea+rs.getString("nombre_oficina_origen").trim()+constanteb);
						objListaDoc.put("oficina_deriva", rs.getString("nombre_oficina_deriva").trim());
						objListaDoc.put("estado_movimiento", "<FONT color='#FF0000 '>"+rs.getString("estado_expediente").trim()+"</FONT>");	
						

						objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion").trim());
						objListaDoc.put("fecha_registro", rs.getString("fecha_registro").trim());
						objListaDoc.put("tipo_doc", rs.getString("descripcion_tipo").trim());
						objListaDoc.put("destinatario", (rs.getString("destinatario_movimiento")!=null)? rs.getString("destinatario_movimiento"):"--------");
						
						//ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
						////log.info("El lls_num_upload.. : " + ls_num_upload);
						
						if(rs.getInt("numupload")==0){
							objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
						}else {
							objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
							"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
						}
						
						/*if(ls_num_upload.equals("0")){
							
							objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
							
						}else {
							
							objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
							"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");

						}*/
						//objListaDoc.put("destinatario", funciones.of_nombre_persona(cnx, rs.getString("destinatario")));
						
						
						
						/*objListaDoc.put("observar", "<A id='A1' href='javascript:Observar("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+","+ls_secuencia_movimiento+","+ls_secuencia_origen+");' >"+
						"<img src='img/07observar.png' height='20' title='Observar' border='0'></A>");*/
						
						ListaMesaPartes.add(objListaDoc);
						
						ls_ant_codigo_documento=rs.getString("codigo_documento").trim();
						/*ls_ant_codigo_recepcion=ls_codigo_recepcion;
						ls_ant_codigo_expediente=ls_codigo_expediente;
						ls_ant_secuencia_movimiento=ls_secuencia_movimiento;*/
						
                    }
					/**GUARDADOS PARA LA SEGUNDA
					ls_ant_codigo_recepcion
					ls_ant_codigo_documento
					ls_ant_codigo_expediente
					ls_ant_secuencia_movimiento
					**/
					if(contador>1){
						
						/*if(ls_ant_codigo_documento.equals(ls_codigo_documento)){
							//log.info("Los codigos son iguales me imprime una lista ji ji....: ");
							//log.info("Codigos Iguales >> "+ls_ant_codigo_documento+", "+ls_codigo_documento);
							//log.info("--------------------------------------------------- ");
						}else */
						
						if(!ls_ant_codigo_documento.equals(rs.getString("codigo_documento").trim())){
							
							/*String seleccionar = "<label style='cursor: hand;' align='center' " 
								+ "onclick=\"fn_editar_cop('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">Seleccionar</label>";
							objListaDoc.put("ACTION", seleccionar);
								 //log.info("El seleccionar XXXXX.. : " + seleccionar);*/

								
							objListaDoc.put("codigo_documento", constantea+rs.getString("codigo_documento")+constanteb);
							objListaDoc.put("codigo_expediente", constantea+ rs.getString("codigo_expediente").trim()+constanteb);
							objListaDoc.put("numero_documento", constantea+rs.getString("numero_documento")+constanteb);
							objListaDoc.put("oficina_origen",  constantea+rs.getString("nombre_oficina_origen").trim()+constanteb);
							objListaDoc.put("oficina_deriva", rs.getString("nombre_oficina_deriva").trim());
							objListaDoc.put("estado_movimiento", "<FONT color='#FF0000 '>"+rs.getString("estado_expediente").trim()+"</FONT>");	
							

							objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion").trim());
							objListaDoc.put("fecha_registro", rs.getString("fecha_registro").trim());
							objListaDoc.put("tipo_doc", rs.getString("descripcion_tipo").trim());
							objListaDoc.put("destinatario", (rs.getString("destinatario_movimiento")!=null)? rs.getString("destinatario_movimiento"):"--------");
							
							if(rs.getInt("numupload")==0){
								objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
							}else {
								objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
								"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
							}
							
							//objListaDoc.put("destinatario", funciones.of_nombre_persona(cnx, rs.getString("destinatario")));
								
								/*objListaDoc.put("observar", "<A id='A1' href='javascript:Observar("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+","+ls_secuencia_movimiento+","+ls_secuencia_origen+");' >"+
								"<img src='img/07observar.png' height='20' title='Observar' border='0'></A>");*/
								
								ListaMesaPartes.add(objListaDoc);

						}

						ls_ant_codigo_documento=rs.getString("codigo_documento").trim();
						/*ls_ant_codigo_recepcion=ls_codigo_recepcion;
						ls_ant_codigo_expediente=ls_codigo_expediente;
						ls_ant_secuencia_movimiento=ls_secuencia_movimiento;*/
					}
					
					/**
					 * FIN DEL WHILE
					 */
				}
				
				obt.cerrar_conexion(conn,rs);	
	        	pstmt.close();
	            
	        } catch (SQLException e) {
	        	obt.cerrar_conexion(conn);	
	            e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 
	
	 public Collection  lista_upload_documentos(Connection cnx,int codigo_documento) throws Exception {
			
	        ////log.info("ENTRO A  Lista de Proyecto Investigacion Upload");
			Collection lista = new ArrayList();
			
			BDocumento BDocumentoVO = null;
			Statement us  = null;
			ResultSet rs = null;
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
	        try {	
	        		
				String ls_sql = "select * from tramite.tbl_det_upload  " +
				"where codigo_documento="+codigo_documento+
				" and flag = 'A' and tipo = 'P' order by id_det_upload asc";
	        	
				////log.info("El ls_sql..."+ ls_sql);
				us = con.createStatement();
 	    		rs = us.executeQuery(ls_sql);
	    		int contador=0;
	    		
				while ( rs.next() ) { 
					contador=contador+1;
					BDocumentoVO = new BDocumento();
					BDocumentoVO.setContador(contador);
					BDocumentoVO.setId_det_upload(rs.getInt("id_det_upload"));
					BDocumentoVO.setNombre_archivo(rs.getString("nombre_archivo"));
					BDocumentoVO.setRuta_archivo(rs.getString("estado_documento"));
					lista.add(BDocumentoVO);
				}	

	            x.cerrar_conexion(con, rs);
	        } catch (SQLException sqle) {
	        	log.info("Error en el metodo Lista Proyecto Investigacion Upload..");
				//mensaje=sqle.toString();  
				sqle.printStackTrace();
				x.cerrar_conexion(con);
	        }
	        return lista;
		                
		}
	 
	 public void DerivarDocumentoDetUploadIng(int codigo_documento,int codigo_expediente,
			 int secuencia_movimiento,String nombre_archivo, String ruta_archivo,
			 String flag,String tipo,String estado){

			Statement us  = null;
			ResultSet rs = null;
	    	String ls_sql = "";
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();

	    	try{
	
				ls_sql = "insert into tramite.tbl_det_upload(codigo_documento,nombre_archivo," +
	 	 		"ruta_archivo,flag,fecha_creacion,tipo,codigo_expediente,secuencia_movimiento,estado_documento) " +
	 	 		"values("+codigo_documento+","
	 	 		+ "'" + nombre_archivo+ "'"  +","
	 	 		+ "'" + ruta_archivo+ "'"  +","
	 	 		+ "'" + flag+ "'"  +","
	 	 		+"current_timestamp"  +","
	 	 		+ "'" + tipo + "'"+","
	 	 		+ "'" + codigo_expediente + "'"+","
	 	 		+ "'" + secuencia_movimiento + "','"+estado+"'"+
	 	 		")";
	    	 us = con.createStatement();
	    	 us.executeUpdate(ls_sql);
				  
			x.cerrar_conexion(con);
	    	}
	    	catch(Exception sqle){
	    		x.cerrar_conexion(con);
	    		log.info("Error en el metodo Ingresar Detalle Upload Proy Invest..");  
				sqle.printStackTrace();
	    	}
		}
	 
	 public void DerivarDocumentoCabUploadIng(String codigo_oficina,int correlativo,int codigo_documento,int codigo_expediente ,int secuencia_movimiento,String usuario_creacion,int codigo_recepcion) {
		    
	    	int    li_retorno = 1;
	    	
	    	Statement us  = null;
			ResultSet rs = null;
	    	StringBuilder ls_sql = new StringBuilder("");
	    	StringBuilder ls_sql2 = new StringBuilder("");
	    	StringBuilder ls_sql3 = new StringBuilder("");
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection	con= x.getConnection();
			log.info("Dentro de DerivarDocumentoCabUploadIng CABECERA..");	

	    	try{
	    		
				ls_sql.append("insert into tramite.tbl_cab_upload(id_cab_upload,codigo_documento,codigo_expediente,codigo_oficina,secuencia_movimiento,usuario_creacion,fecha_creacion,codigo_recepcion) ");
				ls_sql.append("values(nextval('tramite.seq_tbl_cab_upload'),");
				ls_sql.append(codigo_documento);
				ls_sql.append(",");
				ls_sql.append(codigo_expediente);
				ls_sql.append(",");
				ls_sql.append(codigo_oficina);
				ls_sql.append(",");
				ls_sql.append(secuencia_movimiento);
				ls_sql.append(",'");
				ls_sql.append(usuario_creacion);
				ls_sql.append("',current_timestamp,");
				ls_sql.append(codigo_recepcion);
				ls_sql.append(")");;
				//log.info("El ls_sql es XXX.."+ ls_sql);	
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql.toString());
			    	 
			    ls_sql2.append("SELECT last_value as valor FROM tramite.seq_tbl_cab_upload; ");
				us = con.createStatement();
		    	rs = us.executeQuery(ls_sql2.toString());
		    	while (rs.next()){
		    		li_retorno = rs.getInt("valor");	
		    	}	 
			    	 
				    	 
		    	ls_sql3.append("UPDATE tramite.tbl_det_upload SET id_cab_upload=");
		    	ls_sql3.append(li_retorno);
		    	ls_sql3.append(", codigo_oficina=");
		    	ls_sql3.append(codigo_oficina);
		    	ls_sql3.append(", usuario_modificacion='");
		    	ls_sql3.append(usuario_creacion);
		    	ls_sql3.append("', flag='I', fecha_modificacion=current_timestamp, codigo_recepcion=");
		    	ls_sql3.append(codigo_recepcion);
		    	ls_sql3.append("  WHERE codigo_documento=");
		    	ls_sql3.append(codigo_documento);
		    	ls_sql3.append(" and secuencia_movimiento=");
		    	ls_sql3.append(secuencia_movimiento);
		    	ls_sql3.append("  and flag='A'");
		 
		 			//log.info("El ls_sql modificar Cabecera Upload Proy Investigacion .." + ls_sql);
		 	 		us = con.createStatement();
		 	 		us.executeUpdate(ls_sql3.toString());   
		 	 		
		 	 		 x.cerrar_conexion(con);
		 	 		 us.close();
			  
	    	}
	    	catch(Exception sqle){
	    		log.info("Error en el metodo Ingresar CABECERA Upload Documento..");
				sqle.printStackTrace();
				 x.cerrar_conexion(con);
	    	}

		}
	 
	 public void EliminarDocumentoDetUpload(Connection cnx,int id_det_upload) {
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
	    	Connection			cn = x.getConnection();
	    	
	    	String ls_sql = "";
	    	 Statement us  = null;
	    	
	    	 //log.info("Dentro de Eliminar Doc...");
	    	 try{
	    		 
	    			 ls_sql = "delete from tramite.tbl_det_upload WHERE id_det_upload =" + "'" + id_det_upload + "'";
	 	    		us = cn.createStatement();
	 	    		us.executeUpdate(ls_sql);
	 	    		 //log.info("el ls_sql es..."+ls_sql);
	 	    		 x.cerrar_conexion(cn);
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		 x.cerrar_conexion(cn);
	    	} 
	    	
	    }
	 
	 public Collection  lista_upload_documentos_detalle(Connection cnx,int codigo_documento) throws Exception {
			
	        ////log.info("ENTRO A  Lista de Proyecto Investigacion Upload");
			Collection lista = new ArrayList();
			
			BDocumento BDocumentoVO = null;

			PreparedStatement pstmt = null;
			ResultSet rs = null;
			
			Connection conn = null;
			ObtieneConexion obt=new ObtieneConexion();
	    	
	        try {	
	        		
	        	/*StringBuilder ls_sql = new StringBuilder("select du.id_det_upload,du.nombre_archivo,du.estado_documento,ofi.siglas_oficina "); 
	        	ls_sql.append(" from tramite.tbl_det_upload du left join tramite.oficinas ofi on du.codigo_oficina = ofi.codigo_oficina "); 
	        	ls_sql.append(" where  du.codigo_documento=?  and du.flag = 'I' and du.tipo = 'P' order by du.id_det_upload asc");*/
	        	
	        	StringBuilder ls_sql = new StringBuilder("select distinct du.codigo_documento,du.id_det_upload,du.nombre_archivo,du.estado_documento,ofi.siglas_oficina ");
	        	ls_sql.append(" from tramite.tbl_det_upload du "); 
	        	ls_sql.append(" left join tramite.movimientos_doc md on du.codigo_recepcion = md.codigo_recepcion ");  
	        	ls_sql.append(" left join tramite.oficinas ofi on md.oficina_origen = ofi.codigo_oficina "); 
	        	ls_sql.append(" where  du.codigo_documento=?  and du.flag = 'I' and du.tipo = 'P' order by du.id_det_upload asc");
	        	
	        	conn = obt.getConnection();
	    		pstmt = conn.prepareStatement(ls_sql.toString());
	    		pstmt.setInt(1, codigo_documento);

	    		log.info(pstmt);
	    		rs = pstmt.executeQuery();
	    		int contador=0;
	    		
				while ( rs.next() ) { 
					
					contador=contador+1;
					BDocumentoVO = new BDocumento();
					BDocumentoVO.setContador(contador);
					BDocumentoVO.setId_det_upload(rs.getInt("id_det_upload"));
					BDocumentoVO.setNombre_archivo(rs.getString("nombre_archivo"));
					BDocumentoVO.setRuta_archivo(rs.getString("estado_documento"));
					BDocumentoVO.setDescripcion_oficina(rs.getString("siglas_oficina"));
					BDocumentoVO.setCodigo_documento(rs.getInt("codigo_documento")+"");
					lista.add(BDocumentoVO);
					
				}	
	            
				obt.cerrar_conexion(conn, rs);
				pstmt.close();

	            
	        } catch (SQLException sqle) {
	        	log.info("Error en el metodo lista_upload_documentos_detalle");
				//mensaje=sqle.toString();  
				sqle.printStackTrace();
				obt.cerrar_conexion(conn);
	        }
	        return lista;
		                
		}
	 
	 
	 public void of_registrar_recepcion_mismo(Connection cnx,String ls_oficina,String codigo_oficina,String codigo_motivo,String observacion
	   			,String destinatario,String ls_documento,String ls_secuencia,String ls_usuario,String ls_codigoPadre,
	   			int correla,String fecha_rpta,String codigo_expediente,String ls_descripcion_oficina,String codigo_recepcion,String fecha_rpta_rq) {
	    	
	     //   obtenermos el valor maximo...
	    	//log.info("dentro del Registro derivacion......." );
	    	
	    	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	Calendar calendario = new GregorianCalendar();
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "2";
	    	String ls_valor  = "";
	    	String origen_documento  = "";
	    	
	    	String horaActual = "00:00:00";
	    	Calendar cal = Calendar.getInstance();
	        Date hora = cal.getTime();
	        DateFormat df = DateFormat.getTimeInstance();
	        horaActual = df.format(hora);
	        
	       // //log.info("horaActual.... : " + horaActual);
	       
	        
	    	int    li_retorno =0;
	    	int    li_secuencia =0;
	    	int    li_secuencia_nueva =0;
	    	int    li_secuencia_recorrido =0;
	    	
	    //	//log.info("eL ls_secuencia ES.... : " + ls_secuencia);
	    	
	    	li_secuencia_recorrido=Integer.valueOf(ls_secuencia).intValue()+1;
	    	
	    	
	    	// //log.info("eL li_secuencia_recorrido ES.... : " + li_secuencia_recorrido);
	    	 
	    	int    li_parcial = 0 ;
	    	
	    	String codigo_documento= "" ;
	    	String ls_extraer_year= "" ;
	    	
	    	String ls_correlativo=null;
	    	
	    	Statement us  = null;
			ResultSet rs = null;
			String doc_resp="";
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
	    		
	    	
	    		ls_sql = "Select max(secuencia_movimiento) as c_valor from tramite.movimientos_doc where codigo_documento =" + "'" + ls_codigoPadre + "'" + "";
 			//log.info("ls_sql............   " + ls_sql );
 			us = con.createStatement();
		    	 rs = us.executeQuery(ls_sql);
		    //	 //log.info("El resultset es: " + rs);
				
		    	 if (rs == null) 
		    		{
		    			////log.info("rs es nulo ......." );
		    			li_secuencia_nueva = 1;
		    	    }
		    		else
		    		{
		    			////log.info("rs NO es nulo ......." );
			    		while ( rs.next() ) { 
			    				         //   //log.info("dentro del whyle......." );
			    				            if (rs.getString("c_valor") == null )
			    				            {
			    				    		//	//log.info("ta vacio nulo ......." );
			    				    			li_secuencia_nueva = 1;
			    				    	    }
			    				            else
			    				    		{
			    				            	////log.info("ls_valor :" + rs.getString("c_valor"));
			    				            	li_secuencia = Integer.valueOf(rs.getString("c_valor")).intValue();
			    				            	li_secuencia_nueva = Integer.valueOf(rs.getString("c_valor")).intValue() + 1;
			    				            	////log.info("nuevo li_secuencia :" + li_secuencia_nueva);
			    				    		}
			    				           
			    		}
			        }
		    	 
		    	 //Se quito el correlativo_deriva !!
		    	 ls_sql = "insert into tramite.movimientos_doc(codigo_documento," +
		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie,codigo_motivo," +
		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
		 		"oficina_deriva,destinatario,fecha_rpta,codigo_expediente,oficina_origen,desc_origen,codigo_recepcion,doc_resp,fecha_rpta_rq) values(" + "'" + ls_codigoPadre + "'"
	 	 		+ "," +"'01'"+","+"'"+ li_secuencia_nueva + "'"+ "," +"'" + codigo_oficina + "'"+ "," +"'01'"
	 	 		+ "," + "'" + codigo_motivo + "'"+ "," + "'" + origen_documento + "'"+ "," +"'2'"
	 	 		+ "," +"'" + fecha_documento + "'"+ "," +"'" + fechaconsulta + "'"+ "," +"'" + horaActual + "'"
	 	 		+ "," +"'" + observacion + "'"+ "," +"'" + ls_codigoPadre + "'"
	 	 		+ "," +"'" + ls_usuario + "'"+ "," +"'01'"+ "," +"'" + codigo_oficina + "'"+
	 	 		"," +"'" + destinatario + "'"+","+"'"+fecha_rpta+"'"+","+"'"+codigo_expediente+"'"+
	 			","+"'"+ls_oficina+"'"+
	 	 		","+"'"+ls_descripcion_oficina+"'"+
	 	 		","+"'"+correla+"'"+
	 	 		","+"'"+doc_resp+"'"+
	 	 		","+"'"+fecha_rpta_rq+"'"+
	 	 		")";
		    	 
		    	// //log.info("El primer ls_sql es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);
		    	 
		    	
			    	 //log.info("La secuencia del movimiento lista seleccionado es:" + ls_secuencia );
		    		 ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento="+"'5'"+","+
			    	 "fecha_movimiento="+"'"+fecha_documento+"'"+","+"hora_movimiento="+
			    	 "'"+horaActual+"'"+","+"ultimo_usuario="+"'"+ls_usuario+"'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+ls_secuencia+"'"+"";
			    	// //log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); 
			    	 
			    	 /********************registrando derivacion documento***********/
			    	 
			    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+"'"+ls_secuencia+"'"+
		    	 		" )";
			    	 
			    	 ////log.info("El ls_sql insert recorrido_doc 1 documento es" + ls_sql);
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
				    
			    	 
			    	 //log.info("Si el valor es 0 a ingresar duplicacion derivacion");
		 			 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+"'"+li_secuencia_nueva+"'"+
		    	 		" )";
				    	 
			    	// //log.info("El ls_sql insert recorrido_doc 2 documento es" + ls_sql);	 
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
			    	 
			    	 //log.info("update a los estados del recorrido es:" + ls_secuencia );
		    		 ls_sql = "UPDATE tramite.recorrido_doc SET estado="+"'2'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+ls_secuencia+"'"+"";
			    	// //log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); 
			    	 
			    	// //log.info("update a los estados 2 del recorrido es:" + ls_secuencia );
		    		 ls_sql = "UPDATE tramite.recorrido_doc SET estado="+"'1'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+li_secuencia_nueva+"'"+"";
			    	// //log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); 
			    	 
			    	 
			    	 
			    	 x.cerrar_conexion(con);
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );
	    		 x.cerrar_conexion(con);
	    	}

		}
	 
	 public Collection  lista_upload_documentos_doc_entrada(Connection cnx,int codigo_documento) throws Exception {
			
	        ////log.info("ENTRO A  Lista de Proyecto Investigacion Upload");
			Collection lista = new ArrayList();
			
			BDocumento BDocumentoVO = null;
			Statement us  = null;
			ResultSet rs = null;
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
	        try {	
	        		
				String ls_sql = "select * from tramite.tbl_det_upload  " +
				"where codigo_documento="+codigo_documento+
				" and flag = 'A' and tipo = 'P' order by id_det_upload asc";
	        	
				////log.info("El ls_sql..."+ ls_sql);
				us = con.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		////log.info("El rst"+ rst);
	    		//Funciones funciones=new Funciones();
	    		//log.info("El ls_sql...." + ls_sql);
	    		int contador=0;
	    		
				while ( rs.next() ) { 
					
					contador=contador+1;
					BDocumentoVO = new BDocumento();
					BDocumentoVO.setContador(contador);
					BDocumentoVO.setId_det_upload(rs.getInt("id_det_upload"));
					BDocumentoVO.setNombre_archivo(rs.getString("nombre_archivo"));
					
					lista.add(BDocumentoVO);
					
				}	
	            
				x.cerrar_conexion(con, rs);

	            
	        } catch (SQLException sqle) {
	        	log.info("Error en el metodo Lista Proyecto Investigacion Upload..");
				//mensaje=sqle.toString();  
				sqle.printStackTrace();
				x.cerrar_conexion(con);
	        }
	        return lista;
		                
		}
	 
	 public void CrearDocumentoDocEntradaDetUploadIng(int codigo_documento,String nombre_archivo, String ruta_archivo,
			 String flag,String tipo,String usuario_creacion,String vOf){
	    	
	     
	    	int    li_retorno;
	    	int    li_retorno_det;
	    	int    li_parcial = 0 ;
	    	String ls_correlativo=null;
	    	li_retorno = 1;
	    	li_retorno_det=1;
	    	BDocumento BDocumentoVO = null;
			Statement us  = null;
			ResultSet rs = null;
	    	String ls_sql = "";
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();

	    	Funciones funciones=new Funciones();
	    	try{
	    		
	    		 /********************************INGRESANDO CABECERA********************/
	    		/*	ls_sql = "Select max(id_cab_upload) as c_valor from tramite.tbl_cab_upload";
	    			////log.info("ls_sql............   " + ls_sql );
	    			us = con.createStatement();
			    	 rs = us.executeQuery(ls_sql);
			    	 
			    	 if (rs == null) 
			    		{
			    			////log.info("rs es nulo ......." );
			    			li_retorno = 1;
			    	    }
			    		else
			    		{
			    			////log.info("rs NO es nulo ......." );
				    		while ( rs.next() ) { 
				    				           // //log.info("dentro del whyle......." );
				    				            if (rs.getString("c_valor") == null )
				    				            {
				    				    			////log.info("ta vacio nulo ......." );
				    				    			li_retorno = 1;
				    				    	    }
				    				            else
				    				    		{
				    				            	////log.info("ls_valor :" + rs.getString("c_valor"));
				    				            	li_retorno = Integer.valueOf(rs.getString("c_valor")).intValue() + 1;
				    				    		}
				    				           
				    		}
				        }
			    	 
			    	 
			    	 ls_sql = "insert into tramite.tbl_cab_upload(id_cab_upload,codigo_documento,codigo_expediente,secuencia_movimiento,usuario_creacion,fecha_creacion,codigo_recepcion) " +
			 	 		"values(" + "'" + li_retorno + "'" + "," + "'" + codigo_documento+ "'"+ "," + "'" + codigo_expediente+ "'" + "," + "'2'"   +","
			 	 		+ "'" + usuario_creacion+ "'"  +","
			 	 		+"current_timestamp" +","
			 	 		+ "'" + correlativorecepcion+ "'"  +
						    	 		")";
						//log.info("El ls_sql es XXX.."+ ls_sql);	
					    	 us = con.createStatement();
					    	 us.executeUpdate(ls_sql);
	    		 	*/
			    	 /********************************INGRESANDO DETALLE***********
					    	 
					    	 ls_sql = "Select max(id_det_upload) as c_valor from tramite.tbl_det_upload";
				    			////log.info("ls_sql............   " + ls_sql );
				    			us = con.createStatement();
						    	 rs = us.executeQuery(ls_sql);
						    	 
						    	 if (rs == null) 
						    		{
						    			////log.info("rs es nulo ......." );
						    			li_retorno_det = 1;
						    	    }
						    		else
						    		{
						    			////log.info("rs NO es nulo ......." );
							    		while ( rs.next() ) { 
							    				           // //log.info("dentro del whyle......." );
							    				            if (rs.getString("c_valor") == null )
							    				            {
							    				    			////log.info("ta vacio nulo ......." );
							    				            	li_retorno_det = 1;
							    				    	    }
							    				            else
							    				    		{
							    				            	////log.info("ls_valor :" + rs.getString("c_valor"));
							    				            	li_retorno_det = Integer.valueOf(rs.getString("c_valor")).intValue() + 1;
							    				    		}
							    				           
							    		}
							        }
					
					*********/	    	  	 
			    	 ls_sql = "insert into tramite.tbl_det_upload(codigo_documento,nombre_archivo," +
			 	 		"ruta_archivo,flag,fecha_creacion,tipo,usuario_creacion,estado_documento,nombre_archivo_detalle) " +
			 	 		"values(" + "'" + codigo_documento+ "'"  +","
			 	 		+ "'" + nombre_archivo+ "'"  +","
			 	 		+ "'" + ruta_archivo+ "'"  +","
			 	 		+ "'" + flag+ "'"  +","
			 	 		+"current_timestamp"  +","
			 	 		+ "'" + tipo + "'"+","
			 	 		+ "'" + usuario_creacion + "'"+
			 	 		",'"+vOf+"'"+
			 	 		" , '"+funciones.getFechaActualyHoraActualTexto()+nombre_archivo+"' "
						+")";

			    	 //log.info("El ls_sql es XXX.."+ ls_sql);	
				    	 us = con.createStatement();
				    	 us.executeUpdate(ls_sql);
				    	 
				    	 x.cerrar_conexion(con);
				    	 
	    	}
	    	catch(Exception sqle){
	    		log.info("Error en el metodo Ingresar Detalle Upload Proy Invest..");  
				sqle.printStackTrace();
				 x.cerrar_conexion(con);
	    	}
		}
	 

	 public void CrearDocumentoDocEntradaDetUploadIng(int codigo_documento,BArchivo archivo,int codigo_expediente, int secuencia_movimiento,
			 String flag,String tipo, String vOf){
	    	log.info("Entry CrearDocumentoDocEntradaDetUploadIng R");

	    	BDocumento BDocumentoVO = null;
			Statement us  = null;
			ResultSet rs = null;
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
	    	Funciones funciones=new Funciones();
	    	
	    	try{
	    			  	 
	    		String	 ls_sql = "insert into tramite.tbl_det_upload(codigo_documento,nombre_archivo,codigo_expediente,secuencia_movimiento," +
			 	 		"ruta_archivo,flag,fecha_creacion,tipo,usuario_creacion,estado_documento,nombre_archivo_detalle) " +
			 	 		"values(" + codigo_documento+ ", '"
			 	 		+ archivo.getNombre_archivo() +"',"
			 	 		+ codigo_expediente +","+secuencia_movimiento+","
			 	 		+ "'"+filePath+archivo.getRutaDetalleUpload()+funciones.getAnioActualTexto()+"',"
			 	 		+ "'" + flag+ "'"  +","
			 	 		+"current_timestamp"  +","
			 	 		+ "'" + tipo + "', '"
			 	 		+ archivo.getUsuario()+
			 	 		"' ,'"+vOf+"'"+
			 	 		" , '"+archivo.getFecha_hora_actual()+archivo.getNombre_archivo_cifrado()+"')";

			    	 //log.info("El ls_sql es XXX.."+ ls_sql);	
				    	 us = con.createStatement();
				    	 us.executeUpdate(ls_sql);
				    	 
				    	 x.cerrar_conexion(con);
				    	 
	    	}
	    	catch(Exception sqle){
	    		log.info("Error en el metodo Ingresar Detalle Upload Proy Invest..");  
				sqle.printStackTrace();
				 x.cerrar_conexion(con);
	    	}
		}
	 
	 public void CrearDocumentoDocEntradaDetUploadIngFirmaManual(int codigo_documento,String nombre_archivo, String ruta_archivo,
			String flag,String tipo,String usuario_creacion,String vOf){
	    	
	     
	    	int    li_retorno;
	    	int    li_retorno_det;
	    	int    li_parcial = 0 ;
	    	String ls_correlativo=null;
	    	li_retorno = 1;
	    	li_retorno_det=1;
	    	BDocumento BDocumentoVO = null;
			Funciones funciones = new Funciones();
			Statement us  = null;
			ResultSet rs = null;
	    	String ls_sql = "";
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();

	    	try{
			    	 /********************************INGRESANDO DETALLE*******
					    	 
					    	 ls_sql = "Select max(id_det_upload) as c_valor from tramite.tbl_det_upload";
				    			////log.info("ls_sql............   " + ls_sql );
				    			us = con.createStatement();
						    	 rs = us.executeQuery(ls_sql);
						    	 
						    	 if (rs == null) 
						    		{
						    			////log.info("rs es nulo ......." );
						    			li_retorno_det = 1;
						    	    }
						    		else
						    		{
						    			////log.info("rs NO es nulo ......." );
							    		while ( rs.next() ) { 
							    				           // //log.info("dentro del whyle......." );
							    				            if (rs.getString("c_valor") == null )
							    				            {
							    				    			////log.info("ta vacio nulo ......." );
							    				            	li_retorno_det = 1;
							    				    	    }
							    				            else
							    				    		{
							    				            	////log.info("ls_valor :" + rs.getString("c_valor"));
							    				            	li_retorno_det = Integer.valueOf(rs.getString("c_valor")).intValue() + 1;
							    				    		}
							    				           
							    		}
							        }
					*************/	    	 
						    	 //nextval('directorio_cti.seq_id_conocimiento_idioma')
						    	  	 
			    	 ls_sql = "insert into tramite.tbl_det_upload(nombre_archivo," +
			 	 		"ruta_archivo,flag,fecha_creacion,tipo,usuario_creacion,estado_documento,id_codigo_documento_interno) " +
			 	 		"values('"+ nombre_archivo+ "'"  +","
			 	 		+ "'" + ruta_archivo+ "'"  +","
			 	 		+ "'" + flag+ "'"  +","
			 	 		+"current_timestamp"  +","
			 	 		+ "'" + tipo + "'"+","
			 	 		+ "'" + usuario_creacion + "'"+
			 	 		",'"+vOf+"'"+
						","+codigo_documento+
						")";

			    	 //log.info("El ls_sql es XXX.."+ ls_sql);	
				    	 us = con.createStatement();
				    	 us.executeUpdate(ls_sql);
				    	 
				    	 x.cerrar_conexion(con);
				    	 
	    	}
	    	catch(Exception sqle){
	    		log.info("Error en el metodo Ingresar Detalle Upload Proy Invest..");  
				sqle.printStackTrace();
				 x.cerrar_conexion(con);
	    	}
		}
	 
	 
	 public void DerivarDocumentoDetUploadIng(int codigo_documento, int ls_codigo_expediente ,int ls_secuencia_movimiento,
			 String nombre_archivo, String ruta_archivo,
			 String flag,String tipo,String usuario_creacion,String vOf){
	    	
		 	log.info("Entry DerivarDocumentoDetUploadIng - Derivacion");
			Statement us  = null;
			ResultSet rs = null;
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();

	    	Funciones funciones=new Funciones();
	    	try{
	    		   	  	 
	    		String ls_sql = "insert into tramite.tbl_det_upload(codigo_documento,codigo_expediente,nombre_archivo," +
			 	 		"ruta_archivo,flag,fecha_creacion,tipo,secuencia_movimiento,usuario_creacion,estado_documento,"
			 	 		+ "nombre_archivo_detalle) " +
			 	 		"values(" + codigo_documento + ","+
			 	 		ls_codigo_expediente +", '"+ nombre_archivo+ "'," +
			 	 		"'" + ruta_archivo+ "' , '" + flag+ "' ,"
			 	 		+"current_timestamp"  +", '" + tipo + "' ,"
			 	 		+ls_secuencia_movimiento +" ,'" + usuario_creacion + "'"+
			 	 		",'"+vOf+"'"+
			 	 		" , '"+funciones.getFechaActualyHoraActualTexto()+nombre_archivo+"' "
						+")";

			    	 //log.info("El ls_sql es XXX.."+ ls_sql);	
				    	 us = con.createStatement();
				    	 us.executeUpdate(ls_sql);
				    	 
				    	 x.cerrar_conexion(con);
				    	 
	    	}
	    	catch(Exception sqle){
	    		log.info("Error en el metodo Ingresar Detalle Upload Proy Invest..");  
				sqle.printStackTrace();
				 x.cerrar_conexion(con);
	    	}
		}
	 
	 public void ActualizaDocumentoDocEntradaDetUploadIng(int codigo_documento,
			 String usuario_modificacion,int id_detalle_upload){
	    	
			Statement us  = null;
	    	String ls_sql = "";
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();

	    	try{
    		 /********************************INGRESANDO DETALLE********************/
					    	  	 
			    	 ls_sql = "update tramite.tbl_det_upload  set codigo_documento="+codigo_documento+",fecha_modificacion=now(),usuario_modificacion='"+usuario_modificacion+"' "+
			    	 "where id_det_upload="+id_detalle_upload+" and flag = 'A'";

			    	 log.info("El ls_sql es XXX.."+ ls_sql);	
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);
			    	 
			    	 x.cerrar_conexion(con);
				    	 
	    	}
	    	catch(Exception sqle){
	    		log.info("Error en el metodo Ingresar Detalle Upload Proy Invest..");  
				sqle.printStackTrace();
				 x.cerrar_conexion(con);
	    	}
		}
	 
	 public void CrearCabDocEntradaUploadIng(String codigo_oficina,String codigo_documento,String numero_expediente,
				String numero_secuencia,String correlativorecepcion,String usuario_creacion){
	    	
	     
	    	int  li_retorno = 1;
			Statement us  = null;
			ResultSet rs = null;
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection	con= x.getConnection();

	    	try{
	    		
	    		/**	ls_sql = "Select coalesce(max(id_cab_upload),0)+1 as c_valor from tramite.tbl_cab_upload";
	    			////log.info("ls_sql............   " + ls_sql );
	    			us = con.createStatement();
			    	 rs = us.executeQuery(ls_sql);
			    	 
			    	if (rs == null){
			    			li_retorno = 1;
			    	  }
			    	else if( rs.next() ){ 
				    	 li_retorno = rs.getInt("c_valor");				    		
				    }**/
	    		StringBuilder ls_sql = new StringBuilder("");
	    		StringBuilder ls_sq2 = new StringBuilder("");
	    		StringBuilder ls_sq3 = new StringBuilder("");
	    		
				ls_sql.append("insert into tramite.tbl_cab_upload(id_cab_upload,codigo_documento,");
				ls_sql.append("codigo_expediente,codigo_oficina,secuencia_movimiento,codigo_recepcion,fecha_creacion,usuario_creacion) ");
				ls_sql.append("values(nextval('tramite.seq_tbl_cab_upload'),");
				ls_sql.append(codigo_documento);
				ls_sql.append(",");
				ls_sql.append(numero_expediente);
				ls_sql.append(",");
				ls_sql.append(codigo_oficina);
				ls_sql.append(",");
				ls_sql.append(numero_secuencia);
				ls_sql.append(",");
				ls_sql.append(correlativorecepcion);
				ls_sql.append(",current_timestamp,'");
				ls_sql.append(usuario_creacion);
	 	 		ls_sql.append("')");
	 	//log.info("El ls_sql es XXX.."+ ls_sql);	
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql.toString());
		    	 
		    	 
			ls_sq2.append("SELECT last_value as valor FROM tramite.seq_tbl_cab_upload; ");
			us = con.createStatement();
	    	rs = us.executeQuery(ls_sq2.toString());
	    	while (rs.next()){
	    		li_retorno = rs.getInt("valor");	
	    	}
				    	 
				    	 
	    	 ls_sq3.append("UPDATE tramite.tbl_det_upload SET codigo_expediente=");
	    	 ls_sq3.append(numero_expediente);
	    	 ls_sq3.append(",id_cab_upload=");
	    	 ls_sq3.append(li_retorno);
	    	 ls_sq3.append(",secuencia_movimiento=");
	    	 ls_sq3.append(numero_secuencia);
	    	 ls_sq3.append(",codigo_recepcion=");
	    	 ls_sq3.append(correlativorecepcion);
	    	 ls_sq3.append(",codigo_oficina=");
	    	 ls_sq3.append(codigo_oficina);
	    	 ls_sq3.append(",flag='I'  where codigo_documento=");
	    	 ls_sq3.append(codigo_documento);
	    	 //log.info("El segundo ls_sql es" + ls_sql);
	    	 us = con.createStatement();
	    	 us.executeUpdate(ls_sq3.toString()); 	
	    	 
	    	 x.cerrar_conexion(con,rs);
				    	 
	    	}
	    	catch(Exception sqle){
	    		log.info("Error en el metodo Crear Cabecera Documento de Entrada Upload..");  
				sqle.printStackTrace();
				 x.cerrar_conexion(con);
	    	}
		}
	 
	 
	 public String ValidaListaDocEntradaDetUpload(String codigo_documento) throws Exception {
			
	        //log.info("ENTRO A  Obtener documento padre");
			
	      
	        int    li_retorno;
	    	int    li_parcial = 0 ;
	    	String ls_correlativo=null;
	    	li_retorno = 1;
	    	BDocumento BDocumentoVO = null;
			Statement us  = null;
			ResultSet rs = null;
	    	String ls_sql = "";
	    	String ls_valor="0";
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection	con= x.getConnection();

	       
	        try {	
	        	
	        	ls_sql = "select count(id_det_upload) as c_valor from tramite.tbl_det_upload" +
				" where codigo_documento  = " + "'" + codigo_documento + "'"  + "";
	        	us = con.createStatement();
	        	rs = us.executeQuery(ls_sql);
	        	// //log.info("El resultset es: " + rs);
    	
		 		while ( rs.next() ) { 
		            //log.info("dentro del whyle......." );
		            ls_valor = rs.getString("c_valor"); 
		            //log.info("ls_valor :" + ls_valor );
		 		}

	            
				rs.close();
				 x.cerrar_conexion(con,rs);
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con);
	        }
	        return ls_valor;
		                
		}
	 
	 public int ValidaListaDocEntradaDetUpload(String codigo_documento, String secuencia_movimiento) throws Exception {
			
	        log.info("Entry ValidaListaDocEntradaDetUpload");
				      
	    	BDocumento BDocumentoVO = null;
			Statement us  = null;
			ResultSet rs = null;
	    	int ls_valor =0;
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection	con= x.getConnection();
	       
	        try {	
	        	
	        	StringBuffer ls_sql = new StringBuffer("select count(id_det_upload) as c_valor from tramite.tbl_det_upload");
	        	ls_sql.append(" where codigo_documento  = "+ codigo_documento + " and secuencia_movimiento="+secuencia_movimiento);
	        	us = con.createStatement();
	        	rs = us.executeQuery(ls_sql.toString());
 	
		 		while (rs.next()) { 
		            ls_valor = rs.getInt("c_valor"); 
		 		}

	            
				rs.close();
				 x.cerrar_conexion(con,rs);
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con);
	        }
	        return ls_valor;
		                
		}
	 
	 public BMesaPartes  of_detalle_documento_hoja_envio(Connection cnx,String codigo_documento,
			 String codigo_recepcion,String secuencia_movimiento) throws Exception {
			
	        //log.info("ENTRO Al detalle documento");
			
			
	        BMesaPartes BMesaPartesVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       Funciones funciones=new Funciones();
	        try {	
	        	
	        	

	        	String ls_sql = "select md.codigo_documento,md.fecha_movimiento,md.hora_movimiento," +
	        			"md.estado_movimiento,md.secuencia_movimiento,md.ultimo_usuario,md.doc_deriva," +
	        			"md.observa_movimiento,md.codigo_motivo,md.codigo_inicia,md.oficina_origen,md.oficina_deriva,md.codigo_recepcion,md.codigo_expediente,md.fecha_rpta,tp.descripcion_tipo," +
	        			"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,de.origen_documento," +
	        			"de.destino_documento,de.desc_origen,de.tipo,de.remitente,de.destinatario,of.codigo_oficina," +
	        			"of.descripcion_oficina,pr.codigo_personal,pr.nombre_personal,dc.fecha_registro," +
	        			"dc.hora_registro,dc.folios_documento,dc.observa_documento from tramite.movimientos_doc md," +
	        			"tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de,tramite.oficinas of," +
	        			"tramite.personal pr where tp.codigo_tipo=dc.codigo_tipo and " +
	        			"dc.codigo_documento=md.codigo_documento and dc.codigo_documento=de.codigo_documento and" +
	        			" md.codigo_documento=de.codigo_documento and de.destino_documento=of.codigo_oficina and" +
	        			" de.destinatario=pr.codigo_personal  and md.codigo_documento = " + "'" + codigo_documento + "'"+ " and" +
	        			" md.codigo_fondo = '01' and md.codigo_recepcion = " + "'" + codigo_recepcion + "'"+
	        			" and md.secuencia_movimiento = " + "'" + secuencia_movimiento + "'"+ "";
	        	
	        	
	        	//log.info("El ls_sql ggggggllll" + ls_sql);
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BMesaPartesVO = new BMesaPartes();
				
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					
					//BMesaPartesVO.setDescripcion_motivo(rs.getString("descripcion_motivo"));
					BMesaPartesVO.setFecha_registro(rs.getString("fecha_registro"));
					BMesaPartesVO.setHora_registro(rs.getString("hora_registro"));
					BMesaPartesVO.setFolios_documento(rs.getString("folios_documento"));
					BMesaPartesVO.setObserva_documento(rs.getString("observa_documento"));
					
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					////log.info("La oficina origen es.."+rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_recepcion(rs.getString("codigo_recepcion"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setNombre_motivo(funciones.of_nombre_motivo(cnx,rs.getString("codigo_motivo")));
					BMesaPartesVO.setNombre_oficina_origen(funciones.of_nombre_oficina(cnx,rs.getString("oficina_origen")));
					BMesaPartesVO.setNombre_oficina_destino(funciones.of_nombre_oficina(cnx,rs.getString("oficina_deriva")));
				}	
	            
				rs.close();
				
	        	
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return BMesaPartesVO;
		                
		}
	 
	 
	 public Collection of_busca_documentos_registrados(Connection cnx,String oficina,String codigo_documento,
			 String codigo_expediente,String ls_codigo_oficina) throws Exception{
			
			////log.info("ENTRO A BUSCAR Documentos");
			//BDocumentos BDocumentosVO= null;
			
			Collection ListaMesaPartes = new ArrayList();
			
			
			PreparedStatement us  = null;
			ResultSet rs = null;
			//StringBuffer ls_sql ="";
			
			try 
			{	
	
				StringBuilder ls_sql = new StringBuilder("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
							" md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
							"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
							"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion," +
							"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento," +
							"dc.numero_documento_ant,dc.dirigido,de.origen_documento,de.destino_documento,de.desc_origen," +
							"de.tipo,de.remitente,de.destinatario,of.codigo_oficina,of.descripcion_oficina," +
							"of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal" +
							" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
							" tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr " +
							" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and " +
							" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento " +
							" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and " +
							" de.destino_documento=of_a.codigo_oficina " +
							" and md.secuencia_movimiento = 1 and md.codigo_fondo like '01' " +
							" and (select count(tm.codigo_documento) from tramite.movimientos_doc  tm where tm.codigo_documento = md.codigo_documento and tm.secuencia_movimiento > 1 " +
							" and tm.estado_movimiento not in ('2','8'))=0 ");
					
					if(codigo_expediente != null && !codigo_expediente.equals("")){
			    		 ls_sql.append(" and md.codigo_expediente like '"+ codigo_expediente +"%' ");
			    		 ////log.info("el codigo_expediente: " + ls_sql);
						}
					
					log.info("Codigo de Oficina es:"+ls_codigo_oficina);
					
					if(ls_codigo_oficina != null && !ls_codigo_oficina.equals("0")){
			    		 ls_sql.append(" and md.codigo_oficina = '"+ls_codigo_oficina+"'");
			    		 
						}/*
					else{
						//and md.codigo_oficina like " + "'" + oficina + "'" " +		
						ls_sql.append("and trim(md.codigo_oficina) = '"+ oficina +"' ");
					}*/
					
					if(codigo_documento != null && !codigo_documento.equals("")){
			    		 ls_sql.append(" and md.codigo_documento like '"+ codigo_documento +"%' ");
			    		 ////log.info("el codigo_expediente: " + ls_sql);
						}
					
					ls_sql.append(" order by md.codigo_documento desc limit 30 ");
					
					String query = ls_sql.toString();
					
					log.info("query es..: " + query);
					
					us = cnx.prepareStatement(query);
					rs = us.executeQuery();
					
			    	 ////log.info("Si el tipo es Rendicion: " + rs);
					String ls_num_upload="";
					String ls_nomb_upload="";
			    	 Funciones funciones=new Funciones();
			    	 String ls_codigo_recepcion="";
			    	 String ls_codigo_documento="";
			    	 String ls_codigo_expediente="";
			    	 String ls_secuencia_movimiento="";
			    	 
			    	 String ls_ant_codigo_recepcion="";
			    	 String ls_ant_codigo_documento="";
			    	 String ls_ant_codigo_expediente="";
			    	 String ls_ant_secuencia_movimiento="";
			    	 
			    	 int contador=0;
					 while ( rs.next() ) { 
							
						 Hashtable objListaDoc = new Hashtable();
								
								objListaDoc.put("ACTION", "<A id='A1' target='_parent' href='ListaDocumentos.do?tipo=modificardoc" +
										"&codigo_documento="+rs.getString("codigo_documento").trim()+
										"&codigo_expediente="+rs.getString("codigo_expediente").trim()+
										"&secuencia_movimiento="+rs.getString("secuencia_movimiento").trim()+ "'>"+
										"<font color='#0000FF'>Seleccionar</font> </A>");
								
								objListaDoc.put("codigo_documento", "<A id='A1' target='_parent' href='ListaDocumentos.do?tipo=modificardoc" +
										"&codigo_documento="+rs.getString("codigo_documento").trim()+
										"&codigo_expediente="+rs.getString("codigo_expediente").trim()+
										"&secuencia_movimiento="+rs.getString("secuencia_movimiento").trim()+ "'>"+
										"<font color='#0000FF'>"+rs.getString("codigo_documento").trim()+"</font> </A>");
								
								objListaDoc.put("codigo_expediente", "<A id='A1' target='_parent' href='ListaDocumentos.do?tipo=modificardoc" +
										"&codigo_documento="+rs.getString("codigo_documento").trim()+
										"&codigo_expediente="+rs.getString("codigo_expediente").trim()+
										"&secuencia_movimiento="+rs.getString("secuencia_movimiento").trim()+ "'>"+
										"<font color='#0000FF'>"+rs.getString("codigo_expediente").trim()+"</font> </A>");
								
								objListaDoc.put("numero_documento", "<A id='A1' target='_parent' href='ListaDocumentos.do?tipo=modificardoc" +
										"&codigo_documento="+rs.getString("codigo_documento").trim()+
										"&codigo_expediente="+rs.getString("codigo_expediente").trim()+
										"&secuencia_movimiento="+rs.getString("secuencia_movimiento").trim()+ "'>"+
										"<font color='#0000FF'>"+rs.getString("numero_documento").trim()+"</font> </A>");
								
								objListaDoc.put("oficina_origen", "<A id='A1' target='_parent' href='ListaDocumentos.do?tipo=modificardoc" +
										"&codigo_documento="+rs.getString("codigo_documento").trim()+
										"&codigo_expediente="+rs.getString("codigo_expediente").trim()+
										"&secuencia_movimiento="+rs.getString("secuencia_movimiento").trim()+ "'>"+
										"<font color='#0000FF'>"+funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</font> </A>");
								objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
								objListaDoc.put("estado_movimiento", rs.getString("estado_movimiento"));
								objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
								objListaDoc.put("hora", rs.getString("hora_movimiento"));
								objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
								objListaDoc.put("codigo_recepcion", "<A id='A1' target='_parent' href='ListaDocumentos.do?tipo=modificardoc" +
										"&codigo_documento="+rs.getString("codigo_documento").trim()+"&codigo_expediente="+rs.getString("codigo_expediente").trim() +
										"&numero_documento=0&oficina_origen="+rs.getString("oficina_origen").trim()+
										"&oficina_deriva="+rs.getString("oficina_deriva").trim()+"&secuencia_movimiento="+rs.getString("secuencia_movimiento").trim()+"&fecha_rpta="+rs.getString("fecha_rpta").trim()+"&tiposegumiento=R'"+
										"<font color='#0000FF'>"+rs.getString("codigo_recepcion")+"</font> </A>");
								
								objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
								objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
								//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
								objListaDoc.put("naturaleza_documento", rs.getString("naturaleza_documento"));
								
								 ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
								
								if(ls_num_upload.equals("0")){
									objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
								}else {
									objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
									"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
								}
								
								
								ListaMesaPartes.add(objListaDoc);
						}	
					 log.info("El numero total de registros es:"+ListaMesaPartes.size());
					 
				
				
				rs.close();
				
			} catch (SQLException e) 
			{
				 e.printStackTrace();
			}
			return ListaMesaPartes;
	                
			}
	 
	 
	 public BMesaPartes  of_consulta_documento(Connection cnx,String codigo_documento,String secuencia_movimiento) throws Exception {
			
	        //log.info("ENTRO Al detalle Consulta documento");
			
			
	        BMesaPartes BMesaPartesVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       Funciones funciones=new Funciones();
	        try {	
	        	
	        	

	        	String ls_sql = "select md.codigo_documento,md.fecha_movimiento,md.hora_movimiento," +
	        			"md.estado_movimiento,md.secuencia_movimiento,md.ultimo_usuario,md.doc_deriva," +
	        			"md.observa_movimiento,md.codigo_motivo,md.codigo_inicia,md.oficina_origen,md.oficina_deriva,md.codigo_recepcion,md.codigo_expediente,md.fecha_rpta,md.desc_origen as descrip_origen,tp.descripcion_tipo," +
	        			"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.codigo_tipo,dc.dirigido,de.origen_documento," +
	        			"de.destino_documento,de.desc_origen,de.tipo,de.remitente,de.destinatario,de.medio," +
	        			"de.codigo_solicitud,de.firmadopor,of.codigo_oficina," +
	        			"of.descripcion_oficina,pr.codigo_personal,pr.nombre_personal,dc.fecha_registro," +
	        			"dc.hora_registro,dc.folios_documento,dc.observa_documento from tramite.movimientos_doc md," +
	        			"tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de,tramite.oficinas of," +
	        			"tramite.personal pr,tramite.solicitud sl where tp.codigo_tipo=dc.codigo_tipo and " +
	        			"dc.codigo_documento=md.codigo_documento and dc.codigo_documento=de.codigo_documento and" +
	        			" md.codigo_documento=de.codigo_documento and de.destino_documento=of.codigo_oficina and" +
	        			" de.destinatario=pr.codigo_personal and md.codigo_documento = " + "'" + codigo_documento + "'"+
	        			" and md.codigo_fondo = '01' and md.secuencia_movimiento = " + "'" + secuencia_movimiento + "'"+ "";
	        	
	        	
	        	////log.info("El ls_sql ggggggllll" + ls_sql);
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		
				while ( rs.next() ) { 
					
					BMesaPartesVO = new BMesaPartes();
				
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("descrip_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					
					//BMesaPartesVO.setDescripcion_motivo(rs.getString("descripcion_motivo"));
					BMesaPartesVO.setFecha_registro(rs.getString("fecha_registro"));
					BMesaPartesVO.setHora_registro(rs.getString("hora_registro"));
					BMesaPartesVO.setFolios_documento(rs.getString("folios_documento"));
					BMesaPartesVO.setObserva_documento(rs.getString("observa_documento"));
					//BMesaPartesVO.setNombre_solicitud(rs.getString("nombre_solicitud"));
					
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					////log.info("La oficina origen es.."+rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_recepcion(rs.getString("codigo_recepcion"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setNombre_motivo(funciones.of_nombre_motivo(cnx,rs.getString("codigo_motivo")));
					BMesaPartesVO.setNombre_oficina_origen(funciones.of_nombre_oficina(cnx,rs.getString("oficina_origen")));
					BMesaPartesVO.setNombre_oficina_destino(funciones.of_nombre_oficina(cnx,rs.getString("oficina_deriva")));
					BMesaPartesVO.setCodigo_tipo(rs.getString("codigo_tipo").trim());
					//BMesaPartesVO.setCodigo_solicitud(funciones.of_solicitud_documento(cnx,rs.getString("codigo_solicitud")).trim());
					BMesaPartesVO.setCodigo_solicitud(rs.getString("codigo_solicitud"));
					//BMesaPartesVO.setMedio(funciones.of_medio_documento(cnx,rs.getString("medio")).trim());
					BMesaPartesVO.setMedio(rs.getString("medio"));
					BMesaPartesVO.setDirigido(rs.getString("dirigido"));
					BMesaPartesVO.setFirmadopor(rs.getString("firmadopor"));
					
				}	
	            
				rs.close();
				
	        	
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return BMesaPartesVO;
		                
		}
	 
	 public Collection  lista_upload_documentos_doc_entrada(Connection cnx,int codigo_documento,int secuencia_movimiento) throws Exception {
			
	        ////log.info("ENTRO A  Lista de Proyecto Investigacion Upload");
			Collection lista = new ArrayList();
			
			BDocumento BDocumentoVO = null;
			Statement us  = null;
			ResultSet rs = null;
			ObtieneConexion 	x= new ObtieneConexion();
	    	Connection			cn = x.getConnection();
	        try {	
				String ls_sql = "select * from tramite.tbl_det_upload  " +
				"where codigo_documento=" + "'" + codigo_documento +"'"+
				//" and secuencia_movimiento=" + "'" + secuencia_movimiento +"'"+
				" and flag = 'I' and tipo = 'P' order by id_det_upload asc";
	        	
				////log.info("El ls_sql..."+ ls_sql);
				us = cn.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		////log.info("El rst"+ rst);
	    		Funciones funciones=new Funciones();
	    		//log.info("El ls_sql...." + ls_sql);
	    		int contador=0;
	    		
				while ( rs.next() ) { 
					
					contador=contador+1;
					BDocumentoVO = new BDocumento();
					BDocumentoVO.setContador(contador);
					BDocumentoVO.setId_det_upload(rs.getInt("id_det_upload"));
					BDocumentoVO.setNombre_archivo(rs.getString("nombre_archivo"));
					
					lista.add(BDocumentoVO);
					
				}	
	            
				x.cerrar_conexion(cn, rs);
	            
	        } catch (SQLException sqle) {
	        	log.info("Error en el metodo Lista Proyecto Investigacion Upload..");
				//mensaje=sqle.toString();  
				sqle.printStackTrace();
				x.cerrar_conexion(cn);
	        }
	        return lista;
		                
		}
	 
	 public void of_eliminar_documento_upload(Connection cnx,String id_det_upload,String codigo_documento) {
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
	    	Connection			cn = x.getConnection();
	    	
	    	String ls_sql = "";
	    	 Statement us  = null;
	    	
	    	 
	    	 try{
	    		 
	    			ls_sql = "delete from tramite.tbl_det_upload WHERE id_det_upload =" + "'" + id_det_upload + "'"+
	    			" and codigo_documento =" + "'" + codigo_documento + "'";
	    			
	    			log.info("El ls_sql delete documento....: "+ ls_sql);	
	 	    		us = cn.createStatement();
	 	    		us.executeUpdate(ls_sql);
	 	    		
	 	    		x.cerrar_conexion(cn);
	 	    		
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		x.cerrar_conexion(cn);
	    	} 
	    	
	    }
	 
	 public BMesaPartes  of_detalle_documento_hoja_ruta(Connection cnx,String codigo_documento) throws Exception {
			
		 	ObtieneConexion x= new ObtieneConexion();
	    	Connection	cn = x.getConnection();
	    				
	        BMesaPartes BMesaPartesVO = null;
			Statement us  = null;
			ResultSet rs = null;
	        Funciones funciones=new Funciones();
	        try {	
	        	
	        	

	        	StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.fecha_movimiento,md.hora_movimiento,");
	        	ls_sql.append("md.estado_movimiento,md.secuencia_movimiento,md.ultimo_usuario,md.doc_deriva,");
	        	ls_sql.append("md.observa_movimiento,md.codigo_motivo,md.codigo_inicia,md.oficina_origen,md.oficina_deriva,md.codigo_recepcion,md.codigo_expediente,md.fecha_rpta,tp.descripcion_tipo,");
	        	ls_sql.append("dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,de.origen_documento,");
	        	ls_sql.append("de.destino_documento,de.desc_origen,de.tipo,de.remitente,de.destinatario,of.codigo_oficina,");
	        	ls_sql.append("of.descripcion_oficina,pr.codigo_personal,pr.nombre_personal,dc.fecha_registro,");
	        	ls_sql.append("dc.hora_registro,dc.folios_documento,dc.observa_documento from tramite.movimientos_doc md,");
	        	ls_sql.append("tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de,tramite.oficinas of,");
	        	ls_sql.append("tramite.personal pr where tp.codigo_tipo=dc.codigo_tipo and ");
	        	ls_sql.append("dc.codigo_documento=md.codigo_documento and dc.codigo_documento=de.codigo_documento and");
	        	ls_sql.append(" md.codigo_documento=de.codigo_documento and de.destino_documento=of.codigo_oficina and");
	        	ls_sql.append(" de.destinatario=pr.codigo_personal  and md.codigo_documento = '" + codigo_documento + "'  and");
	        	ls_sql.append(" md.codigo_fondo = '01' and md.secuencia_movimiento = '1'");
	        	
	        	        	
		    	us = cn.createStatement();
	    		rs = us.executeQuery(ls_sql.toString());
	    		
				while ( rs.next() ) { 
					
					BMesaPartesVO = new BMesaPartes();
				
					
					BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
					BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
					BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
					BMesaPartesVO.setEstado_movimiento(rs.getString("estado_movimiento"));
					BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
					
					BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
					BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
					
					BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
					BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
					BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
					BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
					BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
					BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
					BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
					BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
					BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
					BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
					BMesaPartesVO.setTipo(rs.getString("tipo"));
					BMesaPartesVO.setRemitente(rs.getString("remitente"));
					
					BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
					BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
					BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
					
					//BMesaPartesVO.setDescripcion_motivo(rs.getString("descripcion_motivo"));
					BMesaPartesVO.setFecha_registro(rs.getString("fecha_registro"));
					BMesaPartesVO.setHora_registro(rs.getString("hora_registro"));
					BMesaPartesVO.setFolios_documento(rs.getString("folios_documento"));
					BMesaPartesVO.setObserva_documento(rs.getString("observa_documento"));
					
					BMesaPartesVO.setOficina_origen(rs.getString("oficina_origen"));
					////log.info("La oficina origen es.."+rs.getString("oficina_origen"));
					BMesaPartesVO.setOficina_deriva(rs.getString("oficina_deriva"));
					BMesaPartesVO.setCodigo_recepcion(rs.getString("codigo_recepcion"));
					BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
					BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
					BMesaPartesVO.setNombre_motivo(funciones.of_nombre_motivo(cn,rs.getString("codigo_motivo")));
					BMesaPartesVO.setNombre_oficina_origen(funciones.of_nombre_oficina(cn,rs.getString("oficina_origen")));
					BMesaPartesVO.setNombre_oficina_destino(funciones.of_nombre_oficina(cn,rs.getString("oficina_deriva")));
				}	
	            
				rs.close();
				x.cerrar_conexion(cn);
				
	        	
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(cn);
	        }
	        return BMesaPartesVO;
		                
		}
	 
	 public Collection  lista_derivacion_documentos(Connection cnx,String oficina,String persona,String inicia) throws Exception {
			
	        log.info("ENTRO A  lista_derivacion_documentos(Connection cnx,String oficina,String persona,String inicia)");
			Collection ListaMesaPartes = new ArrayList();
			
			/*BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;*/
			
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			Statement us  = null;
			ResultSet rs = null;
			PreparedStatement pstmt = null;
	      
			/*String ls_desde;
	        String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	String ls_num_upload="";
	    	String ls_valor  = "";
	    	int li_retorno=0;*/
	    	
			String ls_correla= "";
	    	Date fecha_recep = new Date(); // fecha y hora locales 
	    	SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
	    	SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); 
			/*//log.info("la fecha es.."+ formatoFecha.format(fecha_recep) ); 
			//log.info("la hora es.."+ formatoHora.format(fecha_recep) );*/ 
	    
	    	//Funciones funcion=new Funciones();
		
	        try {	
	        	
	        		
	        		 StringBuilder ls_sql = new StringBuilder("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,");
	        		 ls_sql.append("md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,");
	        		 ls_sql.append("md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta,");
	        		 ls_sql.append("md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion,");
	        		 ls_sql.append("md.destinatario,tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,");
	        		 ls_sql.append("dc.numero_documento_ant,de.origen_documento,de.destino_documento,de.desc_origen,");
	        		 ls_sql.append("de.tipo,de.remitente,de.destinatario,of.codigo_oficina,of.descripcion_oficina,");
	        		 ls_sql.append("of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal");
	        		 
	        		 ls_sql.append(",(select count(tdetu.codigo_documento) from tramite.tbl_det_upload  tdetu  where tdetu.codigo_documento = md.codigo_documento) as numupload ");
	 				ls_sql.append(",tedoc.estado_expediente as estado_expediente ");
	 				ls_sql.append(",(select tofi.descripcion_oficina from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_origen) as nombre_oficina_origen");
	 				ls_sql.append(",(select tofi.descripcion_oficina from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_deriva) as nombre_oficina_deriva ");
	        		 		
	        		 ls_sql.append(" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc,");
	        		 ls_sql.append("tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr,tramite.estados_doc tedoc  ");
	        		 		
	        		 ls_sql.append(" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and");
	        		 ls_sql.append(" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento");
	        		 ls_sql.append(" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and");
	        		 ls_sql.append(" de.destino_documento=of_a.codigo_oficina  and md.estado_movimiento=tedoc.codigo_estado and md.estado_movimiento = '3' and");
	        		 ls_sql.append(" md.codigo_fondo like '01' and md.codigo_oficina =?  ");
	        		 ls_sql.append(" and md.destinatario = ?  ");
	        		 ls_sql.append(" order by md.fecha_consulta desc, md.hora_movimiento desc,");
	        		 ls_sql.append(" md.codigo_documento desc");
	        		 
			        	/*if(inicia!=null && inicia.equals("SI")){
							ls_sql.append(" limit 30");
						}*/

	        		 pstmt = con.prepareStatement(ls_sql.toString());
	    	    	 pstmt.setInt(1, Integer.parseInt(oficina));
	    	    	 pstmt.setString(2, persona);
	    	    	 
	    	    	log.info(" ls_sql.... : " + pstmt);
	    	    	 
	    	    	rs=pstmt.executeQuery();

	    		
	    		//Funciones funciones=new Funciones();
				while (rs.next()) { 
					StringBuilder constantea = new StringBuilder("");
					StringBuilder constanteb = new StringBuilder("");

					Hashtable objListaDoc = new Hashtable();
					
					 constantea.append("<label style='cursor: hand;' align='center' onclick=fn_editar('");
					 constantea.append(rs.getString("codigo_documento").trim());
					 constantea.append("','");
					 constantea.append(rs.getString("codigo_expediente").trim());
					 constantea.append("','");
					 constantea.append(rs.getString("descripcion_tipo").trim());
					 constantea.append("','");
					 constantea.append(rs.getString("numero_documento"));
					 constantea.append("','");
					 constantea.append(rs.getString("codigo_oficina"));
					 constantea.append("','");
					 constantea.append(rs.getString("estado_movimiento"));
					 constantea.append("','");
					 constantea.append(rs.getString("fecha_movimiento"));
					 constantea.append("','");
					 constantea.append(rs.getString("hora_movimiento"));
					 constantea.append("','");
					 constantea.append(rs.getString("secuencia_movimiento"));
					 constantea.append("','");
					 constantea.append(rs.getString("codigo_inicia"));
					 constantea.append("','");
					 constantea.append(rs.getString("naturaleza_documento"));
					 constantea.append("','");
				     constantea.append(ls_correla);
					 constantea.append("');>");
		 
					 constanteb.append("</label>");

					/*String seleccionar = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
			        + rs.getString("codigo_expediente") + "'"+ "," 
			        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
			        + "'"+ rs.getString("numero_documento") + "'"+ "," 
			        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
			        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
			        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
			        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
			        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
			        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
			        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
			        + "'"+ ls_correla + "'"
			        + ");\" " + ">Seleccionar</label>";*/
					
				/*	String ls_codigo_expediente = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
				        + "'"+ ls_correla + "'"
				        + ");\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
					
					String ls_codigo_documento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
				        + "'"+ ls_correla + "'"
				        + ");\" " + ">"+ rs.getString("codigo_documento")+"</label>";
					
					String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
				        + "'"+ ls_correla + "'"
				        + ");\" " + ">"+ rs.getString("numero_documento")+"</label>";
					
					String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
				        + "'"+ ls_correla + "'"
				        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
					
					String ls_fecha_movimiento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
				        + rs.getString("codigo_expediente") + "'"+ "," 
				        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
				        + "'"+ rs.getString("numero_documento") + "'"+ "," 
				        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
				        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
				        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
				        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
				        + "'"+ rs.getString("secuencia_movimiento") + "'"+ ","
				        + "'"+ rs.getString("codigo_inicia") + "'"+ ","
				        + "'"+ rs.getString("naturaleza_documento") + "'"+ ","
				        + "'"+ ls_correla + "'"
				        + ");\" " + ">"+ rs.getString("fecha_movimiento")+"</label>";*/
					
					//objListaDoc.put("ACTION", seleccionar);
					objListaDoc.put("codigo_documento", constantea+rs.getString("codigo_documento")+constanteb);
					objListaDoc.put("codigo_expediente", constantea+rs.getString("codigo_expediente")+constanteb);
					objListaDoc.put("numero_documento", constantea+rs.getString("numero_documento")+constanteb);
					objListaDoc.put("oficina_origen", constantea+rs.getString("nombre_oficina_origen")+constanteb);
					objListaDoc.put("fecha_movimiento", constantea+rs.getString("fecha_movimiento")+constanteb);
					
					
					objListaDoc.put("oficina_deriva", rs.getString("nombre_oficina_deriva"));
					objListaDoc.put("estado_movimiento","<FONT color='#00CC00'>"+rs.getString("estado_expediente").trim()+"</FONT>");
					
					objListaDoc.put("hora", rs.getString("hora_movimiento"));
					objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
					objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
					
					objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
					objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
					//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
					objListaDoc.put("naturaleza_documento", rs.getString("naturaleza_documento"));
					
					if(rs.getInt("numupload")==0){
						objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
					}else {
						objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
						"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
					}
					/*ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
					if(ls_num_upload.equals("0")){
						objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
					}else {
						objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
						"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
					}*/

					/*objListaDoc.put("view_archivo", "<A id='A1' target='_blank' href='N:\\DocumentosTramite\\" +
							rs.getString("codigo_expediente").trim()+".PDF"+"'"+
							"><img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'>  </A>");*/
					
					ListaMesaPartes.add(objListaDoc);
					

				}	
	            x.cerrar_conexion(con, rs);
				pstmt.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con);
	        }
	        return ListaMesaPartes;
		                
		}
	 //2
	 public void of_registrar_derivacion_mismo(Connection cnx,String ls_oficina,String codigo_oficina,String codigo_motivo,String observacion
	   			,String destinatario,String ls_documento,String ls_secuencia,String ls_usuario,String ls_codigoPadre,
	   			int correla,String fecha_rpta,int codigo_expediente,String ls_descripcion_oficina,
	   			int codigo_recepcion,String doc_resp,String fecha_rpta_rq,String flag) {
	    	
	     //   obtenermos el valor maximo...
	    	log.info("dentro del Registro derivacion.......Para Jefes o secretarias - CON LA OFICINA ORIGEN = OFICINA DESTINO" );
	    	
	    	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	Calendar calendario = new GregorianCalendar();
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "2";
	    	String ls_valor  = "";
	    	String origen_documento  = "";
	    	
	    	String horaActual = "00:00:00";
	    	Calendar cal = Calendar.getInstance();
	        Date hora = cal.getTime();
	        DateFormat df = DateFormat.getTimeInstance();
	        horaActual = df.format(hora);
	        
	       // //log.info("horaActual.... : " + horaActual);
	       
	        
	    	int    li_retorno =0;
	    	int    li_secuencia =0;
	    	int    li_secuencia_nueva =0;
	    	int    li_secuencia_recorrido =0;
	    	
	    //	//log.info("eL ls_secuencia ES.... : " + ls_secuencia);
	    	
	    	li_secuencia_recorrido=Integer.valueOf(ls_secuencia).intValue()+1;
	    	
	    	
	    	// //log.info("eL li_secuencia_recorrido ES.... : " + li_secuencia_recorrido);
	    	 
	    	int    li_parcial = 0 ;
	    	
	    	String codigo_documento= "" ;
	    	String ls_extraer_year= "" ;
	    	
	    	String ls_correlativo=null;
	    	
	    	Statement us  = null;
			ResultSet rs = null;
			
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
	    		
	    	
	    		ls_sql = "Select max(secuencia_movimiento) as c_valor from tramite.movimientos_doc where codigo_documento =" + "'" + ls_codigoPadre + "'" + "";
 			//log.info("ls_sql............   " + ls_sql );
 			us = con.createStatement();
		    	 rs = us.executeQuery(ls_sql);
		    //	 //log.info("El resultset es: " + rs);
				
		    	 if (rs == null) 
		    		{
		    			////log.info("rs es nulo ......." );
		    			li_secuencia_nueva = 1;
		    	    }
		    		else
		    		{
		    			////log.info("rs NO es nulo ......." );
			    		while ( rs.next() ) { 
			    				         //   //log.info("dentro del whyle......." );
			    				            if (rs.getString("c_valor") == null )
			    				            {
			    				    		//	//log.info("ta vacio nulo ......." );
			    				    			li_secuencia_nueva = 1;
			    				    	    }
			    				            else
			    				    		{
			    				            	////log.info("ls_valor :" + rs.getString("c_valor"));
			    				            	li_secuencia = Integer.valueOf(rs.getString("c_valor")).intValue();
			    				            	li_secuencia_nueva = Integer.valueOf(rs.getString("c_valor")).intValue() + 1;
			    				            	////log.info("nuevo li_secuencia :" + li_secuencia_nueva);
			    				    		}
			    				           
			    		}
			        }
		    	 
		    	 //Se quito el correlativo_deriva !!
		    	 ls_sql = "insert into tramite.movimientos_doc(codigo_documento," +
		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie,codigo_motivo," +
		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
		 		"oficina_deriva,destinatario,fecha_rpta,codigo_expediente,oficina_origen,desc_origen,codigo_recepcion,doc_resp,fecha_rpta_rq,flag) values(" + "'" + ls_codigoPadre + "'"
	 	 		+ "," +"'01'"+","+"'"+ li_secuencia_nueva + "'"+ "," +"'" + codigo_oficina + "'"+ "," +"'01'"
	 	 		+ "," + "'" + codigo_motivo + "'"+ "," + "'" + origen_documento + "'"+ "," +"'2'"
	 	 		+ "," +"'" + fecha_documento + "'"+ "," +"'" + fechaconsulta + "'"+ "," +"'" + horaActual + "'"
	 	 		+ "," +"'" + observacion + "'"+ "," +"'" + ls_codigoPadre + "'"
	 	 		+ "," +"'" + ls_usuario + "'"+ "," +"'01'"+ "," +"'" + codigo_oficina + "'"+
	 	 		"," +"'" + destinatario + "'"+","+"'"+fecha_rpta+"'"+","+"'"+codigo_expediente+"'"+
	 			","+"'"+ls_oficina+"'"+
	 	 		","+"'"+ls_descripcion_oficina+"'"+
	 	 		","+"'"+correla+"'"+
	 	 		","+"'"+doc_resp+"'"+
	 	 		","+"'"+fecha_rpta_rq+"'"+
	 	 		","+"'"+flag+"'"+
	 	 		")";
		    	 
		    	//log.info("El primer ls_sql es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);
		    	 
		    	
			    	 //log.info("La secuencia del movimiento lista seleccionado es:" + ls_secuencia );
		    		 ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento="+"'5'"+","+
			    	 "fecha_movimiento="+"'"+fecha_documento+"'"+","+"hora_movimiento="+
			    	 "'"+horaActual+"'"+","+"ultimo_usuario="+"'"+ls_usuario+"'"+
			    	 ","+"fecha_rpta="+"'"+fecha_rpta+"'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+ls_secuencia+"'"+"";
			    	// //log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); 
			    	 
			    	 /********************registrando derivacion documento***********/
			    	 
			    	 //log.info("Si el valor es 0 a ingresar duplicacion derivacion");
		 			 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+"'"+li_secuencia_nueva+"'"+
		    	 		" )";
				    	 
			    	// //log.info("El ls_sql insert recorrido_doc 2 documento es" + ls_sql);	 
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
			    	 
			    	 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+"'"+ls_secuencia+"'"+
		    	 		" )";
			    	 
			    	 ////log.info("El ls_sql insert recorrido_doc 1 documento es" + ls_sql);
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	
				    
			    	  
			    	 //log.info("update a los estados del recorrido es:" + ls_secuencia );
		    		 ls_sql = "UPDATE tramite.recorrido_doc SET estado="+"'2'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+ls_secuencia+"'"+"";
			    	// //log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); 
			    	 
			    	// //log.info("update a los estados 2 del recorrido es:" + ls_secuencia );
		    		 ls_sql = "UPDATE tramite.recorrido_doc SET estado="+"'1'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+li_secuencia_nueva+"'"+"";
			    	// //log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); 
			    	 
			    	 x.cerrar_conexion(con);
			    	 
			   
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		x.cerrar_conexion(con);
	    	}

		}
	 
	 public void of_registrar_derivacion_mismo(Connection cnx,String ls_oficina,String codigo_oficina,String codigo_motivo,String observacion
	   			,String destinatario,String ls_documento,String ls_secuencia,String ls_usuario,String ls_codigoPadre,
	   			int correla,String fecha_rpta,int codigo_expediente,String ls_descripcion_oficina,
	   			int codigo_recepcion,String doc_resp,String fecha_rpta_rq,String flag,int secuencia_origen, int value) {
	    	
	     //   obtenermos el valor maximo...
	    	log.info("dentro del Registro derivacion.......Para Jefes o secretarias - CON LA OFICINA ORIGEN = OFICINA DESTINO value 0" );
	    	
	    	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	Calendar calendario = new GregorianCalendar();
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "2";
	    	String ls_valor  = "";
	    	String origen_documento  = "";
	    	
	    	String horaActual = "00:00:00";
	    	Calendar cal = Calendar.getInstance();
	        Date hora = cal.getTime();
	        DateFormat df = DateFormat.getTimeInstance();
	        horaActual = df.format(hora);
	        
	       // //log.info("horaActual.... : " + horaActual);
	       
	        
	    	int    li_retorno =0;
	    	int    li_secuencia =0;
	    	int    li_secuencia_nueva =1;
	    	int    li_secuencia_recorrido =0;
	    	
	    //	//log.info("eL ls_secuencia ES.... : " + ls_secuencia);
	    	
	    	li_secuencia_recorrido=Integer.valueOf(ls_secuencia).intValue()+1;
	    	
	    	
	    	// //log.info("eL li_secuencia_recorrido ES.... : " + li_secuencia_recorrido);
	    	 
	    	int    li_parcial = 0 ;
	    	
	    	String codigo_documento= "" ;
	    	String ls_extraer_year= "" ;
	    	String ls_correlativo=null;
	    	String ls_sql = "";
	    	
	    	int secuencia_origen_ls=secuencia_origen;
	    	
   		 	int horadia = calendario.get(Calendar.HOUR_OF_DAY);
   		 	int minutos = calendario.get(Calendar.MINUTE);
   		 	int segundos = calendario.get(Calendar.SECOND);
	    	
	    	ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
	    	Statement us  = null;
			ResultSet rs = null;
			PreparedStatement pstm = null;
			
	    	try{
	    		
	    	
	    		ls_sql = "Select max(secuencia_movimiento) as c_valor from tramite.movimientos_doc where codigo_documento=? ";
	    		pstm = con.prepareStatement(ls_sql);
				pstm.setInt(1, Integer.parseInt(ls_codigoPadre));
				rs = pstm.executeQuery();
			
				while(rs.next()){
					li_secuencia = rs.getInt("c_valor");
	            	li_secuencia_nueva = rs.getInt("c_valor") + 1;

		 		}
	    		
	    		
	    		/** //log.info("ls_sql............   " + ls_sql );
	    			us = con.createStatement();
	    			rs = us.executeQuery(ls_sql);
		    //	 //log.info("El resultset es: " + rs);
				
		    	 if (rs == null){
		    			////log.info("rs es nulo ......." );
		    			li_secuencia_nueva = 1;
		    	 }else{
		    			////log.info("rs NO es nulo ......." );
			    		while ( rs.next() ) { 
			    				         //   //log.info("dentro del whyle......." );
			    				            if (rs.getString("c_valor") == null )
			    				            {
			    				    		//	//log.info("ta vacio nulo ......." );
			    				    			li_secuencia_nueva = 1;
			    				    	    }
			    				            else
			    				    		{
			    				            	////log.info("ls_valor :" + rs.getString("c_valor"));
			    				            	li_secuencia = Integer.valueOf(rs.getString("c_valor")).intValue();
			    				            	li_secuencia_nueva = Integer.valueOf(rs.getString("c_valor")).intValue() + 1;
			    				            	////log.info("nuevo li_secuencia :" + li_secuencia_nueva);
			    				    		}
			    				           
			    		}
			        }***/
		    	 
		    	 //Se quito el correlativo_deriva !!
				StringBuffer ls_sql1= new StringBuffer("insert into tramite.movimientos_doc(codigo_documento," +
		 		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie,codigo_motivo," +
		 		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		 		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
		 		 		"oficina_deriva,destinatario,fecha_rpta,codigo_expediente,oficina_origen,desc_origen," +
		 		 		"codigo_recepcion,doc_resp,fecha_rpta_rq,flag,secuencia_origen,tipo_envio) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)");
				
				
				pstm = con.prepareStatement(ls_sql1.toString());
				pstm.setInt(1, Integer.parseInt(ls_codigoPadre));
				pstm.setString(2, "01");
				pstm.setInt(3, li_secuencia_nueva);						
		    	pstm.setInt(4, Integer.parseInt(codigo_oficina));
		    	pstm.setString(5, "01");
		    	pstm.setInt(6, Integer.parseInt(codigo_motivo));
		    	pstm.setString(7, origen_documento);
		    	pstm.setString(8, "2");
		    	pstm.setString(9, fecha_documento);
		    	 pstm.setString(10, fechaconsulta);
		    	 pstm.setTime(11, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
		    	 pstm.setString(12, observacion);
		    	 pstm.setInt(13, Integer.parseInt(ls_codigoPadre));
		    	 pstm.setString(14, ls_usuario);
		    	 pstm.setString(15, "01");
		    	 pstm.setInt(16, Integer.parseInt(codigo_oficina));
		    	 pstm.setString(17, destinatario);
		    	 pstm.setString(18, fecha_rpta);
		    	 pstm.setInt(19, codigo_expediente);
		    	 pstm.setInt(20, Integer.parseInt(ls_oficina));
		    	 pstm.setString(21, ls_descripcion_oficina);
		    	 pstm.setInt(22, correla);
		    	 pstm.setString(23, doc_resp);
		    	 pstm.setString(24, fecha_rpta_rq);
		    	 pstm.setString(25, flag);
		    	 pstm.setInt(26, secuencia_origen_ls);
		    	 pstm.setString(27, "P");
		    	 pstm.executeUpdate();
				
				
				
		    	/*** ls_sql = "insert into tramite.movimientos_doc(codigo_documento," +
		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie,codigo_motivo," +
		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
		 		"oficina_deriva,destinatario,fecha_rpta,codigo_expediente,oficina_origen,desc_origen," +
		 		"codigo_recepcion,doc_resp,fecha_rpta_rq,flag) values(" + "'" + ls_codigoPadre + "'"
	 	 		+ "," +"'01'"+","+"'"+ li_secuencia_nueva + "'"+ "," +"'" + codigo_oficina + "'"+ "," +"'01'"
	 	 		+ "," + "'" + codigo_motivo + "'"+ "," + "'" + origen_documento + "'"+ "," +"'2'"
	 	 		+ "," +"'" + fecha_documento + "'"+ "," +"'" + fechaconsulta + "'"+ "," +"'" + horaActual + "'"
	 	 		+ "," +"'" + observacion + "'"+ "," +"'" + ls_codigoPadre + "'"
	 	 		+ "," +"'" + ls_usuario + "'"+ "," +"'01'"+ "," +"'" + codigo_oficina + "'"+
	 	 		"," +"'" + destinatario + "'"+","+"'"+fecha_rpta+"'"+","+"'"+codigo_expediente+"'"+
	 			","+"'"+ls_oficina+"'"+
	 	 		","+"'"+ls_descripcion_oficina+"'"+
	 	 		","+"'"+correla+"'"+
	 	 		","+"'"+doc_resp+"'"+
	 	 		","+"'"+fecha_rpta_rq+"'"+
	 	 		","+"'"+flag+"'"+
	 	 		")";
		    	 
		    	//log.info("El primer ls_sql es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);***/
		    	 
		    	 
		    	 
		    	 ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento=?, fecha_movimiento=?, hora_movimiento=?, "
			    		 +"ultimo_usuario=? ,fecha_rpta=?  where codigo_fondo=?  and  codigo_oficina=? "+
			    		 " and codigo_documento=?  and secuencia_movimiento=? ";
			    	 
			    	 	pstm = con.prepareStatement(ls_sql);
			    	 	pstm.setString(1, "5");
			    	 	pstm.setString(2, fecha_documento);
			    	 	pstm.setTime(3, Time.valueOf(String.valueOf(horadia)+":"+String.valueOf(minutos)+":"+String.valueOf(segundos)));
			    	 	pstm.setString(4, ls_usuario);
			    	 	pstm.setString(5, fecha_rpta);
			    	 	pstm.setString(6, "01");
			    	 	pstm.setInt(7, Integer.parseInt(ls_oficina));
						pstm.setInt(8, Integer.parseInt(ls_codigoPadre));
						pstm.setInt(9, Integer.parseInt(ls_secuencia));
							
						pstm.executeUpdate();
		    	
			    	/*** //log.info("La secuencia del movimiento lista seleccionado es:" + ls_secuencia );
		    		 ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento="+"'5'"+","+
			    	 "fecha_movimiento="+"'"+fecha_documento+"'"+","+"hora_movimiento="+
			    	 "'"+horaActual+"'"+","+"ultimo_usuario="+"'"+ls_usuario+"'"+
			    	 ","+"fecha_rpta="+"'"+fecha_rpta+"'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+ls_secuencia+"'"+"";
			    	// //log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); 
			    	 
			    	 /********************registrando derivacion documento***********/
			    	 
						ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
				    	 		" codigo_fondo=?  and codigo_oficina=? "+
				    	 		" and codigo_documento=?  and secuencia_movimiento=? )";
								pstm = con.prepareStatement(ls_sql);
					    	 	pstm.setString(1, "01");
					    	 	pstm.setInt(2, Integer.parseInt(codigo_oficina));
								pstm.setInt(3, Integer.parseInt(ls_codigoPadre));
								pstm.setInt(4, li_secuencia_nueva);
									
								pstm.executeUpdate();	
						
						
			    	/*** //log.info("Si el valor es 0 a ingresar duplicacion derivacion");
		 			 ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+"'"+li_secuencia_nueva+"'"+
		    	 		" )";
				    	 
			    	// //log.info("El ls_sql insert recorrido_doc 2 documento es" + ls_sql);	 
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	***/
			    	 
					ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
			    	 		" codigo_fondo=?  and codigo_oficina=? "+
			    	 		" and codigo_documento=?  and secuencia_movimiento=? )";
						 
							pstm = con.prepareStatement(ls_sql);
				    	 	pstm.setString(1, "01");
				    	 	pstm.setInt(2, Integer.parseInt(ls_oficina));
							pstm.setInt(3, Integer.parseInt(ls_codigoPadre));
							pstm.setInt(4, Integer.parseInt(ls_secuencia));
							pstm.executeUpdate();			
								
								
			    	/*** ls_sql = "insert into tramite.recorrido_doc(select * from tramite.movimientos_doc where" +
		    	 		" codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
		    	 		" and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+"'"+ls_secuencia+"'"+
		    	 		" )";
			    	 
			    	 ////log.info("El ls_sql insert recorrido_doc 1 documento es" + ls_sql);
			    	 
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);	***/
				    
					ls_sql = "UPDATE tramite.recorrido_doc SET estado=? "+
					    	 " where codigo_fondo=?  and codigo_oficina=? "+
					    	 " and codigo_documento=?  and secuencia_movimiento=? ";
							pstm = con.prepareStatement(ls_sql);
				    	 	pstm.setString(1, "2");
				    	 	pstm.setString(2, "01");
				    	 	pstm.setInt(3, Integer.parseInt(ls_oficina));
							pstm.setInt(4, Integer.parseInt(ls_codigoPadre));
							pstm.setInt(5, Integer.parseInt(ls_secuencia));
								
							pstm.executeUpdate(); 
							
							
							
			    	/*** //log.info("update a los estados del recorrido es:" + ls_secuencia );
		    		 ls_sql = "UPDATE tramite.recorrido_doc SET estado="+"'2'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+ls_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+ls_secuencia+"'"+"";
			    	// //log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); ****/
							
					ls_sql = "UPDATE tramite.recorrido_doc SET estado=? "+
					    	 " where codigo_fondo=?  and codigo_oficina=? "+
					    	 " and codigo_documento=?  and secuencia_movimiento=? ";
							
							pstm = con.prepareStatement(ls_sql);
				    	 	pstm.setString(1, "1");
				    	 	pstm.setString(2, "01");
				    	 	pstm.setInt(3, Integer.parseInt(codigo_oficina));
							pstm.setInt(4, Integer.parseInt(ls_codigoPadre));
							pstm.setInt(5, li_secuencia_nueva);
								
							pstm.executeUpdate();		
							
			    	 
			    	/*** // //log.info("update a los estados 2 del recorrido es:" + ls_secuencia );
		    		 ls_sql = "UPDATE tramite.recorrido_doc SET estado="+"'1'"+
			    	 " where codigo_fondo="+"'01'"+" and codigo_oficina="+"'"+codigo_oficina+"'"+
			    	 " and codigo_documento="+"'"+ls_codigoPadre+"'"+" and secuencia_movimiento="+
			    	 "'"+li_secuencia_nueva+"'"+"";
			    	// //log.info("El segundo ls_sql es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql); ***/
			    	 
			    	 x.cerrar_conexion(con,rs);
			    	 pstm.close();
			   
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		x.cerrar_conexion(con);
	    	}

		}
	 
	 public Collection  lista_recepcion_documentos_normal(Connection cnx,String oficina,String accesoaoficinas,String persona,String inicia) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes Recepcion Normal Persona XXXX..");
		 /****************
		  * Bandeja de Recepcion no secretaria no director
		  */
			Collection ListaMesaPartes = new ArrayList();
			DocumentosInternosService service = new DocumentosInternosServiceImplement();	
			BDatosFirmante resultado= new BDatosFirmante();
						
			String tempaccesosoficina=null;
			String accesocodigospersonales="";
			tempaccesosoficina=service.getAccesosaOficinas(persona);
			resultado=service.getDatosFirmantexCodigo(persona);
			
		
			accesoaoficinas=service.getAccesosaOficinas(persona);
			if(accesoaoficinas != null){
				accesoaoficinas=oficina+","+accesoaoficinas;
			}else{
				accesoaoficinas=oficina;
			}
			
			log.info("accesooficinas - lista_recepcion >"+accesoaoficinas);
			log.info("persona - lista_recepcion >"+persona);
			
			if(tempaccesosoficina!=null){
				
				if(resultado.isEsresponsable() || resultado.isEssecretaria()){
					//ve todos usuarios
					accesocodigospersonales=service.getAccesosaPersonas(tempaccesosoficina,true,null);
				}else {
					//ve solo su usuario
					//accesocodigospersonales=service.getAccesosaPersonas(tempaccesosoficina,false,persona);
					accesocodigospersonales=persona+",";
				}
				
				accesocodigospersonales = (accesocodigospersonales.trim().length()>0)?  accesocodigospersonales.substring(0, accesocodigospersonales.length()-1): accesocodigospersonales;
			}
			
			if(accesocodigospersonales!="" && accesocodigospersonales.length()>0){
				persona=persona+","+accesocodigospersonales;
			}
			/*BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;*/
			
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			ObtieneConexion obt=new ObtieneConexion();
			Connection conn = obt.getConnection();
			
			
	       /*String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	//String ls_sql ="";
	    	String ls_estado_mov="";
	    	String ls_num_upload="";
	    	int cantidad = 0;
	    	
	    	Date fecha_recep = new Date(); // fecha y hora locales 
	    	SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
	    	SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); */
		
	    		
	    		
	        try {	
	        	
	        	//Funciones funciones=new Funciones();
	        	//cantidad = funciones.esUnicoenOficina(cnx,oficina,persona);
	        	
	        	StringBuilder ls_sql = new StringBuilder("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,");
    			ls_sql.append("md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.secuencia_origen, ");
    			ls_sql.append("md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta,");
    			ls_sql.append("md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion,");
				ls_sql.append("md.flag,tp.descripcion_tipo,md.desc_origen,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,");
				ls_sql.append("dc.numero_documento_ant,dc.observa_documento,dc.fecha_registro,dc.hora_registro,dc.dirigido,de.origen_documento,de.destino_documento,de.desc_origen as nombre_procedencia,");
				ls_sql.append("de.tipo,de.remitente,md.destinatario,de.firmadopor,de.medio,de.codigo_solicitud,of.codigo_oficina,of.descripcion_oficina,");
				ls_sql.append("of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal, md.doc_resp");
				
				ls_sql.append(",(select count(tdetu.codigo_documento) from tramite.tbl_det_upload  tdetu  where tdetu.codigo_documento = md.codigo_documento) as numupload ");
				ls_sql.append(",tedoc.estado_expediente as estado_expediente ");
				ls_sql.append(",(select tofi.descripcion_oficina from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_origen) as nombre_oficina_origen");
				ls_sql.append(",(select tofi.descripcion_oficina from tramite.oficinas tofi where tofi.codigo_oficina=md.oficina_deriva) as nombre_oficina_deriva ");
				ls_sql.append(",(select tpers.nombre_personal from tramite.personal tpers where tpers.codigo_personal=md.destinatario) as destinatario_movimiento ");
				
				ls_sql.append(" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc,");
				ls_sql.append(" tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr,tramite.estados_doc tedoc ");
				
				ls_sql.append(" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and");
				ls_sql.append(" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento");
				ls_sql.append(" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and");
				ls_sql.append(" de.destino_documento=of_a.codigo_oficina  and md.estado_movimiento=tedoc.codigo_estado and md.estado_movimiento in (2,8) and");
				ls_sql.append(" md.codigo_fondo like '01' and md.codigo_oficina in ("+accesoaoficinas+")  ");
					        	
	        	ls_sql.append(" and md.destinatario in ("+persona+")   ");
	        	ls_sql.append(" order by md.codigo_documento desc;");
	        		        				
	        	//md.fecha_consulta desc, md.hora_movimiento desc,
	        	
				
				pstmt = conn.prepareStatement(ls_sql.toString());
				//pstmt.setInt(1, Integer.parseInt(oficina));
				//pstmt.setString(2, persona);
				
	    		log.info("ls_sql recepcion.... : " + pstmt);
				rs = pstmt.executeQuery();	
	        				
	 		    		        		
	 	    	/*	 String ls_codigo_recepcion="";
			    	 String ls_codigo_documento="";
			    	 String ls_codigo_documento_cont="";
			    	 String ls_codigo_expediente="";
			    	 String ls_codigo_expediente_cont="";
			    	 String ls_secuencia_movimiento="";
			    	 
			    	 String ls_ant_codigo_recepcion="";
			    	 String ls_ant_codigo_documento="";
			    	 String ls_ant_codigo_expediente="";
			    	 String ls_ant_secuencia_movimiento="";
			    	 String ls_naturaleza_documento="";
			    	 
			    	 String ls_oficina_origen="";
			    	 String ls_numero_documento="";
			    	 String ls_secuencia_origen="";*/
			    	 
		    	String ls_ant_codigo_documento="";
			    String ls_secuencia_origen="";
		    	int contador=0;
		    	int contador2=0;
		    	log.info("-------------- antes del while");
				while ( rs.next() ) {
					 
					StringBuilder constantea = new StringBuilder("");
					StringBuilder constanteb = new StringBuilder("");
					StringBuilder constantec = new StringBuilder("");
					
					
					contador=contador+1;
					Hashtable objListaDoc = new Hashtable();
					
					/***SETEO VALORES**/
					//ls_codigo_recepcion=rs.getString("codigo_recepcion").trim();
	//				ls_codigo_documento=rs.getString("codigo_documento").trim();
					//ls_codigo_expediente=rs.getString("codigo_expediente").trim();
	//				ls_secuencia_movimiento=rs.getString("secuencia_movimiento").trim();
					//ls_codigo_solicitud=funciones.of_solicitud_documento(cnx, rs.getString("codigo_solicitud")).trim();
					//ls_medio=funciones.of_medio_documento(cnx, rs.getString("medio")).trim();
					//String ls_doc_respuesta = (rs.getString("doc_resp")==null)?"":rs.getString("doc_resp");
					//ls_estado_mov=rs.getString("estado_movimiento");
					//String asunto_documento = funciones.convertir_comillas(rs.getString("asunto_documento"));
					
					
					ls_secuencia_origen=rs.getString("secuencia_origen").trim();
					ls_secuencia_origen= (ls_secuencia_origen==null)? "0":ls_secuencia_origen;
					
					/*String ls_observa_movimiento = rs.getString("observa_movimiento");
					ls_observa_movimiento = ls_observa_movimiento==null?"":ls_observa_movimiento;*/
					/**FIN SETEO VALORES***/
					
					 constantea.append("<label style='cursor: hand;' align='center' onclick=fn_editar_cop('");
					 constantea.append(rs.getString("codigo_documento").trim());
					 constantea.append("','");
					 constantea.append(rs.getString("secuencia_movimiento").trim());
					 constantea.append("');>");
		 
					 constanteb.append("</label>");
					 
					if(contador==1){						

						objListaDoc.put("codigo_documento", constantea+rs.getString("codigo_documento")+constanteb);
						objListaDoc.put("codigo_expediente", constantea+ rs.getString("codigo_expediente").trim()+constanteb);
						objListaDoc.put("numero_documento", constantea+rs.getString("numero_documento")+constanteb);
						objListaDoc.put("oficina_origen",  constantea+rs.getString("nombre_oficina_origen").trim()+constanteb);
						objListaDoc.put("oficina_deriva", rs.getString("nombre_oficina_deriva").trim());
						objListaDoc.put("estado_movimiento", "<FONT color='#FF0000 '>"+rs.getString("estado_expediente").trim()+"</FONT>");	
						

						objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion").trim());
						objListaDoc.put("fecha_registro", rs.getString("fecha_registro").trim());
						objListaDoc.put("tipo_doc", rs.getString("descripcion_tipo").trim());
						objListaDoc.put("destinatario", (rs.getString("destinatario_movimiento")!=null)? rs.getString("destinatario_movimiento"):"--------");
						
						//ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
						////log.info("El lls_num_upload.. : " + ls_num_upload);
						
						if(rs.getInt("numupload")==0){
							objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
						}else {
							objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
							"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
						}
						
						/*if(ls_num_upload.equals("0")){
							
							objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
							
						}else {
							
							objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
							"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");

						}*/
						//objListaDoc.put("destinatario", funciones.of_nombre_persona(cnx, rs.getString("destinatario")));
						
						
						
						/*objListaDoc.put("observar", "<A id='A1' href='javascript:Observar("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+","+ls_secuencia_movimiento+","+ls_secuencia_origen+");' >"+
						"<img src='img/07observar.png' height='20' title='Observar' border='0'></A>");*/
						
						ListaMesaPartes.add(objListaDoc);
						
						ls_ant_codigo_documento=rs.getString("codigo_documento").trim();
						/*ls_ant_codigo_recepcion=ls_codigo_recepcion;
						ls_ant_codigo_expediente=ls_codigo_expediente;
						ls_ant_secuencia_movimiento=ls_secuencia_movimiento;*/
						
                    }
					/**GUARDADOS PARA LA SEGUNDA
					ls_ant_codigo_recepcion
					ls_ant_codigo_documento
					ls_ant_codigo_expediente
					ls_ant_secuencia_movimiento
					**/
					if(contador>1){
						
						/*if(ls_ant_codigo_documento.equals(ls_codigo_documento)){
							//log.info("Los codigos son iguales me imprime una lista ji ji....: ");
							//log.info("Codigos Iguales >> "+ls_ant_codigo_documento+", "+ls_codigo_documento);
							//log.info("--------------------------------------------------- ");
						}else */
						
						if(!ls_ant_codigo_documento.equals(rs.getString("codigo_documento").trim())){
							
							/*String seleccionar = "<label style='cursor: hand;' align='center' " 
								+ "onclick=\"fn_editar_cop('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">Seleccionar</label>";
							objListaDoc.put("ACTION", seleccionar);
								 //log.info("El seleccionar XXXXX.. : " + seleccionar);*/

								
							objListaDoc.put("codigo_documento", constantea+rs.getString("codigo_documento")+constanteb);
							objListaDoc.put("codigo_expediente", constantea+ rs.getString("codigo_expediente").trim()+constanteb);
							objListaDoc.put("numero_documento", constantea+rs.getString("numero_documento")+constanteb);
							objListaDoc.put("oficina_origen",  constantea+rs.getString("nombre_oficina_origen").trim()+constanteb);
							objListaDoc.put("oficina_deriva", rs.getString("nombre_oficina_deriva").trim());
							objListaDoc.put("estado_movimiento", "<FONT color='#FF0000 '>"+rs.getString("estado_expediente").trim()+"</FONT>");	
							

							objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion").trim());
							objListaDoc.put("fecha_registro", rs.getString("fecha_registro").trim());
							objListaDoc.put("tipo_doc", rs.getString("descripcion_tipo").trim());
							objListaDoc.put("destinatario", (rs.getString("destinatario_movimiento")!=null)? rs.getString("destinatario_movimiento"):"--------");
							
							if(rs.getInt("numupload")==0){
								objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
							}else {
								objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
								"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
							}
							
							//objListaDoc.put("destinatario", funciones.of_nombre_persona(cnx, rs.getString("destinatario")));
								
								/*objListaDoc.put("observar", "<A id='A1' href='javascript:Observar("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+","+ls_secuencia_movimiento+","+ls_secuencia_origen+");' >"+
								"<img src='img/07observar.png' height='20' title='Observar' border='0'></A>");*/
								
								ListaMesaPartes.add(objListaDoc);

						}

						ls_ant_codigo_documento=rs.getString("codigo_documento").trim();
						/*ls_ant_codigo_recepcion=ls_codigo_recepcion;
						ls_ant_codigo_expediente=ls_codigo_expediente;
						ls_ant_secuencia_movimiento=ls_secuencia_movimiento;*/
					}
					
					/**
					 * FIN DEL WHILE
					 */
				}	
				log.info("-------------- despues del while- contador="+ contador);
				obt.cerrar_conexion(conn,rs);
	        	
	            
	        } catch (SQLException e) {
	        	obt.cerrar_conexion(conn);
	             e.printStackTrace();
	        }
	        
	        //log.info("ListaMesaPartes="+ ListaMesaPartes);
	        return ListaMesaPartes;
		                
		}
	 
	 
	 public Collection of_busca_documentos_report(Connection cnx,String oficina,String procedencia,
			 String sle_fecha,String medio,String codigo_tipo,String codigo_oficina,String codigo_solicitud,
			 String codigo_documento,String codigo_expediente,String firmadopor,String dirigido,String estado,String numero_documento,
			 String doc_resp,String asunto_documento,String sle_fecha_inicio,String sle_fecha_fin,String codigo_motivo) throws Exception{
			
			////log.info("ENTRO A BUSCAR Documentos");
			//BDocumentos BDocumentosVO= null;
		 //log.info("Dentro de Busca Documento HHHHHHHHHH..: " );
			Collection ListaMesaPartes = new ArrayList();
			
			
			PreparedStatement us  = null;
			ResultSet rs = null;
			//StringBuffer ls_sql ="";
			Funciones funciones=new Funciones();
			try 
			{	
	
					StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,e_doc.estado_expediente,md.codigo_oficina,md.fecha_movimiento," +
	        		 		"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
	        		 		"md.ultimo_usuario,md.codigo_expediente,md.oficina_origen,md.oficina_deriva," +
	        		 		"md.codigo_recepcion,md.fecha_rpta,tp.descripcion_tipo,dc.numero_documento," +
	        		 		"dc.naturaleza_documento,dc.asunto_documento," +
	        		 		"dc.fecha_registro,(substr(dc.fecha_registro,7,10) || substr(dc.fecha_registro,4,2) || substr(dc.fecha_registro,0,3)) as" +
	        		 		" fecha_consulta_reg,dc.hora_registro,dc.codigo_tipo,de.origen_documento,de.destino_documento,de.desc_origen," +
	        		 		"de.tipo,de.remitente,de.destinatario,de.codigo_solicitud,de.firmadopor,de.medio,of.codigo_oficina,of.descripcion_oficina," +
	        		 		"of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal" +
	        		 		" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
	        		 		"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr,tramite.estados_doc e_doc " +
	        		 		" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	        		 		" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	        		 		" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	        		 		" md.estado_movimiento=e_doc.codigo_estado and" +
	        		 		" de.destino_documento=of_a.codigo_oficina  " +
	        		 		" and md.codigo_fondo like '01' ");
					
						/*if(oficina.equals("1")){
			    		 ls_sql.append(" and md.secuencia_movimiento='1' ");
			    		 ////log.info("el codigo_documento: " + ls_sql);
						}else
						if(oficina.equals("2")){
							
						ls_sql.append(" and md.secuencia_movimiento='2' ");
						}
						else if(Integer.parseInt(oficina.trim())>=3){
							
							ls_sql.append(" and md.secuencia_movimiento >='3'");
							}*/
					
					if(procedencia != null && !procedencia.equals("") && !procedencia.equals("null")){
			    		 ls_sql.append(" and md.desc_origen like '"+ procedencia +"%' ");
			    		 //log.info("el codigo_documento: " + ls_sql);
						}
					
					if(sle_fecha != null && !sle_fecha.equals("") && !sle_fecha.equals("null")){
			    		 ls_sql.append(" and dc.fecha_registro = '"+ sle_fecha +"' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					if(sle_fecha_inicio != null && !sle_fecha_inicio.equals("") && !sle_fecha_inicio.equals("null")){
			    		 ls_sql.append(" and (substr(dc.fecha_registro,7,10) || substr(dc.fecha_registro,4,2) || substr(dc.fecha_registro,0,3)) >= '"+ funciones.convertir_fecha(sle_fecha_inicio.trim()) +"' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					if(sle_fecha_fin != null && !sle_fecha_fin.equals("") && !sle_fecha_fin.equals("null")){
			    		 ls_sql.append(" and (substr(dc.fecha_registro,7,10) || substr(dc.fecha_registro,4,2) || substr(dc.fecha_registro,0,3)) <= '"+ funciones.convertir_fecha(sle_fecha_fin.trim())  +"' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(codigo_tipo != null && !codigo_tipo.equals("0") && !codigo_tipo.equals("null")){
			    		 ls_sql.append(" and dc.codigo_tipo = '"+ codigo_tipo +"' ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
						}
					if(asunto_documento != null && !asunto_documento.equals("") && !asunto_documento.equals("null")){
			    		 ls_sql.append(" and dc.asunto_documento like '%"+ asunto_documento +"%' ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
						}
					
					if(codigo_solicitud != null && !codigo_solicitud.equals("0") && !codigo_solicitud.equals("null")){
			    		 ls_sql.append(" and de.codigo_solicitud = '"+ codigo_solicitud +"' ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
						}
					
					if(medio != null && !medio.equals("0") && !medio.equals("null")){
			    		 ls_sql.append(" and de.medio = '"+ medio +"' ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
						}
					
					//log.info("Antes codigo_oficina: " + codigo_oficina);
					//log.info("Antes oficina: " + oficina);
					
					if(codigo_oficina != null && !codigo_oficina.equals("0") && !codigo_oficina.equals("null")){
			    		 ls_sql.append(" and md.codigo_oficina = '"+ codigo_oficina +"' ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
						}
					else{
						//and md.codigo_oficina like " + "'" + oficina + "'" " +	
						
						log.info("el oficina: " + oficina);
						
						if(!(oficina.equals("2")) && !(oficina.equals("14"))){
							log.info("Es diferente de 2 o 14...");
							ls_sql.append("and md.codigo_oficina = '"+ oficina +"' ");
						}
						
						//log.info("el ls_codigo_oficina: " + ls_sql);
					}
					//log.info("Despues codigo_oficina: " + codigo_oficina);
					//log.info("Despues oficina: " + oficina);
					
					if(codigo_documento != null && !codigo_documento.equals("") && !codigo_documento.equals("null")){
			    		 ls_sql.append(" and md.codigo_documento = '"+ codigo_documento +"' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(codigo_expediente != null && !codigo_expediente.equals("") && !codigo_expediente.equals("null")){
			    		 ls_sql.append(" and md.codigo_expediente = '"+ codigo_expediente +"' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(firmadopor != null && !firmadopor.equals("") && !firmadopor.equals("null")){
			    		 ls_sql.append(" and de.firmadopor like '"+ firmadopor +"%' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(dirigido != null && !dirigido.equals("") && !procedencia.equals("null")){
			    		 ls_sql.append(" and dc.dirigido like '"+ dirigido +"%' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(numero_documento != null && !numero_documento.equals("") && !numero_documento.equals("null")){
			    		 ls_sql.append(" and dc.numero_documento like '%"+ numero_documento.toUpperCase() +"%' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(estado != null && !estado.equals("0") && !estado.equals("null")){
			    		 ls_sql.append(" and md.estado_movimiento = '"+ estado +"' ");
			    		 //log.info("el estado: " + ls_sql);
						}
					
					if(doc_resp != null && !doc_resp.equals("") && !doc_resp.equals("null")){
			    		 ls_sql.append(" and md.doc_resp like '%"+ doc_resp.toUpperCase() +"%' ");
			    		 //log.info("el codigo_expediente: " + ls_sql);
						}
					
					if(codigo_motivo != null && !codigo_motivo.equals("0") && !codigo_motivo.equals("null")){
			    		 ls_sql.append(" and md.codigo_motivo = '"+ codigo_motivo +"' ");
			    		 //log.info("el ls_codigo_oficina: " + ls_sql);
						}
					
					ls_sql.append(" order by  md.codigo_documento desc,md.secuencia_movimiento desc");
					
					String query = ls_sql.toString();
					
					log.info("Si el ls_sql Busca Documento..: " + ls_sql);
					
					us = cnx.prepareStatement(query);
					rs = us.executeQuery();
					
			    	 ////log.info("Si el tipo es Rendicion: " + rs);
					String ls_num_upload="";
					String ls_nomb_upload="";
			    	 //Funciones funciones=new Funciones();
			    	 String ls_codigo_recepcion="";
			    	 String ls_codigo_documento="";
			    	 String ls_codigo_expediente="";
			    	 String ls_secuencia_movimiento="";
			    	 
			    	 String ls_ant_codigo_recepcion="";
			    	 String ls_ant_codigo_documento="";
			    	 String ls_ant_codigo_expediente="";
			    	 String ls_ant_secuencia_movimiento="";
			    	 String ls_naturaleza_documento="";
			    	 int contador=0;
					 while ( rs.next() ) { 
							
						contador=contador+1;
						 Hashtable objListaDoc = new Hashtable();
						 ////log.info("Imprime listas XXX...." + contador);
							////log.info("Imprime listas...." + contador);
							
							ls_codigo_recepcion=rs.getString("codigo_recepcion").trim();
							ls_codigo_documento=rs.getString("codigo_documento").trim();
							ls_codigo_expediente=rs.getString("codigo_expediente").trim();
							ls_secuencia_movimiento=rs.getString("secuencia_movimiento").trim();
							//String ls_fecha_registro=rs.getString("fecha_registro").trim();
							
							////log.info("El ls_fecha_registro es....: " + ls_fecha_registro);
							/*//log.info("El ls_codigo_documento es....: " + ls_codigo_documento);
							//log.info("El ls_codigo_expediente es....: " + ls_codigo_expediente);
							//log.info("El ls_secuencia_movimiento es....: " + ls_secuencia_movimiento);
							//log.info("El ls_codigo_recepcion es....: " + ls_codigo_recepcion);*/
							
							if(contador==1){
								
								String ls_seleccionar="<A id='A1' target='_parent' href='ListaDocumentos.do?tipo=detalleseg&operacion=S" +
								"&codigo_documento="+rs.getString("codigo_documento").trim()+"&codigo_expediente="+rs.getString("codigo_expediente").trim() +
								"&numero_documento=0&oficina_origen="+rs.getString("oficina_origen").trim()+
								"&oficina_deriva="+rs.getString("oficina_deriva").trim()+"&secuencia_movimiento="+rs.getString("secuencia_movimiento").trim()+"&tiposegumiento=R'"+
								"<font color='#0000FF'>Seleccionar</font> </A>";
								//log.info("El ls_seleccionar OOOOOOOOOOO es.."+ ls_seleccionar);
								objListaDoc.put("ACTION", ls_seleccionar);
								
								//objListaDoc.put("codigo_documento", rs.getString("codigo_documento"));
								objListaDoc.put("codigo_documento",  rs.getString("codigo_documento"));
								objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
								objListaDoc.put("estado_expediente", rs.getString("estado_expediente"));
								//log.info("Estado_Expediente: "+rs.getString("estado_expediente"));
								objListaDoc.put("numero_documento", rs.getString("numero_documento"));
								objListaDoc.put("oficina_origen",funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim()));

								objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()) );
								
								
								
								objListaDoc.put("estado_movimiento", rs.getString("estado_movimiento"));
								objListaDoc.put("fecha_registro",rs.getString("fecha_registro"));
								
								objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
								objListaDoc.put("hora_registro", rs.getString("hora_registro"));
								objListaDoc.put("hora", rs.getString("hora_movimiento"));
								objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
								objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
								
								objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
								objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
								//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
								ls_naturaleza_documento=rs.getString("naturaleza_documento");
								if(ls_naturaleza_documento.equals("I")){
									ls_naturaleza_documento="Interno";
								}else{
									ls_naturaleza_documento="Externo";
								}
								objListaDoc.put("naturaleza_documento", ls_naturaleza_documento);
								
								 ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
								
								if(ls_num_upload.equals("0")){
									objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
								}else {
									objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
									"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
								}
								
								
								ListaMesaPartes.add(objListaDoc);
							
								ls_ant_codigo_recepcion=ls_codigo_recepcion;
								ls_ant_codigo_documento=ls_codigo_documento;
								ls_ant_codigo_expediente=ls_codigo_expediente;
								ls_ant_secuencia_movimiento=ls_secuencia_movimiento;
								
			
							}
							else if(contador>1){
								////log.info("Si el contador es mayor a cero es....: ");
								
								if(ls_ant_codigo_documento.equals(ls_codigo_documento)){
									////log.info("Los codigos son iguales me imprime una lista ji ji....: ");
									
									
									
									////log.info("--------------------------------------------------- ");
								}else {
								
							//log.info("YYYYYYYYYYYYYYYYYYYYYYYYYYYYYY ");*/
									String ls_seleccionar="<A id='A1' target='_parent' href='ListaDocumentos.do?tipo=detalleseg&operacion=S" +
									"&codigo_documento="+rs.getString("codigo_documento").trim()+"&codigo_expediente="+rs.getString("codigo_expediente").trim() +
									"&numero_documento=0&oficina_origen="+rs.getString("oficina_origen").trim()+
									"&oficina_deriva="+rs.getString("oficina_deriva").trim()+"&secuencia_movimiento="+rs.getString("secuencia_movimiento").trim()+"&tiposegumiento=R'"+
									"<font color='#0000FF'>Seleccionar</font> </A>";
									
									////log.info("El ls_seleccionar OOOOOOOOOOO es.."+ ls_seleccionar);
									
							objListaDoc.put("ACTION", ls_seleccionar);
							//objListaDoc.put("codigo_documento", rs.getString("codigo_documento"));
							objListaDoc.put("codigo_documento",  rs.getString("codigo_documento"));
							objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
							objListaDoc.put("estado_expediente", rs.getString("estado_expediente"));
							//log.info("Estado_Expediente: "+rs.getString("estado_expediente"));
							objListaDoc.put("numero_documento", rs.getString("numero_documento"));
							objListaDoc.put("oficina_origen",funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim()));

							objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()) );
							
							objListaDoc.put("estado_movimiento", rs.getString("estado_movimiento"));
							objListaDoc.put("fecha_registro",rs.getString("fecha_registro"));
							
							objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
							objListaDoc.put("hora_registro", rs.getString("hora_registro"));
							objListaDoc.put("hora", rs.getString("hora_movimiento"));
							objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
							objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
							
							objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
							objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
							//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
							//objListaDoc.put("naturaleza_documento", rs.getString("naturaleza_documento"));
							ls_naturaleza_documento=rs.getString("naturaleza_documento");
							if(ls_naturaleza_documento.equals("I")){
								ls_naturaleza_documento="Interno";
							}else{
								ls_naturaleza_documento="Externo";
							}
							objListaDoc.put("naturaleza_documento", ls_naturaleza_documento);
							 ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
							/* if(ls_num_upload.equals("")){
								 ls_num_upload="0";
							 }*/
							////log.info("El ls_num_upload es..: " + ls_num_upload);
							if(ls_num_upload.equals("0")){
								
								objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
								
							}else {
								
								objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
								"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");

							}
							
							
							ListaMesaPartes.add(objListaDoc);

									
									
								}
								ls_ant_codigo_recepcion=ls_codigo_recepcion;
								ls_ant_codigo_documento=ls_codigo_documento;
								ls_ant_codigo_expediente=ls_codigo_expediente;
								ls_ant_secuencia_movimiento=ls_secuencia_movimiento;
								
							} 
							
							
						}	
					 
				
				
				rs.close();
				
			} catch (SQLException e) 
			{
				 e.printStackTrace();
			}
			return ListaMesaPartes;
	                
			}
	 
	 
	 public Collection of_busca_documentos_report_general(Connection cnx,String oficina,String procedencia,
			 String sle_fecha,String medio,String codigo_tipo,String codigo_oficina,String codigo_solicitud,
			 String codigo_documento,String codigo_expediente,String firmadopor,String dirigido,String estado
			 ,String numero_documento,String doc_resp,String asunto_documento
			 ,String sle_fecha_inicio,String sle_fecha_fin,String codigo_motivo) throws Exception{
			
			//log.info("ENTRO A BUSCAR Documentos AQUI ......");
			//BDocumentos BDocumentosVO= null;
		 //log.info("Dentro de Busca Documento HHHHHHHHHH..: " );
			Collection ListaMesaPartes = new ArrayList();
			
			
			PreparedStatement us  = null;
			ResultSet rs = null;
			//StringBuffer ls_sql ="";
			Funciones funciones=new Funciones();
			try 
			{	
	
				StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.secuencia_movimiento,md.codigo_oficina,md.fecha_movimiento" +
						",md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.ultimo_usuario," +
						"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.codigo_recepcion,md.fecha_rpta," +
						"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.fecha_registro," +
						"(substr(dc.fecha_registro,7,10) || substr(dc.fecha_registro,4,2) || substr(dc.fecha_registro,0,3)) as fecha_consulta_reg," +
						"dc.hora_registro,dc.codigo_tipo,de.origen_documento,de.destino_documento,de.desc_origen,de.tipo," +
						"de.remitente,de.destinatario,de.codigo_solicitud,de.firmadopor,de.medio,of.codigo_oficina," +
						"of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal," +
						"pr.nombre_personal from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
						"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where " +
						"tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
						" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento and " +
						"de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
						" de.destino_documento=of_a.codigo_oficina and md.codigo_fondo like '01' ");

					
				if(procedencia != null && !procedencia.equals("") && !procedencia.equals("null")){
		    		 ls_sql.append(" and md.desc_origen like '"+ procedencia +"%' ");
		    		 //log.info("el codigo_documento: " + ls_sql);
					}
				
				if(sle_fecha != null && !sle_fecha.equals("") && !sle_fecha.equals("null")){
		    		 ls_sql.append(" and dc.fecha_registro = '"+ sle_fecha +"' and md.estado_movimiento ='5' and md.secuencia_movimiento ='1'");
		    		 //log.info("el codigo_expediente: " + ls_sql);
					}
				if(sle_fecha_inicio != null && !sle_fecha_inicio.equals("") && !sle_fecha_inicio.equals("null")){
		    		 ls_sql.append(" and (substr(dc.fecha_registro,7,10) || substr(dc.fecha_registro,4,2) || substr(dc.fecha_registro,0,3)) >= '"+ funciones.convertir_fecha(sle_fecha_inicio.trim()) +"' ");
		    		 //log.info("el codigo_expediente: " + ls_sql);
					}
				if(sle_fecha_fin != null && !sle_fecha_fin.equals("") && !sle_fecha_fin.equals("null")){
		    		 ls_sql.append(" and (substr(dc.fecha_registro,7,10) || substr(dc.fecha_registro,4,2) || substr(dc.fecha_registro,0,3)) <= '"+ funciones.convertir_fecha(sle_fecha_fin.trim())  +"' ");
		    		 //log.info("el codigo_expediente: " + ls_sql);
					}
				
				if(codigo_tipo != null && !codigo_tipo.equals("0") && !codigo_tipo.equals("null")){
		    		 ls_sql.append(" and dc.codigo_tipo = '"+ codigo_tipo +"' ");
		    		 //log.info("el ls_codigo_oficina: " + ls_sql);
					}
				if(asunto_documento != null && !asunto_documento.equals("") && !asunto_documento.equals("null")){
		    		 ls_sql.append(" and dc.asunto_documento like '%"+ asunto_documento +"%' ");
		    		 //log.info("el ls_codigo_oficina: " + ls_sql);
					}
				
				if(codigo_solicitud != null && !codigo_solicitud.equals("0") && !codigo_solicitud.equals("null")){
		    		 ls_sql.append(" and de.codigo_solicitud = '"+ codigo_solicitud +"' ");
		    		 //log.info("el ls_codigo_oficina: " + ls_sql);
					}
				
				if(medio != null && !medio.equals("0") && !medio.equals("null")){
		    		 ls_sql.append(" and de.medio = '"+ medio +"' ");
		    		 //log.info("el ls_codigo_oficina: " + ls_sql);
					}
				
				//log.info("Antes codigo_oficina: " + codigo_oficina);
				//log.info("Antes oficina: " + oficina);
				
				if(codigo_oficina != null && !codigo_oficina.equals("0") && !codigo_oficina.equals("null")){
		    		 ls_sql.append(" and md.codigo_oficina = '"+ codigo_oficina +"' ");
		    		 //log.info("el ls_codigo_oficina: " + ls_sql);
					}
				else{
					//and md.codigo_oficina like " + "'" + oficina + "'" " +	
					
					log.info("el oficina: " + oficina);
					
					if(!(oficina.equals("2")) && !(oficina.equals("14"))){
						log.info("Es diferente de 2 o 14...");
						ls_sql.append("and md.codigo_oficina = '"+ oficina +"' ");
					}
					
					//log.info("el ls_codigo_oficina: " + ls_sql);
				}
				//log.info("Despues codigo_oficina: " + codigo_oficina);
				//log.info("Despues oficina: " + oficina);
				
				if(codigo_documento != null && !codigo_documento.equals("") && !codigo_documento.equals("null")){
		    		 ls_sql.append(" and md.codigo_documento = '"+ codigo_documento +"' ");
		    		 //log.info("el codigo_expediente: " + ls_sql);
					}
				
				if(codigo_expediente != null && !codigo_expediente.equals("") && !codigo_expediente.equals("null")){
		    		 ls_sql.append(" and md.codigo_expediente = '"+ codigo_expediente +"' ");
		    		 //log.info("el codigo_expediente: " + ls_sql);
					}
				
				if(firmadopor != null && !firmadopor.equals("") && !firmadopor.equals("null")){
		    		 ls_sql.append(" and de.firmadopor like '"+ firmadopor +"%' ");
		    		 //log.info("el codigo_expediente: " + ls_sql);
					}
				
				if(dirigido != null && !dirigido.equals("") && !procedencia.equals("null")){
		    		 ls_sql.append(" and dc.dirigido like '"+ dirigido +"%' ");
		    		 //log.info("el codigo_expediente: " + ls_sql);
					}
				
				if(numero_documento != null && !numero_documento.equals("") && !numero_documento.equals("null")){
		    		 ls_sql.append(" and dc.numero_documento like '%"+ numero_documento.toUpperCase() +"%' ");
		    		 //log.info("el codigo_expediente: " + ls_sql);
					}
				
				if(estado != null && !estado.equals("0") && !estado.equals("null")){
		    		 ls_sql.append(" and md.estado_movimiento = '"+ estado +"' ");
		    		 //log.info("el estado: " + ls_sql);
					}
				
				if(doc_resp != null && !doc_resp.equals("") && !doc_resp.equals("null")){
		    		 ls_sql.append(" and md.doc_resp like '%"+ doc_resp.toUpperCase() +"%' ");
		    		 //log.info("el codigo_expediente: " + ls_sql);
					}
				
				if(codigo_motivo != null && !codigo_motivo.equals("0") && !codigo_motivo.equals("null") && !codigo_motivo.equals("")){
		    		 ls_sql.append(" and md.codigo_motivo = '"+ codigo_motivo +"' ");
		    		 //log.info("el ls_codigo_oficina: " + ls_sql);
					}
				
				ls_sql.append(" order by  md.codigo_documento desc,md.secuencia_movimiento desc");

					
					String query = ls_sql.toString();
					
					//log.info("Si el ls_sql Reporte General ..: " + ls_sql);
					
					us = cnx.prepareStatement(query);
					rs = us.executeQuery();
					
			    	 ////log.info("Si el tipo es Rendicion: " + rs);
					String ls_num_upload="";
					String ls_nomb_upload="";
			    	 String ls_codigo_recepcion="";
			    	 String ls_codigo_documento="";
			    	 String ls_codigo_expediente="";
			    	 String ls_secuencia_movimiento="";
			    	 
			    	 String ls_ant_codigo_recepcion="";
			    	 String ls_ant_codigo_documento="";
			    	 String ls_ant_codigo_expediente="";
			    	 String ls_ant_secuencia_movimiento="";
			    	 String ls_naturaleza_documento="";
			    	 int contador=0;
					 while ( rs.next() ) { 
							
						contador=contador+1;
						 Hashtable objListaDoc = new Hashtable();
						 ////log.info("Imprime listas XXX...." + contador);
							////log.info("Imprime listas...." + contador);
							
							ls_codigo_recepcion=rs.getString("codigo_recepcion").trim();
							ls_codigo_documento=rs.getString("codigo_documento").trim();
							ls_codigo_expediente=rs.getString("codigo_expediente").trim();
							ls_secuencia_movimiento=rs.getString("secuencia_movimiento").trim();
							//String ls_fecha_registro=rs.getString("fecha_registro").trim();
							
						
							if(contador==1){
								
								String ls_seleccionar="<A id='A1' target='_parent' href='ListaDocumentos.do?tipo=detalleseg&operacion=S" +
								"&codigo_documento="+rs.getString("codigo_documento").trim()+"&codigo_expediente="+rs.getString("codigo_expediente").trim() +
								"&numero_documento=0&oficina_origen="+rs.getString("oficina_origen").trim()+
								"&oficina_deriva="+rs.getString("oficina_deriva").trim()+"&secuencia_movimiento="+rs.getString("secuencia_movimiento").trim()+"&tiposegumiento=R'"+
								"<font color='#0000FF'>Seleccionar</font> </A>";
								//log.info("El ls_seleccionar OOOOOOOOOOO es.."+ ls_seleccionar);
								objListaDoc.put("ACTION", ls_seleccionar);
								
								//objListaDoc.put("codigo_documento", rs.getString("codigo_documento"));
								objListaDoc.put("ACTION", ls_seleccionar);
								objListaDoc.put("codigo_oficina", funciones.of_nombre_corto_oficina(cnx, rs.getString("codigo_oficina").trim()));
								objListaDoc.put("codigo_documento", rs.getString("codigo_documento").trim());
								objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente").trim());
								objListaDoc.put("desc_origen", rs.getString("desc_origen").trim());
								objListaDoc.put("numero_documento", rs.getString("numero_documento").trim());
								objListaDoc.put("oficina_origen", funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_origen").trim()));

								objListaDoc.put("oficina_deriva",funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_deriva").trim()));

								
								//objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()) );
								
								objListaDoc.put("estado_movimiento", funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim()));
								objListaDoc.put("fecha_registro", rs.getString("fecha_registro"));
								
								//objListaDoc.put("fecha_registro",rs.getString("fecha_registro"));
								
								objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
								objListaDoc.put("hora_registro", rs.getString("hora_registro"));
								objListaDoc.put("hora", rs.getString("hora_movimiento"));
								objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
								objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
								objListaDoc.put("fecha_rpta", rs.getString("fecha_rpta"));
								objListaDoc.put("ultimo_usuario", rs.getString("ultimo_usuario"));
								
								objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
								objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
								objListaDoc.put("nombre_personal", rs.getString("nombre_personal"));
								
								//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
								ls_naturaleza_documento=rs.getString("naturaleza_documento");
								
								
								if(ls_naturaleza_documento.equals("I")){
									ls_naturaleza_documento="Interno";
								}else{
									ls_naturaleza_documento="Externo";
								}
								objListaDoc.put("naturaleza_documento", ls_naturaleza_documento);
								
								 ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
								
								if(ls_num_upload.equals("0")){
									objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
								}else {
									objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
									"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");
								}
								
								
								ListaMesaPartes.add(objListaDoc);
							
								ls_ant_codigo_recepcion=ls_codigo_recepcion;
								ls_ant_codigo_documento=ls_codigo_documento;
								ls_ant_codigo_expediente=ls_codigo_expediente;
								ls_ant_secuencia_movimiento=ls_secuencia_movimiento;
								
								
							}
							else if(contador>1){
								////log.info("Si el contador es mayor a cero es....: ");
								
								if(ls_ant_codigo_documento.equals(ls_codigo_documento)){
									////log.info("Los codigos son iguales me imprime una lista ji ji....: ");
									
									
									
									////log.info("--------------------------------------------------- ");
								}else {
									
									
									String ls_seleccionar="<A id='A1' target='_parent' href='ListaDocumentos.do?tipo=detalleseg&operacion=S" +
									"&codigo_documento="+rs.getString("codigo_documento").trim()+"&codigo_expediente="+rs.getString("codigo_expediente").trim() +
									"&numero_documento=0&oficina_origen="+rs.getString("oficina_origen").trim()+
									"&oficina_deriva="+rs.getString("oficina_deriva").trim()+"&secuencia_movimiento="+rs.getString("secuencia_movimiento").trim()+"&tiposegumiento=R'"+
									"<font color='#0000FF'>Seleccionar</font> </A>";
									
									////log.info("El ls_seleccionar OOOOOOOOOOO es.."+ ls_seleccionar);
									
									objListaDoc.put("ACTION", ls_seleccionar);
									objListaDoc.put("codigo_oficina", funciones.of_nombre_corto_oficina(cnx, rs.getString("codigo_oficina").trim()));
									objListaDoc.put("codigo_documento", rs.getString("codigo_documento").trim());
									objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente").trim());
									objListaDoc.put("desc_origen", rs.getString("desc_origen").trim());
									objListaDoc.put("numero_documento", rs.getString("numero_documento").trim());
									objListaDoc.put("oficina_origen", funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_origen").trim()));

									objListaDoc.put("oficina_deriva", funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_deriva").trim()));

							
							objListaDoc.put("estado_movimiento", funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim()));
							objListaDoc.put("fecha_registro", rs.getString("fecha_registro"));
							objListaDoc.put("ultimo_usuario", rs.getString("ultimo_usuario"));
							objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
							objListaDoc.put("hora_registro", rs.getString("hora_registro"));
							objListaDoc.put("hora", rs.getString("hora_movimiento"));
							objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
							objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
							objListaDoc.put("fecha_rpta", rs.getString("fecha_rpta"));
							objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
							objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
							objListaDoc.put("nombre_personal", rs.getString("nombre_personal"));
							//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
							//objListaDoc.put("naturaleza_documento", rs.getString("naturaleza_documento"));
							
							ls_naturaleza_documento=rs.getString("naturaleza_documento");
							if(ls_naturaleza_documento.equals("I")){
								ls_naturaleza_documento="Interno";
							}else{
								ls_naturaleza_documento="Externo";
							}
							objListaDoc.put("naturaleza_documento", ls_naturaleza_documento);
							 ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
							/* if(ls_num_upload.equals("")){
								 ls_num_upload="0";
							 }*/
							////log.info("El ls_num_upload es..: " + ls_num_upload);
							if(ls_num_upload.equals("0")){
								
								objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
								
							}else {
								
								objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
								"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");

							}
							
							
							ListaMesaPartes.add(objListaDoc);

									
									
								}
								ls_ant_codigo_recepcion=ls_codigo_recepcion;
								ls_ant_codigo_documento=ls_codigo_documento;
								ls_ant_codigo_expediente=ls_codigo_expediente;
								ls_ant_secuencia_movimiento=ls_secuencia_movimiento;
								
							} 
							
							
						}	
					 
				
				
				rs.close();
				
			} catch (SQLException e) 
			{
				 e.printStackTrace();
			}
			return ListaMesaPartes;
	                
			}
	 
	 public Collection lista_documentos_modificar_deriva(Connection cnx,String oficina,String codigo_doc) throws Exception{
			
			////log.info("ENTRO A BUSCAR Documentos");
			//BDocumentos BDocumentosVO= null;
		 //log.info("Dentro de Lista documentos modificar..: " );
			Collection ListaMesaPartes = new ArrayList();
			
			
			PreparedStatement us  = null;
			ResultSet rs = null;
			//StringBuffer ls_sql ="";
			
			try 
			{	
	
					StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        		 		"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento," +
	        		 		"md.ultimo_usuario,md.codigo_expediente,md.oficina_origen,md.oficina_deriva," +
	        		 		"md.codigo_recepcion,md.fecha_rpta,md.observa_registro,md.observa_movimiento,tp.descripcion_tipo,dc.numero_documento," +
	        		 		"dc.naturaleza_documento,dc.asunto_documento," +
	        		 		"dc.fecha_registro,dc.hora_registro,dc.codigo_tipo,de.origen_documento,de.destino_documento,de.desc_origen," +
	        		 		"de.tipo,de.remitente,de.destinatario,de.codigo_solicitud,de.firmadopor,de.medio,of.codigo_oficina,of.descripcion_oficina," +
	        		 		"of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal" +
	        		 		" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
	        		 		"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr" +
	        		 		" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	        		 		" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	        		 		" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	        		 		" de.destino_documento=of_a.codigo_oficina  " +
	        		 		" and md.codigo_fondo like '01' ");
					
							if(codigo_doc!=null && !codigo_doc.trim().equals("")){
								ls_sql.append(" and md.codigo_documento ='"+ codigo_doc+"'");								
							}
						ls_sql.append(" and md.codigo_oficina like '"+ oficina +"' and md.estado_movimiento='5' ");
						//log.info("el ls_codigo_oficina: " + ls_sql);
						
						ls_sql.append(" order by md.codigo_documento desc limit 30 offset 0");
					
					String query = ls_sql.toString();
					
					log.info("Si el ls_sql Busca Documento..: " + ls_sql);
					
					us = cnx.prepareStatement(query);
					rs = us.executeQuery();
					
			    	 ////log.info("Si el tipo es Rendicion: " + rs);
					String ls_num_upload="";
					String ls_nomb_upload="";
			    	 Funciones funciones=new Funciones();
			    	 String ls_codigo_recepcion="";
			    	 String ls_codigo_documento="";
			    	 String ls_codigo_expediente="";
			    	 String ls_secuencia_movimiento="";
			    	 
			    	 String ls_ant_codigo_recepcion="";
			    	 String ls_ant_codigo_documento="";
			    	 String ls_ant_codigo_expediente="";
			    	 String ls_ant_secuencia_movimiento="";
			    	 String ls_naturaleza_documento="";
			    	 String ls_valida_doc_recibidos="";
			    	 int contador=0;
					 while ( rs.next() ) { 
							
						contador=contador+1;
						 Hashtable objListaDoc = new Hashtable();
						 ////log.info("Imprime listas XXX...." + contador);
							////log.info("Imprime listas...." + contador);
							
							ls_codigo_recepcion=rs.getString("codigo_recepcion").trim();
							ls_codigo_documento=rs.getString("codigo_documento").trim();
							ls_codigo_expediente=rs.getString("codigo_expediente").trim();
							ls_secuencia_movimiento=rs.getString("secuencia_movimiento").trim();
							ls_valida_doc_recibidos=funciones.of_valida_documento_recibidos
							(cnx, ls_codigo_documento, ls_secuencia_movimiento);
							//log.info("El ls_valida_doc_recibidos...." + ls_valida_doc_recibidos);
							if(contador==1){
								
								String seleccionar = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
							        + rs.getString("codigo_expediente") + "'"+ "," 
							        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
							        + "'"+ rs.getString("numero_documento") + "'"+ "," 
							        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
							        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
							        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
							        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
							        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
							        + "'"+ rs.getString("secuencia_movimiento").trim() + "'"
							        + ");\" " + ">Seleccionar</label>";
									
									 ls_codigo_expediente = "<label style='cursor: hand;' align='center' " 
										+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
								        + rs.getString("codigo_expediente") + "'"+ "," 
								        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
								        + "'"+ rs.getString("numero_documento") + "'"+ "," 
								        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
								        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
								        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
								        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
								        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
								        + "'"+ rs.getString("secuencia_movimiento").trim() + "'"
								        + ");\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
									
									 ls_codigo_documento = "<label style='cursor: hand;' align='center' " 
										+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
								        + rs.getString("codigo_expediente") + "'"+ "," 
								        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
								        + "'"+ rs.getString("numero_documento") + "'"+ "," 
								        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
								        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
								        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
								        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
								        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
								        + "'"+ rs.getString("secuencia_movimiento").trim() + "'"
								        + ");\" " + ">"+ rs.getString("codigo_documento")+"</label>";
									
									String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
										+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
								        + rs.getString("codigo_expediente") + "'"+ "," 
								        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
								        + "'"+ rs.getString("numero_documento") + "'"+ "," 
								        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
								        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
								        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
								        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
								        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
								        + "'"+ rs.getString("secuencia_movimiento").trim() + "'"
								        + ");\" " + ">"+ rs.getString("numero_documento")+"</label>";
									
									String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
										+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
								        + rs.getString("codigo_expediente") + "'"+ "," 
								        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
								        + "'"+ rs.getString("numero_documento") + "'"+ "," 
								        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
								        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
								        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
								        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
								        + "'"+ rs.getString("observa_movimiento") + "'" + ","
								        + "'"+ rs.getString("secuencia_movimiento").trim() + "'"
								        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";

								
									objListaDoc.put("ACTION", seleccionar);
									if(ls_valida_doc_recibidos.equals("0")){
										objListaDoc.put("codigo_documento", ls_codigo_documento);	
									}else{
										objListaDoc.put("codigo_documento", "<FONT color='#FF0000'>"+ls_codigo_documento+"</FONT>");
									}
									
									
									objListaDoc.put("codigo_expediente", ls_codigo_expediente);
									objListaDoc.put("numero_documento", ls_numero_documento);
									objListaDoc.put("oficina_origen", ls_oficina_origen);
									objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
									objListaDoc.put("estado_movimiento", funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim()));
									objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
									objListaDoc.put("hora", rs.getString("hora_movimiento"));
									objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
									objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
									
								ListaMesaPartes.add(objListaDoc);
							
								ls_ant_codigo_recepcion=ls_codigo_recepcion;
								ls_ant_codigo_documento=ls_codigo_documento;
								ls_ant_codigo_expediente=ls_codigo_expediente;
								ls_ant_secuencia_movimiento=ls_secuencia_movimiento;
									
							}
							else if(contador>1){
								////log.info("Si el contador es mayor a cero es....: ");
								
								if(ls_ant_codigo_documento.equals(ls_codigo_documento)){
									////log.info("Los codigos son iguales me imprime una lista ji ji....: ");
									
									
									
									////log.info("--------------------------------------------------- ");
								}else {
									
									
									String seleccionar = "<label style='cursor: hand;' align='center' " 
										+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
								        + rs.getString("codigo_expediente") + "'"+ "," 
								        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
								        + "'"+ rs.getString("numero_documento") + "'"+ "," 
								        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
								        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
								        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
								        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
								        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
								        + "'"+ rs.getString("secuencia_movimiento").trim() + "'"
								        + ");\" " + ">Seleccionar</label>";
										
										 ls_codigo_expediente = "<label style='cursor: hand;' align='center' " 
											+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
									        + rs.getString("codigo_expediente") + "'"+ "," 
									        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
									        + "'"+ rs.getString("numero_documento") + "'"+ "," 
									        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
									        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
									        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
									        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
									        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
									        + "'"+ rs.getString("secuencia_movimiento").trim() + "'"
									        + ");\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
										
										 ls_codigo_documento = "<label style='cursor: hand;' align='center' " 
											+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
									        + rs.getString("codigo_expediente") + "'"+ "," 
									        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
									        + "'"+ rs.getString("numero_documento") + "'"+ "," 
									        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
									        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
									        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
									        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
									        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
									        + "'"+ rs.getString("secuencia_movimiento").trim() + "'"
									        + ");\" " + ">"+ rs.getString("codigo_documento")+"</label>";
										
										String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
											+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
									        + rs.getString("codigo_expediente") + "'"+ "," 
									        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
									        + "'"+ rs.getString("numero_documento") + "'"+ "," 
									        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
									        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
									        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
									        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
									        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
									        + "'"+ rs.getString("secuencia_movimiento").trim() + "'"
									        + ");\" " + ">"+ rs.getString("numero_documento")+"</label>";
										
										String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
											+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
									        + rs.getString("codigo_expediente") + "'"+ "," 
									        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
									        + "'"+ rs.getString("numero_documento") + "'"+ "," 
									        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
									        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
									        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
									        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
									        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
									        + "'"+ rs.getString("secuencia_movimiento").trim() + "'"
									        + ");\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";

									
										objListaDoc.put("ACTION", seleccionar);
										if(ls_valida_doc_recibidos.equals("0")){
											objListaDoc.put("codigo_documento", ls_codigo_documento);	
										}else{
											objListaDoc.put("codigo_documento", "<FONT color='#FF0000'>"+ls_codigo_documento+"</FONT>");
										}
										objListaDoc.put("codigo_expediente", ls_codigo_expediente);
										objListaDoc.put("numero_documento", ls_numero_documento);
										objListaDoc.put("oficina_origen", ls_oficina_origen);
										objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
										objListaDoc.put("estado_movimiento", funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim()));
										objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
										objListaDoc.put("hora", rs.getString("hora_movimiento"));
										objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
										objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
							
							
							ListaMesaPartes.add(objListaDoc);

									
									
								}
								ls_ant_codigo_recepcion=ls_codigo_recepcion;
								ls_ant_codigo_documento=ls_codigo_documento;
								ls_ant_codigo_expediente=ls_codigo_expediente;
								ls_ant_secuencia_movimiento=ls_secuencia_movimiento;
								
							} 
							
							
						}	
					 
				
				
				rs.close();
				
			} catch (SQLException e) 
			{
				 e.printStackTrace();
			}
			return ListaMesaPartes;
	                
			}
	 
	 
	 public String of_modificar_doc_deriva(Connection cnx,String codigo_oficina,String codigo_documento,String usuario,
			 String fecha,String hora,String observacion,String estado_movimiento,String secuencia_movimiento) {
	    	
	     //   obtenermos el valor maximo...
	    log.info("dentro de Reversion de derivacion......." );
	    	int    li_retorno;
	    	int    li_parcial = 0 ;
	    	String ls_correlativo=null;
	    	String ls_ano=null;
	    	String ls_mes=null;
	    	String ls_dia=null;
	    	String fecha_consulta=null;
	    	int ls_estado=0;
	    	String codigo_fondo="01";
	    	li_retorno = 1;
	    	Statement us  = null;
			ResultSet rs = null;
			int ls_count_estado_cod=0;
			
			
	    	String ls_sql = "";
	    	String ls_mensaje = "";
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			Funciones funciones=new Funciones();
	    	try{
	    		
		    			/*ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = " +"'9'"+
		    			","+"observa_movimiento ="+"'"+ls_observacion+"'" + " where codigo_fondo='01' "
		    			+ " and codigo_oficina= "+ "'" +ls_oficina + "'" + " and codigo_documento="+"'"+ls_documento+"'"
		    			+ " and secuencia_movimiento="+"'"+ls_secuencia+"'"+"";^*/
	    		
	    		ls_count_estado_cod= funciones.of_count_estado_codigo(cnx, codigo_documento, secuencia_movimiento);
				log.info("El ls_count_estado_cod es.. " + ls_count_estado_cod);	
				log.info("Modificando la secuencia="+secuencia_movimiento);
				if(ls_count_estado_cod==0){
					
					log.info("El estado documento es igual a CERO....");	
					
					ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento="+"'"+estado_movimiento+"'"
    				+ " where codigo_fondo="+ "'01'" +
    				" and codigo_documento="+"'"+codigo_documento+"'"
    				+ " and secuencia_movimiento="+"'"+secuencia_movimiento+"'"+"";
    		
	        		
	        		  log.info("El ls_sql update modificar documento es" + ls_sql);
				    	 us = con.createStatement();
				    	 us.executeUpdate(ls_sql);
				    	 
				   ls_sql = "UPDATE tramite.tbl_det_upload set flag = 'A'"+
		    				" where  codigo_documento='"+codigo_documento+"' and secuencia_movimiento='"+secuencia_movimiento+"'";
				   
				   log.info(ls_sql);
				   us=con.createStatement();
				   us.executeUpdate(ls_sql);
				
			//int ls_secuencia = Integer.valueOf(secuencia_movimiento).intValue()+1;	
			int ls_count_secuencia=0;
			
			ls_count_secuencia= funciones.of_max_secuencia_codigo(cnx, codigo_documento, secuencia_movimiento);
			log.info("El ls_count_secuencia es.. " + ls_count_secuencia);	
			
			int ls_secuencia = Integer.valueOf(secuencia_movimiento).intValue()+1;
			
			for(int i=ls_count_secuencia; i>=ls_secuencia;ls_secuencia++){
				
				ls_sql = "delete from tramite.movimientos_doc WHERE codigo_documento="+"'"+codigo_documento+"'"
				+ " and secuencia_movimiento="+"'"+ls_secuencia+"'"+"";
				//log.info("El ls_sql es.. " + ls_sql);	
	    		us = con.createStatement();
	    		us.executeUpdate(ls_sql);	
	    		
			}
	    	 
			ls_mensaje="DOCUMENTO MODIFICADO A ESTADO TRÁMITE CON EXITO...!";
			log.info("FIN DEL FORRRRRRR... ");
			
				}else{
					
					log.info("El estado documento es mAYOR a CERO....");	
					ls_mensaje="EL DOCUMENTO NO SE PUEDE REVERTIR POR TENER UNA SECUENCIA EN ESTADO TRAMITE...!";
					log.info("mensaje... " + ls_mensaje);	
					
				}
				
				
	    				    	 
			 x.cerrar_conexion(con);   	
	    	}
	    	catch(Exception e){
	    		x.cerrar_conexion(con);
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    	}
	    	return ls_mensaje;

		}
	 
	 public String of_ingresar_doc_observardo(Connection cnx,String codigo_documento,String secuencia_movimiento,String secuencia_movimiento_destino,String observacion,
			 String codigo_motivo,String doc_resp,String fecha_rpta_rq,int codigo_recepcion_destino,int id_cab_upload){


		    log.info("dentro de of_ingresar_doc_observardo......." );
		    	String codigo_fondo="01";
		    	Statement us  = null;
				ResultSet rs = null;
				
		    	String ls_sql = "";
		    	String ls_mensaje = "NO";
		    	String ls_estado_movimiento="2";
		    	ObtieneConexion  x= new ObtieneConexion();
				Connection	con= x.getConnection();
				PreparedStatement pstmt = null;
				
				SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
				
		    	try{
					
						ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento=? , flag = ? "
	    				+ " where codigo_fondo=?  and codigo_documento=?  and secuencia_movimiento=? ";
						
						pstmt = con.prepareStatement(ls_sql);

						pstmt.setString(1, "5");
						pstmt.setString(2, "");
						pstmt.setString(3, "01");
						pstmt.setInt(4, Integer.parseInt(codigo_documento));
						pstmt.setInt(5, Integer.parseInt(secuencia_movimiento));
						
						
						pstmt.executeUpdate();
					    	 
					   log.info("codigo_recepcion_destino -> "+codigo_recepcion_destino);
					   
					   //PODRIA PONERSE EL USUARIO QUE LO MODIFICO
					   ls_sql = "UPDATE tramite.tbl_det_upload set  id_cab_upload=?, flag =?, codigo_recepcion =? ,  fecha_modificacion= current_timestamp "+
					   	" where  codigo_documento=?  and secuencia_movimiento =? ";
					   
					   pstmt = con.prepareStatement(ls_sql);
					    pstmt.setInt(1, id_cab_upload);
						pstmt.setString(2, "I");
						pstmt.setInt(3, codigo_recepcion_destino);
						pstmt.setInt(4, Integer.parseInt(codigo_documento));
						//pstmt.setInt(5, Integer.parseInt(secuencia_movimiento));
						pstmt.setInt(5, Integer.parseInt(secuencia_movimiento_destino));
						
						pstmt.executeUpdate();
					
					   /***
					    * NECESITO VERIFICAR SI DESTINO ESTABA EN RECIBIR O TRAMITE
					    */
					   int cantidad_movimientos=0;
					   
					   ls_sql = "SELECT count(codigo_documento) as cantidad_movimientos  from tramite.recorrido_doc  " +
					   	"where codigo_documento=?  and secuencia_movimiento=? ";
					   
					   pstmt = con.prepareStatement(ls_sql);

						pstmt.setInt(1, Integer.parseInt(codigo_documento));
						pstmt.setInt(2, Integer.parseInt(secuencia_movimiento_destino));
						
						rs=pstmt.executeQuery();
						
					   log.info("Cantidad de movimientos ls_sql -->"+ls_sql);
						while ( rs.next() ) { 
    				           // //log.info("dentro del whyle......." );
    				            if (rs.getString("cantidad_movimientos") == null )
    				            {
    				    			////log.info("ta vacio nulo ......." );
    				            	cantidad_movimientos = 0;
    				    	    }
    				            else
    				    		{
    				            	////log.info("ls_valor :" + rs.getString("c_valor"));
    				            	cantidad_movimientos = Integer.valueOf(rs.getString("cantidad_movimientos")).intValue();
    				    		}

				        }
					
					log.info("------cantidad_movimientos "+cantidad_movimientos);	
					if(cantidad_movimientos==1){//ES POR RECIBIR
						ls_estado_movimiento = "2";
					}
					if(cantidad_movimientos==2){//ES EN TRAMITE
						ls_estado_movimiento = "3";
					}	
					   
					
				   ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento=? ";
				   if(!observacion.equals("")){
					   ls_sql=ls_sql+" ,observa_movimiento=?  ";
				   }
				   if(!codigo_motivo.equals("")){
					   ls_sql=ls_sql+" ,codigo_motivo=? ";
				   }
				   ls_sql=ls_sql+" where codigo_documento=?  and  secuencia_movimiento=? ";	   
					   
					pstmt = con.prepareStatement(ls_sql);
					
					int siguiente=1;
					pstmt.setString(siguiente, ls_estado_movimiento);
					if(!observacion.equals("")){
						pstmt.setString(siguiente=siguiente+1, observacion);
					}
					if(!codigo_motivo.equals("")){
						pstmt.setInt(siguiente=siguiente+1, Integer.parseInt(codigo_motivo));
					}
					pstmt.setInt(siguiente=siguiente+1, Integer.parseInt(codigo_documento));
					pstmt.setInt(siguiente=siguiente+1, Integer.parseInt(secuencia_movimiento_destino));
					
					pstmt.executeUpdate();
	
		    	 
				ls_mensaje="SI";
				log.info("FIN DE observa... ");
				
				x.cerrar_conexion(con,rs);
				pstmt.close();
								
		    	}	
		    	catch(Exception e){
		    		x.cerrar_conexion(con);
		    		log.info("error en el Servlet : " + e.getMessage() );	
		    	}
		    	return ls_mensaje;
			
	 }
	 
	 public String of_observar_doc_deriva(Connection cnx,String codigo_oficina,String codigo_documento,String usuario,
			 String fecha,String hora,String observacion,String estado_movimiento,String secuencia_movimiento) {

	    log.info("dentro de Observacion de derivacion......." );
	    	int    li_retorno;
	    	int    li_parcial = 0 ;
	    	String ls_correlativo=null;
	    	String ls_ano=null;
	    	String ls_mes=null;
	    	String ls_dia=null;
	    	String fecha_consulta=null;
	    	int ls_estado=0;
	    	String codigo_fondo="01";
	    	li_retorno = 1;
	    	int ls_count_estado_cod=0;
			//int valor_codigo_oficina = Integer.valueOf(codigo_oficina.trim());
			
	    	String ls_sql1 = "";
	    	String ls_mensaje = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();

			ResultSet rs = null;
			PreparedStatement pstmt = null;
			
			Funciones funciones=new Funciones();
			BInfoListaObservacion informacion = new BInfoListaObservacion();
			
			SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
			String hora_movimiento="";
			String ultimo_usuario="";
			String fecha_movimiento="";
			String tipo_envio="";
			int codigo_recepcion=0;
			
			int oficina_origen=0;
	    	try{
	    		
	    		/**
	    		 * SACO LOS DATOS DE LA OFICINA ACTUAL QUE ESTA OBSERVANDO
	    		 */
	    		ls_sql1 = "select fecha_movimiento,hora_movimiento,tipo_envio,oficina_origen,ultimo_usuario,codigo_recepcion  from tramite.recorrido_doc " +
    			"where codigo_documento =?  and secuencia_movimiento=?  and estado_movimiento=2";
	    		
	    		 pstmt = con.prepareStatement(ls_sql1);
		    	 pstmt.setInt(1, Integer.parseInt(codigo_documento));
		    	 pstmt.setInt(2, Integer.parseInt(secuencia_movimiento));

		    	 rs= pstmt.executeQuery();
	    		
				while ( rs.next() ) { 
					hora_movimiento = rs.getString("hora_movimiento");
					ultimo_usuario = rs.getString("ultimo_usuario");
					fecha_movimiento = rs.getString("fecha_movimiento");
					tipo_envio =rs.getString("tipo_envio");
					oficina_origen = rs.getInt("oficina_origen");
					codigo_recepcion = rs.getInt("codigo_recepcion");
				}
				
				System.out.println("hora > "+hora_movimiento);
				System.out.println("ult usuario > "+ultimo_usuario);
				System.out.println("tipo envio > "+tipo_envio);
				System.out.println("codigo_recepcion > "+codigo_recepcion);
				log.info("sql -> "+ls_sql1);
				//tipo_envio="C";
				/***
				 * CONSIDERAR QUE EL TIPO DE ENVIO NO NECESARIAMENTE ESTA LLENO
				 */
				if(tipo_envio.equals("P") || tipo_envio.equals("R")){
					
				informacion= funciones.of_contador_estado_codigo(cnx, codigo_documento, secuencia_movimiento,hora_movimiento,ultimo_usuario,fecha_movimiento,tipo_envio,oficina_origen,codigo_oficina,codigo_recepcion);
	    		
				
				log.info("informacion -> "+informacion.isSi_observa());
				
				//informacion.setSi_observa(false);
					if(informacion.isSi_observa()){
						log.info("secuencia inicial->> "+informacion.getSecuencia_inicial());
						log.info("->> "+informacion.getEstado_codigo());
						log.info(""+informacion.getTipo_envio());
						String secuencia_movimiento_inicial=String.valueOf(informacion.getSecuencia_inicial());
						
						String nuevo_estado_movimiento = "A"; //observado
						
						//MODIFICA LA PENULTIMA SECUENCIA
						ls_sql1 = "UPDATE tramite.movimientos_doc SET estado_movimiento=? , flag = ? "  ///MODIFICADO PARA QUE NO APAREZCA EN LA LISTA DE DERIVACION
	    				+ " where codigo_fondo= ?  and codigo_documento=?  and  secuencia_movimiento=? ";
	    		
		        		
		        		 log.info("El ls_sql update modificar documento es" + ls_sql1);
		        		 pstmt = con.prepareStatement(ls_sql1);
		        		 pstmt.setString(1, "3");
		        		 pstmt.setString(2, "I");
		        		 pstmt.setString(3, "01");
		 		    	 pstmt.setInt(4, Integer.parseInt(codigo_documento));
		 		    	 pstmt.setInt(5, Integer.parseInt(secuencia_movimiento_inicial));
	
		 		    	 pstmt.executeUpdate();
					    
					   //MODIFICA LA TABLA DETALLE 	PARA MODIFICAR LOS ADJUNTOS
					   ls_sql1 = "UPDATE tramite.tbl_det_upload set flag = ? "+
			    				//" where  codigo_documento='"+codigo_documento+"' and secuencia_movimiento='"+secuencia_movimiento_inicial+"'";
					   	//		" where  codigo_documento='"+codigo_documento+"' and secuencia_movimiento='"+secuencia_movimiento+"'";
					   " where  codigo_documento=?  and codigo_recepcion=? ";///MODIFICADO PARA QUE APAREZCA EL DOC ADJUNTO
					   
					    pstmt = con.prepareStatement(ls_sql1);
					    pstmt.setString(1, "A");
					   	pstmt.setInt(2, Integer.parseInt(codigo_documento));
		 		    	pstmt.setInt(3, codigo_recepcion);
	
		 		    	pstmt.executeUpdate();
					
					   //MODIFICA LA ULTIMA SECUENCIA PARA QUE SE RECONOZCA COMO OBSERVADO
					   ls_sql1 = "UPDATE tramite.movimientos_doc SET estado_movimiento=?  ,secuencia_origen=? ,flag =? "
					   + " where  codigo_documento=?  and secuencia_movimiento=? ";	   
					   
					    pstmt = con.prepareStatement(ls_sql1);
					    pstmt.setString(1, nuevo_estado_movimiento);
					   	pstmt.setInt(2, Integer.parseInt(secuencia_movimiento_inicial));
		 		    	pstmt.setString(3, "");
		 		    	pstmt.setInt(4, Integer.parseInt(codigo_documento));
		 		    	pstmt.setInt(5, Integer.parseInt(secuencia_movimiento));
		 		    	pstmt.executeUpdate();	
		    		
		    		//MODIFICA LA TABLA DOCUMENTO INTERNO PARA QUE RECONOZCA COMO OBSERVADO
					   ls_sql1 = "UPDATE tramite.documento_tipo_documento_interno SET codigo_estado_documento=?  "
					   + " where  codigo_documento=?  and secuencia_movimiento_destino=? ";	   
					   
					   pstmt = con.prepareStatement(ls_sql1);
					   pstmt.setInt(1, 9);
					   pstmt.setInt(2, Integer.parseInt(codigo_documento));
					   pstmt.setInt(3, Integer.parseInt(secuencia_movimiento));
					   pstmt.executeUpdate();	
		    	 
				ls_mensaje="SI";
				log.info("FIN DEL FORRRRRRR... ");
				}else{
						log.info("El estado documento es mAYOR a CERO....");	
						ls_mensaje="NO";
						log.info("mensaje... " + ls_mensaje);
				}
			}else{    	 
				log.info("Es una copia");	
				ls_mensaje="NO";
	    	}
				
				 x.cerrar_conexion(con,rs);
				 pstmt.close();
	    	}	
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    		 x.cerrar_conexion(con);
	    	}
	    	return ls_mensaje;

		}
	 
	 public String of_ingresar_documento_asociado_cod_documento(Connection cnx,String codigo_oficina,String medio,String codigo_tipo,String naturaleza_documento,String destino_documento,
				String contacto,String destinatario,String codigo_solicitud,String numero_documento,
				String fecha_registro,String hora,String folios_documento,String asunto_documento,
				String observa_documento,String usuario_actual,String firmadopor,String origen_documento,
				String desc_origen,String tipo,String persona,String fecha_rpta,String correlativorecepcion,String numero_referencia,String dirigido) {
	    	
	     //   obtenermos el valor maximo...
	    	//log.info("dentro del ingresar Nuevo Documento......." );
	    	
	    	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "2";
	    	String ls_valor  = "";
	    	Funciones funciones=new Funciones();
	    	/*//log.info("FECHA fecha_documento.... : " + fecha_documento);
	    	//log.info("FECHA fechaconsulta.... : " + fechaconsulta);
	    	//log.info("Año yearactual.... : " + yearactual);*/
	    	
	    	
	    	int    li_retorno;
	    	int    li_parcial = 0 ;
	    	int li_secuencia;
	    	int li_secuencia_oficina;
	    	String codigo_documento= "" ;
	    	String ls_extraer_year= "" ;
	    	//String naturaleza_documento = "E";
	    	String ls_correlativo=null;
	    	li_retorno = 1;
	    	Statement us  = null;
			ResultSet rs = null;
			
	    	String ls_sql = "";
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
			Connection			con= x.getConnection();
			
	    	try{
	    		
	    		ls_sql = "Select max(codigo_documento) as c_valor from tramite.documento";
			////log.info("ls_sql............   " + ls_sql );
			us = cnx.createStatement();
		    	 rs = us.executeQuery(ls_sql);
		    	// //log.info("El resultset es: " + rs);
				
		    	 if (rs == null) 
		    		{
		    			////log.info("rs es nulo ......." );
		    			li_retorno = 1;
		    	    }
		    		else
		    		{
		    			//log.info("rs NO es nulo ......." );
			    		while ( rs.next() ) { 
			    				         //   //log.info("dentro del whyle......." );
			    				            if (rs.getString("c_valor") == null )
			    				            {
			    				    		//	//log.info("ta vacio nulo ......." );
			    				    			li_retorno = 1;
			    				    	    }
			    				            else
			    				    		{
			    				            //	//log.info("ls_valor :" + rs.getString("c_valor"));
			    				            	ls_valor=rs.getString("c_valor");
			    				            	////log.info("ls_extraer_year :" + ls_extraer_year);
			    				            	li_retorno = Integer.valueOf(ls_valor).intValue() + 1;
			    				            	
			    				    		}
			    				           
			    		}
			        }
		    	 
		    	 codigo_documento = String.valueOf(li_retorno);
		    	 
		    	 //log.info("El nuevo codigo documento DOC INTERNO es" + codigo_documento);
		    	 
	    		//Registramos un documento en la tabla tramite.documento
		    	 
		    	 ls_sql = "insert into tramite.documento(codigo_documento,codigo_tipo,naturaleza_documento," +
		    	 		"numero_documento,fecha_documento,asunto_documento,folios_documento,observa_documento," +
		    	 		"fecha_registro,hora_registro,ultima_modificacion,ultimo_usuario,estado_documento," +
		    	 		"postergado,cargo,anio,dirigido) values(" + "'" + codigo_documento + "'" + "," + "'" + codigo_tipo + "'" +
		    	 		"," + "'" + naturaleza_documento + "'" +
		    	 		"," + "'" + numero_documento + "'" +
		    	 		"," + "'" + fecha_documento + "'" +
		    	 		"," + "'" + asunto_documento + "'" +
		    	 		"," + "'" + folios_documento + "'" +
		    	 		"," + "'" + observa_documento + "'" +
		    	 		"," + "'" + fecha_registro + "'" +
		    	 		"," + "'" + hora + "'" +
		    	 		"," + "'" + fecha_documento + "'" +
		    	 		"," + "'" + usuario_actual + "'" +
		    	 		"," + "'" + estado_documento + "'"+
		    	 		"," + "'N'"+
		    	 		"," + "'N'"+
		    	 		","+"'" + yearactual + "'"+
		    	 		","+"'" + dirigido + "'"+
		    	 		")";
		    	//log.info("El primer ls_sql es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);
		    	 
//		    	------------------------Registramos la Oficina de Origen y Destino-------------------------//
		    	 
		    	 /*ls_sql = "insert into tramite.doc_interno_origen(codigo_documento,codigo_fondo,codigo_oficina,codigo_personal)" +
		    	 		" values(" + "'" + codigo_documento + "'"+ "," +"'01'"+ 
		    	 		"," +"'" + codigo_oficina + "'"+ "," +"'" + remitente + "'"+ ")";
	    	 
			    	 //log.info("El segundo ls_sql doc_interno_origen es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);
	    	 
			    	 
		    	 ls_sql = "insert into tramite.doc_interno_destino(codigo_documento,secuencia_documento,codigo_personal,codigo_fondo,codigo_oficina)" +
	    	 		" values(" + "'" + codigo_documento + "'"+ "," +"'1'"+ 
	    	 		"," +"'" + destinatario + "'"+ "," +"'01'"+"," +"'" + destino_documento + "'"+")";
	 
		    	 //log.info("El tercero ls_sql doc_interno_destino es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);*/
		    	 
		    	 	//------------------------Registramos Origen y Destino del Documento-------------------------//
		    	 
		    	 ls_sql = "insert into tramite.doc_entrada(codigo_documento,destinatario,remitente,destino_documento," +
		    	 		"fondo_destino,origen_documento,medio,hora,firmadopor,codigo_solicitud,desc_origen,tipo) values(" + "'" + codigo_documento + "'"
		    	 		+ "," +"'" + destinatario + "'"+ "," +"'" + contacto  + "'"
		    	 		+ "," +"'" + destino_documento + "'"+ "," +"'01'"
		    	 		+ "," + "'" + codigo_oficina + "'"+ "," +"'" + medio + "'"
		    	 		+ "," +"'" + hora + "'"+ "," +"'" + firmadopor + "'"
		    	 		+ "," +"'" + codigo_solicitud + "'"
		    	 		+ "," +"'" + desc_origen + "'"
		    	 		+ "," +"'" + tipo + "'"+ ")";
		    	 
		    	//log.info("El cuarto ls_sql doc_interno es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);
		    	 
		    		//------------------------Registramos el movimiento del Documento-------------------------//
		    	/* ls_sql = "select count(codigo_documento) as c_valor from tramite.movimientos_doc where codigo_documento  = " + "'" + codigo_documento + "'"  + "";
		    	 us = cnx.createStatement();
		    	 rs = us.executeQuery(ls_sql);
		    	//log.info("El resultset es: " + rs);
		    	
		 		while ( rs.next() ) { 
		 				            //log.info("dentro del whyle......." );
		 				            ls_valor = rs.getString("c_valor"); 
		 				            //log.info("ls_valor :" + ls_valor );
		 				            
		 		}
		 		
		 		li_secuencia = Integer.valueOf(ls_valor).intValue() + 1;
		 		////log.info("li_secuencia: " + li_secuencia);
		    	 if (ls_valor.equals("0")) {*/
		 			
		    	 li_secuencia =1;
		    	 
		    		 String fecha_consulta = fecha_registro.substring(6,10)+fecha_registro.substring(3,5)+fecha_registro.substring(0,2);
			        	
			      //   //log.info("fecha_consulta: " + fecha_consulta);
			         
			         
			        	 ls_sql = "insert into tramite.movimientos_doc(codigo_documento," +
		    		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
		    		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		    		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
		    		 		"oficina_deriva,destinatario,desc_origen,tipo,fecha_rpta,oficina_origen,codigo_recepcion,numero_referencia,codigo_expediente) values(" + "'" + codigo_documento + "'"
		    	 		+ "," +"'01'"+","+"'"+ li_secuencia + "'"+ "," +"'" + codigo_oficina + "'"+ "," +"'01'"
		    	 		+ "," + "'" + origen_documento + "'"+ "," +"'5'"
		    	 		+ "," +"'" + fecha_registro + "'"+ "," +"'" + fecha_consulta + "'"+ "," +"'" + hora + "'"
		    	 		+ "," +"'" + observa_documento + "'"+ "," +"'" + codigo_documento + "'"
		    	 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+ "," +"'" + destino_documento + "'"+
		    	 		"," +"'" + destinatario + "'"+
		    	 		"," +"'" + desc_origen + "'"+
		    	 		"," +"'" + tipo + "'"+
		    	 		"," +"'" + fecha_rpta + "'"+
		    	 		"," +"'" + codigo_oficina + "'"+
		    	 		"," +"'" + correlativorecepcion + "'"+
		    	 		"," +"'" + numero_referencia + "'"+
		    	 		"," +"'0'"+
		    	 		")";
		    	 
		    	//log.info("El tercer ls_sql registro de nuestra oficina origen es" + ls_sql);
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);
		    	 
		    	 	li_secuencia_oficina = Integer.parseInt(funciones.of_max_secuencia_envio(cnx,numero_referencia).trim()) + 1;
			 		log.info("li_secuencia_oficina: " + li_secuencia_oficina);
			 	
		    	 
		    	 
		    	 ls_sql = "insert into tramite.movimientos_doc(codigo_documento," +
		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
		 		"oficina_deriva,destinatario,desc_origen,tipo,fecha_rpta,oficina_origen,codigo_recepcion,numero_referencia," +
		 		"codigo_expediente,numero_documento,asunto_documento) values(" + "'" + numero_referencia + "'"
	 	 		+ "," +"'01'"+","+"'"+ li_secuencia_oficina + "'"+ "," +"'" + destino_documento + "'"+ "," +"'01'"
	 	 		+ "," + "'" + origen_documento + "'"+ "," +"'2'"
	 	 		+ "," +"'" + fecha_registro + "'"+ "," +"'" + fecha_consulta + "'"+ "," +"'" + hora + "'"
	 	 		+ "," +"'" + observa_documento + "'"+ "," +"'" + codigo_documento + "'"
	 	 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+ "," +"'" + destino_documento + "'"+
	 	 		"," +"'" + destinatario + "'"+
	 	 		"," +"'" + desc_origen + "'"+
	 	 		"," +"'" + tipo + "'"+
	 	 		"," +"'" + fecha_rpta + "'"+
	 	 		"," +"'" + codigo_oficina + "'"+
	 	 		"," +"'" + correlativorecepcion + "'"+
	 	 		"," +"'" + numero_referencia + "'"+
	 	 		"," +"'0'"+
	 	 		"," +"'" + numero_documento + "'"+
	 	 		"," +"'" + asunto_documento + "'"+
	 	 		")";
	 
			 	//log.info("El cuarto ls_sql oficina a las q se deriva el documento es" + ls_sql);
			 	 us = con.createStatement();
			 	 us.executeUpdate(ls_sql);
			 
			 	/***********************Registrando para el recorrido********************/
		    	 
			 	 
				 	ls_sql = "insert into tramite.recorrido_doc(codigo_documento," +
			 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
			 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
			 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
			 		"oficina_deriva,destinatario,desc_origen,tipo,fecha_rpta,oficina_origen,estado,codigo_recepcion,numero_referencia,codigo_expediente) values(" + "'" + codigo_documento + "'"
		 		+ "," +"'01'"+","+"'"+ li_secuencia + "'"+ "," +"'" + codigo_oficina + "'"+ "," +"'01'"
		 		+ "," + "'" + origen_documento + "'"+ "," +"'1'"
		 		+ "," +"'" + fecha_registro + "'"+ "," +"'" + fecha_consulta + "'"+ "," +"'" + hora + "'"
		 		+ "," +"'" + observa_documento + "'"+ "," +"'" + codigo_documento + "'"
		 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+ "," +"'" + destino_documento + "'"+
		 		"," +"'" + destinatario + "'"+
		 		"," +"'" + desc_origen + "'"+
		 		"," +"'" + tipo + "'"+
		 		"," +"'" + fecha_rpta + "'"+
		 		"," +"'" + codigo_oficina + "'"+
		 		"," +"'R'"+
		 		"," +"'" + correlativorecepcion + "'"+
		 		"," +"'" + numero_referencia + "'"+
		 		"," +"'0'"+
		 		")";
		 
				// //log.info("El 1er ls_sql recorrido_doc registro de nuestra oficina origen es" + ls_sql);
				 us = con.createStatement();
				 us.executeUpdate(ls_sql);
		 
				
		    	 ls_sql = "insert into tramite.recorrido_doc(codigo_documento," +
		 		"codigo_fondo,secuencia_movimiento,codigo_oficina,codigo_serie," +
		 		"codigo_institucion,estado_movimiento,fecha_movimiento,fecha_consulta,hora_movimiento," +
		 		"observa_movimiento,codigo_inicia,ultimo_usuario,fondo_deriva," +
		 		"oficina_deriva,destinatario,desc_origen,tipo,fecha_rpta,oficina_origen,estado,codigo_recepcion,numero_referencia,codigo_expediente) values(" + "'" + codigo_documento + "'"
		 		+ "," +"'01'"+","+"'"+ li_secuencia_oficina + "'"+ "," +"'" + destino_documento + "'"+ "," +"'01'"
		 		+ "," + "'" + origen_documento + "'"+ "," +"'2'"
		 		+ "," +"'" + fecha_registro + "'"+ "," +"'" + fecha_consulta + "'"+ "," +"'" + hora + "'"
		 		+ "," +"'" + observa_documento + "'"+ "," +"'" + codigo_documento + "'"
		 		+ "," +"'" + usuario_actual + "'"+ "," +"'01'"+ "," +"'" + destino_documento + "'"+
		 		"," +"'" + destinatario + "'"+
		 		"," +"'" + desc_origen + "'"+
		 		"," +"'" + tipo + "'"+
		 		"," +"'" + fecha_rpta + "'"+
		 		"," +"'" + codigo_oficina + "'"+
		 		"," +"'R'"+
		 		"," +"'" + correlativorecepcion + "'"+
		 		"," +"'" + numero_referencia + "'"+
		 		"," +"'0'"+
		 		")";

			 	// //log.info("El quinto ls_sql recorrido_doc a las q se deriva el documento es" + ls_sql);
			 	 us = con.createStatement();
			 	 us.executeUpdate(ls_sql);
			 	 
			 	 
		 		/*}else{
		 			String ls_estado="A";
		 			ls_sql = "UPDATE tramite.movimientos_doc SET estado_movimiento = " + "'" + ls_estado  + "'"+
		 			"," + "fecha_movimiento=" + "'" + fecha_registro + "'"+ "," + " hora_movimiento=" +
		 			"'" + hora + "'"+ "," + " ultimo_usuario=" + "'" + usuario_actual + "'" +
		 			" where codigo_documento = " + "'" + codigo_documento + "'"+" and secuencia_movimiento = " +
		 			"'" + li_secuencia + "'" + " ";
		 			
		 			// //log.info("Para actualizar los movimientos es" + ls_sql);
			    	 us = con.createStatement();
			    	 us.executeUpdate(ls_sql);
		 		}*/
		    	 
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    	}
	    	return numero_referencia;

		}
	 
	 
	 public Collection  of_lista_oficinas_copia(Connection cnx,String codigo_documento) throws Exception {
			
	       // //log.info("ENTRO A  Lista de Oficinas por Usuario");
			Collection OficinasUsuario = new ArrayList();
			
			BUsuario BUsuarioVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
			 
	        try {	
	        	
	        
	        	String ls_sql = "md.codigo_documento,md.oficina_deriva from tramite.movimientos_doc md" +
	        			" where md.secuencia_movimiento ='2' and md.estado_movimiento='2' " +
	        			"and md.codigo_documento= " + "'" + codigo_documento + "'" ;
	        	////log.info("El s_sql"+ ls_sql);
	        	
		    	us = cnx.createStatement();
		    	////log.info("El us"+ us);
	    		rs = us.executeQuery(ls_sql);
	    		////log.info("El rs"+ rs);
				while ( rs.next() ) { 
					////log.info("Dentro del Resultset");
					BUsuarioVO = new BUsuario();
					////log.info("Despues del Bean");
					BUsuarioVO.setCodigo_oficina(rs.getString("codigo_oficina"));
					BUsuarioVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
					BUsuarioVO.setC_usuario(rs.getString("c_usuario"));
					BUsuarioVO.setCodigo_personal(rs.getString("codigo_personal"));
					
					OficinasUsuario.add(BUsuarioVO);
				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return OficinasUsuario;
		                
		}
	 
	 
	 public Collection  lista_derivacion_documentos_buscar(Connection cnx,String oficina,String accesoaoficinas,String codigo_documento,String codigo_expediente) throws Exception {
			
	        //log.info("ENTRO A  Lista Derivacion de Mesa de Partes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			ObtieneConexion  x= new ObtieneConexion();
			Connection	con= x.getConnection();
			Statement us  = null;
			ResultSet rs = null;
			PreparedStatement pstmt = null;
			
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	DocumentosInternosService service = new DocumentosInternosServiceImplement();	
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	String ls_correla= "";
	    	String ls_num_upload="";
	    	String ls_valor  = "";
	    	//String ls_sql ="";
	    	int li_retorno=0;
	    	int codigo_temporal = 0;
	    	int estado_temporal = 0;
	    	
	    
	    	Date fecha_recep = new Date(); // fecha y hora locales 
		SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
		SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); 
		/*//log.info("la fecha es.."+ formatoFecha.format(fecha_recep) ); 
		//log.info("la hora es.."+ formatoHora.format(fecha_recep) );*/ 
	    
		Funciones funcion=new Funciones();
		
		
	        try {	
	        	
	        
	        	StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        				"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.secuencia_origen," +
	        				"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo," +
	        				"md.fecha_rpta,md.codigo_expediente,md.oficina_origen,md.oficina_deriva," +
	        				"md.correlativo_deriva,md.observa_registro,md.codigo_recepcion,md.flag," +
	        				"tp.descripcion_tipo,dc.numero_documento,dc.naturaleza_documento," +
	        				"dc.asunto_documento,dc.numero_documento_ant,de.origen_documento," +
	        				"de.destino_documento,de.desc_origen,de.tipo,de.remitente,de.destinatario," +
	        				"of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
	        				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from" +
	        				" tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
	        				"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a," +
	        				"tramite.personal pr where tp.codigo_tipo=dc.codigo_tipo and " +
	        				"dc.codigo_documento=md.codigo_documento and " +
	        				"dc.codigo_documento=de.codigo_documento and " +
	        				"md.codigo_documento=de.codigo_documento and de.destinatario=pr.codigo_personal" +
	        				" and md.codigo_oficina=of.codigo_oficina and " +
	        				"de.destino_documento=of_a.codigo_oficina and md.estado_movimiento = '3'" +
	        				" and md.codigo_fondo like '01' and md.codigo_oficina in ("+accesoaoficinas+") ");
	        				
	        				
	        				//" and md.codigo_documento = " + "'" + codigo_documento + "'");
	        				if(codigo_documento != null && !codigo_documento.equals("")){
	       		    		 ls_sql.append(" and md.codigo_documento like '"+ codigo_documento +"%' ");
	       		    		 //log.info("el codigo_expediente: " + ls_sql);
	       					}
	        	
	        				if(codigo_expediente != null && !codigo_expediente.equals("")){
	        				ls_sql.append(" and md.codigo_expediente like '"+ codigo_expediente +"%' ");
	        				//log.info("el codigo_expediente: " + ls_sql);
	        				}
	        				
	        				ls_sql.append(" and md.codigo_documento not in (select codigo_documento from " +
	        				"tramite.movimientos_doc where estado_movimiento = '3' and" +
	        				" codigo_fondo like '01' and codigo_oficina  in ("+accesoaoficinas+")   and flag ='I') order by md.codigo_documento desc limit 30 ");
	        		 
	        		// log.info("El ls_sql..otros mesa de partes oficinas DERIVACION.. : " + ls_sql);
				
				log.info("Si el ls_sql Busca Documento General..: " + ls_sql);
				
				 pstmt = con.prepareStatement(ls_sql.toString());
		    	 //pstmt.setInt(1, Integer.parseInt(oficina));
		    	 //pstmt.setInt(2, Integer.parseInt(oficina));

		    	 rs=pstmt.executeQuery();
	        		
	        	
	    		////log.info(" ls_sql.... : " + ls_sql);
	    		
	    		Funciones funciones=new Funciones();
	    		
	    		 String ls_ant_codigo_recepcion="";
		    	 String ls_ant_codigo_documento="";
		    	 String ls_ant_codigo_expediente="";
		    	 String ls_ant_secuencia_movimiento="";
		    	 String ls_naturaleza_documento="";
		    	 
		    	 String ls_codigo_recepcion="";
		    	 String ls_codigo_documento="";
		    	 String ls_codigo_documento_cont="";
		    	 String ls_codigo_expediente="";
		    	 String ls_codigo_expediente_cont="";
		    	 String ls_secuencia_movimiento="";
		    	 String ls_secuencia_origen ="";
		    	 
		    	 int contador=0;

		    	 
				while ( rs.next() ) { 
					
					
					//BMesaPartesVO = new BMesaPartes();
					
					contador=contador+1;
					 Hashtable objListaDoc = new Hashtable();
					 ////log.info("Imprime listas XXX...." + contador);
						////log.info("Imprime listas...." + contador);
						
						ls_codigo_recepcion=rs.getString("codigo_recepcion").trim();
						ls_codigo_documento=rs.getString("codigo_documento").trim();
						ls_codigo_expediente=rs.getString("codigo_expediente").trim();
						ls_secuencia_movimiento=rs.getString("secuencia_movimiento").trim();
						ls_secuencia_origen=rs.getString("secuencia_origen").trim();
					
						if(contador==1){

					String seleccionar = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">Seleccionar</label>";
					
					 ls_codigo_expediente_cont = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
					
					 ls_codigo_documento_cont = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("codigo_documento")+"</label>";
					
					String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("numero_documento")+"</label>";
					
					String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
					
					String ls_fecha_movimiento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("fecha_movimiento")+"</label>";
					
					objListaDoc.put("ACTION", seleccionar);
					objListaDoc.put("codigo_documento", ls_codigo_documento_cont);
					objListaDoc.put("codigo_expediente", ls_codigo_expediente_cont);
					objListaDoc.put("numero_documento", ls_numero_documento);
					objListaDoc.put("oficina_origen", ls_oficina_origen);
					objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
					objListaDoc.put("estado_movimiento","<FONT color='#00CC00'>"
							+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");
					objListaDoc.put("fecha_movimiento", ls_fecha_movimiento);
					objListaDoc.put("hora", rs.getString("hora_movimiento"));
					objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
					objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
					
					objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
					objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
					//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
					objListaDoc.put("naturaleza_documento", rs.getString("naturaleza_documento"));
					
					ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
					
					////log.info("El ls_num_upload es..: " + ls_num_upload);
					if(ls_num_upload.equals("0")){
						
						objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
						
					}else {
						
						objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
						"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");

					}
					
					/**
					 * INSERCION DE LINK FIRMA DIGITAL
					 */
					//System.out.println("cod -> "+rs.getString("codigo_documento").trim()+" sec -> "+rs.getString("secuencia_movimiento").trim());
					BInfoListaReiterativo infoLista = new BInfoListaReiterativo();
					
					infoLista = service.getCodigoDocumentoInternoDerivado(rs.getString("codigo_documento").trim(),oficina,rs.getString("secuencia_movimiento").trim(),rs.getString("oficina_origen").trim());
					estado_temporal = infoLista.getEstado_documento_interno();
					
					//ESTADO TEMPORAL,  SI ES CERO SIGNIFICA QUE NO TIENE HISTORIAL 
					if(estado_temporal == 0){
						//preparar respuesta
						//<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+infoLista.getCodigo_documento_interno_origen()+"' ><img src='img/edit_doc.png' height='20'  border='0'></A>  
						if(infoLista.getCodigo_documento_interno_origen() > 0){
							objListaDoc.put("documento_respuesta", "<A id='A1' title='Preparar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
							"<img src='img/send_doc.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
							"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+infoLista.getCodigo_documento_interno_origen()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
						}else{
							objListaDoc.put("documento_respuesta", "<A id='A1' title='Preparar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
							"<img src='img/send_doc.png' height='20'  border='0'></A>");
						}

					}else{
						if(estado_temporal == 1){
							//modificar respuesta
							if(infoLista.getCodigo_documento_interno_origen() > 0){
								
								
								objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
								"<img src='img/edit_doc.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
								"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+infoLista.getCodigo_documento_interno_origen()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
							}else{
								objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
								"<img src='img/edit_doc.png' height='20'  border='0'></A>");
							}
							
							  /*objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"' >"+
							"<img src='img/edit_doc.png' height='20'  border='0'></A>");*/
						}else{
							if(estado_temporal == 5){
								//firmar
								if(infoLista.getCodigo_documento_interno_origen() > 0){
									
									
									objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
									"<img src='img/03firmar.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
									"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+infoLista.getCodigo_documento_interno_origen()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
								}else{
									objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
									"<img src='img/03firmar.png' height='20'  border='0'></A>");
								}
								
								/*objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"' >"+
								"<img src='img/03firmar.png' height='20'  border='0'></A>");*/
								
							}else{
								if(estado_temporal == 3){
									//firmar
									objListaDoc.put("documento_respuesta", "<FONT color='#00CC00'>FIRMADO</FONT>");
									
								}
							}
							
						}
					}
					/***
					 * OBSERVAR
					 */
					objListaDoc.put("observar", "<A id='A1' href='javascript:Observar("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+","+ls_secuencia_movimiento+","+ls_secuencia_origen+");' >"+
					"<img src='img/07observar.png' height='20' title='Observar' border='0'></A>");
					/*objListaDoc.put("view_archivo", "<A id='A1' target='_blank' href='N:\\DocumentosTramite\\" +
							rs.getString("codigo_expediente").trim()+".PDF"+"'"+
							"><img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'>  </A>");*/
					
					ListaMesaPartes.add(objListaDoc);
					
					ls_ant_codigo_recepcion=ls_codigo_recepcion;
					ls_ant_codigo_documento=ls_codigo_documento;
					ls_ant_codigo_expediente=ls_codigo_expediente;
					ls_ant_secuencia_movimiento=ls_secuencia_movimiento;

					
						}
						else if(contador>1){
							////log.info("Si el contador es mayor a cero es....: ");
							
							if(ls_ant_codigo_documento.equals(ls_codigo_documento)){
								////log.info("Los codigos son iguales me imprime una lista ji ji....: ");
								
								
								
								////log.info("--------------------------------------------------- ");
							}else {
								
								String seleccionar = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">Seleccionar</label>";
									
									 ls_codigo_expediente_cont = "<label style='cursor: hand;' align='center' " 
										+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("codigo_expediente")+"</label>";
									
									 ls_codigo_documento_cont = "<label style='cursor: hand;' align='center' " 
										+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("codigo_documento")+"</label>";
									
									String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
										+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("numero_documento")+"</label>";
									
									String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
										+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
									
									String ls_fecha_movimiento = "<label style='cursor: hand;' align='center' " 
										+ "onclick=\"fn_editar_copia('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("fecha_movimiento")+"</label>";
									
									objListaDoc.put("ACTION", seleccionar);
									objListaDoc.put("codigo_documento", ls_codigo_documento_cont);
									objListaDoc.put("codigo_expediente", ls_codigo_expediente_cont);
									objListaDoc.put("numero_documento", ls_numero_documento);
									objListaDoc.put("oficina_origen", ls_oficina_origen);
									objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
									objListaDoc.put("estado_movimiento","<FONT color='#00CC00'>"
											+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");
									objListaDoc.put("fecha_movimiento", ls_fecha_movimiento);
									objListaDoc.put("hora", rs.getString("hora_movimiento"));
									objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
									objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
									
									objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
									objListaDoc.put("codigo_inicia", rs.getString("codigo_inicia"));
									//objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
									objListaDoc.put("naturaleza_documento", rs.getString("naturaleza_documento"));
									
									ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
									
									////log.info("El ls_num_upload es..: " + ls_num_upload);
									if(ls_num_upload.equals("0")){
										
										objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
										
									}else {
										
										objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
										"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");

									}
									/**
									 * INSERCION DE LINK FIRMA DIGITAL
									 */
									//System.out.println("cod -> "+rs.getString("codigo_documento").trim()+" sec -> "+rs.getString("secuencia_movimiento").trim());
									BInfoListaReiterativo infoLista = new BInfoListaReiterativo();
									
									infoLista = service.getCodigoDocumentoInternoDerivado(rs.getString("codigo_documento").trim(),oficina,rs.getString("secuencia_movimiento").trim(),rs.getString("oficina_origen").trim());
									estado_temporal = infoLista.getEstado_documento_interno();
									
									//ESTADO TEMPORAL,  SI ES CERO SIGNIFICA QUE NO TIENE HISTORIAL 
									if(estado_temporal == 0){
										//preparar respuesta
										//<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+infoLista.getCodigo_documento_interno_origen()+"' ><img src='img/edit_doc.png' height='20'  border='0'></A>  
										if(infoLista.getCodigo_documento_interno_origen() > 0){
											objListaDoc.put("documento_respuesta", "<A id='A1' title='Preparar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
											"<img src='img/send_doc.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
											"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+infoLista.getCodigo_documento_interno_origen()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
										}else{
											objListaDoc.put("documento_respuesta", "<A id='A1' title='Preparar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
											"<img src='img/send_doc.png' height='20'  border='0'></A>");
										}

									}else{
										if(estado_temporal == 1){
											//modificar respuesta
											if(infoLista.getCodigo_documento_interno_origen() > 0){
												
												
												objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
												"<img src='img/edit_doc.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
												"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+infoLista.getCodigo_documento_interno_origen()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
											}else{
												objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
												"<img src='img/edit_doc.png' height='20'  border='0'></A>");
											}
											
											  /*objListaDoc.put("documento_respuesta", "<A id='A1' title='Modificar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"' >"+
											"<img src='img/edit_doc.png' height='20'  border='0'></A>");*/
										}else{
											if(estado_temporal == 5){
												//firmar
												if(infoLista.getCodigo_documento_interno_origen() > 0){
													
													
													objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
													"<img src='img/03firmar.png' height='20'  border='0'></A>&nbsp;&nbsp;" +
													"<A id='A1' title='Preparar Respuesta con Proyecto' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"&codproy="+infoLista.getCodigo_documento_interno_origen()+"' ><img src='img/letterpblue.png' height='20'  border='0'></A>");
												}else{
													objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"&ofini="+rs.getString("oficina_origen").trim()+"' >"+
													"<img src='img/03firmar.png' height='20'  border='0'></A>");
												}
												
												/*objListaDoc.put("documento_respuesta", "<A id='A1' title='Firmar Respuesta' href='PuenteDocumentoInterno.do?cdi="+rs.getString("codigo_documento").trim()+"&cei="+rs.getString("codigo_expediente").trim()+"&cri="+rs.getString("codigo_recepcion").trim()+"&tipenv=D&sec="+rs.getString("secuencia_movimiento").trim()+"' >"+
												"<img src='img/03firmar.png' height='20'  border='0'></A>");*/
												
											}else{
												if(estado_temporal == 3){
													//firmar
													objListaDoc.put("documento_respuesta", "<FONT color='#00CC00'>FIRMADO</FONT>");
													
												}
											}
											
										}
									}
									/***
									 * OBSERVAR
									 */
									objListaDoc.put("observar", "<A id='A1' href='javascript:Observar("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+","+ls_secuencia_movimiento+","+ls_secuencia_origen+");' >"+
									"<img src='img/07observar.png' height='20' title='Observar' border='0'></A>");
									ListaMesaPartes.add(objListaDoc);
									
							}
							ls_ant_codigo_recepcion=ls_codigo_recepcion;
							ls_ant_codigo_documento=ls_codigo_documento;
							ls_ant_codigo_expediente=ls_codigo_expediente;
							ls_ant_secuencia_movimiento=ls_secuencia_movimiento;
							
								
							}
				}	
	            

				x.cerrar_conexion(con,rs);
		    	pstmt.close();
	        	
	            
	        } catch (SQLException e) {
	        	x.cerrar_conexion(con);
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 
	 public BPersona  of_detalle_codigo_persona_oficina(Connection cnx,String codigo_oficina) throws Exception {
			
	        //log.info("ENTRO A  Obtener documento padre");
			
	        SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_sistema  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String yearactual = year.format(d);
	    	
	    	BPersona BPersonaVO = null;
			Statement us  = null;
			ResultSet rs = null;
	       
	        try {	
	        	
	        	String ls_sql = "select codigo_persona, nombre_persona,tipo from tramite.persona where" +
					" codigo_oficina=" + "'" + codigo_oficina + "'" + "";
	        	
		    	us = cnx.createStatement();
	    		rs = us.executeQuery(ls_sql);
	    		log.info("JM -> "+ls_sql);
				while ( rs.next()) { 
					
					BPersonaVO = new BPersona();
					BPersonaVO.setCodigo_persona(rs.getString("codigo_persona"));
					BPersonaVO.setNombre_persona(rs.getString("nombre_persona"));
					BPersonaVO.setTipo(rs.getString("tipo"));
					
				}	
	            
				rs.close();
				
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return BPersonaVO;
		                
		}
	 
	 
	 public Collection lista_documentos_modificar_deriva_pendientes(Connection cnx,String codigo_documento
			 ,String secuencia_documento) throws Exception{
			
			////log.info("ENTRO A BUSCAR Documentos");
			//BDocumentos BDocumentosVO= null;
		 //log.info("Dentro de Lista documentos modificar..: " );
			Collection ListaMesaPartes = new ArrayList();
			
			
			PreparedStatement us  = null;
			ResultSet rs = null;
			//StringBuffer ls_sql ="";
			
			try 
			{	
	
					StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.codigo_oficina," +
							"md.fecha_movimiento,md.hora_movimiento,md.estado_movimiento,md.codigo_inicia," +
							"md.secuencia_movimiento,md.ultimo_usuario,md.codigo_expediente," +
							"md.oficina_origen,md.oficina_deriva,md.codigo_recepcion,md.fecha_rpta," +
							"md.observa_registro,md.observa_movimiento,tp.descripcion_tipo," +
							"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento," +
							"dc.fecha_registro,dc.hora_registro,dc.codigo_tipo,de.origen_documento," +
							"de.destino_documento,de.desc_origen,de.tipo,de.remitente,de.destinatario," +
							"de.codigo_solicitud,de.firmadopor,de.medio,of.codigo_oficina," +
							"of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino," +
							"pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc md," +
							"tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
							"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
							" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento" +
							" and dc.codigo_documento=de.codigo_documento and " +
							"md.codigo_documento=de.codigo_documento and de.destinatario=pr.codigo_personal" +
							" and md.codigo_oficina=of.codigo_oficina and " +
							"de.destino_documento=of_a.codigo_oficina and md.codigo_fondo like '01'");
					
							
						ls_sql.append(" and md.codigo_documento = '"+ codigo_documento +"'" +
								" and md.secuencia_movimiento > '"+ secuencia_documento + "'");
						//log.info("el ls_codigo_oficina: " + ls_sql);
						
						ls_sql.append(" order by codigo_documento desc,secuencia_movimiento desc," +
								" hora_movimiento desc, fecha_movimiento desc");
					
					String query = ls_sql.toString();
					
					//log.info("Si el ls_sql Busca Documento..: " + ls_sql);
					
					us = cnx.prepareStatement(query);
					rs = us.executeQuery();
					
			    	 ////log.info("Si el tipo es Rendicion: " + rs);
					String ls_num_upload="";
					String ls_nomb_upload="";
			    	 Funciones funciones=new Funciones();
			    	 String ls_codigo_recepcion="";
			    	 String ls_codigo_documento="";
			    	 String ls_codigo_expediente="";
			    	 String ls_secuencia_movimiento="";
			    	 
			    	 String ls_ant_codigo_recepcion="";
			    	 String ls_ant_codigo_documento="";
			    	 String ls_ant_codigo_expediente="";
			    	 String ls_ant_secuencia_movimiento="";
			    	 String ls_naturaleza_documento="";
			    	 int contador=0;
					 while ( rs.next() ) { 
							
						contador=contador+1;
						 Hashtable objListaDoc = new Hashtable();
						String seleccionar = "<label style='cursor: hand;' align='center' " 
							+ "onclick=\"fn_editar(" + "'" + rs.getString("codigo_documento") + "', " + "'"
					        + rs.getString("codigo_expediente") + "'"+ "," 
					        + "'"+ rs.getString("descripcion_tipo").trim() + "'"+ "," 
					        + "'"+ rs.getString("numero_documento") + "'"+ "," 
					        + "'"+ rs.getString("codigo_oficina") + "'"+ ","
					        + "'"+ rs.getString("estado_movimiento") + "'"+ ","
					        + "'"+ rs.getString("fecha_movimiento") + "'"+ ","
					        + "'"+ rs.getString("hora_movimiento") + "'"+ ","
					        + "'"+ rs.getString("observa_movimiento") + "'"+ ","
					        + "'"+ rs.getString("secuencia_movimiento").trim() + "'"
					        + ");\" " + ">Seleccionar</label>";
										
									objListaDoc.put("ACTION", seleccionar);
									objListaDoc.put("contador", contador);
									objListaDoc.put("codigo_documento", rs.getString("codigo_documento"));
									objListaDoc.put("codigo_expediente", rs.getString("codigo_expediente"));
									objListaDoc.put("numero_documento",rs.getString("numero_documento"));
									objListaDoc.put("oficina_origen", funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim()));
									objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
									objListaDoc.put("estado_movimiento", funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim()));
									objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
									objListaDoc.put("hora", rs.getString("hora_movimiento"));
									objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
									objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion"));
									objListaDoc.put("secuencia_movimiento", rs.getString("secuencia_movimiento"));
							
							
							ListaMesaPartes.add(objListaDoc);

							
						}	
					 
				
				
				rs.close();
				
			} catch (SQLException e) 
			{
				 e.printStackTrace();
			}
			return ListaMesaPartes;
	                
			}
	 
	 public void of_eliminar_documento_copia(Connection cnx,String codigo_documento,String secuencia_movimiento) {
	    	
	    	ObtieneConexion 	x= new ObtieneConexion();
	    	Connection			cn = x.getConnection();
	    	
	    	String ls_sql = "";
	    	 Statement us  = null;
	    	
	    	 
	    	 try{
	    		 
	    			ls_sql = "delete from tramite.movimientos_doc WHERE " +
	    					"codigo_documento =" + "'" + codigo_documento + "'"+
	    					" and secuencia_movimiento =" + "'" + secuencia_movimiento + "'";
	    			
	    			//log.info("El ls_sql 1 delete: "+ ls_sql);	
	 	    		us = cn.createStatement();
	 	    		us.executeUpdate(ls_sql);
	 	    		
	    	}
	    	catch(Exception e){
	    		log.info("error en el Servlet : " + e.getMessage()  );	
	    	} 
	    	
	    }
	 
	 
	 public Collection lista_recepcion_documentos_buscar(Connection cnx,String oficina,String accesoaoficinas,
			 String codigo_documento,String codigo_expediente) throws Exception {
			
	        //log.info("ENTRO A  Lista de Mesa de Partes Recepcion Normal..");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	//String ls_sql ="";
	    	String ls_estado_mov="";
	    	String ls_num_upload="";
			String ls_dirigido= "";
    		Funciones funciones=new Funciones();
    		
    		String ls_codigo_solicitud="";
    		String ls_medio="";
    		
    		 String ls_ant_codigo_recepcion="";
	    	 String ls_ant_codigo_documento="";
	    	 String ls_ant_codigo_expediente="";
	    	 String ls_ant_secuencia_movimiento="";
	    	 String ls_naturaleza_documento="";
	    	 
	    	 String ls_codigo_recepcion="";
	    	 String ls_codigo_documento="";
	    	 String ls_codigo_documento_cont="";
	    	 String ls_codigo_expediente_cont="";
	    	 
	    	 String ls_codigo_expediente="";
	    	 String ls_secuencia_movimiento="";
	    	 String ls_secuencia_origen="";
	    	 int contador=0;
	    	
	    	Date fecha_recep = new Date(); // fecha y hora locales 
		SimpleDateFormat formatoFecha = new SimpleDateFormat("dd/MM/yyyy"); 
		SimpleDateFormat formatoHora = new SimpleDateFormat("HH:mm"); 
		/*//log.info("la fecha es.."+ formatoFecha.format(fecha_recep) ); 
		//log.info("la hora es.."+ formatoHora.format(fecha_recep) );*/ 

    	ObtieneConexion  x= new ObtieneConexion();
		Connection	con= x.getConnection();
		ResultSet rs = null;
		PreparedStatement pstmt = null;
	    		
	        try {	
	        	
	        	StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento," +
	        		 		"md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.secuencia_origen," +
	        		 		"md.ultimo_usuario,md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
	        		 		"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.observa_registro,md.codigo_recepcion," +
	        		 		"md.flag,tp.descripcion_tipo,md.desc_origen,dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento," +
	        		 		"dc.numero_documento_ant,dc.observa_documento,dc.fecha_registro,dc.hora_registro,dc.dirigido,de.origen_documento,de.destino_documento,de.desc_origen as nombre_procedencia," +
	        		 		"de.tipo,de.remitente,md.destinatario,de.firmadopor,de.medio,de.codigo_solicitud,of.codigo_oficina,of.descripcion_oficina," +
	        		 		"of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal,pr.nombre_personal, md.doc_resp" +
	        		 		" from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
	        		 		"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr" +
	        		 		" where tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
	        		 		" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
	        		 		" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
	        		 		
	        		 		" de.destino_documento=of_a.codigo_oficina and md.estado_movimiento ='2' and" +
	        		 		" md.codigo_fondo like '01' and md.codigo_oficina in ("+accesoaoficinas+")  ");
	        		 		
	        				if(codigo_documento != null && !codigo_documento.equals("")){
			  		    		 ls_sql.append(" and md.codigo_documento like '"+ codigo_documento +"%' ");
			  		    		 //log.info("el codigo_expediente: " + ls_sql);
			  					}
			   	
			   				if(codigo_expediente != null && !codigo_expediente.equals("")){
			   				ls_sql.append(" and md.codigo_expediente like '"+ codigo_expediente +"%' ");
			   				//log.info("el codigo_expediente: " + ls_sql);
			   				}

			   				ls_sql.append(" order by md.codigo_documento desc limit 30 offset 0");
        		 
			   				 pstmt = con.prepareStatement(ls_sql.toString());
					    	 //pstmt.setInt(1, Integer.parseInt(oficina));

					    	 rs=pstmt.executeQuery();


	    		////log.info(" ls_sql.... : " + ls_sql);
	    
				while ( rs.next() ) { 
					
			
					contador=contador+1;
					Hashtable objListaDoc = new Hashtable();
					
					ls_codigo_recepcion=rs.getString("codigo_recepcion").trim();
					ls_codigo_documento=rs.getString("codigo_documento").trim();
					ls_codigo_expediente=rs.getString("codigo_expediente").trim();
					ls_secuencia_movimiento=rs.getString("secuencia_movimiento").trim();
					ls_secuencia_origen=rs.getString("secuencia_origen").trim();
					
					ls_codigo_solicitud=funciones.of_solicitud_documento(cnx, rs.getString("codigo_solicitud")).trim();
					ls_medio=funciones.of_medio_documento(cnx, rs.getString("medio")).trim();
					
					/*//log.info("El lls_codigo_solicitud es.. : " + ls_codigo_solicitud);
					//log.info("El ls_medio es.. : " + ls_medio);
					
					//log.info("El contador TTTTTTTT es.. : " + contador);
					*/
					ls_estado_mov=rs.getString("estado_movimiento");
					String asunto_documento = funciones.convertir_comillas(rs.getString("asunto_documento"));
					String documento_respuesta = rs.getString("doc_resp")==null?"":rs.getString("doc_resp");
					if(contador==1){
						
						
						
						////log.info("El contador es igual a 1... ");
					String seleccionar = "<label style='cursor: hand;' align='center' " 
					+ "onclick=\"fn_editar_cop('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">Seleccionar</label>";
					 //log.info("El seleccionar XXXXX.. : " + seleccionar);
					 ls_codigo_expediente_cont = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar_cop('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("codigo_expediente").trim()+"</label>";
					 ////log.info("El ls_codigo_expediente.. : " + ls_codigo_expediente.trim());
					 ls_codigo_documento_cont = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar_cop('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("codigo_documento")+"</label>";
					////log.info("El ls_codigo_documento.. : " + ls_codigo_documento);
					String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar_cop('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("numero_documento")+"</label>";
					////log.info("El ls_numero_documento.. : " + ls_numero_documento);
					String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
						+ "onclick=\"fn_editar_cop('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
					////log.info("El ls_oficina_origen.. : " + ls_oficina_origen);
					objListaDoc.put("ACTION", seleccionar);
					objListaDoc.put("codigo_documento", ls_codigo_documento_cont);
					objListaDoc.put("codigo_expediente", ls_codigo_expediente_cont);
					objListaDoc.put("numero_documento", ls_numero_documento);
					objListaDoc.put("oficina_origen", ls_oficina_origen);
					objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
					if(ls_estado_mov.equals("5")){
						objListaDoc.put("estado_movimiento", "<FONT color='#009933'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");	
					}
					else if(ls_estado_mov.equals("2")){
						objListaDoc.put("estado_movimiento", "<FONT color='#FF0000 '>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");	
					}
					else{
						objListaDoc.put("estado_movimiento", "<FONT color='#00CC00'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");
					}
					
					/*objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
					objListaDoc.put("hora", rs.getString("hora_movimiento"));
					objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
					*/
					objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion").trim());
					objListaDoc.put("fecha_registro", rs.getString("fecha_registro").trim());
					objListaDoc.put("tipo_doc", rs.getString("descripcion_tipo").trim());
					
					ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
					////log.info("El lls_num_upload.. : " + ls_num_upload);
					if(ls_num_upload.equals("0")){
						
						objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
						
					}else {
						
						objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
						"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");

					}
					objListaDoc.put("destinatario", funciones.of_nombre_persona(cnx, rs.getString("destinatario")));
					
					objListaDoc.put("observar", "<A id='A1' href='javascript:Observar("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+","+ls_secuencia_movimiento+","+ls_secuencia_origen+");' >"+
					"<img src='img/07observar.png' height='20' alt='Observar' border='0'></A>");
					
					/*objListaDoc.put("view_archivo", "<A id='A1' target='_blank' href='N:\\DocumentosTramite\\" +
							rs.getString("codigo_expediente").trim()+".PDF"+"'"+
							"><img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'>  </A>");*/
					
					ListaMesaPartes.add(objListaDoc);
				
					ls_ant_codigo_recepcion=ls_codigo_recepcion;
					ls_ant_codigo_documento=ls_codigo_documento;
					ls_ant_codigo_expediente=ls_codigo_expediente;
					ls_ant_secuencia_movimiento=ls_secuencia_movimiento;
					
													
				}
					else if(contador>1){
						//log.info("Si el contador es mayor a cero es....: ");
						
						/*//log.info("Si ls_ant_codigo_documento a cero es....: " + ls_ant_codigo_documento);
						//log.info("Si ls_codigo_documento a cero es....: " + ls_codigo_documento);*/
						if(ls_ant_codigo_documento.equals(ls_codigo_documento)){
							////log.info("Los codigos son iguales me imprime una lista ji ji....: ");
							
							
							
						//	//log.info("--------------------------------------------------- ");
						}else {
							
							String seleccionar = "<label style='cursor: hand;' align='center' " 
								+ "onclick=\"fn_editar('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">Seleccionar</label>";
								 //log.info("El seleccionar XXXXX.. : " + seleccionar);
								 ls_codigo_expediente_cont = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("codigo_expediente").trim()+"</label>";
								 ////log.info("El ls_codigo_expediente.. : " + ls_codigo_expediente.trim());
								 ls_codigo_documento_cont = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("codigo_documento")+"</label>";
								////log.info("El ls_codigo_documento.. : " + ls_codigo_documento);
								String ls_numero_documento = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ rs.getString("numero_documento")+"</label>";
								////log.info("El ls_numero_documento.. : " + ls_numero_documento);
								String ls_oficina_origen = "<label style='cursor: hand;' align='center' " 
									+ "onclick=\"fn_editar('"+ls_codigo_documento+"','"+ls_secuencia_movimiento+"');\" " + ">"+ funciones.of_nombre_oficina(cnx, rs.getString("oficina_origen").trim())+"</label>";
								////log.info("El ls_oficina_origen.. : " + ls_oficina_origen);
								objListaDoc.put("ACTION", seleccionar);
								objListaDoc.put("codigo_documento", ls_codigo_documento_cont);
								objListaDoc.put("codigo_expediente", ls_codigo_expediente_cont);
								objListaDoc.put("numero_documento", ls_numero_documento);
								objListaDoc.put("oficina_origen", ls_oficina_origen);
								objListaDoc.put("oficina_deriva", funciones.of_nombre_oficina(cnx, rs.getString("oficina_deriva").trim()));
								if(ls_estado_mov.equals("5")){
									objListaDoc.put("estado_movimiento", "<FONT color='#009933'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");	
								}
								else if(ls_estado_mov.equals("2")){
									objListaDoc.put("estado_movimiento", "<FONT color='#FF0000 '>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");	
								}
								else{
									objListaDoc.put("estado_movimiento", "<FONT color='#00CC00'>"+funciones.of_nombre_estado(cnx, rs.getString("estado_movimiento").trim())+"</FONT>");
								}
								
								/*objListaDoc.put("fecha_movimiento", rs.getString("fecha_movimiento"));
								objListaDoc.put("hora", rs.getString("hora_movimiento"));
								objListaDoc.put("asunto_documento", rs.getString("asunto_documento"));
								*/
								objListaDoc.put("codigo_recepcion", rs.getString("codigo_recepcion").trim());
								objListaDoc.put("fecha_registro", rs.getString("fecha_registro").trim());
								objListaDoc.put("tipo_doc", rs.getString("descripcion_tipo").trim());
								
								ls_num_upload=funciones.of_numero_doc_upload(cnx,rs.getString("codigo_documento").trim());
								////log.info("El lls_num_upload.. : " + ls_num_upload);
								if(ls_num_upload.equals("0")){
									
									objListaDoc.put("view_archivo", "<font color='#0000FF'>--------</font>");
									
								}else {
									
									objListaDoc.put("view_archivo", "<A id='A1' href='javascript:VerArchivos("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+");' >"+
									"<img src='img/copy_f2.png' height='20' alt='Ver Documento' border='0'></A>");

								}	
								objListaDoc.put("destinatario", funciones.of_nombre_persona(cnx, rs.getString("destinatario")));
								
								objListaDoc.put("observar", "<A id='A1' href='javascript:Observar("+rs.getString("codigo_documento").trim()+","+rs.getString("codigo_expediente").trim()+","+rs.getString("codigo_recepcion").trim()+","+ls_secuencia_movimiento+","+ls_secuencia_origen+");' >"+
								"<img src='img/07observar.png' height='20' alt='Observar' border='0'></A>");
								
								ListaMesaPartes.add(objListaDoc);

						}

						ls_ant_codigo_recepcion=ls_codigo_recepcion;
						ls_ant_codigo_documento=ls_codigo_documento;
						ls_ant_codigo_expediente=ls_codigo_expediente;
						ls_ant_secuencia_movimiento=ls_secuencia_movimiento;
					}
				}
				
				x.cerrar_conexion(con, rs);
				pstmt.close();
	        	
	            
	        } catch (SQLException e) {
	             e.printStackTrace();
	             x.cerrar_conexion(con);
	        }
	        return ListaMesaPartes;
		                
		}
	 
	 
	 public Collection  reportes_criterio_buscar(Connection cnx,String naturaleza,String tipodoc
			 ,String estado,String usuario,String sle_fecha,String codigo_oficina,
			 String estado_criterio_usuario,String codigo_tipo,String procedencia,String firmadopor,
			 String estado_criterio,String fecha_rpta,String numero_referencia) throws Exception {
			
	        //log.info("ENTRO A  Lista Naturaleza reportes");
			Collection ListaMesaPartes = new ArrayList();
			
			BCorrelativos BCorrelativosVO = null;
			BTipoDocumento BTipoDocumentoVO = null;
			BOficinas BOficinasVO = null;
			BFondo BFondoVO = null;
			BMesaPartes BMesaPartesVO = null;
			
			PreparedStatement us  = null;
			ResultSet rs = null;

	       String ls_desde;
	       String ls_hasta;
	       
	       	SimpleDateFormat fechaActual  = new SimpleDateFormat ("dd/MM/yyyy");
	       	SimpleDateFormat fechaActualFormat  = new SimpleDateFormat ("yyyy-dd-MM");
	    	SimpleDateFormat fechaConsulta = new SimpleDateFormat ("yyyyMMdd");
	    	SimpleDateFormat year = new SimpleDateFormat ("yyyy");
	    	
	    	Date d= new Date(); 
	    	String fecha_documento  = fechaActual.format(d);
	    	String fechaconsulta = fechaConsulta.format(d);
	    	String fechaformat = fechaActualFormat.format(d);
	    	String yearactual = year.format(d);
	    	String estado_documento = "1";
	    	String fondo = "01";
	    	
	    	String ls_valor  = "";
	    	String ls_codigo_documento = "";
	    	String ls_ant_codigo_documento="";
	    	int contador=0;
	    	//String ls_sql ="";
	    	
	        try {	
	        	
	        
	        		/*//log.info(" Si es una lista naTURALEZA BUSCAR");
	   
	              		 //log.info(" Si la naturaleza es diferente de Cero 0");*/
	        			
	        	/*StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.codigo_oficina,md.fecha_movimiento,md.hora_movimiento," +
		 				"md.estado_movimiento,md.codigo_inicia,md.secuencia_movimiento,md.ultimo_usuario," +
		 				"md.doc_deriva,md.observa_movimiento,md.codigo_motivo,md.fecha_rpta," +
		 				"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,tp.descripcion_tipo," +
		 				"dc.numero_documento,dc.naturaleza_documento,dc.asunto_documento,dc.numero_documento_ant," +
		 				"de.origen_documento,de.destino_documento,de.desc_origen,de.tipo,de.remitente," +
		 				"de.destinatario,of.codigo_oficina,of.descripcion_oficina,of_a.descripcion_oficina as" +
		 				" descripcion_destino,pr.codigo_personal,pr.nombre_personal from tramite.movimientos_doc" +
		 				" md,tramite.tipo_documento tp,tramite.documento dc,tramite.doc_entrada de," +
		 				"tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where" +
		 				" tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
		 				" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento" +
		 				" and de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
		 				" de.destino_documento=of_a.codigo_oficina");*/
	        	/**
	        	 * Cambiamos aqui el Query para que tenga consistencia con el de Seguimiento
	        	 */
	        	/*StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.secuencia_movimiento,md.codigo_oficina,md.fecha_movimiento,md.doc_deriva" +
						",md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.ultimo_usuario," +
						"md.codigo_expediente,md.oficina_origen,md.observa_movimiento,md.correlativo_deriva,md.codigo_motivo,md.oficina_deriva,md.codigo_recepcion,md.fecha_rpta," +
						"tp.descripcion_tipo,dc.numero_documento,dc.numero_documento_ant,dc.naturaleza_documento,dc.asunto_documento,dc.fecha_registro," +
						"(substr(dc.fecha_registro,7,10) || substr(dc.fecha_registro,4,2) || substr(dc.fecha_registro,0,3)) as fecha_consulta_reg," +
						"dc.hora_registro,dc.codigo_tipo,de.origen_documento,de.destino_documento,de.desc_origen,de.tipo," +
						"de.remitente,de.destinatario,de.codigo_solicitud,de.firmadopor,de.medio,of.codigo_oficina," +
						"of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal," +
						"pr.nombre_personal from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
						"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where " +
						"tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
						" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento and " +
						"de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
						" de.destino_documento=of_a.codigo_oficina and md.codigo_fondo like '01' ");*/
	        	
	        	StringBuffer ls_sql = new StringBuffer("select md.codigo_documento,md.secuencia_movimiento,md.codigo_oficina,md.fecha_movimiento" +
						",md.hora_movimiento,md.estado_movimiento,md.codigo_inicia,md.ultimo_usuario," +
						"md.codigo_expediente,md.oficina_origen,md.oficina_deriva,md.correlativo_deriva,md.codigo_recepcion,md.fecha_rpta," +
						"tp.descripcion_tipo,dc.numero_documento,dc.numero_documento_ant,dc.naturaleza_documento,dc.asunto_documento,dc.fecha_registro," +
						"(substr(dc.fecha_registro,7,10) || substr(dc.fecha_registro,4,2) || substr(dc.fecha_registro,0,3)) as fecha_consulta_reg," +
						"dc.hora_registro,dc.codigo_tipo,de.origen_documento,de.destino_documento,de.desc_origen,de.tipo," +
						"de.remitente,de.destinatario,de.codigo_solicitud,de.firmadopor,de.medio,of.codigo_oficina," +
						"of.descripcion_oficina,of_a.descripcion_oficina as descripcion_destino,pr.codigo_personal," +
						"pr.nombre_personal from tramite.movimientos_doc md,tramite.tipo_documento tp,tramite.documento dc," +
						"tramite.doc_entrada de,tramite.oficinas of,tramite.oficinas of_a,tramite.personal pr where " +
						"tp.codigo_tipo=dc.codigo_tipo and dc.codigo_documento=md.codigo_documento and" +
						" dc.codigo_documento=de.codigo_documento and md.codigo_documento=de.codigo_documento and " +
						"de.destinatario=pr.codigo_personal and md.codigo_oficina=of.codigo_oficina and" +
						" de.destino_documento=of_a.codigo_oficina and md.codigo_fondo like '01' ");
	        	
		 				
			        	if(naturaleza != null && !naturaleza.equals("0") && !naturaleza.equals("")){
		  		    		 ls_sql.append(" and dc.naturaleza_documento ='"+ naturaleza +"' ");
		  		    		 //log.info("el codigo_expediente: " + ls_sql);
		  					}

			        	if(tipodoc != null && !tipodoc.equals("0") && !tipodoc.equals("")){
		  		    		 ls_sql.append(" and dc.codigo_tipo ='"+ tipodoc +"' ");
		  		    		 //log.info("el codigo_expediente: " + ls_sql);
		  					}
			        	if(estado != null && !estado.equals("0") && !estado.equals("")){
		  		    		 ls_sql.append(" and md.estado_movimiento ='"+ estado +"' ");
		  		    		 //log.info("el codigo_expediente: " + ls_sql);
		  					}
			        	if(usuario != null && !usuario.equals("0") && !usuario.equals("")){
		  		    		 ls_sql.append(" and md.ultimo_usuario ='"+ usuario +"' ");
		  		    		 //log.info("el codigo_expediente: " + ls_sql);
		  					}
			        	if(sle_fecha != null && !sle_fecha.equals("") ){
		  		    		 ls_sql.append(" and dc.fecha_registro ='"+ sle_fecha +"' ");
		  		    		 //log.info("el codigo_expediente: " + ls_sql);
		  					}
			        	if(codigo_oficina != null && !codigo_oficina.equals("0") && !codigo_oficina.equals("")){
		  		    		 ls_sql.append(" and md.codigo_oficina ='"+ codigo_oficina +"' ");
		  		    		 //log.info("el codigo_expediente: " + ls_sql);
		  					}
			        	if(estado_criterio_usuario != null && !estado_criterio_usuario.equals("0") && !estado_criterio_usuario.equals("")){
		  		    		 ls_sql.append(" and md.estado_movimiento ='"+ estado_criterio_usuario +"' ");
		  		    		 //log.info("el codigo_expediente: " + ls_sql);
		  					}
			        	if(codigo_tipo != null && !codigo_tipo.equals("0") && !codigo_tipo.equals("")){
		  		    		 ls_sql.append(" and dc.codigo_tipo ='"+ codigo_tipo +"' ");
		  		    		 //log.info("el codigo_expediente: " + ls_sql);
		  					}
			        	if(procedencia != null && !procedencia.equals("")){
		  		    		 ls_sql.append(" and md.desc_origen like '%"+ procedencia.toUpperCase() +"%' ");
		  		    		 //log.info("el codigo_expediente: " + ls_sql);
		  					}
			        	if(firmadopor != null && !firmadopor.equals("")){
		  		    		 ls_sql.append(" and de.firmadopor like '%"+ firmadopor.toUpperCase() +"%' ");
		  		    		 //log.info("el codigo_expediente: " + ls_sql);
		  					}
			        	
			        	if(estado_criterio != null && !estado_criterio.equals("0") && !estado_criterio.equals("")){
		  		    		 ls_sql.append(" and md.estado_movimiento ='"+ estado_criterio +"' ");
		  		    		// log.info("el codigo_expediente: " + estado_criterio);
		  					}
			        	if(fecha_rpta != null && !fecha_rpta.equals("")){
		  		    		 ls_sql.append(" and md.fecha_rpta = '"+ fecha_rpta +"' ");
		  		    		 //log.info("el codigo_expediente: " + ls_sql);
		  					}
			        	if(numero_referencia != null && !numero_referencia.equals("")){
		  		    		 ls_sql.append(" and md.numero_referencia like '%"+ numero_referencia.toUpperCase() +"%' ");
		  		    		 //log.info("el codigo_expediente: " + ls_sql);
		  					}
			        	
			        
			        	ls_sql.append(" order by  md.codigo_documento desc,md.secuencia_movimiento desc");

	              		 
	    
	        		//log.info("El ls_sql..otros naturaleza.. : " + ls_sql);
			        	String query = ls_sql.toString();
						
					//	log.info("Si el ls_sql Busca Documento General..: " + ls_sql);
						
						us = cnx.prepareStatement(query);
						rs = us.executeQuery();
						Funciones funciones=new Funciones();
		 	    		
						while ( rs.next() ) { 
							BMesaPartesVO = new BMesaPartes();
							contador=contador+1;
							ls_codigo_documento=rs.getString("codigo_documento").trim();

								
							if(contador==1){
								BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
								BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
								BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
								BMesaPartesVO.setEstado_movimiento(funciones.of_nombre_estado(cnx,rs.getString("estado_movimiento")));
								BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
								
								BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
								//BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
								
								//BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
								//BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
								BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
								BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
								BMesaPartesVO.setCodigo_oficina(funciones.of_nombre_corto_oficina(cnx, rs.getString("codigo_oficina").trim()));
								BMesaPartesVO.setOficina_origen(funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_origen").trim()));
								BMesaPartesVO.setOficina_deriva(funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_deriva").trim()));
								BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
								BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
								BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
								BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
								BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
								BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
								BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
								BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
								BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
								BMesaPartesVO.setTipo(rs.getString("tipo"));
								BMesaPartesVO.setRemitente(rs.getString("remitente"));
								
								BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
								//BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
								BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
								BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
								BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
								BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
								BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
								
								String naturaleza_documento=rs.getString("naturaleza_documento");
							//	//log.info("El naturaleza_documento Mesa partes" + naturaleza_documento);
								ListaMesaPartes.add(BMesaPartesVO);
								//ListaMesaPartes.add(objListaDoc);
								ls_ant_codigo_documento=ls_codigo_documento;
							}
							else if(contador>1){
									if(ls_ant_codigo_documento.equals(ls_codigo_documento)){}
									else {
										BMesaPartesVO.setCodigo_documento(rs.getString("codigo_documento"));
										BMesaPartesVO.setFecha_movimiento(rs.getString("fecha_movimiento"));
										BMesaPartesVO.setHora_movimiento(rs.getString("hora_movimiento"));
										BMesaPartesVO.setEstado_movimiento(funciones.of_nombre_estado(cnx,rs.getString("estado_movimiento")));
										BMesaPartesVO.setSecuencia_movimiento(rs.getString("secuencia_movimiento"));
										
										BMesaPartesVO.setUltimo_usuario(rs.getString("ultimo_usuario"));
										//BMesaPartesVO.setDoc_deriva(rs.getString("doc_deriva"));
										
										//BMesaPartesVO.setObserva_movimiento(rs.getString("observa_movimiento"));
										//BMesaPartesVO.setCodigo_motivo(rs.getString("codigo_motivo"));
										BMesaPartesVO.setFecha_rpta(rs.getString("fecha_rpta"));
										BMesaPartesVO.setCodigo_expediente(rs.getString("codigo_expediente"));
										BMesaPartesVO.setCodigo_oficina(funciones.of_nombre_corto_oficina(cnx, rs.getString("codigo_oficina").trim()));
										BMesaPartesVO.setOficina_origen(funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_origen").trim()));
										BMesaPartesVO.setOficina_deriva(funciones.of_nombre_corto_oficina(cnx, rs.getString("oficina_deriva").trim()));
										BMesaPartesVO.setCodigo_inicia(rs.getString("codigo_inicia"));
										BMesaPartesVO.setDescripcion_tipo(rs.getString("descripcion_tipo"));
										BMesaPartesVO.setNumero_documento(rs.getString("numero_documento"));
										BMesaPartesVO.setNumero_documento_ant(rs.getString("numero_documento_ant"));
										BMesaPartesVO.setNaturaleza_documento(rs.getString("naturaleza_documento"));
										BMesaPartesVO.setAsunto_documento(rs.getString("asunto_documento"));
										BMesaPartesVO.setOrigen_documento(rs.getString("origen_documento"));
										BMesaPartesVO.setDestino_documento(rs.getString("destino_documento"));
										BMesaPartesVO.setDesc_origen(rs.getString("desc_origen"));
										BMesaPartesVO.setTipo(rs.getString("tipo"));
										BMesaPartesVO.setRemitente(rs.getString("remitente"));
										
										BMesaPartesVO.setDestinatario(rs.getString("destinatario"));
										//BMesaPartesVO.setCodigo_oficina(rs.getString("codigo_oficina"));
										BMesaPartesVO.setDescripcion_oficina(rs.getString("descripcion_oficina"));
										BMesaPartesVO.setDescripcion_destino(rs.getString("descripcion_destino"));
										BMesaPartesVO.setCodigo_personal(rs.getString("codigo_personal"));
										BMesaPartesVO.setNombre_personal(rs.getString("nombre_personal"));
										BMesaPartesVO.setCorrelativo_deriva(rs.getString("correlativo_deriva"));
										
										String naturaleza_documento=rs.getString("naturaleza_documento");
										ListaMesaPartes.add(BMesaPartesVO);
									}
								ls_ant_codigo_documento=ls_codigo_documento;
				
						}	
			    	 }
						  
					rs.close();
	        			            
	        } catch (SQLException e) {
	             e.printStackTrace();
	        }
	        return ListaMesaPartes;
		                
		}

	public String obtenerNombreArchivo(Connection cnx, String ls_id_det_upload,
			String ls_codigo_documento) {
			PreparedStatement pstmt = null;
			ResultSet rs = null;
			String nombre_archivo="";
		try {
			
			log.info("Selecting nombre de archivo ...");
			String selectSQL = "SELECT nombre_archivo  FROM tramite.tbl_det_upload WHERE codigo_documento=? AND id_det_upload=?";
			pstmt = cnx.prepareStatement(selectSQL);
			pstmt.setInt(1, Integer.parseInt(ls_codigo_documento));
			pstmt.setInt(2, Integer.parseInt(ls_id_det_upload));
			
			rs = pstmt.executeQuery();
			
			// iterate the ResultSet object, and get all the data
			while (rs.next()) {
			nombre_archivo = rs.getString(1);			
			}
			
			
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			log.fatal("Error!!! ... " + e.getMessage());
			e.printStackTrace();
		}
		finally {
			// close ResultSet, PreparedStatement, and Connection objects
			try {
				rs.close();
				pstmt.close();
				//cnx.close();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				log.fatal("Error!!! ... " + e.getMessage());
				e.printStackTrace();
			}
			
			}
		
		// TODO Auto-generated method stub
		return nombre_archivo;
	}
	@Override
	/*
	 * Descripcion: permite obtener el correo electronico de un usuario del sistema
	 * */
	public HashMap<String, String> obtenerDatosUsuario(String destinatario) {
		String correo_electronico="";
		ObtieneConexion 	x= new ObtieneConexion();
		Connection			con= x.getConnection();
		PreparedStatement pstmt = null;
		ResultSet rs = null;
		HashMap<String, String> h = new HashMap<String, String>();
		String ls_sql="SELECT email,c_usuario,nombre_personal  FROM tramite.personal P, tramite.usuarios U WHERE P.c_usuario=U.usuario AND P.codigo_personal=?";
		try {
			
			pstmt = con.prepareStatement(ls_sql); // create a statement
			pstmt.setInt(1, Integer.parseInt(destinatario));
			rs = pstmt.executeQuery();
			
			while (rs.next()) { 
				
				h.put("email", rs.getString(1));
				h.put("nombre_personal", rs.getString(3));
				h.put("c_usuario", rs.getString(2));
				
				correo_electronico = rs.getString(1);
                String usuario = rs.getString(2);                
                log.info(usuario +"\t"+ correo_electronico) ;
                      
            }
			
		}
		catch (Exception e) {
			// TODO: handle exception
		}
		finally {
			// close ResultSet, PreparedStatement, and Connection objects
			try {
				x.cerrar_conexion(con, rs);
				pstmt.close();
			
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				log.fatal("Error!!! ... " + e.getMessage());
				e.printStackTrace();
			}
			
			}
		return h;
	}
	@Override
	public ArrayList<String> obtenerDatosUsuario(
			ArrayList<String> myListaCodigoPersonal) {
		ArrayList<String> myListaCorreos = new ArrayList<String>();
		String cadenaCodigos="";
		for (String string : myListaCodigoPersonal) {
			cadenaCodigos=cadenaCodigos+","+string;
		}
		cadenaCodigos=cadenaCodigos.substring(1);
		log.info("cadenaCodigos:"+cadenaCodigos);
		
		
		ObtieneConexion 	x= new ObtieneConexion();
		Connection			con= x.getConnection();
		Statement stmt = null;
		ResultSet rs = null;
		
		String ls_sql=" SELECT email,c_usuario,nombre_personal  FROM tramite.personal P, tramite.usuarios U WHERE P.c_usuario=U.usuario AND P.codigo_personal in ("+cadenaCodigos+")";
		log.info("ls_sql:"+ls_sql);
		try {
			
			stmt = con.createStatement();			
			rs = stmt.executeQuery(ls_sql);
			
			while (rs.next()) {	
				String email=rs.getString(1);				
				myListaCorreos.add(email);				
                String usuario = rs.getString(2);                
                log.info(usuario +"\t"+ email) ;                      
            }
			
		}
		catch (IndexOutOfBoundsException e) {
			log.fatal("Error!!! ... " + e.getMessage());
		}
		catch (Exception e) {
			log.fatal("Error!!! ... " + e.getMessage());
		}
		finally {
			// close ResultSet, PreparedStatement, and Connection objects
			try {
				rs.close();
				stmt.close();
				con.close();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				log.fatal("Error!!! ... " + e.getMessage());
				e.printStackTrace();
			}
			
			}
		log.info("tamanio myListaCorreos:" +myListaCorreos.size());
		return myListaCorreos;
		
	}
	 
	private int compararFechasConDate(String fecha1, String fechaActual) {  
		  log.info("Parametro String Fecha 1 = "+fecha1);
		  log.info("Parametro String fechaActual = "+fechaActual);  
		  int resultado=4; //error
		  try {
		   /**Obtenemos las fechas enviadas en el formato a comparar*/
		   SimpleDateFormat formateador = new SimpleDateFormat("dd/MM/yyyy"); 
		   Date fechaDate1 = formateador.parse(fecha1);
		   Date fechaDate2 = formateador.parse(fechaActual);
		    
		  /** System.out.println("Parametro Date Fecha 1 = "+fechaDate1+"\n" +
		     "Parametro Date fechaActual = "+fechaDate2+"\n");**/
		    
		    if ( fechaDate1.before(fechaDate2) ){
		    resultado= 3; //"La Fecha 1 es menor ";
		    }else{
		     if ( fechaDate2.before(fechaDate1) ){
		      resultado=1; // "La Fecha 1 es Mayor ";
		     }else{
		      resultado=2; // "Las Fechas Son iguales ";
		     } 
		    }
		  } catch (ParseException e) {
		   System.out.println("Se Produjo un Error!!!  "+e.getMessage());
		  }  
		  return resultado;
		 }

	@Override
	public String codigo_oficina(String ls_codigo_oficina) throws Exception {
		ObtieneConexion  x= new ObtieneConexion();
		Connection	con= x.getConnection();
		ResultSet rs = null;
		PreparedStatement pstmt = null;
        int resultado=1;
		
        try {	
        	
        	String ls_sql = "select padre from tramite.oficinas where codigo_oficina="+ls_codigo_oficina;
        		        		        	
        	pstmt = con.prepareStatement(ls_sql);
        	
        	//log.info("sql-> "+pstmt);
        	rs=pstmt.executeQuery();
    		
			while ( rs.next() ) { 
									
				resultado=rs.getInt("padre");
				
			}	
            
			x.cerrar_conexion(con,rs);
			pstmt.close();
			
            
        } catch (SQLException e) {
        	x.cerrar_conexion(con);
             e.printStackTrace();
        }
        return String.valueOf(resultado);
	}

	@Override
	public void registrar_conexion(String usuario) throws Exception {
		Statement us  = null;
		
    	String ls_sql = "";
    	String host=InetAddress.getLocalHost().getHostName();
    	String ip=InetAddress.getLocalHost().getHostAddress();;
    	String fecha_ing="";
    	ObtieneConexion 	x= new ObtieneConexion();
		Connection			con= x.getConnection();
		
    	try{
		    	 ls_sql = "insert into tramite.aud_accesos(usuario,host,ip) values('"+usuario+ "','"+host+ "','"+ip+"')";
		    	 log.info("Query conexion : " + ls_sql  );	
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);
    		
		    	 x.cerrar_conexion(con);
		    	 us.close();
    	}
    	catch(Exception e){
    		log.info("error en el Servlet : " + e.getMessage()  );	
    		x.cerrar_conexion(con);
    	}
		
	}

	public Collection lista_conexion(Connection cnx, String fecha_in,String fecha_fin){
			
			Collection lista = new ArrayList();
	
	AConexion AConexioV = null;

	PreparedStatement pstmt = null;
	ResultSet rs = null;
	
	Connection conn = null;
	ObtieneConexion obt=new ObtieneConexion();
	
    try {	
    		
    	/*StringBuilder ls_sql = new StringBuilder("select du.id_det_upload,du.nombre_archivo,du.estado_documento,ofi.siglas_oficina "); 
    	ls_sql.append(" from tramite.tbl_det_upload du left join tramite.oficinas ofi on du.codigo_oficina = ofi.codigo_oficina "); 
    	ls_sql.append(" where  du.codigo_documento=?  and du.flag = 'I' and du.tipo = 'P' order by du.id_det_upload asc");*/
    	
    	StringBuilder ls_sql = new StringBuilder("select au.usuario,nombres,apellidos,fecha_ing,host,ip from tramite.aud_accesos au inner join tramite.usuarios usu on usu.usuario=au.usuario ");
    	
    	conn = obt.getConnection();
		pstmt = conn.prepareStatement(ls_sql.toString());
		

		log.info(pstmt);
		rs = pstmt.executeQuery();
		int contador=0;
		
		while ( rs.next() ) { 
			contador++;
			
			AConexioV = new AConexion();
			AConexioV.setContador(contador);
			AConexioV.setUsuario(rs.getString("usuario"));
			AConexioV.setFecha_conexion(rs.getTimestamp("fecha_ing"));
			AConexioV.setNombres(rs.getString("nombres"));
			AConexioV.setApellidos(rs.getString("apellidos"));
			AConexioV.setHost(rs.getString("host"));
			AConexioV.setIp(rs.getString("ip"));
			
			
			lista.add(AConexioV);
			
		}	
        
		obt.cerrar_conexion(conn, rs);
		pstmt.close();

        
    } catch (SQLException sqle) {
    	log.info("Error en el metodo lista_upload_documentos_detalle");
		//mensaje=sqle.toString();  
		sqle.printStackTrace();
		obt.cerrar_conexion(conn);
    }
    return lista;
	}

	@Override
	public void actualizar_detalle_documento(String id_detalle)
			throws Exception {
Statement us  = null;
int idd = Integer.parseInt(id_detalle);
    	String ls_sql = "";
    	String host=InetAddress.getLocalHost().getHostName();
    	String ip=InetAddress.getLocalHost().getHostAddress();;
    	String fecha_ing="";
    	ObtieneConexion 	x= new ObtieneConexion();
		Connection			con= x.getConnection();
		
    	try{
		    	 ls_sql = "update tramite.tbl_det_upload set flag='A' where id_det_upload= "+idd;
		    	 log.info("Query conexion : " + ls_sql  );	
		    	 us = con.createStatement();
		    	 us.executeUpdate(ls_sql);
    		
		    	 x.cerrar_conexion(con);
		    	 us.close();
    	}
    	catch(Exception e){
    		log.info("error en el Servlet : " + e.getMessage()  );	
    		x.cerrar_conexion(con);
    	}
		
	}
}
